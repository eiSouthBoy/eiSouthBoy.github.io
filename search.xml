<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Rust Program Language</title>
    <url>/2024/12/14/2024/Rust/</url>
    <content><![CDATA[<p><a href="https://kaisery.github.io/trpl-zh-cn/">ã€ŠRust ç¨‹åºè®¾è®¡è¯­è¨€ã€‹ ç®€ä½“ä¸­æ–‡ç‰ˆ</a></p>
<p><a href="https://doc.rust-lang.org/stable/book/#the-rust-programming-language">ã€ŠThe Rust Programming Languageã€‹è‹±æ–‡ç‰ˆ</a></p>
<p>ç†Ÿæ‚‰å…³äºRustå•è¯ï¼š</p>
<ul>
<li>Rustaceanï¼šRustç¼–ç¨‹è¯­è¨€çš„ç”¨æˆ·æˆ–å¼€å‘è€…ã€‚</li>
</ul>
<p>ä»€ä¹ˆé€‰æ‹© Rustï¼Ÿ</p>
<ul>
<li><p>é«˜æ€§èƒ½</p>
<p>Rust é€Ÿåº¦æƒŠäººä¸”<strong>å†…å­˜</strong>åˆ©ç”¨ç‡æé«˜ã€‚ç”±äºæ²¡æœ‰è¿è¡Œæ—¶å’Œåƒåœ¾å›æ”¶ï¼Œå®ƒèƒ½å¤Ÿèƒœä»»å¯¹æ€§èƒ½è¦æ±‚ç‰¹åˆ«é«˜çš„æœåŠ¡ï¼Œå¯ä»¥åœ¨<strong>åµŒå…¥å¼è®¾å¤‡</strong>ä¸Šè¿è¡Œï¼Œè¿˜èƒ½è½»æ¾å’Œå…¶ä»–è¯­è¨€é›†æˆã€‚</p>
</li>
<li><p>å¯é æ€§</p>
<p>Rust ä¸°å¯Œçš„ç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒæ¨¡å‹ä¿è¯äº†<strong>å†…å­˜å®‰å…¨</strong>å’Œ<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œè®©æ‚¨åœ¨ç¼–è¯‘æœŸå°±èƒ½å¤Ÿæ¶ˆé™¤å„ç§å„æ ·çš„é”™è¯¯ã€‚</p>
</li>
<li><p>ç”Ÿäº§åŠ›</p>
<p>Rust æ‹¥æœ‰å‡ºè‰²çš„æ–‡æ¡£ã€å‹å¥½çš„ç¼–è¯‘å™¨å’Œæ¸…æ™°çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼Œ è¿˜é›†æˆäº†ä¸€æµçš„å·¥å…·â€”â€”åŒ…ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·ï¼Œ æ™ºèƒ½åœ°è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€éªŒçš„å¤šç¼–è¾‘å™¨æ”¯æŒï¼Œ ä»¥åŠè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ç­‰ç­‰ã€‚</p>
</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/Rust">Rust</a> çš„å†å²ï¼Ÿ</p>
<p>Rustè¯­è¨€åŸæœ¬æ˜¯ <a href="https://zh.wikipedia.org/wiki/Mozilla">Mozilla</a> å‘˜å·¥ <code>Graydon Hoare</code> çš„ä¸ªäººé¡¹ç›®ï¼Œè€Œ Mozilla äº2009å¹´å¼€å§‹èµåŠ©è¿™ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”åœ¨2010å¹´é¦–æ¬¡å…¬å¼€ã€‚ä¹Ÿåœ¨åŒä¸€å¹´ï¼Œå…¶ç¼–è¯‘å™¨æºä»£ç å¼€å§‹ç”±åŸæœ¬çš„<a href="https://zh.wikipedia.org/wiki/OCaml">OCamlè¯­è¨€</a>è½¬ç§»åˆ°ç”¨Rustè¯­è¨€ï¼Œè¿›è¡Œè‡ªæˆ‘ç¼–è¯‘å·¥ä½œï¼Œç§°åšâ€œrustcâ€ï¼Œå¹¶äº2011å¹´å®é™…å®Œæˆã€‚è¿™ä¸ªå¯è‡ªæˆ‘ç¼–è¯‘çš„ç¼–è¯‘å™¨åœ¨æ¶æ„ä¸Šé‡‡ç”¨äº†<a href="https://zh.wikipedia.org/wiki/LLVM">LLVM</a>åšä¸ºå®ƒçš„åç«¯ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæœ‰ç‰ˆæœ¬å·çš„Rustç¼–è¯‘å™¨äº2012å¹´1æœˆå‘å¸ƒã€‚<em><strong>Rust 1.0æ˜¯ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ï¼Œäº2015å¹´5æœˆ15æ—¥å‘å¸ƒ</strong></em>ã€‚</p>
<p><strong>Rust å¼€å‘å·¥å…·</strong>ï¼š</p>
<ul>
<li><em>Cargo</em> æ˜¯å†…ç½®çš„ä¾èµ–ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·ï¼Œå®ƒèƒ½è½»æ¾å¢åŠ ã€ç¼–è¯‘å’Œç®¡ç†ä¾èµ–ï¼Œå¹¶ä½¿ä¾èµ–åœ¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ä¿æŒä¸€è‡´ã€‚</li>
<li><em>Rustfmt</em> æ ¼å¼åŒ–å·¥å…·ç¡®ä¿å¼€å‘è€…éµå¾ªä¸€è‡´çš„ä»£ç é£æ ¼ã€‚</li>
<li><em>rust-analyzer</em> ä¸ºé›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æä¾›äº†å¼ºå¤§çš„ä»£ç è¡¥å…¨å’Œå†…è”é”™è¯¯ä¿¡æ¯åŠŸèƒ½</li>
</ul>
<p><strong>Rust åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å‘½ä»¤è¡Œå·¥å…·</li>
<li>WebæœåŠ¡</li>
<li>DevOpså·¥å…·</li>
<li>åµŒå…¥å¼è®¾å¤‡</li>
<li>éŸ³è§†é¢‘åˆ†æä¸è½¬ç </li>
<li>åŠ å¯†è´§å¸</li>
<li>ç”Ÿç‰©ä¿¡æ¯å­¦</li>
<li>æœç´¢å¼•æ“</li>
<li>ç‰©è”ç½‘ï¼ˆIOTï¼‰ç¨‹åº</li>
<li>æœºå™¨å­¦ä¹ </li>
</ul>
<h2 id="Rust-å®‰è£…"><a href="#Rust-å®‰è£…" class="headerlink" title="Rust å®‰è£…"></a>Rust å®‰è£…</h2><p>é€šè¿‡ <code>rustup</code>  å®‰è£…å®˜æ–¹çš„ç¼–è¯‘å™¨ <code>rustc</code> å’Œ æ„å»ºç³»ç»Ÿå·¥å…·&amp;åŒ…ç®¡ç†å·¥å…· <code>cargo</code>ã€‚</p>
<p>åœ¨ Linux æˆ– macOS çš„å‘½ä»¤è¡Œç»ˆç«¯æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alex@alex-NMH-WCX9:~$ curl --proto &#x27;=https&#x27; --tlsv1.2 https://sh.rustup.rs -sSf | sh</span><br><span class="line">info: downloading installer</span><br><span class="line"></span><br><span class="line">Welcome to Rust!</span><br><span class="line"></span><br><span class="line">This will download and install the official compiler for the Rust</span><br><span class="line">programming language, and its package manager, Cargo.</span><br><span class="line"></span><br><span class="line">Rustup metadata and toolchains will be installed into the Rustup</span><br><span class="line">home directory, located at:</span><br><span class="line"></span><br><span class="line">  /home/alex/.rustup</span><br><span class="line"></span><br><span class="line">This can be modified with the RUSTUP_HOME environment variable.</span><br><span class="line"></span><br><span class="line">The Cargo home directory is located at:</span><br><span class="line"></span><br><span class="line">  /home/alex/.cargo</span><br><span class="line"></span><br><span class="line">This can be modified with the CARGO_HOME environment variable.</span><br><span class="line"></span><br><span class="line">The cargo, rustc, rustup and other commands will be added to</span><br><span class="line">Cargo&#x27;s bin directory, located at:</span><br><span class="line"></span><br><span class="line">  /home/alex/.cargo/bin</span><br><span class="line"></span><br><span class="line">This path will then be added to your PATH environment variable by</span><br><span class="line">modifying the profile files located at:</span><br><span class="line"></span><br><span class="line">  /home/alex/.profile</span><br><span class="line">  /home/alex/.bashrc</span><br><span class="line"></span><br><span class="line">You can uninstall at any time with rustup self uninstall and</span><br><span class="line">these changes will be reverted.</span><br><span class="line"></span><br><span class="line">Current installation options:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   default host triple: x86_64-unknown-linux-gnu</span><br><span class="line">     default toolchain: stable (default)</span><br><span class="line">               profile: default</span><br><span class="line">  modify PATH variable: yes</span><br><span class="line"></span><br><span class="line">1) Proceed with standard installation (default - just press enter)</span><br><span class="line">2) Customize installation</span><br><span class="line">3) Cancel installation</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">info: profile set to &#x27;default&#x27;</span><br><span class="line">info: default host triple is x86_64-unknown-linux-gnu</span><br><span class="line">info: syncing channel updates for &#x27;stable-x86_64-unknown-linux-gnu&#x27;</span><br><span class="line">info: latest update on 2024-11-28, rust version 1.83.0 (90b35a623 2024-11-26)</span><br><span class="line">info: downloading component &#x27;cargo&#x27;</span><br><span class="line">  8.6 MiB /   8.6 MiB (100 %) 140.8 KiB/s in 58s ETA:  0s </span><br><span class="line">info: downloading component &#x27;clippy&#x27;</span><br><span class="line">  2.7 MiB /   2.7 MiB (100 %) 155.8 KiB/s in 17s ETA:  0s</span><br><span class="line">info: downloading component &#x27;rust-docs&#x27;</span><br><span class="line"> 16.4 MiB /  16.4 MiB (100 %) 244.4 KiB/s in  1m 44s ETA:  0s    </span><br><span class="line">info: downloading component &#x27;rust-std&#x27;</span><br><span class="line"> 26.1 MiB /  26.1 MiB (100 %) 146.2 KiB/s in  4m  0s ETA:  0s    </span><br><span class="line">info: downloading component &#x27;rustc&#x27;</span><br><span class="line"> 69.3 MiB /  69.3 MiB (100 %) 134.4 KiB/s in 11m 10s ETA:  0s    </span><br><span class="line">info: downloading component &#x27;rustfmt&#x27;</span><br><span class="line">  2.4 MiB /   2.4 MiB (100 %) 150.4 KiB/s in 22s ETA:  0s</span><br><span class="line">info: installing component &#x27;cargo&#x27;</span><br><span class="line">info: installing component &#x27;clippy&#x27;</span><br><span class="line">info: installing component &#x27;rust-docs&#x27;</span><br><span class="line"> 16.4 MiB /  16.4 MiB (100 %)  10.9 MiB/s in  1s ETA:  0s</span><br><span class="line">info: installing component &#x27;rust-std&#x27;</span><br><span class="line"> 26.1 MiB /  26.1 MiB (100 %)  16.5 MiB/s in  1s ETA:  0s</span><br><span class="line">info: installing component &#x27;rustc&#x27;</span><br><span class="line"> 69.3 MiB /  69.3 MiB (100 %)  17.9 MiB/s in  3s ETA:  0s</span><br><span class="line">info: installing component &#x27;rustfmt&#x27;</span><br><span class="line">info: default toolchain set to &#x27;stable-x86_64-unknown-linux-gnu&#x27;</span><br><span class="line"></span><br><span class="line">  stable-x86_64-unknown-linux-gnu installed - rustc 1.83.0 (90b35a623 2024-11-26)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Rust is installed now. Great!</span><br><span class="line"></span><br><span class="line">To get started you may need to restart your current shell.</span><br><span class="line">This would reload your PATH environment variable to include</span><br><span class="line">Cargo&#x27;s bin directory ($HOME/.cargo/bin).</span><br><span class="line"></span><br><span class="line">To configure your current shell, you need to source</span><br><span class="line">the corresponding env file under $HOME/.cargo.</span><br><span class="line"></span><br><span class="line">This is usually done by running one of the following (note the leading DOT):</span><br><span class="line">. &quot;$HOME/.cargo/env&quot;            # For sh/bash/zsh/ash/dash/pdksh</span><br><span class="line">source &quot;$HOME/.cargo/env.fish&quot;  # For fish</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆï¼Œé‡å¯å½“å‰çš„ Terminal ï¼Œæ£€æŸ¥ rustc ç‰ˆæœ¬ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ rustc --version</span><br><span class="line">rustc 1.83.0 (90b35a623 2024-11-26)</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ£€æŸ¥ cargo ç‰ˆæœ¬ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cargo --verison</span><br><span class="line">cargo 1.83.0 (5ffbef321 2024-10-29)</span><br></pre></td></tr></table></figure>



<h2 id="VSCode-Rustæ’ä»¶"><a href="#VSCode-Rustæ’ä»¶" class="headerlink" title="VSCode Rustæ’ä»¶"></a>VSCode Rustæ’ä»¶</h2><ul>
<li><p><strong>rust-analyzer</strong>ï¼šå®æ—¶ç¼–è¯‘å’Œåˆ†æ Rust ä»£ç ï¼Œæç¤ºä»£ç ä¸­çš„é”™è¯¯ï¼Œè¿˜å¯ä»¥ä»£ç è·³è½¬ï¼Œå¹¶å¯¹ç±»å‹è¿›è¡Œæ ‡å‡†ã€‚</p>
</li>
<li><p><strong>Even Better TOML</strong>ï¼šæ”¯æŒ .toml æ–‡ä»¶è¯­æ³•é«˜äº®</p>
</li>
<li><p>Error Lensï¼šæ”¯æŒè·å¾—é”™è¯¯æç¤º</p>
</li>
<li><p>CodeLLDBï¼šæ”¯æŒ Debugger ç¨‹åº</p>
</li>
<li><p>Rust Syntaxï¼šæ”¯æŒ Rust è¯­æ³•é«˜äº®</p>
</li>
<li><p><strong>Git Graph</strong>ï¼šæ”¯æŒ Git ä»¥å›¾å½¢åŒ–æ˜¾ç¤ºï¼Œè¿˜æ˜¯å¯ä»¥è¿›è¡Œé€šè¿‡UIæ‰§è¡Œ git å‘½ä»¤</p>
</li>
</ul>
<h2 id="Rust-è¯­æ³•"><a href="#Rust-è¯­æ³•" class="headerlink" title="Rust è¯­æ³•"></a>Rust è¯­æ³•</h2><p>ä½†å‡¡ç¼–ç¨‹è¯­è¨€ï¼ŒåŸºæœ¬éƒ½ä¼šæœ‰ä¸€ä¸ªå…±æ€§ï¼šæ•°æ®ã€æ•°æ®ç±»å‹ã€å…³é”®å­—ã€åˆ†æ”¯ç»“æ„ã€å¾ªç¯ç»“æ„ã€å‡½æ•°ã€‚</p>
<h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><h4 id="å˜é‡å’Œå¸¸é‡"><a href="#å˜é‡å’Œå¸¸é‡" class="headerlink" title="å˜é‡å’Œå¸¸é‡"></a>å˜é‡å’Œå¸¸é‡</h4><p>å˜é‡é»˜è®¤æ˜¯ä¸å¯æ”¹å˜çš„ï¼ˆimmutableï¼‰ã€‚</p>
<p>å¸¸é‡ï¼ˆconstantsï¼‰æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåç§°çš„ã€ä¸å…è®¸æ”¹å˜çš„å€¼ï¼Œä¸è¿‡å¸¸é‡ä¸å˜é‡è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ã€‚</p>
<ul>
<li>å£°æ˜å¸¸é‡ä½¿ç”¨ <code>const</code> å…³é”®å­—ï¼Œä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ <code>mut</code>ï¼Œå¹¶ä¸” å¿…é¡» æ³¨æ˜å€¼çš„ç±»å‹ã€‚</li>
<li>å¸¸é‡ä¸å…‰é»˜è®¤ä¸å¯å˜ï¼Œå®ƒæ€»æ˜¯ä¸å¯å˜ã€‚</li>
<li>å¸¸é‡ åªèƒ½ è¢«è®¾ç½®ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œè€Œä¸å¯ä»¥æ˜¯å…¶ä»–ä»»ä½• åªèƒ½ åœ¨è¿è¡Œæ—¶è®¡ç®—å‡ºçš„å€¼ã€‚</li>
</ul>
<p>å£°æ˜ä¸€ä¸ªå¸¸é‡çš„ä¾‹å­ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> THREE_HOURS_IN_SECONDS: <span class="type">u32</span> = <span class="number">60</span> * <span class="number">60</span> * <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>Rust å¯¹å¸¸é‡çš„å‘½åçº¦å®šæ˜¯åœ¨å•è¯ä¹‹é—´ä½¿ç”¨å…¨å¤§å†™åŠ ä¸‹åˆ’çº¿ï¼ˆéå¼ºåˆ¶æ€§è¦æ±‚ï¼‰ã€‚</p>
<h4 id="éšè—"><a href="#éšè—" class="headerlink" title="éšè—"></a>éšè—</h4><p>å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡ï¼Œç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ªå˜é‡ éšè—ï¼ˆShadowingï¼‰ äº†ï¼Œä¸ä»…éšè—äº†å˜é‡åç§°ï¼Œè€Œä¸”è¿˜éšè—äº†å˜é‡ç±»å‹ã€‚è¿™åœ¨Cè¯­è¨€ä¸­æ˜¯ä¸è¢«å…è®¸çš„ï¼Œè€Œä¸”ç¼–è¯‘ä¼šæŠ¥é”™ï¼šé‡å¤å®šä¹‰å˜é‡ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = x * <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;the value of x in the inner scope is: &#123;x&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;the value of x is: &#123;x&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><p>Rust æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨ç¼–è¯‘æ—¶å°±å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚æ ¹æ®å€¼åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œç¼–è¯‘å™¨é€šå¸¸å¯ä»¥æ¨æ–­å‡ºæˆ‘ä»¬æƒ³è¦çš„ç±»å‹ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰æ˜¾ç¤ºè¯´æ˜å…·ä½“ç±»å‹ã€‚</p>
<p>Rust æœ‰ä¸¤ç±»æ•°æ®ç±»å‹å­é›†ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œ å¤åˆï¼ˆcompoundï¼‰ã€‚</p>
<p>æ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å€¼ã€‚Rust æœ‰ 4 ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼š<strong>æ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹ã€å­—ç¬¦ç±»å‹</strong>ã€‚</p>
<h5 id="æ ‡é‡ç±»å‹"><a href="#æ ‡é‡ç±»å‹" class="headerlink" title="æ ‡é‡ç±»å‹"></a>æ ‡é‡ç±»å‹</h5><p>Rust ä¸­çš„<strong>æ•´å‹</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>é•¿åº¦</th>
<th>æœ‰ç¬¦å·</th>
<th>æ— ç¬¦å·</th>
</tr>
</thead>
<tbody><tr>
<td>8 bit</td>
<td>i8</td>
<td>u8</td>
</tr>
<tr>
<td>16 bit</td>
<td>i16</td>
<td>u16</td>
</tr>
<tr>
<td>32 bit</td>
<td>i32</td>
<td>u32</td>
</tr>
<tr>
<td>64 bit</td>
<td>i64</td>
<td>u64</td>
</tr>
<tr>
<td>128 bit</td>
<td>i128</td>
<td>u128</td>
</tr>
<tr>
<td>arch</td>
<td>isize</td>
<td>usize</td>
</tr>
</tbody></table>
<p><em>æ³¨æ„ï¼šisize å’Œ usize ç±»å‹ä¾èµ–è¿è¡Œç¨‹åºçš„è®¡ç®—æœºæ¶æ„ï¼š32ä½æ¶æ„ä¸Šä»–ä»¬æ˜¯32ä½çš„ï¼Œ64ä¸ºæ¶æ„ä¸Šä»–ä»¬æ˜¯64ä½çš„ã€‚</em></p>
<p>Rust æ•´å‹å­—é¢å€¼ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°å­—å­—é¢å€¼</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td>Decimalï¼ˆåè¿›åˆ¶ï¼‰</td>
<td>98_222</td>
</tr>
<tr>
<td>Hexï¼ˆåå…­è¿›åˆ¶ï¼‰</td>
<td>0xff</td>
</tr>
<tr>
<td>Octalï¼ˆå…«è¿›åˆ¶ï¼‰</td>
<td>0o77</td>
</tr>
<tr>
<td>Binaryï¼ˆäºŒè¿›åˆ¶ï¼‰</td>
<td>0b1111_0000</td>
</tr>
<tr>
<td>Byteï¼ˆå•å­—èŠ‚å­—ç¬¦ï¼Œä»…é™äºu8ï¼‰</td>
<td>bâ€™Aâ€™</td>
</tr>
</tbody></table>
<p>å¦‚æœæ²¡æœ‰æ˜¾ç¤ºå®šä¹‰æ•°å­—ç±»å‹ï¼ŒRust çš„é»˜è®¤æ•´å‹ç±»å‹é€šå¸¸æ˜¯ i32ã€‚</p>
<p>Rust çš„<strong>æµ®ç‚¹æ•°ç±»å‹</strong>æ˜¯ f32 å’Œ f64ï¼Œé»˜è®¤æµ®ç‚¹æ•°ç±»å‹æ˜¯ f64ï¼Œæ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹éƒ½æ˜¯æœ‰ç¬¦å·çš„ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">2.0</span>; <span class="comment">// f64</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">f32</span> = <span class="number">3.0</span>; <span class="comment">// f32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Rust çš„<strong>å¸ƒå°”ç±»å‹</strong>ï¼štrue å’Œ falseã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">bool</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Rust çš„<strong>å­—ç¬¦ç±»å‹</strong>ï¼šcharï¼Œchar ç±»å‹çš„å¤§å°ä¸ºå››å­—èŠ‚ï¼Œå¹¶ä»£è¡¨äº†ä¸€ä¸ª Unicode æ ‡é‡å€¼ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ¯” ASCII è¡¨ç¤ºæ›´å¤šå†…å®¹ã€‚åœ¨ Rust ä¸­ï¼Œå¸¦å˜éŸ³ç¬¦å·çš„å­—æ¯ï¼Œä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰å­—ç¬¦ï¼Œemoji ï¼ˆç»˜æ–‡å­—ï¼‰ä»¥åŠé›¶é•¿åº¦çš„ç©ºè¡¨å­—ç¬¦éƒ½æ˜¯æœ‰æ•ˆçš„ char å€¼ã€‚</p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œä¸€å®šæŠŠCè¯­è¨€ä¸­çš„char ç±»å‹åŒºåˆ†å¼€æ¥ï¼ŒCè¯­è¨€ä¸­char ç±»å‹åªæœ‰1ä¸ªå­—èŠ‚ã€‚</em></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="string">&#x27;z&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span>: <span class="type">char</span> = <span class="string">&#x27;Z&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">heart_eyed_cat</span> = &#x27;ğŸ˜»&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="å¤åˆç±»å‹"><a href="#å¤åˆç±»å‹" class="headerlink" title="å¤åˆç±»å‹"></a>å¤åˆç±»å‹</h5><p>å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œ æ•°ç»„ï¼ˆarrayï¼‰ã€‚</p>
<p>å…ƒç»„æ˜¯ä¸€ä¸ªå°†å¤šä¸ªå…¶ä»–æ•°æ®ç±»å‹çš„å€¼ç»„åˆåˆ°ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ã€‚å…ƒç»„é•¿åº¦å›ºå®šï¼šä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢åŠ æˆ–å‡å°ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…ƒç»„è§£æ„ æ–¹å¼1</span></span><br><span class="line">    <span class="keyword">let</span> (x, y, z) = tup;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x is: &#123;x&#125;, y is: &#123;y&#125;, z is: &#123;z&#125;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…ƒç»„è§£æ„ æ–¹å¼2</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">one</span> = tup.<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">two</span> = tup.<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">three</span> = tup.<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;one is: &#123;one&#125;, two is: &#123;two&#125;, three is: &#123;three&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ•°ç»„æ˜¯å°†å¤šä¸ªç›¸åŒæ•°æ®ç±»å‹ç»„åˆåˆ°ä¸€èµ·ã€‚Rust ä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span> ,<span class="number">2</span> <span class="number">3</span>, <span class="number">4</span> ,<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">months</span> = [<span class="string">&quot;January&quot;</span>, <span class="string">&quot;February&quot;</span>, <span class="string">&quot;March&quot;</span>, <span class="string">&quot;April&quot;</span>, <span class="string">&quot;May&quot;</span>, <span class="string">&quot;June&quot;</span>, <span class="string">&quot;July&quot;</span>,</span><br><span class="line">              <span class="string">&quot;August&quot;</span>, <span class="string">&quot;September&quot;</span>, <span class="string">&quot;October&quot;</span>, <span class="string">&quot;November&quot;</span>, <span class="string">&quot;December&quot;</span>];</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">let</span> <span class="variable">b</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]; <span class="comment">// æ˜¾ç¤ºå£°æ˜æ•°ç»„ä¸­å…ƒç´ çš„æ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = [<span class="number">3</span>; <span class="number">5</span>]; <span class="comment">// æ•°ç»„cåŒ…å«5ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å€¼éƒ½æ˜¯3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šé€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œç´¢å¼•ä»0å¼€å§‹</em></p>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>Rust ä½¿ç”¨ <code>fn</code> å…³é”®å­—å£°æ˜å‡½æ•°ã€‚Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ <em><strong>snake case</strong></em> è§„èŒƒé£æ ¼ã€‚åœ¨ <em>snake case</em> ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯ <em><strong>å°å†™</strong></em> å¹¶ä½¿ç”¨ <em><strong>ä¸‹åˆ’çº¿</strong></em> åˆ†éš”å•è¯ã€‚</p>
<p>åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ <em><strong>å¿…é¡»</strong></em> å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ä¹è¡Œæ³¨è§£ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨å†ä¹Ÿä¸éœ€è¦ä½ åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹æ³¨æ˜ç±»å‹æ¥æ”¯å‡ºä½ çš„æ„å›¾ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i32</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">i32</span> = <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span>: <span class="type">i32</span> = <span class="title function_ invoke__">sum</span>(x, y);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;x&#125; + &#123;y&#125; == &#123;z&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ±‚ä¸¤ä¸ªæ•´æ•°çš„å’Œ */</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">sum</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šåœ¨Cè¯­è¨€ä¸­ï¼Œsumå‡½æ•°çš„è°ƒç”¨å‡ºç°åœ¨å®šä¹‰ä¹‹å‰æ˜¯ä¸è¢«å…è®¸çš„ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™ã€‚ä½†æ˜¯åœ¨Rust ä¸­ï¼Œè¿™ç§åšæ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</em></p>
<h3 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h3><p>æ§åˆ¶æµä¸€èˆ¬æ˜¯é€šè¿‡ <strong>åˆ†æ”¯ç»“æ„</strong> å’Œ <strong>å¾ªç¯ç»“æ„</strong> å®ç°ã€‚</p>
<h4 id="åˆ†æ”¯ç»“æ„"><a href="#åˆ†æ”¯ç»“æ„" class="headerlink" title="åˆ†æ”¯ç»“æ„"></a>åˆ†æ”¯ç»“æ„</h4><p>Rust ä»£ç ä¸­æœ€å¸¸è§çš„ç”¨æ¥æ§åˆ¶æ‰§è¡Œæµçš„å…³é”®å­—æ˜¯ï¼š<code>if</code> ã€<code>else</code>ã€<code>else if</code></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 4&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 3&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 2&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is not divisible by 4, 3, or 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¾ªç¯ç»“æ„"><a href="#å¾ªç¯ç»“æ„" class="headerlink" title="å¾ªç¯ç»“æ„"></a>å¾ªç¯ç»“æ„</h4><p>Rust æä¾›äº†å¤šç§å¾ªç¯ï¼š<code>loop</code>ã€<code>while</code>ã€<code>for</code>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;again!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨å…³é”®å­— <code>break</code> è·³å‡ºå¾ªç¯ä½“ï¼Œä½¿ç”¨å…³é”®å­— <code>continue</code> è·³è¿‡è¿™ä¸€è½®å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚</p>
<p><strong>ä»å¾ªç¯è¿”å›å€¼</strong>ï¼Œå³ç»“æŸå¾ªç¯ï¼Œç„¶åè¿”å›ä¸€ä¸ªå€¼</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">counter</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">loop</span> &#123;</span><br><span class="line">        counter += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> counter == <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> counter * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The result is &#123;result&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¾ªç¯æ ‡ç­¾</strong>ï¼šåœ¨å¤šä¸ªå¾ªç¯ä¹‹é—´æ¶ˆé™¤æ­§ä¹‰</p>
<p>è¿™ä¸ªåŠŸèƒ½æœ‰ç‚¹åƒCè¯­è¨€ä¸­çš„ <code>goto</code> è·³è½¬åˆ°æŒ‡å®šæ ‡ç­¾åŠŸèƒ½ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">&#x27;counting_up</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remaining</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> remaining == <span class="number">9</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">&#x27;counting_up</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>while å¾ªç¯</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">number</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> number != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        number -= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>for å¾ªç¯</strong></p>
<p>ä½¿ç”¨ for å¾ªç¯éå†æ•°ç»„</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">element</span> <span class="keyword">in</span> a &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;the value is: &#123;element&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ for å¾ªç¯éå†å…ƒç»„</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">number</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">4</span>).<span class="title function_ invoke__">rev</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h3><p>Rust å®šä¹‰ç»“æ„ä½“ï¼Œéœ€è¦ä½¿ç”¨å…³é”®å­— <code>struct</code> å¹¶ä¸ºæ•´ä¸ªç»“æ„ä½“æä¾›ä¸€ä¸ªåå­—ã€‚ </p>
<p>å®šä¹‰ä¸€ä¸ªç”¨æˆ·ç»“æ„ä½“ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;User Info:</span></span><br><span class="line"><span class="string">             username: &#123;&#125;</span></span><br><span class="line"><span class="string">             email: &#123;&#125;</span></span><br><span class="line"><span class="string">             active: &#123;&#125;</span></span><br><span class="line"><span class="string">             sign_in_count: &#123;&#125;&quot;</span>, user1.username, user1.email, </span><br><span class="line">             user1.active, user1.sign_in_count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰ä¸€ä¸ªé•¿æ–¹å½¢ç»“æ„ä½“ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123;</span><br><span class="line">        width: <span class="number">30</span>,</span><br><span class="line">        height: <span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;The area of the rectangle is &#123;&#125; square pixels.&quot;</span>,</span><br><span class="line">        <span class="title function_ invoke__">area</span>(&amp;rect1)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">area</span>(rectangle: &amp;Rectangle) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">    rectangle.width * rectangle.height</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Tasmota</title>
    <url>/2024/12/14/2024/Tasmota/</url>
    <content><![CDATA[<p>äº†è§£åŠå¯¼ä½“è¡Œä¸šå‡ ä¸ªå•è¯ï¼š</p>
<ul>
<li>Vendorï¼ˆä¾›åº”å•†ï¼‰ï¼šä¾›åº”å•†æ˜¯æŒ‡å‘å…¶ä»–ä¼ä¸šæˆ–æ¶ˆè´¹è€…æä¾›äº§å“æˆ–æœåŠ¡çš„ä¸ªäººæˆ–å…¬å¸ã€‚ä»–ä»¬é€šå¸¸è´­ä¹°äº§å“æˆ–åŸææ–™å¹¶è½¬å”®ï¼Œæˆ–æä¾›ç‰¹å®šçš„æœåŠ¡ã€‚</li>
<li>Manufacturerï¼ˆåˆ¶é€ å•†ï¼‰ï¼šåˆ¶é€ å•†æ˜¯æŒ‡åŸææ–™æˆ–ç»„ä»¶ä¸­åˆ¶é€ äº§å“çš„å…¬å¸ã€‚ä»–ä»¬è´Ÿè´£è®¾è®¡ã€ç”Ÿäº§ã€å’Œç»„ä»¶äº§å“ï¼Œå¹¶å°†å…¶æ¨å‘å¸‚åœºã€‚</li>
</ul>
<h2 id="å›ºä»¶ä»‹ç»"><a href="#å›ºä»¶ä»‹ç»" class="headerlink" title="å›ºä»¶ä»‹ç»"></a>å›ºä»¶ä»‹ç»</h2><p><a href="https://tasmota.github.io/docs/">Tasmota</a> æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Open source firmware for ESP devices</p>
<p>é‡Šä¹‰ï¼šTasmotaæ˜¯ESP è®¾å¤‡çš„å¼€æºå›ºä»¶</p>
<p>Total local control with quick setup and updates. Control using MQTT, Web UI, HTTP or serial. Automate using timers, rules or scripts. Integration with home automation solutions. Incredibly expandable and flexible.</p>
<p>é‡Šä¹‰ï¼šé€šè¿‡å¿«é€Ÿè®¾ç½®å’Œæ›´æ–°å®ç°å…¨é¢çš„æœ¬åœ°æ§åˆ¶ã€‚ä½¿ç”¨MQTTã€Web UIã€HTTP æˆ– ä¸²å£è¿›è¡Œæ§åˆ¶ã€‚ä½¿ç”¨å®šæ—¶å™¨ã€è§„åˆ™æˆ–è„šæœ¬å®ç°è‡ªåŠ¨åŒ–ã€‚æ”¯æŒä¸å®¶åº­è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆé›†æˆã€‚ä»¤äººéš¾ä»¥ç½®ä¿¡çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p>
</blockquote>
<p>Tasmota æ˜¯ <a href="https://github.com/arendst">Theo Arends</a> åœ¨ 2016 å¹´ å‘èµ·çš„é’ˆå¯¹ESP 8622è®¾å¤‡çš„å¼€æºé¡¹ç›®ï¼Œéšç€é¡¹ç›®çš„é€æ­¥å®Œå–„ï¼Œå·²ç»é€‚é…äº†ä¹é‘« ESP8266ã€ESP8285ã€ESP32ã€ESP32-S æˆ– ESP32-C3 èŠ¯ç‰‡ï¼Œæœ€æ–°Release ç‰ˆæœ¬æ˜¯ v14.4.0ï¼ŒLicense æ˜¯ GPL-3.0ã€‚</p>
<h2 id="çƒ§å½•æ–¹å¼"><a href="#çƒ§å½•æ–¹å¼" class="headerlink" title="çƒ§å½•æ–¹å¼"></a>çƒ§å½•æ–¹å¼</h2><p>Tasmota å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯¹ESPè®¾å¤‡è¿›è¡Œå›ºä»¶çƒ§å½•ï¼š</p>
<ul>
<li><p>Web</p>
<p>ç›´æ¥ä»ç½‘ç»œæµè§ˆå™¨å°†å›ºä»¶çƒ§å½•è‡³ESPè®¾å¤‡ï¼ˆæœ¬è´¨ä¸Šæ˜¯ç½‘ç»œæµè§ˆå™¨è°ƒç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API">Web Serial API</a>ï¼‰ã€‚</p>
</li>
<li><p>Tasmotizer</p>
<p>ä¸“ä¸ºä¸ Tasmota é…åˆä½¿ç”¨è€Œè®¾è®¡ï¼Œå…·æœ‰æ˜“äºä½¿ç”¨çš„GUI å’Œ esptool.pyã€‚ä¸è¿‡ä»…é€‚ç”¨äº ESP82XXï¼Œä¾‹å¦‚ ESP8266ã€ESP 8285ã€‚</p>
</li>
<li><p>esptool.py</p>
<p>Esptool æ˜¯ Espressif å®˜æ–¹çš„ ESP èŠ¯ç‰‡åˆ·æœºå·¥å…·ã€‚å®ƒéœ€è¦ Pythonï¼Œå¦‚æœä½ æ²¡æœ‰å®‰è£… Python 2.x æˆ– 3.xï¼Œè¯·ä»<a href="https://www.python.org/">https://www.python.org</a>ä¸‹è½½å¹¶å®‰è£…ï¼ˆå»ºè®®å®‰è£… Python 3.xï¼‰ã€‚</p>
<p>å¦‚æœç”µè„‘å·²ç»å®‰è£… Python ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ pip è¿›è¡Œå®‰è£…ï¼Œå‘½ä»¤ï¼š<code>pip install esptool</code></p>
<p>å¦‚æœä¹‹å‰å®‰è£…è¿‡ <code>ESP-IDF</code> ï¼Œé‚£ä¹ˆä¸ç”¨é‡æ–°å®‰è£… esptoolã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alex@alex-NMH-WCX9:~/.espressif/python_env/idf5.2_py3.10_env/bin$ ll</span><br><span class="line">total 376</span><br><span class="line">drwxrwxr-x 3 alex alex  4096  8æœˆ  9 21:22 ./</span><br><span class="line">drwxrwxr-x 5 alex alex  4096  8æœˆ  8 14:21 ../</span><br><span class="line">-rw-r--r-- 1 alex alex  2045  8æœˆ  8 14:20 activate</span><br><span class="line">-rw-r--r-- 1 alex alex   971  8æœˆ  8 14:20 activate.csh</span><br><span class="line">-rw-r--r-- 1 alex alex  2251  8æœˆ  8 14:20 activate.fish</span><br><span class="line">-rw-r--r-- 1 alex alex  9033  8æœˆ  8 14:20 Activate.ps1</span><br><span class="line">-rwxrwxr-x 1 alex alex   258  8æœˆ  8 14:23 alldefconfig*</span><br><span class="line">-rwxrwxr-x 1 alex alex   258  8æœˆ  8 14:23 allmodconfig*</span><br><span class="line">-rwxrwxr-x 1 alex alex   257  8æœˆ  8 14:23 allnoconfig*</span><br><span class="line">-rwxrwxr-x 1 alex alex   258  8æœˆ  8 14:23 allyesconfig*</span><br><span class="line">-rwxrwxr-x 1 alex alex  3867  8æœˆ  8 14:23 bin2hex.py*</span><br><span class="line">-rwxrwxr-x 1 alex alex   279  8æœˆ  8 14:23 compote*</span><br><span class="line">-rwxrwxr-x 1 alex alex 15881  8æœˆ  9 21:22 configure_esp_secure_cert.py*</span><br><span class="line">-rwxrwxr-x 1 alex alex   255  8æœˆ  8 14:23 defconfig*</span><br><span class="line">-rwxrwxr-x 1 alex alex   263  8æœˆ  8 14:23 doesitcache*</span><br><span class="line">-rwxrwxr-x 1 alex alex   278  8æœˆ  8 14:23 esp-coredump*</span><br><span class="line">-rwxrwxr-x 1 alex alex  1224  8æœˆ  8 14:23 espefuse.py*</span><br><span class="line">-rwxrwxr-x 1 alex alex   263  8æœˆ  9 21:22 esp-matter-mfg-tool*</span><br><span class="line">-rwxrwxr-x 1 alex alex 10540  8æœˆ  8 14:23 esp_rfc2217_server.py*</span><br><span class="line">-rwxrwxr-x 1 alex alex  1229  8æœˆ  8 14:23 espsecure.py*</span><br><span class="line">-rwxrwxr-x 1 alex alex  1219  8æœˆ  8 14:23 esptool.py*</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="åˆå§‹é…ç½®"><a href="#åˆå§‹é…ç½®" class="headerlink" title="åˆå§‹é…ç½®"></a>åˆå§‹é…ç½®</h2><p>ESPè®¾å¤‡çƒ§å½• Tasmota å›ºä»¶ï¼Œéœ€è¦è¿›è¡Œä¸€äº›åˆå§‹é…ç½®ï¼Œä¾‹å¦‚ç½‘ç»œé…ç½®ã€‚</p>
<p>Tasmota å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼è¿›è¡Œåˆå§‹é…ç½®ï¼š</p>
<ul>
<li><p>Web</p>
<p>é€šè¿‡ Web  çƒ§å½•å›ºä»¶å®Œæˆåï¼Œå¯ä»¥ç‚¹å‡» â€œä¸‹ä¸€æ­¥â€ï¼Œæ‰«æé™„è¿‘ Wi-Fi ç½‘ç»œï¼Œç”¨æˆ·éœ€è¦é€‰æ‹©ç›®æ ‡ç½‘ç»œå’Œè¾“å…¥å¯†ç è¿›è¡Œè¿æ¥ã€‚</p>
</li>
<li><p>Web UI</p>
<p>ESPè®¾å¤‡çƒ§å½•å›ºä»¶åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ™ºèƒ½ç»ˆç«¯ï¼ˆæ™ºèƒ½æ‰‹æœºã€ç¬”è®°æœ¬ç”µè„‘ã€å¹³æ¿ç”µè„‘ï¼‰æœç´¢åˆ°ESPè®¾å¤‡çš„APçƒ­ç‚¹ï¼ŒAPçƒ­ç‚¹çš„åç§°ï¼š<code>tasmota_XXXXXX-####</code> çš„ Wi-Fi AP ï¼ˆå…¶ä¸­ <code>XXXXXX</code> æ˜¯ä»è®¾å¤‡çš„ MAC åœ°å€æ´¾ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œ<code>####</code>æ˜¯æ•°å­—ï¼‰ã€‚å½“ç”¨æˆ·ä½¿ç”¨æ™ºèƒ½ç»ˆç«¯è¿æ¥ä¸ŠESPè®¾å¤‡çš„APçƒ­ç‚¹åï¼Œå°†ä¼šè‡ªåŠ¨æ‹‰èµ·Web UIï¼Œåœ¨è¿™ä¸ªé¡µé¢ç”¨æˆ·å¯ä»¥å¯¹ESPè®¾å¤‡è¿›è¡Œç½‘ç»œé…ç½®ã€‚</p>
</li>
<li><p>ä¸²å£è°ƒè¯•å·¥å…·</p>
<p>ESPè®¾å¤‡çƒ§å½•å›ºä»¶åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ â€œä¸²å£è°ƒè¯•å·¥å…·â€ å‘ESPè®¾å¤‡å‘é€å‘½ä»¤ï¼Œå¯¹ESPè®¾å¤‡è¿›è¡Œç½‘ç»œé…ç½®ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ putty ï¼ˆé€šè¿‡UIæ“ä½œï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ minicomï¼ˆé€šè¿‡å‘½ä»¤è¡Œæ“ä½œï¼‰ï¼Œæˆ–è€…é€šè¿‡ <code>idf.py -p /dev/ttyUSB0 monitor</code> æ“ä½œï¼ˆå‰ææ˜¯å·²ç»å®‰è£…äº† ESP-IDFï¼Œå¹¶åŠ è½½äº†ç¯å¢ƒï¼‰ã€‚</p>
</li>
</ul>
<h2 id="å›ºä»¶å‡çº§"><a href="#å›ºä»¶å‡çº§" class="headerlink" title="å›ºä»¶å‡çº§"></a>å›ºä»¶å‡çº§</h2><p>éšç€ Tasmota ä¸æ–­å¼€å‘å’Œå®Œå–„ï¼Œæ”¯æŒçš„åŠŸèƒ½è¶Šæ¥è¶Šå¤šã€‚ç”¨æˆ·æƒ³ä½“éªŒæ–°åŠŸèƒ½ï¼Œå°±è¦å‡çº§å›ºä»¶ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>åŸºäº ESP çš„è®¾å¤‡å¯ç”¨å†…å­˜æœ‰é™ã€‚ä¸ºäº†ç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥åˆ·æ–°å›ºä»¶ï¼Œæœ€å¥½å°†æ€»å¤§å°ä¿æŒåœ¨å°½å¯èƒ½å°çš„æ°´å¹³ï¼Œå¹¶ä¸”ç»å¯¹ä¸è¦è¶…è¿‡ 625Kï¼Œä»¥ç¡®ä¿å¯ä»¥è¿›è¡Œ OTA æ›´æ–°ã€‚</p>
</blockquote>
<p>Tasmota å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼è¿›è¡Œå›ºä»¶å‡çº§ï¼š</p>
<ul>
<li><p>Web UI</p>
<p>é€šè¿‡æ— çº¿æ–¹å¼å‡çº§è®¾å¤‡å›ºä»¶ï¼ˆåˆç§° OTAï¼Œ Over The Airï¼‰æ˜¯æœ€æ–¹ä¾¿çš„å‡çº§æ–¹å¼ã€‚</p>
<p>ç”¨æˆ·éœ€è¦å³å¯ä»¥é€‰æ‹© <strong>é€šè¿‡ç½‘ç»œæœåŠ¡å™¨å‡çº§</strong> æˆ–  <strong>é€šè¿‡ä¸Šä¼ æ–‡ä»¶å‡çº§</strong>ã€‚ </p>
</li>
<li><p>å‘½ä»¤</p>
<p>é€šè¿‡MQTTã€Web è¯·æ±‚ ã€ Web UI ä¸­çš„æ§åˆ¶å°ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå‡çº§</p>
</li>
<li><p>ä¸²å£</p>
<p>é€šè¿‡ä¸²å£è¿›è¡Œå‡çº§</p>
</li>
</ul>
<h2 id="å›ºä»¶ä½¿ç”¨"><a href="#å›ºä»¶ä½¿ç”¨" class="headerlink" title="å›ºä»¶ä½¿ç”¨"></a>å›ºä»¶ä½¿ç”¨</h2><p>å¾…è¡¥å……</p>
<h2 id="å›ºä»¶æ„å»º"><a href="#å›ºä»¶æ„å»º" class="headerlink" title="å›ºä»¶æ„å»º"></a>å›ºä»¶æ„å»º</h2><p>è‹¥ç”¨æˆ·æƒ³å¯¹äºå®˜æ–¹ Tasmota ä¸€äº›åŠŸèƒ½è¿›è¡Œé˜‰å‰²æˆ–é¢å¤–é€‚é…ä¸€äº›æ–°åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥ä» <a href="https://github.com/arendst/tasmota">Tasmota Github</a> ä¸Šæ‹‰å–ä»£ç ä»“åº“ï¼Œåœ¨ â€œ<a href="https://zh.wikipedia.org/wiki/PlatformIO">PlatformIO</a>â€œ ä¸­è¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹ï¼Œç„¶åé‡æ–°ç¼–è¯‘ã€‚</p>
<p>å…³äº PlatformIO çš„ç®€å•ä»‹ç»ï¼š</p>
<p>PlatformIO æœ€æ—©ç”±ä¹Œå…‹å…°çš„ <a href="https://www.ikravets.com/about-me">Ivan Kravets</a> åœ¨2014å¹´å‘èµ·å¼€æºé¡¹ç›®ã€‚</p>
<blockquote>
<p>Ivan Kravets åšå®¢ç½‘é¡µå¯¹äº PlatformIOè¯´æ˜ï¼š</p>
<p>åœ¨ 2014 å¹´ï¼Œæˆ‘åˆ›ç«‹äº†<a href="https://platformio.org/">PlatformIOï¼Œ</a>æ—¨åœ¨è§£å†³åµŒå…¥å¼ç³»ç»Ÿè¡Œä¸šçš„å¤šå¹³å°å¼€å‘é—®é¢˜ã€‚æˆ‘ä»¬ç‹¬ç‰¹çš„ç†å¿µèµ‹äºˆåµŒå…¥å¼å¼€å‘äººå‘˜çœŸæ­£çš„è‡ªç”± - äº²è‡ªå†³å®šä½¿ç”¨å“ªç§æ“ä½œç³»ç»Ÿã€é›†æˆå¼€å‘ç¯å¢ƒå’Œç¡¬ä»¶ã€‚ä¸å†å±€é™äºç‰¹å®šçš„åŠå¯¼ä½“å·¥å…·é“¾ã€‚ä¸€ä¸ªå¼€æºç”Ÿæ€ç³»ç»Ÿ - å¤šç§æ¶æ„ã€å¼€å‘å¹³å°å’Œå¤„ç†å™¨ç³»åˆ—ï¼åœ¨ PlatformIOï¼Œæˆ‘ä»¬è®¤ä¸ºåµŒå…¥å¼ç³»ç»Ÿè¡Œä¸šè¿«åˆ‡éœ€è¦é‡å¡‘ã€‚ä¸ä»… IDE å’Œå·¥å…·æ˜¯ä½¿ç”¨ 20 ä¸–çºª 90 å¹´ä»£çš„æŠ€æœ¯æ„å»ºçš„ï¼Œè€Œä¸”åµŒå…¥å¼å·¥ç¨‹å¸ˆçš„å¤æ‚è¦æ±‚ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ç°ä»£æŠ€æœ¯ä»å¤´å¼€å§‹é‡æ–°æ„æƒ³å’Œé‡å»ºåµŒå…¥å¼åŸºç¡€è®¾æ–½çš„æ ¸å¿ƒç»„ä»¶ã€‚æˆ‘ä»¬è‡´åŠ›äºé€šè¿‡å…è´¹ã€å¼€æºå’Œä¸‹ä¸€ä»£ä¸“ä¸šå¼€å‘å·¥å…·æ¥æ”¹å–„å·¥ç¨‹å¸ˆçš„æ—¥å¸¸ç”Ÿæ´»ã€‚</p>
</blockquote>
<p><strong>PlatformIOï¼ˆä¹Ÿç§°PIOï¼‰</strong>æ˜¯ä¸€æ¬¾å¼€æºä¸”è·¨å¹³å°çš„<a href="https://zh.wikipedia.org/wiki/%E5%B5%8C%E5%85%A5%E5%BC%8F">åµŒå…¥å¼</a>ç³»ç»Ÿä¸äº§å“ç¨‹åºçš„å¼€å‘å·¥å…·ï¼Œå¯ç”¨äºå¤šç§åµŒå…¥å¼æ¶æ„ä¸å¹³å°çš„å¼€å‘ã€‚ä¸é€šå¸¸ä¸å‚å•†ç»‘å®šçš„åµŒå…¥å¼å¼€å‘å·¥å…·ä¸åŒï¼ŒPlatformIOæ”¯æŒå¤šç§åµŒå…¥å¼å¹³å°ï¼Œä¾‹å¦‚<a href="https://zh.wikipedia.org/wiki/STM32">STM32</a>ã€<a href="https://zh.wikipedia.org/w/index.php?title=STM8&action=edit&redlink=1">STM8</a>ã€<a href="https://zh.wikipedia.org/wiki/ESP32">ESP32</a>ã€<a href="https://zh.wikipedia.org/w/index.php?title=Amtel_AVR&action=edit&redlink=1">Amtel AVR</a>ã€<a href="https://zh.wikipedia.org/wiki/ESP8266">ESP8266</a>ã€<a href="https://zh.wikipedia.org/wiki/8051">8051</a>ç­‰ã€‚</p>
<p>PlatformIOçš„æ ¸å¿ƒç»„ä»¶æ˜¯ç§°ä¸ºâ€œPIO Coreâ€çš„å‘½ä»¤è¡Œå·¥å…·ï¼ŒåŸºäº<a href="https://zh.wikipedia.org/wiki/Python">Python</a>ç¼–å†™ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹äº<a href="https://zh.wikipedia.org/wiki/%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">é›†æˆå¼€å‘ç¯å¢ƒ</a>ä¸æ–‡æœ¬ç¼–è¾‘å™¨ä½¿ç”¨ã€‚PlatformIOä¹Ÿä¸ºè®¸å¤šé›†æˆå¼€å‘ç¯å¢ƒä¸æ–‡æœ¬ç¼–è¾‘å™¨å¼€å‘äº†æ’ä»¶ï¼ŒåŒ…æ‹¬<a href="https://zh.wikipedia.org/wiki/Atom_(%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8)">Atom</a>ã€<a href="https://zh.wikipedia.org/wiki/Eclipse">Eclipse</a>ã€<a href="https://zh.wikipedia.org/wiki/Emacs">Emacs</a>ã€<a href="https://zh.wikipedia.org/wiki/NetBeans">NetBeans</a>ã€<a href="https://zh.wikipedia.org/wiki/Vim">Vim</a>ã€<a href="https://zh.wikipedia.org/wiki/Visual_Studio">Visual Studio</a>ä¸<a href="https://zh.wikipedia.org/wiki/Visual_Studio_Code">Visual Studio Code</a>ã€‚</p>
<p>PlatformIOæ”¯æŒå•å…ƒæµ‹è¯•ä¸è¿œç¨‹å¼€å‘åŠŸèƒ½ï¼Œè¿˜é™„å¸¦äº†ç®€æ˜“çš„ä¸²å£è°ƒè¯•å·¥å…·ã€‚</p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>Tasmota</tag>
      </tags>
  </entry>
  <entry>
    <title>2.4Gæœ€ä¼˜ä¿¡é“ç®—æ³•</title>
    <url>/2024/12/13/2024/WiFi-Channel-Algorithm/</url>
    <content><![CDATA[<h2 id="é¢‘æ®µ"><a href="#é¢‘æ®µ" class="headerlink" title="é¢‘æ®µ"></a>é¢‘æ®µ</h2><p>IEEE 802.11 ä¸º ISMæä¾›äº† å…æ‰§ç…§ çš„ 2.4G é¢‘æ®µï¼Œé¢‘ç‡èŒƒå›´ï¼š2400 ~ 2483.5 MHzã€‚</p>
<p>2.4GHzä¸ºå„å›½å…±åŒçš„ISMé¢‘æ®µï¼Œå› æ­¤<a href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%BA%BF%E5%B1%80%E5%9F%9F%E7%BD%91">æ— çº¿å±€åŸŸç½‘</a>ï¼ˆIEEE 802.11b&#x2F;IEEE 802.11gï¼‰ã€<a href="https://zh.wikipedia.org/wiki/%E8%93%9D%E7%89%99">è“ç‰™</a>ã€<a href="https://zh.wikipedia.org/wiki/ZigBee">ZigBee</a>ç­‰æ— çº¿ç½‘ç»œï¼Œå‡å¯å·¥ä½œåœ¨2.4GHzé¢‘æ®µä¸Šã€‚</p>
<p>ISMé¢‘æ®µï¼š<strong>I</strong>ndustrial <strong>S</strong>cientific <strong>M</strong>edical Bandï¼ŒISMé¢‘æ®µå°±æ˜¯å„å›½æŒªå‡ºæŸä¸€æ®µé¢‘æ®µä¸»è¦å¼€æ”¾ç»™å·¥ä¸šï¼Œç§‘å­¦å’ŒåŒ»å­¦æœºæ„ä½¿ç”¨ã€‚åº”ç”¨è¿™äº›é¢‘æ®µæ— éœ€è®¸å¯è¯æˆ–è´¹ç”¨ï¼Œåªéœ€è¦éµå®ˆä¸€å®šçš„å‘å°„åŠŸç‡ï¼ˆä¸€èˆ¬ä½äº1Wï¼‰ï¼Œå¹¶ä¸”ä¸è¦å¯¹å…¶å®ƒé¢‘æ®µé€ æˆ<a href="https://zh.wikipedia.org/wiki/%E5%B9%B2%E6%89%B0">å¹²æ‰°</a>å³å¯ã€‚</p>
<h3 id="Wi-Fi-é¢‘æ®µ"><a href="#Wi-Fi-é¢‘æ®µ" class="headerlink" title="Wi-Fi é¢‘æ®µ"></a>Wi-Fi é¢‘æ®µ</h3><p>åœ¨ 802.11 b&#x2F;g&#x2F;n æ¨¡å¼ä¸‹ï¼Œä¿¡é“å¸¦å®½é€šå¸¸ä¸º 20MHzï¼ˆå…¶å®ä¹Ÿæœ‰40MHzï¼‰ï¼Œè€Œä¸”é€šé“ä¹‹é—´é¢„ç•™äº† 2MHz çš„ä¿æŠ¤å¸¦å®½ï¼Œä¿¡é“ä¸­å¿ƒé¢‘ç‡ <code>f=2412+(k-1)*5 MHz, k=1,â€¦,14</code>ã€‚å› æ­¤ï¼Œå½“åŒä¸€æ— çº¿ç©ºåŸŸå†…æœ‰ä¸¤ä¸ªå‘å°„å™¨æ—¶ï¼Œç›¸é‚»ä¿¡é“å°±å¯èƒ½å‘ç”Ÿé¢‘ç‡é‡å ã€‚</p>
<p>é™¤äº† 13 å’Œ 14 ä¿¡é“çš„ä¸­å¿ƒé¢‘ç‡é—´éš”ä¸º 12 MHzï¼Œå…¶ä»–ä¸¤ä¸ªä¿¡é“çš„é—´éš”å‡ä¸º 5 MHzã€‚</p>
<blockquote>
<p>Wi-Fiè®¾å¤‡é€šå¸¸å·¥ä½œåœ¨å›ºå®šçš„æŸä¸ªChannelä¸Šï¼Œå·¥ä½œåœ¨åŒä¸€ä¸ªChannelä¸Šçš„è®¾å¤‡é‡‡ç”¨ç«äº‰çš„æ–¹å¼æ¥ä½¿ç”¨è¯¥Channelã€‚æŸä¸ªWi-Fi Channelé‡Œçš„Wi-Fiä¿¡å·å¯èƒ½æ˜¯æ–­æ–­ç»­ç»­çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ç›´è¢«æŒ¤å çš„ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>ä¿¡é“</th>
<th>é¢‘å®½(MHz)</th>
<th>ä¸­å¿ƒé¢‘ç‡(MHz)</th>
<th>20 MHz</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>20</td>
<td>2412</td>
<td><strong>2402~2422</strong></td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>2417</td>
<td>2407~2427</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>2422</td>
<td>2412~2432</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>2427</td>
<td>2417~2437</td>
</tr>
<tr>
<td>5</td>
<td>20</td>
<td>2432</td>
<td>2422~2442</td>
</tr>
<tr>
<td>6</td>
<td>20</td>
<td>2437</td>
<td><strong>2427~2447</strong></td>
</tr>
<tr>
<td>7</td>
<td>20</td>
<td>2442</td>
<td>2432~2452</td>
</tr>
<tr>
<td>8</td>
<td>20</td>
<td>2447</td>
<td>2437~2457</td>
</tr>
<tr>
<td>9</td>
<td>20</td>
<td>2452</td>
<td>2442~2462</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>2457</td>
<td>2447~2467</td>
</tr>
<tr>
<td>11</td>
<td>20</td>
<td>2462</td>
<td><strong>2452~2472</strong></td>
</tr>
<tr>
<td>12</td>
<td>20</td>
<td>2467</td>
<td>2457~2477</td>
</tr>
<tr>
<td>13</td>
<td>20</td>
<td>2472</td>
<td>2462~2482</td>
</tr>
<tr>
<td>14</td>
<td>20</td>
<td>2484</td>
<td>&#x2F;</td>
</tr>
</tbody></table>
<p>2.4G WiFi ä¿¡é“åˆ†å¸ƒå›¾ï¼ˆå¸¦å®½ï¼š20 MHzï¼‰</p>
<p><img src="/2024/12/13/2024/WiFi-Channel-Algorithm/image-20241213111252424.png" alt="image-20241213111252424"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š1ã€6ã€11ä¿¡é“æ²¡æœ‰é¢‘æ®µé‡å éƒ¨åˆ†ï¼Œå› æ­¤ä¸€èˆ¬æ¨èç”¨æˆ·ä½¿ç”¨è¿™ä¸‰ä¸ªä¿¡é“ã€‚</p>
<h3 id="Zigbee-é¢‘æ®µ"><a href="#Zigbee-é¢‘æ®µ" class="headerlink" title="Zigbee é¢‘æ®µ"></a>Zigbee é¢‘æ®µ</h3><p><strong>ZigBee</strong> æ˜¯ä¸€ç§åŸºäºIEEE 802.15.4 æ ‡å‡†çš„æ— çº¿é€šä¿¡æŠ€æœ¯ï¼Œå…¶å·¥ä½œé¢‘æ®µå’Œä¿¡é“åˆ†é…å¦‚ä¸‹ï¼š</p>
<p><strong>å·¥ä½œé¢‘æ®µ</strong>ï¼š</p>
<ul>
<li><strong>2.4 GHzé¢‘æ®µ</strong>ï¼šè¿™æ˜¯ ZigBee æœ€å¸¸ç”¨ä¸” <em><strong>å…¨çƒé€šç”¨</strong></em> çš„é¢‘æ®µã€‚åœ¨è¿™ä¸ªé¢‘æ®µä¸Šï¼ŒZigBeeå®šä¹‰äº†16ä¸ªç‰©ç†ä¿¡é“(Channel)ï¼Œæ¯ä¸ªä¿¡é“çš„å¸¦å®½ä¸º 5MHzã€‚</li>
<li><strong>868 MHzé¢‘æ®µ</strong>ï¼šä¸»è¦ç”¨äº æ¬§æ´²åœ°åŒºï¼Œè¯¥é¢‘æ®µä»…å®šä¹‰äº†ä¸€ä¸ªç‰©ç†ä¿¡é“ã€‚</li>
<li><strong>915 MHzé¢‘æ®µ</strong>ï¼šä¸»è¦ç”¨äº ç¾å›½ å’Œ ä¸­å›½å°æ¹¾åœ°åŒºï¼Œè¯¥é¢‘æ®µå®šä¹‰äº† 10 ä¸ªç‰©ç†ä¿¡é“ï¼Œæ¯ä¸ªä¿¡é“çš„å¸¦å®½ä¸º 2MHzã€‚</li>
</ul>
<p><strong>å·¥ä½œä¿¡é“</strong>ï¼š</p>
<ul>
<li><strong>2.4 GHzé¢‘æ®µ</strong>ï¼šåœ¨ 2.4GHz é¢‘æ®µä¸­ï¼ŒZigBee ä½¿ç”¨äº† 16 ä¸ªæ— é‡å çš„ä¿¡é“ï¼Œè¿™äº›ä¿¡é“åˆ†åˆ«æ˜¯ Channel 11è‡³Channel 26ï¼Œæ¯ä¸ªä¿¡é“çš„ä¸­å¿ƒé¢‘ç‡é—´éš”ä¸º5MHzã€‚</li>
<li><strong>868 MHzé¢‘æ®µ</strong>ï¼šåœ¨è¿™ä¸ªé¢‘æ®µä¸­ï¼Œåªå®šä¹‰äº†ä¸€ä¸ªä¿¡é“ã€‚</li>
<li><strong>915 MHzé¢‘æ®µ</strong>ï¼šåœ¨è¿™ä¸ªé¢‘æ®µä¸­ï¼Œå®šä¹‰äº† 10 ä¸ªä¿¡é“ï¼Œå…·ä½“ä¸º Channel 1 è‡³ Channel 10ï¼Œæ¯ä¸ªä¿¡é“çš„ä¸­å¿ƒé¢‘ç‡é—´éš”ä¸º2MHzã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>ä¿¡é“</th>
<th>é¢‘å®½(MHz)</th>
<th>ä¸­å¿ƒé¢‘ç‡(MHz)</th>
<th>5 MHz</th>
</tr>
</thead>
<tbody><tr>
<td>11</td>
<td>5</td>
<td>2405</td>
<td>2402.5~2407.5</td>
</tr>
<tr>
<td>12</td>
<td>5</td>
<td>2410</td>
<td>2407.5~2412.5</td>
</tr>
<tr>
<td>13</td>
<td>5</td>
<td>2415</td>
<td>2412.5~2417.5</td>
</tr>
<tr>
<td>14</td>
<td>5</td>
<td>2420</td>
<td><strong>2417.5~2422.5</strong></td>
</tr>
<tr>
<td>15</td>
<td>5</td>
<td>2425</td>
<td><strong>2422.5~2427.5</strong></td>
</tr>
<tr>
<td>16</td>
<td>5</td>
<td>2430</td>
<td>2427.5~2432.5</td>
</tr>
<tr>
<td>17</td>
<td>5</td>
<td>2435</td>
<td>2432.5~2437.5</td>
</tr>
<tr>
<td>18</td>
<td>5</td>
<td>2440</td>
<td>2437.5~2442.5</td>
</tr>
<tr>
<td>19</td>
<td>5</td>
<td>2445</td>
<td><strong>2442.5~2447.5</strong></td>
</tr>
<tr>
<td>20</td>
<td>5</td>
<td>2450</td>
<td><strong>2447.5~2452.5</strong></td>
</tr>
<tr>
<td>21</td>
<td>5</td>
<td>2455</td>
<td>2452.5~2457.5</td>
</tr>
<tr>
<td>22</td>
<td>5</td>
<td>2460</td>
<td>2457.5~2462.5</td>
</tr>
<tr>
<td>23</td>
<td>5</td>
<td>2465</td>
<td>2462.5~2467.5</td>
</tr>
<tr>
<td>24</td>
<td>5</td>
<td>2470</td>
<td>2467.5~2472.5</td>
</tr>
<tr>
<td>25</td>
<td>5</td>
<td>2475</td>
<td><strong>2472.5~2477.5</strong></td>
</tr>
<tr>
<td>26</td>
<td>5</td>
<td>2480</td>
<td>2477.5~2482.5</td>
</tr>
</tbody></table>
<p><em>æ³¨æ„ï¼šä»¥ä¸Šå¸¦å®½æ˜¯5MHzï¼Œä¸”æ²¡æœ‰ä¸ºä¿¡é“æä¾›ä¿æŠ¤å¸¦å®½ã€‚</em></p>
<p><img src="/2024/12/13/2024/WiFi-Channel-Algorithm/image-20241213141631183.png" alt="image-20241213141631183"></p>
<p>åœ¨ç¯å¢ƒä¸­å­˜åœ¨ Wi-Fi çš„æƒ…å†µä¸‹ï¼ŒZigbee å·¥ä½œå°±ä¼šæ”¶åˆ°å¹²æ‰°ã€‚</p>
<h2 id="è“ç‰™é¢‘æ®µ"><a href="#è“ç‰™é¢‘æ®µ" class="headerlink" title="è“ç‰™é¢‘æ®µ"></a>è“ç‰™é¢‘æ®µ</h2><p>åœ¨ç»å…¸è“ç‰™ï¼ˆBR&#x2F;EDRï¼‰ä¸­ï¼ŒISMé¢‘æ®µè¢«åˆ’åˆ†ä¸º79ä¸ª1 MHzå¸¦å®½çš„ä¿¡é“ï¼ˆä»2402 MHzåˆ°2480 MHzï¼‰ï¼Œä¿¡é“ä¸­å¿ƒé¢‘ç‡  <code>f=2402+k MHz, k=0,â€¦,78</code>ã€‚</p>
<p>å¯¹äºè“ç‰™ä½èƒ½è€—ï¼ˆBLE, Bluetooth Low Energyï¼‰æŠ€æœ¯ï¼Œé¢‘æ®µåŒæ ·æ˜¯2.4 GHz ISMé¢‘æ®µï¼Œä½†å®ƒä»…ä½¿ç”¨äº†å…¶ä¸­çš„40ä¸ªä¿¡é“ï¼Œæ¯ä¸ªä¿¡é“çš„å¸¦å®½ä¸º2 MHzï¼Œä¿¡é“ä¸­å¿ƒé¢‘ç‡ <code>f=2402+k*2 MHz, k=0,â€¦,39</code>ã€‚BLEçš„ä¿¡é“åˆ’åˆ†æ˜¯ä¸ºäº†ä¼˜åŒ–åŠŸè€—å’Œæé«˜æ•ˆç‡ï¼ŒåŒæ—¶ä¿æŒä¸ç»å…¸è“ç‰™æŠ€æœ¯çš„å…±å­˜ã€‚å¯¹äºä¿¡é“çš„åˆ†é…å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¹¿æ’­ä¿¡é“ï¼š3ä¸ªï¼Œå›ºå®šåœ¨37ã€38ã€39ä¿¡é“</li>
<li>æ•°æ®ä¿¡é“ï¼š37ä¸ªï¼Œè‡ªé€‚åº”è°ƒé¢‘</li>
</ul>
<p>æ— çº¿æ•°æ®ï¼š1Mbpsã€2Mbps</p>
<blockquote>
<p>Bluetoothé‡‡ç”¨çš„æ˜¯è·³é¢‘æŠ€æœ¯ï¼ŒæŒ‰ç…§çº¦å®šå¥½çš„éšæœºåºåˆ—ä»ä¸€ä¸ªChannelä»¥æ¯ç§’1600è·³çš„é¢‘ç‡åˆ°å¦ä¸€ä¸ªChannelã€‚Bluetoothè®¾å¤‡åœ¨å›ºå®šçš„æ—¶é—´é‡Œ(625us)åœ¨ä¸€ä¸ªChannelæ”¶å‘æ•°æ®ï¼Œæ¥ç€è·³åˆ°å¦ä¸€ä¸ªChannelï¼Œè¿™é‡Œå¯èƒ½ä¼šç”¨åˆ°æ‰€æœ‰çš„Bluetooth Channelã€‚<br>æ˜¾ç„¶ï¼Œä»ä¸Šé¢Wi-Fiå’ŒBluetoothçš„æŠ€æœ¯å®ç°æ¥çœ‹ï¼Œç›¸é‚»çš„Wi-Fiå’ŒBluetoothè®¾å¤‡æœ‰å¯èƒ½ä¼šå‡ºç°ä¿¡å·é‡å æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´å¯èƒ½ä¼šå‡ºç°å¹²æ‰°ã€‚<br>ç”±äºBluetoothä½¿ç”¨è·³é¢‘æŠ€æœ¯ï¼Œå®ƒçš„ä¿¡å·å¹¶ä¸ä¼šé•¿æ—¶é—´åœç•™åœ¨æŸä¸ªWi-Fi Channelå†…ï¼Œå› æ­¤è¿™é‡Œçš„ç›¸äº’å½±å“å¹¶ä¸ä¼šæŒç»­å¾ˆä¹…ã€‚<br>å¦å¤–ï¼ŒBluetoothè¿˜æä¾›AFH (Adaptive Frequency Hoppingï¼Œè‡ªé€‚åº”è·³é¢‘)æŠ€æœ¯ï¼Œå½“æŸäº›Bluetooth Channelåœ¨ä¸€å®šæ—¶é—´å†…å—åˆ°çš„å¹²æ‰°æ¯”è¾ƒä¸¥é‡æ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠŠè¿™äº›Channelå‰”å‡ºè·³é¢‘åºåˆ—ã€‚</p>
</blockquote>
<h2 id="ä¿¡é“é€‰æ‹©ç®—æ³•"><a href="#ä¿¡é“é€‰æ‹©ç®—æ³•" class="headerlink" title="ä¿¡é“é€‰æ‹©ç®—æ³•"></a>ä¿¡é“é€‰æ‹©ç®—æ³•</h2><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„ä¸€ç‚¹ï¼Œå¸‚é¢ä¸Šæ²¡æœ‰æ‰€è°“çš„ â€œæœ€ä¼˜ä¿¡é“é€‰æ‹©ç®—æ³•æ ‡å‡†â€ï¼Œä¸åŒçš„è·¯ç”±å™¨å‚å®¶å®ç°çš„ç®—æ³•å¯èƒ½ä¸åŒã€‚</p>
<p>è¿™é‡Œä»…å‚è€ƒè°·æ­Œå­¦æœ¯çš„æŠ€æœ¯å‘æ˜ä¸“åˆ©çš„å®ç°ï¼š</p>
<ul>
<li>æ–¹æ³•1ï¼š<a href="https://patents.google.com/patent/CN104507113A/zh">ä¸€ç§æ£€æµ‹å„ä¸ªä¿¡é“wifiä¿¡å·è´¨é‡çš„æ–¹æ³•</a> </li>
<li>æ–¹æ³•2ï¼š<a href="https://patents.google.com/patent/CN103974369B/zh?q=(%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93%E8%AF%84%E5%88%86%E6%9C%BA%E5%88%B6)&oq=%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93%E8%AF%84%E5%88%86%E6%9C%BA%E5%88%B6">ä¸€ç§åŸºäºwlanæ— çº¿ä¿¡é“è¯„åˆ†æœºåˆ¶çš„ä¿¡é“é€‰æ‹©æ–¹æ³•åŠå…¶ç³»ç»Ÿ</a></li>
</ul>
<h3 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h3><p>èƒŒæ™¯æè¿°ï¼šåŒä¸€ä¿¡é“å†…çš„è®¾å¤‡è¶Šå¤šï¼Œå¹²æ‰°è¶Šå¤§ï¼Œç›¸è¿‘ä¸¤ä¸ªä¿¡é“å†…è®¾å¤‡çš„æ•°é‡è¶Šå¤šï¼Œå½±å“æ¯”åŒä¸€ä¿¡é“çš„å½±å“æ¬¡è¦ä¸€äº›ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>æ”¶é›†æŒ‡å®šè·¯ç”±å™¨å‘¨å›´çš„WiFiä¿¡æ¯ï¼ŒWiFiä¿¡æ¯åŒ…æ‹¬æ¯ä¸ªä¿¡é“çš„çƒ­ç‚¹ä¸ªæ•°å’Œä¿¡å·å¼ºåº¦ï¼›</p>
</li>
<li><p>æ ¹æ® <em><strong>å…¬å¼</strong></em> è®¡ç®—æ¯ä¸ªä¿¡é“çš„æ‹¥æŒ¤æŒ‡æ•°ï¼›</p>
</li>
<li><p>å°†æŒ‡å®šè·¯ç”±å™¨ç½®äºæ‹¥æŒ¤æŒ‡æ•°æœ€å°çš„ä¿¡é“ã€‚</p>
</li>
</ol>
<p><em><strong>å…¬å¼</strong></em>ï¼š</p>
<p><img src="/2024/12/13/2024/WiFi-Channel-Algorithm/image-20241213155922492.png" alt="image-20241213155922492"><br>$$<br>{\alpha_n} &#x3D; (200 * {X_n} + 0.2 * {Y_n}) + 1&#x2F;2 (200 * {X_(n-1)} + 0.2 * {Y_(n-1)}) + 1&#x2F;4 (200 * {X_(n-2)} + 0.2 * {Y_(n-2)})<br>$$</p>
<p>$$<br>{\alpha_n} ï¼šä¿¡é“næ‹¥å µæŒ‡æ•°<br>{X_n}ï¼šä¿¡é“nçƒ­ç‚¹ä¸ªæ•°<br>{Y_n}ï¼šä¿¡é“næ‰€æœ‰ä¿¡å·å¼ºåº¦ä¹‹å’Œ<br>$$</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.espressif.com/sites/default/files/documentation/esp8266_wi-fi_channel_selection_guidelines_cn_1.pdf">1ã€ä¹é‘« ESP8266 Wi-Fi ä¿¡é“é€‰æ‹©æŒ‡å—</a></p>
<p><a href="https://en.wikipedia.org/wiki/List_of_WLAN_channels">2ã€List of WLAN channels</a></p>
<p><a href="https://www.metageek.com/training/resources/zigbee-wifi-coexistence/">3ã€ZigBee ä¸ Wi-Fi å…±å­˜</a></p>
<p><a href="https://zh.wikipedia.org/wiki/ISM%E9%A2%91%E6%AE%B5">4ã€ISMé¢‘æ®µ</a></p>
]]></content>
      <categories>
        <category>Wi-Fi</category>
      </categories>
      <tags>
        <tag>WiFi Channel</tag>
      </tags>
  </entry>
  <entry>
    <title>NIZ X87 Tç³»åˆ— ä¸‰æ¨¡é”®ç›˜</title>
    <url>/2024/12/11/2024/NIZ-X87-Keyboard/</url>
    <content><![CDATA[<h2 id="è¯´æ˜ä¹¦"><a href="#è¯´æ˜ä¹¦" class="headerlink" title="è¯´æ˜ä¹¦"></a>è¯´æ˜ä¹¦</h2><p>å›¾ä¸€ï¼š</p>
<p><img src="/2024/12/11/2024/NIZ-X87-Keyboard/NIZ-x87-01.png"></p>
<p>å›¾äºŒï¼š</p>
<p><img src="/2024/12/11/2024/NIZ-X87-Keyboard/NIZ-x87-02.png" alt="NIZ-x87-02"></p>
<h2 id="ç”µæºå¼€å…³"><a href="#ç”µæºå¼€å…³" class="headerlink" title="ç”µæºå¼€å…³"></a>ç”µæºå¼€å…³</h2><p>ESCæŒ‰é”®å³è¾¹çš„ <code>å°åœ†ç‚¹æŒ‰é”®</code> </p>
<h2 id="ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢"><a href="#ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢" class="headerlink" title="ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢"></a>ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢</h2><p>ç»„åˆé”®ï¼š<code>Fn + å·¦Alt</code>ï¼Œå¯ä»¥è¿›è¡Œç³»ç»Ÿæ¨¡å¼åˆ‡æ¢ã€‚</p>
<h2 id="è“ç‰™è¿æ¥"><a href="#è“ç‰™è¿æ¥" class="headerlink" title="è“ç‰™è¿æ¥"></a>è“ç‰™è¿æ¥</h2><p>æ’å…¥USBé€‚é…å™¨åˆ°ç”µè„‘ï¼Œæ‰“å¼€é”®ç›˜ç”µæºï¼Œé•¿æŒ‰ç»„åˆé”®3ç§’ï¼š</p>
<ul>
<li><code>Fn + Del (æŒ‰é”®ä¸Šæœ‰è“ç‰™LOG1)</code>ï¼ŒESCæŒ‰é”®ä¸‹è¾¹ç¬¬ä¸€ä¸ªç¯å˜æˆ <strong>çº¢è‰²</strong>ï¼Œå¹¶æŒç»­å¿«é—ªï¼Œè¯´æ˜è¿›å…¥é…å¯¹çŠ¶æ€ã€‚</li>
<li><code>Fn + End (æŒ‰é”®ä¸Šæœ‰è“ç‰™LOG2)</code>ï¼ŒESCæŒ‰é”®ä¸‹è¾¹ç¬¬ä¸€ä¸ªç¯å˜æˆ <strong>ç»¿è‰²</strong>ï¼Œå¹¶æŒç»­å¿«é—ªï¼Œè¯´æ˜è¿›å…¥é…å¯¹çŠ¶æ€ã€‚</li>
<li><code>Fn + PgDn (æŒ‰é”®ä¸Šæœ‰è“ç‰™LOG3)</code>ï¼ŒESCæŒ‰é”®ä¸‹è¾¹ç¬¬ä¸€ä¸ªç¯å˜æˆ <strong>è“è‰²</strong>ï¼Œå¹¶æŒç»­å¿«é—ªï¼Œè¯´æ˜è¿›å…¥é…å¯¹çŠ¶æ€ã€‚</li>
</ul>
<h2 id="ç”µé‡æŸ¥è¯¢"><a href="#ç”µé‡æŸ¥è¯¢" class="headerlink" title="ç”µé‡æŸ¥è¯¢"></a>ç”µé‡æŸ¥è¯¢</h2><p>åœ¨ä»…æ”¯æŒè“ç‰™è¿æ¥çš„æƒ…å†µä¸‹æŸ¥è¯¢å‰©ä½™ç”µé‡ï¼ŒæŒ‰ä¸‹ç»„åˆé”®ï¼š<code>Fn + T</code>ã€‚å³ä¸Šè§’æŒ‡ç¤ºç¯é—ªçƒï¼Œ3ä¸ªç¯äº®è¯´æ˜æ»¡ç”µã€‚</p>
<h2 id="æ¢å¤å‡ºå‚è®¾ç½®"><a href="#æ¢å¤å‡ºå‚è®¾ç½®" class="headerlink" title="æ¢å¤å‡ºå‚è®¾ç½®"></a>æ¢å¤å‡ºå‚è®¾ç½®</h2><p>ç»„åˆé”®ï¼š<code>ESC + å·¦Ctrl + F12 + å³Ctrl</code></p>
]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>é”®ç›˜</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: rgb and hsv</title>
    <url>/2024/12/09/2024/esp-rgb-and-hsv/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>led control</tag>
        <tag>strip led(RMT or SPI)</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: ota</title>
    <url>/2024/11/30/2024/esp-ota/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>ota</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: ESP-IDF VSCode Configuration</title>
    <url>/2024/11/29/2024/esp-idf-vscode-configuration/</url>
    <content><![CDATA[<p>ç¯å¢ƒä»‹ç»ï¼š</p>
<ul>
<li>VSCodeï¼šv1.92.2</li>
<li>C&#x2F;C++ æ‰©å±•</li>
<li>nRF Kconfig æ‰©å±•</li>
<li>CMake Tools æ‰©å±•</li>
<li>Makefile Tools æ‰©å±•</li>
</ul>
<p>ä¸ºä»€ä¹ˆæˆ‘æ˜æ˜å·²ç»å®‰è£…äº† <code>esp-idf</code> ç¯å¢ƒï¼Œä½†æ˜¯ VSCode æ‰“å¼€å·¥ç¨‹åï¼Œç¼–ç¨‹å´æ²¡æœ‰ <code>esp-idf</code>  å‡½æ•°ã€å˜é‡ã€å®ç­‰ æ™ºèƒ½æç¤ºã€‚ä½†æ˜¯æˆ‘å‘ç°å¯¹äºGNUæ ‡å‡†åº“ <code>glibc</code> ä¸­å¤´æ–‡ä»¶çš„å‡½æ•°å¯ä»¥å‡ºç°æ™ºèƒ½æç¤ºã€‚ä¾‹å¦‚ï¼šstdio.hã€stdlib.hã€time.hã€math.hã€assert.h</p>
<p>VSCode <code>C/C++ æ‰©å±•</code> èƒ½å¤Ÿå¯¹äºGNUæ ‡å‡†åº“çš„æ™ºèƒ½æç¤ºï¼ŒåŸå› æ˜¯ï¼šé»˜è®¤è‡ªåŠ¨åŠ è½½äº†GCCå¤´æ–‡ä»¶è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡å‘½ä»¤æŸ¥è¯¢ GCC çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">$ gcc -E -x c++ - -v &lt; /dev/null</span><br><span class="line">çœç•¥éƒ¨åˆ†...</span><br><span class="line"><span class="comment">#include &quot;...&quot; search starts here:</span></span><br><span class="line"><span class="comment">#include &lt;...&gt; search starts here:</span></span><br><span class="line"> /usr/include/c++/11</span><br><span class="line"> /usr/include/x86_64-linux-gnu/c++/11</span><br><span class="line"> /usr/include/c++/11/backward</span><br><span class="line"> /usr/lib/gcc/x86_64-linux-gnu/11/include</span><br><span class="line"> /usr/local/include</span><br><span class="line"> /usr/include/x86_64-linux-gnu</span><br><span class="line"> /usr/include</span><br><span class="line">End of search list.</span><br><span class="line">çœç•¥éƒ¨åˆ†...</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>/usr/include</code> å°±æ˜¯ GNUæ ‡å‡†åº“çš„Cç›¸å…³å¤´æ–‡ä»¶è·¯å¾„ï¼Œ<code>/usr/include/c++/11</code> å°±æ˜¯GNUæ ‡å‡†åº“çš„C++ç›¸å…³å¤´æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>Cç›¸å…³çš„æ ‡å‡†åº“å¤´æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ caojun@caojun-NMH-WCX9:~$ <span class="built_in">ls</span> /usr/include/</span><br><span class="line"></span><br><span class="line">aio.h         drm                getopt.h                   misc             paths.h             scsi           thread_db.h</span><br><span class="line">aliases.h     elf.h              gio-unix-2.0               mntent.h         pcre2.h             search.h       threads.h</span><br><span class="line">alloca.h      endian.h           GL                         monetary.h       pcre2posix.h        selinux        tic.h</span><br><span class="line">argp.h        envz.h             glib-2.0                   mosquitto.h      pcrecpparg.h        semaphore.h    time.h</span><br><span class="line">argz.h        err.h              glob.h                     mqtt_protocol.h  pcrecpp.h           sepol          tirpc</span><br><span class="line">ar.h          errno.h            gnumake.h                  mqueue.h         pcre.h              setjmp.h       ttyent.h</span><br><span class="line">arpa          error.h            gnu-versions.h             mtd              pcreposix.h         sgtty.h        uchar.h</span><br><span class="line">asm-generic   eti.h              gobject-introspection-1.0  nc_tparm.h       pcre_scanner.h      shadow.h       ucontext.h</span><br><span class="line">assert.h      etip.h             grp.h                      ncurses_dll.h    pcre_stringpiece.h  signal.h       ulimit.h</span><br><span class="line">avahi-client  execinfo.h         gshadow.h                  ncurses.h        pixman-1            sound          unctrl.h</span><br><span class="line">avahi-common  expat_external.h   iconv.h                    ncursesw         pngconf.h           spawn.h        unistd.h</span><br><span class="line">blkid         expat.h            ifaddrs.h                  net              png.h               stab.h         utime.h</span><br><span class="line">brotli        fcntl.h            inttypes.h                 netash           pnglibconf.h        stdc-predef.h  utmp.h</span><br><span class="line">byteswap.h    features.h         iproute2                   netatalk         poll.h              stdint.h       utmpx.h</span><br><span class="line">c++           features-time64.h  langinfo.h                 netax25          printf.h            stdio_ext.h    uuid</span><br><span class="line">cairo         fenv.h             lastlog.h                  netdb.h          proc_service.h      stdio.h        values.h</span><br><span class="line">complex.h     finclude           libgen.h                   neteconet        protocols           stdlib.h       video</span><br><span class="line">cpio.h        FlexLexer.h        libintl.h                  netinet          pthread.h           string.h       wait.h</span><br><span class="line">crypt.h       fmtmsg.h           libmount                   netipx           pty.h               strings.h      wchar.h</span><br><span class="line">ctype.h       fnmatch.h          libpng                     netiucv          pwd.h               sudo_plugin.h  wctype.h</span><br><span class="line">cursesapp.h   fontconfig         libpng16                   netpacket        python3.10          syscall.h      wordexp.h</span><br><span class="line">cursesf.h     form.h             limits.h                   netrom           rdma                sysexits.h     X11</span><br><span class="line">curses.h      freetype2          link.h                     netrose          readline            syslog.h       x86_64-linux-gnu</span><br><span class="line">cursesm.h     fstab.h            linux                      nfs              re_comp.h           tar.h          xcb</span><br><span class="line">cursesp.h     fts.h              locale.h                   nl_types.h       regex.h             termcap.h      xen</span><br><span class="line">cursesw.h     ftw.h              malloc.h                   nss.h            regexp.h            term_entry.h   xorg</span><br><span class="line">cursslk.h     gcalc-2            math.h                     obstack.h        resolv.h            term.h         zconf.h</span><br><span class="line">dbus-1.0      gci-2              mcheck.h                   openssl          rpc                 termio.h       zlib.h</span><br><span class="line">dirent.h      gconv.h            memory.h                   openvpn          rpcsvc              termios.h</span><br><span class="line">dlfcn.h       gdb                menu.h                     panel.h          sched.h             tgmath.h</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>C++æ ‡å‡†åº“ç›¸å…³çš„å¤´æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> /usr/include/c++/11/</span><br><span class="line">algorithm  cfenv      concepts            ctgmath       fenv.h            latch            ostream           span          tr1</span><br><span class="line">any        cfloat     condition_variable  ctime         filesystem        limits           parallel          sstream       tr2</span><br><span class="line">array      charconv   coroutine           cuchar        forward_list      list             pstl              stack         tuple</span><br><span class="line">atomic     chrono     csetjmp             cwchar        fstream           locale           queue             stdexcept     typeindex</span><br><span class="line">backward   cinttypes  csignal             cwctype       functional        map              random            stdlib.h      typeinfo</span><br><span class="line">barrier    ciso646    cstdalign           cxxabi.h      future            math.h           ranges            stop_token    type_traits</span><br><span class="line">bit        climits    cstdarg             debug         initializer_list  memory           ratio             streambuf     unordered_map</span><br><span class="line">bits       clocale    cstdbool            decimal       iomanip           memory_resource  regex             string        unordered_set</span><br><span class="line">bitset     cmath      cstddef             deque         ios               mutex            scoped_allocator  string_view   utility</span><br><span class="line">cassert    codecvt    cstdint             exception     iosfwd            new              semaphore         syncstream    valarray</span><br><span class="line">ccomplex   compare    cstdio              execution     iostream          numbers          <span class="built_in">set</span>               system_error  variant</span><br><span class="line">cctype     complex    cstdlib             experimental  istream           numeric          shared_mutex      tgmath.h      vector</span><br><span class="line">cerrno     complex.h  cstring             ext           iterator          optional         source_location   thread        version</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>å¯¹äº esp-idf ç›¸å…³çš„å¤´æ–‡ä»¶éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œè®©VSCode èƒ½å¤Ÿæ‰¾åˆ° esp-idf çš„å¤´æ–‡ä»¶ã€‚</p>
<p>åœ¨å½“å‰é¡¹ç›®çš„åŒä¸€çº§åˆ›å»º <code>.vscode</code> ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼š  <code>c_cpp_properties.json</code></p>
<ul>
<li><p>settings.json</p>
<p>è¯¥æ–‡ä»¶æ˜¯é»˜è®¤åˆ›å»ºçš„</p>
</li>
<li><p>c_cpp_properties.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESP-IDF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;/home/your_username/esp/esp-idf/components/**&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼š<code>/home/your_username/esp/esp-idf/components/**</code> æ ¹æ® esp-idf å®é™…å®‰è£…è·¯å¾„</em></p>
</li>
</ul>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>ESP-IDF</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: nvs</title>
    <url>/2024/11/28/2024/esp-nvs/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>nvs</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: button component</title>
    <url>/2024/11/26/2024/esp-button-component/</url>
    <content><![CDATA[<h2 id="buttonç»„ä»¶"><a href="#buttonç»„ä»¶" class="headerlink" title="buttonç»„ä»¶"></a>buttonç»„ä»¶</h2><p>ESP æŒ‰é”®ï¼š<a href="https://docs.espressif.com/projects/esp-iot-solution/zh_CN/latest/input_device/button.html">https://docs.espressif.com/projects/esp-iot-solution/zh_CN&#x2F;latest&#x2F;input_device&#x2F;button.html</a></p>
<p>æŒ‰é”®ç»„ä»¶å®ç°äº† GPIO å’Œ ADC ä¸¤ç§æŒ‰é”®ï¼Œå¹¶å…è®¸åŒæ—¶åˆ›å»ºä¸¤ç§ä¸åŒçš„æŒ‰é”®ã€‚</p>
<p><em>æ³¨æ„ï¼š</em></p>
<p>*1ã€GPIO æŒ‰é”®éœ€æ³¨æ„ä¸Šä¸‹æ‹‰é—®é¢˜ï¼Œç»„ä»¶å†…éƒ¨ä¼šå¯ç”¨èŠ¯ç‰‡å†…éƒ¨çš„ä¸Šä¸‹æ‹‰ç”µé˜»ï¼Œä½†æ˜¯åœ¨ä»…æ”¯æŒè¾“å…¥çš„ IO å†…éƒ¨æ²¡æœ‰ç”µé˜»ï¼Œ <strong>éœ€è¦å¤–éƒ¨è¿æ¥</strong>ã€‚*</p>
<p><em>2ã€ADC æŒ‰é”®éœ€æ³¨æ„ç”µå‹ä¸èƒ½è¶…è¿‡ ADC é‡ç¨‹ã€‚</em></p>
<h3 id="æŒ‰é”®äº‹ä»¶"><a href="#æŒ‰é”®äº‹ä»¶" class="headerlink" title="æŒ‰é”®äº‹ä»¶"></a>æŒ‰é”®äº‹ä»¶</h3><p>æ¯ä¸ªæŒ‰é”®æ‹¥æœ‰ä¸‹è¡¨çš„ 8 ä¸ªäº‹ä»¶ï¼š</p>
<table>
<thead>
<tr>
<th>äº‹ä»¶</th>
<th>è§¦å‘æ¡ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td>BUTTON_PRESS_DOWN</td>
<td>æŒ‰ä¸‹</td>
</tr>
<tr>
<td>BUTTON_PRESS_UP</td>
<td>å¼¹èµ·</td>
</tr>
<tr>
<td>BUTTON_PRESS_REPEAT</td>
<td>æŒ‰ä¸‹å¼¹èµ·æ¬¡æ•° &gt;&#x3D; 2æ¬¡</td>
</tr>
<tr>
<td>BUTTON_PRESS_REPEAT_DONE</td>
<td>é‡å¤æŒ‰ä¸‹ç»“æŸ</td>
</tr>
<tr>
<td>BUTTON_SINGLE_CLICK</td>
<td>æŒ‰ä¸‹å¼¹èµ· 1 æ¬¡</td>
</tr>
<tr>
<td>BUTTON_DOUBLE_CLICK</td>
<td>æŒ‰ä¸‹å¼¹èµ· 2 æ¬¡</td>
</tr>
<tr>
<td>BUTTON_MULTIPLE_CLICK</td>
<td>æŒ‡å®šé‡å¤æŒ‰ä¸‹æ¬¡æ•° N æ¬¡ï¼Œè¾¾æˆæ—¶è§¦å‘</td>
</tr>
<tr>
<td>BUTTON_LONG_PRESS_START</td>
<td>æŒ‰ä¸‹æ—¶é—´è¾¾åˆ°é˜ˆå€¼çš„ç¬é—´</td>
</tr>
<tr>
<td>BUTTON_LONG_PRESS_HOLD</td>
<td>é•¿æŒ‰æœŸé—´ä¸€ç›´è§¦å‘</td>
</tr>
<tr>
<td>BUTTON_LONG_PRESS_UP</td>
<td>é•¿æŒ‰å¼¹èµ·</td>
</tr>
<tr>
<td>BUTTON_PRESS_REPEAT_DONE</td>
<td>å¤šæ¬¡æŒ‰ä¸‹å¼¹èµ·ç»“æŸ</td>
</tr>
<tr>
<td>BUTTON_PRESS_END</td>
<td>è¡¨ç¤º button æ­¤æ¬¡æ£€æµ‹å·²ç»“æŸ</td>
</tr>
</tbody></table>
<p><a href="https://components.espressif.com/">espç»„ä»¶ä»“åº“</a>  </p>
<ul>
<li><a href="https://components.espressif.com/components/espressif/button/versions/3.4.0">espressif&#x2F;button</a>ï¼šå½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯v3.4.0</li>
</ul>
<p>å¦‚ä½•å°†buttonç»„ä»¶æ·»åŠ åˆ°ç›®æ ‡é¡¹ç›®ï¼Ÿ</p>
<blockquote>
<p>Please use the component manager command <code>add-dependency</code> to add the <code>button</code> to your projectâ€™s dependency, during the <code>CMake</code> step the component will be downloaded automatically</p>
<p>é‡Šä¹‰ï¼šè¯·ä½¿ç”¨ add-dependency ç»„ä»¶ç®¡ç†å‘½ä»¤å°† button æ·»åŠ åˆ°ç›®æ ‡é¡¹ç›®ä¾èµ–ï¼Œåœ¨æ‰§è¡Œ CMake æ­¥éª¤æ—¶ï¼Œbutton ç»„ä»¶å°†ä¼šè¢«è‡ªåŠ¨ä¸‹è½½åˆ°ç›®æ ‡é¡¹ç›®ã€‚</p>
</blockquote>
<p>ç»„ä»¶ç®¡ç†å‘½ä»¤æ·»åŠ buttonç»„ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ æŒ‡å®šbuttonæœ€æ–°ç‰ˆæœ¬ä¾èµ–</span></span><br><span class="line">idf.py add-dependency <span class="string">&quot;espressif/button=*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æŒ‡å®šbuttonæŒ‡å®šç‰ˆæœ¬ç»„ä»¶ä¾èµ–</span></span><br><span class="line">idf.py add-dependency <span class="string">&quot;espressif/button^3.4.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç»„ä»¶ç®¡ç†å‘½ä»¤æ‰§è¡Œåï¼Œåœ¨é¡¹ç›®çš„ main æ–‡ä»¶å¤¹ä¸‹å°†å‡ºç° <code>idf_component.yml</code> æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">## IDF Component Manager Manifest File</span></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">espressif/button:</span> <span class="string">&quot;^3.4.0&quot;</span></span><br><span class="line">  <span class="comment">## Required IDF version</span></span><br><span class="line">  <span class="attr">idf:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">&quot;&gt;=4.1.0&quot;</span></span><br><span class="line">  <span class="comment"># # Put list of dependencies here</span></span><br><span class="line">  <span class="comment"># # For components maintained by Espressif:</span></span><br><span class="line">  <span class="comment"># component: &quot;~1.0.0&quot;</span></span><br><span class="line">  <span class="comment"># # For 3rd party components:</span></span><br><span class="line">  <span class="comment"># username/component: &quot;&gt;=1.0.0,&lt;2.0.0&quot;</span></span><br><span class="line">  <span class="comment"># username2/component2:</span></span><br><span class="line">  <span class="comment">#   version: &quot;~1.0.0&quot;</span></span><br><span class="line">  <span class="comment">#   # For transient dependencies `public` flag can be set.</span></span><br><span class="line">  <span class="comment">#   # `public` flag doesn&#x27;t have an effect dependencies of the `main` component.</span></span><br><span class="line">  <span class="comment">#   # All dependencies of `main` are public by default.</span></span><br><span class="line">  <span class="comment">#   public: true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>idf.py build</code> å®Œæˆåï¼Œåœ¨é¡¹ç›®ä¸‹åˆ›å»ºäº† <code>managed_components</code> æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹æœ‰ä¸‹è½½çš„ç»„ä»¶ï¼š<code>espressif__button</code> å’Œ <code>espressif__cmake_utilities</code></p>
<p>åŒæ—¶å‘ç°è¿˜æœ‰å…¶ä»–æ–‡ä»¶è¢«æ–°å»ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@pi-NMH-WCX9:~/esp/app-example/get-started/button$ <span class="built_in">ls</span> -al</span><br><span class="line">total 84</span><br><span class="line">drwxrwxr-x  5 pi pi  4096 11æœˆ 26 14:39 .</span><br><span class="line">drwxrwxr-x 16 pi pi  4096 11æœˆ 20 14:18 ..</span><br><span class="line">drwxrwxr-x  8 pi pi  4096 11æœˆ 26 14:39 build</span><br><span class="line">-rw-rw-r--  1 pi pi   244 11æœˆ 26 14:36 CMakeLists.txt</span><br><span class="line">-rw-rw-r--  1 pi pi   637 11æœˆ 26 14:39 dependencies.lock</span><br><span class="line">drwxrwxr-x  2 pi pi  4096 11æœˆ 26 14:12 main</span><br><span class="line">drwxrwxr-x  4 pi pi  4096 11æœˆ 26 14:39 managed_components</span><br><span class="line">-rw-rw-r--  1 pi pi 56876 11æœˆ 26 14:39 sdkconfig</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ï¼Œdependencies.lockã€sdkconfigæ–‡ä»¶æ˜¯è‡ªåŠ¨æ–°å»ºçš„ï¼Œmanaged_componentsæ–‡ä»¶å¤¹ä¹Ÿæ˜¯è‡ªåŠ¨è¢«æ–°å»ºçš„ã€‚</p>
<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æºç åœ°å€ï¼š<a href="https://github.com/eiSouthBoy/esp-idf-example/tree/main/002-button">https://github.com/eiSouthBoy/esp-idf-example/tree/main/002-button</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iot_button.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUTTON_ACTIVE_LEVEL 0  <span class="comment">// ä½ç”µå¹³æœ‰æ•ˆ</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUTTON_GPIO_0 CONFIG_BUTTON_GPIO_NUM</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_GPIO_4 CONFIG_LED_GPIO_NUM</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;button-example&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> g_led_state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŒ‰é”®äº‹ä»¶ç±»å‹è¡¨ */</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *button_event_table[] = &#123;</span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_DOWN&quot;</span>,        <span class="comment">// æŒ‰ä¸‹</span></span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_UP&quot;</span>,          <span class="comment">// å¼¹èµ·</span></span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_REPEAT&quot;</span>,      <span class="comment">// æŒ‰ä¸‹å¼¹èµ·æ¬¡æ•° &gt;= 2æ¬¡</span></span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_REPEAT_DONE&quot;</span>, <span class="comment">// é‡å¤æŒ‰ä¸‹ç»“æŸ</span></span><br><span class="line">    <span class="string">&quot;BUTTON_SINGLE_CLICK&quot;</span>,      <span class="comment">// æŒ‰ä¸‹å¼¹èµ·ä¸€æ¬¡</span></span><br><span class="line">    <span class="string">&quot;BUTTON_DOUBLE_CLICK&quot;</span>,      <span class="comment">// æŒ‰ä¸‹å¼¹èµ·ä¸¤æ¬¡</span></span><br><span class="line">    <span class="string">&quot;BUTTON_MULTIPLE_CLICK&quot;</span>,    <span class="comment">// æŒ‡å®šé‡å¤æŒ‰ä¸‹æ¬¡æ•° N æ¬¡ï¼Œè¾¾æˆæ—¶è§¦å‘</span></span><br><span class="line">    <span class="string">&quot;BUTTON_LONG_PRESS_START&quot;</span>,  <span class="comment">// æŒ‰ä¸‹æ—¶é—´è¾¾åˆ°é˜ˆå€¼çš„ç¬é—´</span></span><br><span class="line">    <span class="string">&quot;BUTTON_LONG_PRESS_HOLD&quot;</span>,   <span class="comment">// é•¿æŒ‰æœŸé—´ä¸€ç›´è§¦å‘</span></span><br><span class="line">    <span class="string">&quot;BUTTON_LONG_PRESS_UP&quot;</span>,     <span class="comment">// é•¿æŒ‰å¼¹èµ·</span></span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_REPEAT_DONE&quot;</span>, <span class="comment">// å¤šæ¬¡æŒ‰ä¸‹å¼¹èµ·ç»“æŸ</span></span><br><span class="line">    <span class="string">&quot;BUTTON_PRESS_END&quot;</span>          <span class="comment">// è¡¨ç¤ºbuttonæ­¤æ¬¡æ£€æµ‹å·²ç»“æŸ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŒ‰é”®äº‹ä»¶å›è°ƒå‡½æ•° */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">button_event_cb</span><span class="params">(<span class="type">void</span> *arg, <span class="type">void</span> *data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> btn_event[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">snprintf</span>(btn_event, <span class="number">64</span>, <span class="string">&quot;%s&quot;</span>, button_event_table[(<span class="type">button_event_t</span>)data]);</span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Button event %s&quot;</span>, btn_event);</span><br><span class="line">    iot_button_print_event((<span class="type">button_handle_t</span>)arg);</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(btn_event, <span class="string">&quot;BUTTON_PRESS_DOWN&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        g_led_state = !g_led_state;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Turning the LED %s!&quot;</span>, g_led_state == <span class="literal">true</span> ? <span class="string">&quot;ON&quot;</span> : <span class="string">&quot;OFF&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Set the GPIO level according to the state (LOW or HIGH)*/</span></span><br><span class="line">        gpio_set_level(LED_GPIO_4, g_led_state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŒ‰é”®åˆå§‹åŒ–æ“ä½œ */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">app_driver_button_init</span><span class="params">(<span class="type">uint32_t</span> button_num)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">esp_err_t</span> err;</span><br><span class="line">    <span class="type">button_config_t</span> btn_cfg = &#123;</span><br><span class="line">        .type = BUTTON_TYPE_GPIO,</span><br><span class="line">        .gpio_button_config = &#123;</span><br><span class="line">            .gpio_num = button_num,</span><br><span class="line">            .active_level = BUTTON_ACTIVE_LEVEL,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">button_handle_t</span> btn = iot_button_create(&amp;btn_cfg);</span><br><span class="line">    assert(btn);</span><br><span class="line">    <span class="comment">/* æ ¹æ®ä¸åŒçš„æŒ‰é”®äº‹ä»¶æ³¨å†Œå›è°ƒ */</span></span><br><span class="line">    err = iot_button_register_cb(btn, BUTTON_PRESS_DOWN, button_event_cb, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_PRESS_UP, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_PRESS_REPEAT, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_PRESS_REPEAT_DONE, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_SINGLE_CLICK, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_DOUBLE_CLICK, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_LONG_PRESS_START, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_LONG_PRESS_HOLD, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_LONG_PRESS_UP, button_event_cb, NULL);</span></span><br><span class="line">    <span class="comment">// err |= iot_button_register_cb(btn, BUTTON_PRESS_END, button_event_cb, NULL);</span></span><br><span class="line"></span><br><span class="line">    ESP_ERROR_CHECK(err);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LEDç¯åˆå§‹åŒ– */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">app_driver_led_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Example configured to GPIO LED(GPIO %d)!&quot;</span>, LED_GPIO_4);</span><br><span class="line">    gpio_reset_pin(LED_GPIO_4);</span><br><span class="line">    gpio_set_direction(LED_GPIO_4, GPIO_MODE_OUTPUT); <span class="comment">/* Set the GPIO as a push/pull output */</span></span><br><span class="line">    gpio_set_level(LED_GPIO_4, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    app_driver_led_init();</span><br><span class="line">    app_driver_button_init(BUTTON_GPIO_0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“ ESP32-DevKitC å¼€å‘æ¿ä¸Šçš„ Boot æŒ‰é”®è¢«æŒ‰ä¸‹åï¼Œå¤–æ¥ GPIO4 çš„LEDç¯å°†ä¼šç‚¹äº®ï¼Œå†æ¬¡æŒ‰ä¸‹ï¼ŒLEDç¯ç†„ç­ã€‚</p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>buttonæŒ‰é”®ç»„ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 22.04: VirtualBox7</title>
    <url>/2024/11/26/2024/Ubuntu-22-04-VirtualBox7/</url>
    <content><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><a href="https://www.virtualbox.org/">Oracle Virtualbox</a> VirtualBox æ˜¯ä¸€æ¬¾å¼€æºè™šæ‹Ÿæœºè½¯ä»¶ã€‚ç”±å¾·å›½ Innotek å…¬å¸å¼€å‘ï¼ŒSun Microsystems å…¬å¸å‡ºå“ã€‚ä½¿ç”¨ Qt ç¼–å†™ï¼Œåœ¨ Sun è¢« Oracle æ”¶è´­åæ­£å¼æ›´åæˆ Oracle VM VirtualBoxã€‚é‡‡ç”¨ GPL åè®®å¼€æºã€‚</p>
<p><strong>æ³¨æ„ï¼šå…ˆè¿›å…¥PCçš„BIOSç³»ç»Ÿå…³é—­å®‰å…¨å¯åŠ¨ï¼ˆSecure Bootï¼‰ï¼Œå¦åˆ™VirtualBoxèµ·ä¸æ¥</strong></p>
<ul>
<li><p>å®‰è£…VirtualBox7</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥GPGç§˜é’¥</span></span><br><span class="line">wget -O- https://www.virtualbox.org/download/oracle_vbox_2016.asc | <span class="built_in">sudo</span> gpg --dearmor --<span class="built_in">yes</span> --output /usr/share/keyrings/oracle-virtualbox-2016.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä»“åº“åœ°å€ï¼ŒUbuntu 22.04è‡ªå¸¦çš„ä»“åº“ä¸­VirtualBoxç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼Œå¥½åƒæ˜¯v6.5</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] http://download.virtualbox.org/virtualbox/debian <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)</span> contrib&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/virtualbox.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…7.0ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> apt install virtualbox-7.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…VirtualBox æ‰©å±•åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å·²å®‰è£…çš„VirtualBoxç‰ˆæœ¬</span></span><br><span class="line">pi@pi-NMH-WCX9:~$ vboxmanage -v | <span class="built_in">cut</span> -dr -f1</span><br><span class="line">7.0.22</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å¯¹åº”çš„æ‰©å±•åŒ…</span></span><br><span class="line">wget https://download.virtualbox.org/virtualbox/7.0.22/Oracle_VM_VirtualBox_Extension_Pack-7.0.22.vbox-extpack</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å¯¹åº”çš„æ‰©å±•åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> vboxmanage extpack install Oracle_VM_VirtualBox_Extension_Pack-7.0.22.vbox-extpack</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å·²å®‰è£…çš„æ‰©å±•åŒ…ç‰ˆæœ¬</span></span><br><span class="line">pi@pi-NMH-WCX9:~$ vboxmanage list extpacks</span><br><span class="line">Extension Packs: 1</span><br><span class="line">Pack no. 0:   Oracle VM VirtualBox Extension Pack</span><br><span class="line">Version:        7.0.22</span><br><span class="line">Revision:       165102</span><br><span class="line">Edition:        </span><br><span class="line">Description:    Oracle Cloud Infrastructure integration, Host Webcam, VirtualBox RDP, PXE ROM, Disk Encryption, NVMe, full VM encryption.</span><br><span class="line">VRDE Module:    VBoxVRDP</span><br><span class="line">Crypto Module:  VBoxPuelCrypto</span><br><span class="line">Usable:         <span class="literal">true</span></span><br><span class="line">Why unusable: </span><br></pre></td></tr></table></figure>
</li>
<li><p>æ·»åŠ å½“å‰ç”¨æˆ·åˆ°vboxusersç»„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG vboxusers <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>VirtualBox7</tag>
      </tags>
  </entry>
  <entry>
    <title>WAN/LAN è‡ªé€‚åº”</title>
    <url>/2024/11/23/2024/WAN-LAN-adaptive/</url>
    <content><![CDATA[<h2 id="ç½‘å£çš„ç±»å‹"><a href="#ç½‘å£çš„ç±»å‹" class="headerlink" title="ç½‘å£çš„ç±»å‹"></a>ç½‘å£çš„ç±»å‹</h2><p>ä¸€èˆ¬å®¶ç”¨è·¯ç”±å™¨ç½‘å£ä¼šæ ‡æ˜ï¼šLANã€WANã€WAN&#x2F;LANï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="/home/caojun/.config/Typora/typora-user-images/image-20241123182945665.png" alt="image-20241123182945665"></p>
<ul>
<li>WANç½‘å£ï¼šWide Area Networkï¼Œå¹¿åŸŸç½‘ï¼Œä¾‹å¦‚äº’è”ç½‘ã€‚</li>
<li>LANç½‘å£ï¼šLocal Area Networkï¼Œå±€åŸŸç½‘ï¼Œä¾‹å¦‚å®¶åº­å†…éƒ¨ç½‘ç»œã€åŠå…¬å®¤å†…éƒ¨ç½‘ç»œã€‚</li>
<li>WAN&#x2F;LANè‡ªé€‚åº”ç½‘å£ï¼š</li>
</ul>
<p><em>æ³¨æ„ï¼šæ—©æœŸè·¯ç”±å™¨ä¸Šçš„ç½‘çº¿æ¥å£æ˜¯åŒºåˆ†WANå£ã€LANå£çš„ã€‚WANå£ç”¨æ¥è¿æ¥å…‰çŒ«ã€å®½å¸¦çŒ«ã€ä¸Šç½‘ç½‘çº¿çš„;LANæ¥å£ä½¿ç”¨æ¥è¿æ¥ç”µè„‘ã€ç”µè§†æœºã€æœºé¡¶ç›’ç­‰ç½‘ç»œè®¾å¤‡çš„ã€‚</em></p>
]]></content>
      <categories>
        <category>Wi-Fi</category>
      </categories>
      <tags>
        <tag>WAN/LAN</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: Hardware Communation Interface Or Protocol</title>
    <url>/2024/11/17/2024/esp-Hardware-Communation-Interface-Or-Protocol/</url>
    <content><![CDATA[<blockquote>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªAIçš„å›ç­”</p>
</blockquote>
<p>åœ¨åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œç¡¬ä»¶é€šä¿¡æ¥å£æˆ–åè®®æ˜¯å®ç°ä¸åŒè®¾å¤‡ä¹‹é—´æ•°æ®äº¤æ¢çš„å…³é”®ã€‚è¿™äº›æ¥å£å’Œåè®®æ ¹æ®ä¼ è¾“è·ç¦»ã€é€Ÿåº¦ã€åŠŸè€—ç­‰å› ç´ çš„ä¸åŒè€Œæœ‰æ‰€åŒºåˆ«ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç¡¬ä»¶é€šä¿¡æ¥å£æˆ–åè®®ï¼š</p>
<h2 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h2><p>UART ï¼ˆUniversal Asynchronous Receiver&#x2F;Transmitterï¼Œé€šç”¨å¼‚æ­¥æ”¶å‘å™¨ï¼‰æ˜¯ä¸€ç§éå¸¸åŸºç¡€çš„ä¸²è¡Œé€šä¿¡åè®®ï¼Œå®ƒå…è®¸ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´è¿›è¡Œ<strong>ä¸²è¡Œã€å¼‚æ­¥ã€å…¨åŒå·¥</strong>çš„æ•°æ®ä¼ è¾“ã€‚å®ƒç®€å•æ˜“ç”¨ï¼Œé€‚ç”¨äºçŸ­è·ç¦»é€šä¿¡ã€‚</p>
<p>ä¸²å£åªéœ€è¦ 2æ ¹çº¿ï¼ˆTX å’Œ RXï¼‰ å°±å¯ä»¥å®ç°æ•°æ®å‘é€å’Œæ¥å—ï¼ŒTXç”¨äºå‘é€æ•°æ®ï¼ŒRXç”¨äºæ¥æ”¶æ•°æ®ï¼ˆæ”¶å‘ä¸æ˜¯ä¸€æ ¹çº¿ï¼Œæ‰€ä»¥æ˜¯å…¨åŒå·¥é€šä¿¡ï¼‰ï¼Œé€šä¿¡åŒæ–¹åªè¦é‡‡ç”¨ç›¸åŒçš„å¸§æ ¼å¼å’Œæ³¢ç‰¹ç‡ï¼Œå°±èƒ½åœ¨æœªå…±äº«æ—¶é’Ÿä¿¡å·çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å®Œæˆé€šä¿¡è¿‡ç¨‹ï¼ˆæ”¶å‘ä¸åŒæ­¥ï¼Œæ‰€ä»¥æ˜¯å¼‚æ­¥ä¸²è¡Œé€šä¿¡ï¼‰ã€‚</p>
<h3 id="ç”µæ°”æ ‡å‡†"><a href="#ç”µæ°”æ ‡å‡†" class="headerlink" title="ç”µæ°”æ ‡å‡†"></a>ç”µæ°”æ ‡å‡†</h3><p>ä¸²å£æœ‰4ç§ç”µæ°”æ ‡å‡†ï¼Œåˆ†åˆ«æ˜¯ï¼šTTLã€RS232ã€RS422ã€RS485ã€‚è¿™4ç§ä¸²å£åªåœ¨ç”µæ°”ä¿¡å·ä¸Šæœ‰å·®åˆ«ï¼Œåœ¨å¸§æ ¼å¼ã€ä¼ è¾“é€»è¾‘ã€è½¯ä»¶æ“ä½œä¸ŠåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ä¸²å£çš„4ç§ç”µæ°”æ ‡å‡†æ¯”è¾ƒï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>TTL</th>
<th>RS232</th>
<th>RS422</th>
<th>RS485</th>
</tr>
</thead>
<tbody><tr>
<td>ä¿¡å·ç±»å‹</td>
<td>ç”µå¹³ä¿¡å·</td>
<td>ç”µå¹³ä¿¡å·</td>
<td>å·®åˆ†ä¿¡å·</td>
<td>å·®åˆ†ä¿¡å·</td>
</tr>
<tr>
<td>ç”µå‹èŒƒå›´</td>
<td>0~3.3V&#x2F;5.0V</td>
<td>+15V&#x2F;-15V</td>
<td>-0.25V~+6V</td>
<td>-7V~+12V</td>
</tr>
<tr>
<td>æŠ—å¹²æ‰°æ€§</td>
<td>å¼±</td>
<td>è¾ƒå¼º</td>
<td>å¼º</td>
<td>å¼º</td>
</tr>
<tr>
<td>ä¼ è¾“è·ç¦»</td>
<td>1m</td>
<td>10m</td>
<td>1.2km</td>
<td>1.2km</td>
</tr>
<tr>
<td>è´Ÿè½½æ•°é‡</td>
<td>100Kbps</td>
<td>100Kbps</td>
<td>10Mbps</td>
<td>10Mbps</td>
</tr>
<tr>
<td>ä¼ è¾“æ¨¡å¼</td>
<td>1</td>
<td>1</td>
<td>10</td>
<td>32</td>
</tr>
<tr>
<td>å¯¼çº¿æ•°é‡</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>2</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>TTLï¼ˆTransistor-Transistor Logicï¼‰</strong></p>
<p>TTLç”µå¹³æ˜¯æŒ‡è¿™ç§é€»è¾‘ç”µè·¯ä¸­ä½¿ç”¨çš„ç”µå‹æ ‡å‡†ï¼Œç”¨äºè¡¨ç¤ºäºŒè¿›åˆ¶çš„â€œ0â€å’Œâ€œ1â€ã€‚</p>
<p>é€»è¾‘ä½ç”µå¹³â€0â€ é€šå¸¸æŒ‡ <em><strong>æ¥è¿‘</strong></em> 0Vçš„ç”µå‹ï¼Œä¸€èˆ¬è®¤ä¸ºä½äº 0.8V ä¸ºä½ç”µå¹³ã€‚</p>
<p>é€»è¾‘é«˜ç”µå¹³â€1â€ é€šå¸¸æŒ‡ç›¸å¯¹è¾ƒé«˜çš„ç”µå‹ï¼Œå¯¹äºä¼ ç»Ÿçš„5V TTLé€»è¾‘ï¼Œé«˜ç”µå¹³é€šå¸¸æ˜¯åœ¨ <code>2V~5V</code> ä¹‹é—´ï¼›å¯¹äº3.3V TTLé€»è¾‘ï¼Œé«˜ç”µå¹³åˆ™åœ¨ <code>2V~3.3V</code> ä¹‹é—´ã€‚</p>
</li>
<li><p><strong>RS232ï¼ˆRecommended Standard 232ï¼‰</strong></p>
<p>RS-232ä½¿ç”¨ <em><strong>è´Ÿé€»è¾‘</strong></em>ï¼Œå³é€»è¾‘â€œ1â€ä¸ºè´Ÿç”µå‹ï¼Œé€šå¸¸åœ¨ <code>-3V~-15V</code> ä¹‹é—´ï¼Œé€»è¾‘â€œ0â€ä¸ºæ­£ç”µå‹ï¼Œé€šå¸¸åœ¨<code>+3V~+15V</code> ä¹‹é—´ï¼‰ã€‚è¿™ç§è¾ƒé«˜çš„ç”µå‹èŒƒå›´æœ‰åŠ©äºæé«˜æŠ—å™ªèƒ½åŠ›ï¼Œä½†åŒæ—¶ä¹Ÿé™åˆ¶äº†å…¶é€‚ç”¨äºä½åŠŸè€—åº”ç”¨ã€‚</p>
</li>
<li><p><strong>RS422ï¼ˆRecommended Standard 422ï¼‰</strong></p>
<p>RS-422 ä½¿ç”¨å·®åˆ†ä¿¡å·ä¼ è¾“ï¼Œè¿™æ„å‘³ç€æ¯æ¡æ•°æ®çº¿éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„åç›¸çº¿ã€‚</p>
<p>å·®åˆ†ä¿¡å·çº¿ä¹‹é—´çš„ç”µå‹å·®ç”¨æ¥è¡¨ç¤ºé€»è¾‘ç”µå¹³ï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºåœ°çº¿çš„ç»å¯¹ç”µå‹ã€‚</p>
<p>å‘é€ç«¯ï¼šé€»è¾‘â€œ1â€å¯¹åº”äº<code>+2Våˆ°+6V</code> ä¹‹é—´çš„ç”µå‹å·®ï¼Œè€Œé€»è¾‘â€œ0â€åˆ™å¯¹åº”äº <code>-2Våˆ°-6V</code> ä¹‹é—´çš„ç”µå‹å·®ã€‚</p>
<p>æ¥æ”¶ç«¯ï¼šé€»è¾‘â€œ1â€å¯¹åº”äºç”µå‹å·® <code>å¤§äº+0.2V</code>ï¼Œè€Œé€»è¾‘â€œ0â€åˆ™å¯¹åº”äºç”µå‹å·® <code>å°äº-0.2V</code>ã€‚</p>
</li>
<li><p><strong>RS485ï¼ˆRecommended Standard 485ï¼‰</strong></p>
<p>RS485 ä½¿ç”¨å·®åˆ†ä¿¡å·ä¼ è¾“ï¼Œè¿™æ„å‘³ç€æ¯æ¡æ•°æ®çº¿éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„åç›¸çº¿ã€‚</p>
<p>å·®åˆ†ä¿¡å·çº¿ä¹‹é—´çš„ç”µå‹å·®ç”¨æ¥è¡¨ç¤ºé€»è¾‘ç”µå¹³ã€‚</p>
<p>å‘é€ç«¯ï¼šé€»è¾‘â€œ1â€å¯¹åº”äºç”µå‹å·® <code>+0.2Våˆ°+6V</code> ä¹‹é—´ï¼Œè€Œé€»è¾‘â€œ0â€åˆ™å¯¹åº”äºç”µå‹å·®  <code>-0.2Våˆ°-6V</code> ä¹‹é—´ã€‚</p>
<p>æ¥æ”¶ç«¯ï¼šé€»è¾‘â€œ1â€å¯¹åº”äºç”µå‹å·® <code>å¤§äº+0.2V</code>ï¼Œè€Œé€»è¾‘â€œ0â€åˆ™å¯¹åº”äºç”µå‹å·® <code>å°äº-0.2V</code>ã€‚</p>
</li>
</ul>
<h3 id="å¸§ç»“æ„"><a href="#å¸§ç»“æ„" class="headerlink" title="å¸§ç»“æ„"></a>å¸§ç»“æ„</h3><p><img src="/2024/11/17/2024/esp-Hardware-Communation-Interface-Or-Protocol/image-20241208113119541.png" alt="image-20241208113119541"></p>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šä½æœºä¸²å£è½¯ä»¶ï¼ˆä¾‹å¦‚ï¼šPuttyï¼‰ï¼Œéœ€è¦é€‰æ‹©ä¸²å£åç§°ã€æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€åœæ­¢ä½ã€æ ¡éªŒä½å’Œæµæ§ã€‚</p>
<p><img src="/2024/11/17/2024/esp-Hardware-Communation-Interface-Or-Protocol/image-20241208113706448.png" alt="image-20241208113706448"></p>
<h3 id="ä¸²å£æ§åˆ¶"><a href="#ä¸²å£æ§åˆ¶" class="headerlink" title="ä¸²å£æ§åˆ¶"></a>ä¸²å£æ§åˆ¶</h3><blockquote>
<p>ä¸ºä»€ä¹ˆå¼€å‘æ¿é€šè¿‡USBæ¥åˆ°ç”µè„‘åï¼Œç”µè„‘å¯ä»¥é€šè¿‡ä¸²å£è°ƒè¯•åŠ©æ‰‹ä¸å¼€å‘æ¿é€šä¿¡ï¼Ÿ</p>
</blockquote>
<p>ç”µè„‘ï¼ˆUbuntu 22.04ï¼‰ä¸€èˆ¬é»˜è®¤å®‰è£…äº†ä¸åŒ â€œUSB to UART Bridgeâ€ èŠ¯ç‰‡å‚å®¶çš„é©±åŠ¨ï¼Œæ‰€ä»¥å½“å¼€å‘æ¿é€šè¿‡USBæ¥å…¥ç”µè„‘ï¼Œç³»ç»Ÿä¸­çš„å·²å®‰è£…çš„é©±åŠ¨èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶æ­£ç¡®é…ç½®ä¸åŒèŠ¯ç‰‡å‚å®¶çš„ â€œUSB to UART Bridgeâ€ è®¾å¤‡ï¼Œä»è€Œåˆ›å»ºåƒ <code>/dev/ttyUSB0</code> è¿™æ ·çš„è®¾å¤‡èŠ‚ç‚¹ï¼Œä»¥ä¾¿ç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥ä¸è¿™äº›è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</p>
<p><em>USB to UARTèŠ¯ç‰‡ï¼šSiliconï¼ˆèŠ¯ç§‘ï¼‰ CP2102ã€FDTIï¼ˆé£ç‰¹å¸äºšï¼‰ FT232ã€Prolificï¼ˆæ—ºç–ï¼‰ PL2303ã€å—äº¬æ²æ’ CH340ã€‚</em></p>
<p>åœ¨ Ubuntu 22.04 ç³»ç»ŸæŸ¥çœ‹è‡ªå¸¦é©±åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">6.8.0-49-generic</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> /lib/modules/$(<span class="built_in">uname</span> -r)/kernel/drivers/usb/serial</span><br><span class="line">aircable.ko         f81232.ko       iuu_phoenix.ko  mxuport.ko   quatech2.ko          usbserial.ko</span><br><span class="line">ark3116.ko          f81534.ko       keyspan.ko      navman.ko    safe_serial.ko       usb-serial-simple.ko</span><br><span class="line">belkin_sa.ko        ftdi_sio.ko     keyspan_pda.ko  omninet.ko   sierra.ko            usb_wwan.ko</span><br><span class="line">ch341.ko            garmin_gps.ko   kl5kusb105.ko   opticon.ko   spcp8x5.ko           visor.ko</span><br><span class="line">cp210x.ko           io_edgeport.ko  kobil_sct.ko    option.ko    ssu100.ko            whiteheat.ko</span><br><span class="line">cyberjack.ko        io_ti.ko        mct_u232.ko     oti6858.ko   symbolserial.ko      wishbone-serial.ko</span><br><span class="line">cypress_m8.ko       ipaq.ko         metro-usb.ko    pl2303.ko    ti_usb_3410_5052.ko  xr_serial.ko</span><br><span class="line">digi_acceleport.ko  ipw.ko          mos7720.ko      qcaux.ko     upd78f0730.ko        xsens_mt.ko</span><br><span class="line">empeg.ko            ir-usb.ko       mos7840.ko      qcserial.ko  usb_debug.ko</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° Ubuntu 22.04 ç³»ç»Ÿé»˜è®¤å°±æ”¯æŒ <em>Silicon cp210x.koã€å—äº¬æ²æ’ ch341.koã€FTDI ftdi_sio.koã€Prolific pl2303.ko</em>ã€‚</p>
<p>USB to UART BridgeèŠ¯ç‰‡é€šè¿‡ä¸²å£é©±åŠ¨è¯†åˆ«åï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ lsusb</span><br><span class="line">Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 003 Device 003: ID 27c6:5125 Shenzhen Goodix Technology Co.,Ltd. Goodix Fingerprint Device </span><br><span class="line">Bus 003 Device 002: ID 0489:e0df Foxconn / Hon Hai </span><br><span class="line">Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 002 Device 005: ID 0b95:1790 ASIX Electronics Corp. AX88179 Gigabit Ethernet</span><br><span class="line">Bus 002 Device 004: ID 05e3:0626 Genesys Logic, Inc. USB3.1 Hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 005: ID 13d3:56f8 IMC Networks ov9734_azurewave_camera</span><br><span class="line">Bus 001 Device 003: ID 046d:c52f Logitech, Inc. Unifying Receiver</span><br><span class="line">Bus 001 Device 009: ID 10c4:ea60 Silicon Labs CP210x UART Bridge</span><br><span class="line">Bus 001 Device 006: ID 05e3:0610 Genesys Logic, Inc. Hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> lsusb -v</span><br><span class="line">Bus 001 Device 009: ID 10c4:ea60 Silicon Labs CP210x UART Bridge</span><br><span class="line">Device Descriptor:</span><br><span class="line">  bLength                18</span><br><span class="line">  bDescriptorType         1</span><br><span class="line">  bcdUSB               2.00</span><br><span class="line">  bDeviceClass            0 </span><br><span class="line">  bDeviceSubClass         0 </span><br><span class="line">  bDeviceProtocol         0 </span><br><span class="line">  bMaxPacketSize0        64</span><br><span class="line">  idVendor           0x10c4 Silicon Labs</span><br><span class="line">  idProduct          0xea60 CP210x UART Bridge</span><br><span class="line">  bcdDevice            1.00</span><br><span class="line">  iManufacturer           1 Silicon Labs</span><br><span class="line">  iProduct                2 CP2102N USB to UART Bridge Controller</span><br><span class="line">  iSerial                 3 6a7f096aba1aef11a7db0b764909ffd0</span><br><span class="line">  bNumConfigurations      1</span><br><span class="line">  Configuration Descriptor:</span><br><span class="line">    bLength                 9</span><br><span class="line">    bDescriptorType         2</span><br><span class="line">    wTotalLength       0x0020</span><br><span class="line">    bNumInterfaces          1</span><br><span class="line">    bConfigurationValue     1</span><br><span class="line">    iConfiguration          0 </span><br><span class="line">    bmAttributes         0x80</span><br><span class="line">      (Bus Powered)</span><br><span class="line">    MaxPower              100mA</span><br><span class="line">    Interface Descriptor:</span><br><span class="line">      bLength                 9</span><br><span class="line">      bDescriptorType         4</span><br><span class="line">      bInterfaceNumber        0</span><br><span class="line">      bAlternateSetting       0</span><br><span class="line">      bNumEndpoints           2</span><br><span class="line">      bInterfaceClass       255 Vendor Specific Class</span><br><span class="line">      bInterfaceSubClass      0 </span><br><span class="line">      bInterfaceProtocol      0 </span><br><span class="line">      iInterface              0 </span><br><span class="line">      Endpoint Descriptor:</span><br><span class="line">        bLength                 7</span><br><span class="line">        bDescriptorType         5</span><br><span class="line">        bEndpointAddress     0x02  EP 2 OUT</span><br><span class="line">        bmAttributes            2</span><br><span class="line">          Transfer Type            Bulk</span><br><span class="line">          Synch Type               None</span><br><span class="line">          Usage Type               Data</span><br><span class="line">        wMaxPacketSize     0x0040  1x 64 bytes</span><br><span class="line">        bInterval               0</span><br><span class="line">      Endpoint Descriptor:</span><br><span class="line">        bLength                 7</span><br><span class="line">        bDescriptorType         5</span><br><span class="line">        bEndpointAddress     0x82  EP 2 IN</span><br><span class="line">        bmAttributes            2</span><br><span class="line">          Transfer Type            Bulk</span><br><span class="line">          Synch Type               None</span><br><span class="line">          Usage Type               Data</span><br><span class="line">        wMaxPacketSize     0x0040  1x 64 bytes</span><br><span class="line">        bInterval               0</span><br><span class="line">Device Status:     0x0000</span><br><span class="line">  (Bus Powered)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å…¶ä¸­æ¯”è¾ƒå…³é”®çš„å­—æ®µï¼š</p>
<ul>
<li><p>idVendorï¼šä¸è¦ä¿®æ”¹</p>
</li>
<li><p>idProductï¼šä¸è¦ä¿®æ”¹</p>
</li>
<li><p>iManufacturerï¼šå¯è‡ªå®šä¿®æ”¹</p>
</li>
<li><p>iProductï¼šå¯è‡ªå®šä¹‰ä¿®æ”¹</p>
</li>
</ul>
<p><em>æ³¨æ„ï¼šKeyä½¿ç”¨Silicon Labsæä¾› Simplicity Studio è½¯ä»¶ ä¿®æ”¹ä¸Šè¿°å­—æ®µ</em></p>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>SPI ï¼ˆSerial Peripheral Interfaceï¼Œä¸²è¡Œå¤–è®¾æ¥å£ï¼‰æ˜¯ä¸€ç§åŒæ­¥ä¸²è¡Œé€šä¿¡æ¥å£ï¼Œé€šå¸¸ç”¨äºå¾®æ§åˆ¶å™¨ä¸ä¸€ä¸ªæˆ–å¤šä¸ªå¤–è®¾ä¹‹é—´çš„çŸ­è·ç¦»é€šä¿¡ã€‚å®ƒä½¿ç”¨ä¸»ä»æ¶æ„ï¼Œæ”¯æŒå…¨åŒå·¥é€šä¿¡ã€‚</p>
<ol>
<li><p><strong>I2C (Inter-Integrated Circuit)</strong></p>
<ul>
<li>I2C æ˜¯ä¸€ç§å¤šä¸»æœºæ€»çº¿ï¼Œä½¿ç”¨ä¸¤æ ¹çº¿ï¼ˆSDA æ•°æ®çº¿å’Œ SCL æ—¶é’Ÿçº¿ï¼‰è¿›è¡ŒåŠåŒå·¥é€šä¿¡ã€‚å®ƒå¹¿æ³›åº”ç”¨äºéœ€è¦è¿æ¥å¤šä¸ªä½é€Ÿå¤–å›´è®¾å¤‡çš„åœºåˆã€‚</li>
</ul>
</li>
<li><p><strong>CAN (Controller Area Network)</strong></p>
<ul>
<li>CAN åè®®æ˜¯ä¸€ç§æœ‰æ•ˆæ”¯æŒåˆ†å¸ƒå¼å®æ—¶æ§åˆ¶çš„ä¸²è¡Œé€šä¿¡ç½‘ç»œï¼Œä¸»è¦ç”¨äºæ±½è½¦å’Œå·¥ä¸šè‡ªåŠ¨åŒ–é¢†åŸŸï¼Œå…·æœ‰è¾ƒå¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ã€‚</li>
</ul>
</li>
<li><p><strong>USB (Universal Serial Bus)</strong></p>
<ul>
<li>USB æ˜¯ä¸€ç§é€šç”¨çš„ä¸²è¡Œæ€»çº¿æ ‡å‡†ï¼Œç”¨äºå»ºç«‹è®¡ç®—æœºä¸å…¶å¤–éƒ¨è®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚å®ƒæ”¯æŒçƒ­æ’æ‹”å’Œå³æ’å³ç”¨åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li><p><strong>Ethernet (ä»¥å¤ªç½‘)</strong></p>
<ul>
<li>ä»¥å¤ªç½‘æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å±€åŸŸç½‘æŠ€æœ¯ï¼Œå¯ä»¥å®ç°é«˜é€Ÿçš„æ•°æ®ä¼ è¾“ã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä»¥å¤ªç½‘æ¥å£å¸¸ç”¨äºè¿æ¥äº’è”ç½‘æˆ–æ„å»ºæœ¬åœ°ç½‘ç»œã€‚</li>
</ul>
</li>
<li><p><strong>Modbus</strong></p>
<ul>
<li>Modbus æ˜¯ä¸€ç§å·¥ä¸šæ ‡å‡†é€šä¿¡åè®®ï¼Œç”¨äºæ§åˆ¶å™¨ä¸æ‰§è¡Œå™¨ä¹‹é—´çš„é€šä¿¡ã€‚å®ƒæ”¯æŒRTUå’ŒASCIIä¸¤ç§æ¨¡å¼ï¼Œé€‚ç”¨äºå·¥ä¸šè‡ªåŠ¨åŒ–ç¯å¢ƒã€‚</li>
</ul>
</li>
<li><p><strong>RS-232, RS-422, RS-485</strong></p>
<ul>
<li>è¿™äº›æ˜¯ä¸²è¡Œé€šä¿¡çš„æ ‡å‡†ï¼Œå…¶ä¸­RS-232ä¸»è¦ç”¨äºç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œè€ŒRS-422å’ŒRS-485åˆ™æ”¯æŒå¤šç‚¹ç½‘ç»œï¼Œå¹¶ä¸”å…·æœ‰æ›´å¥½çš„ç”µæ°”ç‰¹æ€§ï¼Œé€‚åˆé•¿è·ç¦»é€šä¿¡ã€‚</li>
</ul>
</li>
<li><p><strong>Bluetooth (è“ç‰™)</strong></p>
<ul>
<li>è“ç‰™æ˜¯ä¸€ç§æ— çº¿é€šä¿¡æŠ€æœ¯ï¼Œé€‚ç”¨äºçŸ­è·ç¦»å†…çš„è®¾å¤‡äº’è”ï¼Œå¦‚ç§»åŠ¨ç”µè¯ã€ç¬”è®°æœ¬ç”µè„‘å’Œä¸ªäººæ•°å­—åŠ©ç†(PDA)ç­‰ã€‚</li>
</ul>
</li>
<li><p><strong>Wi-Fi (Wireless Fidelity)</strong></p>
<ul>
<li>Wi-Fi æŠ€æœ¯å…è®¸ç”µå­è®¾å¤‡é€šè¿‡æ— çº¿å±€åŸŸç½‘(WLAN)è¿æ¥åˆ°äº’è”ç½‘ã€‚å®ƒæ˜¯è®¸å¤šç°ä»£åµŒå…¥å¼ç³»ç»Ÿå’Œç‰©è”ç½‘(IoT)è®¾å¤‡ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</li>
</ul>
</li>
<li><p><strong>Zigbee</strong></p>
<ul>
<li>Zigbee æ˜¯ä¸€ç§åŸºäºIEEE 802.15.4æ ‡å‡†çš„ä½åŠŸè€—ã€ä½æ•°æ®é€Ÿç‡çš„æ— çº¿é€šä¿¡æŠ€æœ¯ï¼Œç‰¹åˆ«é€‚åˆäºä¼ æ„Ÿå™¨ç½‘ç»œå’Œå®¶åº­è‡ªåŠ¨åŒ–åº”ç”¨ã€‚</li>
</ul>
</li>
<li><p><strong>Thread</strong> </p>
<p>Thread æ˜¯ä¸€ç§ä½åŠŸè€—ã€åŸºäº IPv6 çš„æ— çº¿ç½‘ç»œåè®®ï¼Œæ—¨åœ¨ä¸ºå®¶åº­å’Œå·¥ä¸šç¯å¢ƒä¸­çš„ç‰©è”ç½‘è®¾å¤‡æä¾›å¯é ã€å®‰å…¨çš„é€šä¿¡ã€‚å®ƒå»ºç«‹åœ¨ IEEE 802.15.4 æ ‡å‡†ä¹‹ä¸Šï¼Œç±»ä¼¼äº Zigbeeï¼Œä½†æä¾›äº†æ›´å¼ºå¤§çš„ç½‘ç»œç®¡ç†å’Œå®‰å…¨æ€§åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong>NFC (Near Field Communication)</strong></p>
<ul>
<li>NFC æ˜¯ä¸€ç§çŸ­è·ç¦»çš„é«˜é¢‘æ— çº¿é€šä¿¡æŠ€æœ¯ï¼Œä½¿ä¸¤ä¸ªç”µå­è®¾å¤‡ï¼ˆå…¶ä¸­ä¸€ä¸ªé€šå¸¸æ˜¯ç§»åŠ¨ç”µè¯ï¼‰åœ¨å½¼æ­¤é è¿‘æ—¶èƒ½å¤Ÿäº¤æ¢æ•°æ®ã€‚</li>
</ul>
</li>
<li><p><strong>I2S (Inter-IC Sound)</strong></p>
<ul>
<li>I2S æ˜¯ä¸€ç§ä¸“ä¸ºéŸ³é¢‘è®¾å¤‡é—´ä¼ è¾“å£°éŸ³æ•°æ®è€Œè®¾è®¡çš„æ•°å­—æ¥å£ã€‚å®ƒå®šä¹‰äº†ä¸€ç§æ ‡å‡†æ ¼å¼ï¼Œç”¨äºåœ¨é›†æˆç”µè·¯ä¹‹é—´é«˜æ•ˆåœ°ä¼ è¾“é«˜è´¨é‡çš„éŸ³é¢‘ä¿¡å·ã€‚I2S æ¥å£é€šå¸¸ç”¨äºè¿æ¥æ•°å­—éŸ³é¢‘å¤„ç†å™¨ã€DACï¼ˆæ•°æ¨¡è½¬æ¢å™¨ï¼‰å’ŒADCï¼ˆæ¨¡æ•°è½¬æ¢å™¨ï¼‰ç­‰ç»„ä»¶ã€‚</li>
</ul>
</li>
<li><p><strong>SDIO (Secure Digital Input Output)</strong></p>
<ul>
<li>SDIO æ˜¯ä¸€ç§æ‰©å±•äº†SDå¡æ ‡å‡†çš„æ¥å£ï¼Œå…è®¸è®¾å¤‡é€šè¿‡ç›¸åŒçš„ç‰©ç†æ¥å£ä¸å¤šç§ç±»å‹çš„å¤–è®¾è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚Wi-Fiæ¨¡å—ã€è“ç‰™æ¨¡å—ã€GPSæ¥æ”¶å™¨ç­‰ã€‚å®ƒä¸ºåµŒå…¥å¼ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªçµæ´»ä¸”æ ‡å‡†åŒ–çš„æ–¹æ³•æ¥å¢åŠ åŠŸèƒ½è€Œä¸å¿…æ”¹å˜ç¡¬ä»¶è®¾è®¡ã€‚</li>
</ul>
</li>
<li><p><strong>PWM (Pulse Width Modulation)</strong></p>
<ul>
<li>PWM ä¸æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œè€Œæ˜¯ä¸€ç§ä¿¡å·è°ƒåˆ¶æ–¹æ³•ï¼Œå¸¸ç”¨äºæ§åˆ¶ç”µæœºçš„é€Ÿåº¦ã€LEDçš„äº®åº¦ç­‰éœ€è¦æ¨¡æ‹Ÿè¾“å‡ºçš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡æ”¹å˜è„‰å†²å®½åº¦æ¥è°ƒæ•´è¾“å‡ºä¿¡å·çš„å¹³å‡å€¼ï¼Œä»è€Œå®ç°å¯¹è´Ÿè½½çš„æœ‰æ•ˆæ§åˆ¶ã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼ŒPWM é€šå¸¸ç”±å®šæ—¶å™¨æˆ–ä¸“é—¨çš„PWMæ§åˆ¶å™¨äº§ç”Ÿã€‚</li>
</ul>
</li>
<li><p><strong>RMT</strong>ï¼ˆRemote Control Protocolï¼‰ ä¸»è¦ç”¨äºå¤„ç†è„‰å†²ä¿¡å·ï¼Œç‰¹åˆ«æ˜¯åœ¨çº¢å¤–é€šä¿¡ä¸­ã€‚å®ƒå¯ä»¥ç”¨æ¥æ¥æ”¶å’Œå‘é€ç»è¿‡è°ƒåˆ¶çš„è„‰å†²ä¿¡å·ï¼Œæ¯”å¦‚å¸¸è§çš„çº¢å¤–é¥æ§ä¿¡å·ã€‚RMT åŠŸèƒ½é€šå¸¸é›†æˆåœ¨æŸäº›å¾®æ§åˆ¶å™¨æˆ–SoCï¼ˆSystem on Chipï¼‰ä¸­ï¼Œç‰¹åˆ«æ˜¯é‚£äº›é’ˆå¯¹æ™ºèƒ½å®¶å±…ã€æ¶ˆè´¹ç”µå­ç­‰é¢†åŸŸçš„èŠ¯ç‰‡ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>esp32</tag>
        <tag>Interface</tag>
        <tag>Protocol</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: Automatic Bootloader</title>
    <url>/2024/11/17/2024/esp-Automatic-Bootloader/</url>
    <content><![CDATA[<blockquote>
<p>ä¸‹è½½æ¨¡å¼ã€çƒ§å½•æ¨¡å¼ã€Bootæ¨¡å¼ã€Boot Modeéƒ½æ˜¯åŒæ ·çš„æ„æ€ï¼ï¼ï¼</p>
</blockquote>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨å¯¹esp32å¼€å‘æ¿çƒ§å½•å›ºä»¶æ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆæŒ‰ä½booté”®ä¸æ”¾ï¼Œç„¶åæŒ‰ä½ené”®ï¼Œæ­¤æ—¶æ‰èƒ½è¿›å…¥çƒ§å½•æ¨¡å¼ã€‚æ„Ÿè§‰éº»çƒ¦çš„ï¼Œè¦æ˜¯æœ‰ä¸€ç§è‡ªåŠ¨ä¸‹è½½æ¨¡å¼å°±å¥½äº†ï¼Œæ— éœ€å¼€å‘è€…å»æ“ä½œæŒ‰é”®ï¼Œç›´æ¥çƒ§å½•å°±è¡Œã€‚</p>
<p><img src="/2024/11/17/2024/esp-Automatic-Bootloader/image-20241117132345736.png" alt="image-20241117132345736"></p>
<p>ä¸‹è½½æ¨¡å¼åˆ†ä¸ºï¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å¼ å’Œ æ‰‹åŠ¨ä¸‹è½½æ¨¡å¼ã€‚ä½†æœ‰ä¸€ä¸ªå‰æï¼Œå¦‚ä½•è¿›å…¥ä¸‹è½½æ¨¡å¼ï¼Ÿ</p>
<p>ENï¼ˆä¹Ÿç§°ä¸ºRSTï¼‰ä¸Šå‡æ²¿ï¼ˆä»ä½ç”µå¹³åˆ°é«˜ç”µå¹³ï¼‰æ—¶å€™ï¼Œæ£€æµ‹åˆ°GPIO0ï¼ˆä¹Ÿç§°ä¸ºBootï¼‰ä¸ºä½ç”µå¹³ï¼Œè¿›å…¥ä¸‹è½½æ¨¡å¼ã€‚å…·ä½“æ“ä½œæ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>æ–¹å¼1ï¼šå…ˆæŒ‰ä½Booté”®ä¸æ”¾ï¼Œç„¶åæŒ‰ä½ENé”®</li>
<li>æ–¹å¼2ï¼šå…ˆæŒ‰ä½Booté”®ä¸æ”¾ï¼Œç„¶åæ–­ç”µå’Œä¸Šç”µæ“ä½œ</li>
</ul>
<p><em>æ³¨æ„ï¼šé»˜è®¤GPIO0ä¸ºé«˜ç”µå¹³ï¼Œå½“æŒ‰ä¸‹Booté”®åï¼ŒGPIO0ä¸ºä½ç”µå¹³ã€‚å¯ä»¥æŸ¥çœ‹å¼€å‘æ¿åŸç†å›¾å¾—çŸ¥</em></p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é‚£ä¹ˆå¼€å‘æ¿çš„è‡ªåŠ¨ä¸‹è½½æ¨¡å¼çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®æ˜¯é€šè¿‡ç”µè·¯æ¨¡æ‹Ÿäº†è¿›å…¥Bootæ¨¡å¼æ“ä½œã€‚</p>
<p>ä¹é‘«è§£é‡Šäº†å¦‚ä½•è¿›å…¥è‡ªåŠ¨ä¸‹è½½æ¨¡å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><code>esptool.py</code> resets ESP32 automatically by asserting <code>DTR</code> and <code>RTS</code> control lines of the USB to serial converter chip, i.e., FTDI, CP210x, or CH340x. The <code>DTR</code> and <code>RTS</code> control lines are in turn connected to <code>GPIO0</code> and <code>EN</code> (<code>CHIP_PU</code>) pins of ESP32, thus changes in the voltage levels of <code>DTR</code> and <code>RTS</code> will boot the ESP32 into Firmware Download mode.</p>
<p>Noteï¼šWhen developing <code>esptool.py</code>, keep in mind <code>DTR</code> and <code>RTS</code> are active low signals, i.e., <code>True</code> &#x3D; pin @ 0V, <code>False</code> &#x3D; pin @ VCC.</p>
<p>é‡Šä¹‰ï¼šesptool.py é€šè¿‡ç½®ä½ USB è½¬ä¸²å£è½¬æ¢å™¨èŠ¯ç‰‡ï¼ˆå³ FTDIã€CP210x æˆ– CH340xï¼‰çš„ DTR å’Œ RTS æ§åˆ¶çº¿æ¥è‡ªåŠ¨é‡ç½® ESP32ã€‚DTR å’Œ RTS æ§åˆ¶çº¿ä¾æ¬¡è¿æ¥åˆ° ESP32 çš„ GPIO0 å’Œ ENï¼ˆCHIP_PUï¼‰å¼•è„šï¼Œå› æ­¤ DTR å’Œ RTS çš„ç”µå‹å˜åŒ–å°†ä½¿ ESP32 è¿›å…¥å›ºä»¶ä¸‹è½½æ¨¡å¼ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨å¼€å‘ esptool.py æ—¶ï¼Œè¯·è®°ä½ DTR å’Œ RTS æ˜¯ä½ç”µå¹³æœ‰æ•ˆä¿¡å·ï¼Œå³ True &#x3D; å¼•è„š @ 0Vï¼ŒFalse &#x3D; å¼•è„š @ VCCã€‚</p>
</blockquote>
<p>å…ˆæ¥çœ‹å¼€å‘æ¿çš„åŸç†å›¾ï¼ˆä¾æ¬¡ä¸º å›¾1 å’Œ å›¾2ï¼‰ï¼š</p>
<p><img src="/2024/11/17/2024/esp-Automatic-Bootloader/image-20241117173318335.png" alt="image-20241117173318335"></p>
<p><img src="/2024/11/17/2024/esp-Automatic-Bootloader/image-20241117140224096.png" alt="image-20241117140224096"></p>
<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šDTR å’Œ RTS åœ¨å“ªé‡Œï¼Ÿè¿™ä¸¤ä¸ªå¼•è„šåœ¨ CP2102NèŠ¯ç‰‡ä¸Šï¼ˆUSB-UART Bridge ç”µè·¯ï¼‰</p>
<p><strong>ä¸²å£æµæ§æœºåˆ¶ï¼š</strong></p>
<ul>
<li>DTRï¼š Data Terminal Readyï¼Œæ•°æ®ç»ˆç«¯å‡†å¤‡å¥½ï¼Œä½æœ‰æ•ˆ</li>
<li>RTSï¼šRequest To Sendï¼Œè¯·æ±‚å‘é€ï¼Œä½æœ‰æ•ˆ</li>
</ul>
<p>å¦å¤– â€œAuto programâ€ ä¸­æ˜¯æœ‰è§„å¾‹çš„ï¼Œè§„å¾‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å½“ DTR å’Œ RTS åŒæ—¶ä¸º 0 æˆ–è€…åŒæ—¶ä¸º 1 æ—¶ï¼Œä¸‰æç®¡ Q1 å’Œ Q2 å‡ä¸ºæˆªæ­¢çŠ¶æ€ï¼Œæ­¤æ—¶ EN å’Œ IO0 çš„çŠ¶æ€ç”±å…¶ä»–ç”µè·¯å†³å®šï¼ˆå†…éƒ¨&#x2F;å¤–éƒ¨ä¸Šæ‹‰ç”µé˜»ï¼‰ã€‚</li>
<li>å½“ DTR å’Œ RTS ä¸åŒæ—¶ï¼ŒEN &#x3D; RTS, IO0 &#x3D; DTRã€‚</li>
</ol>
<p>è‡ªåŠ¨è¿›å…¥ä¸‹è½½æ¨¡å¼çš„é¡ºåºåº”è¯¥æ˜¯è¿™æ ·çš„ï¼ˆèŠ¯ç‰‡æ–­ç”µï¼Œç„¶åä¸Šç”µï¼‰ï¼šï¼ˆEN&#x3D;0ï¼Œ IO0&#x3D;0ï¼‰â€“&gt;ï¼ˆEN&#x3D;1ï¼ŒIO0&#x3D;0ï¼‰ï¼Œå¯æ˜¯çœ‹ä¸Šå›¾çš„ â€œAuto programâ€ æ˜¯æ²¡æœ‰ï¼ˆEN&#x3D;0ï¼Œ IO0&#x3D;0ï¼‰è¿™ç§é€»è¾‘çš„ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€»è¾‘ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•è¿›å…¥ä¸‹è½½æ¨¡å¼çš„ã€‚ï¼ˆæš‚æ—¶å…ˆä¸ç®¡ï¼‰</p>
<p>æŸ¥çœ‹esptool.pyå…³äºè‡ªåŠ¨ä¸‹è½½æ¨¡å¼çš„å®ç°ï¼Œåœ¨ <a href="https://github.com/espressif/esptool/blob/master/esptool/reset.py">esptool&#x2F;reset.py</a> æ‰¾åˆ°äº†å…·ä½“é€»è¾‘å®ç°ï¼š</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassicReset</span>(<span class="title class_ inherited__">ResetStrategy</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Classic reset sequence, sets DTR and RTS lines sequentially.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._setDTR(<span class="literal">False</span>)  <span class="comment"># IO0=HIGH</span></span><br><span class="line">        <span class="variable language_">self</span>._setRTS(<span class="literal">True</span>)  <span class="comment"># EN=LOW, chip in reset			(1)</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="variable language_">self</span>._setDTR(<span class="literal">True</span>)  <span class="comment"># IO0=LOW 						(2)</span></span><br><span class="line">        <span class="variable language_">self</span>._setRTS(<span class="literal">False</span>)  <span class="comment"># EN=HIGH, chip out of reset 	(3)</span></span><br><span class="line">        time.sleep(<span class="variable language_">self</span>.reset_delay)</span><br><span class="line">        <span class="variable language_">self</span>._setDTR(<span class="literal">False</span>)  <span class="comment"># IO0=HIGH, done 				(4)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸¤ä¸ªç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆåœ¨ (1) å’Œ (2)ä¹‹é—´è¦sleep?   ä¸ºç”šä¹ˆ (3) å’Œ (4) ä¹‹é—´è¦sleep? </p>
<p><strong>åœ¨(1)ä¹‹åï¼Œè®¾ç½®EN&#x3D;0ï¼Œç”±äºå……æ”¾ç”µç”µè·¯ï¼ˆå›¾1ï¼‰ä¸­çš„ç”µå®¹éœ€è¦æ”¾ç”µï¼Œæ‰€ä»¥ENå¹¶ä¸æ˜¯ä¸€ä¸‹å­ä»é«˜ç”µå¹³1çªå˜è‡³ä½ç”µå¹³0ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªæ”¾ç”µæ—¶é—´ã€‚æ•…è¿™é‡Œ sleep 0.1ç§’ï¼Œç¡®ä¿ENä¸€å®šæ˜¯ä½ç”µå¹³0ã€‚æ­¤æ—¶ï¼ŒèŠ¯ç‰‡å¼€å§‹å¤ä½ã€‚</strong></p>
<p><strong>åœ¨(3)ä¹‹åï¼Œè®¾ç½®EN&#x3D;1ï¼Œç”±äºå……æ”¾ç”µç”µè·¯ï¼ˆå›¾1ï¼‰ä¸­çš„ç”µå®¹éœ€è¦å……ç”µï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ä¸€ä¸‹ä»ä½ç”µå¹³0çªå˜è‡³é«˜ç”µå¹³1ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªå……ç”µæ—¶é—´ã€‚æ•…è¿™é‡Œ sleep reset_delay ç§’ï¼Œç¡®ä¿ENä¸€å®šæ˜¯é«˜ç”µå¹³1ã€‚åœ¨ENä»ä½ç”µå¹³åˆ°é«˜ç”µå¹³ï¼ˆä¸Šå‡æ²¿ï¼‰æ—¶ï¼Œæ£€æµ‹åˆ°IO0ä¸ºä½ç”µå¹³0ï¼ŒèŠ¯ç‰‡å¼€å§‹ä¸‹è½½æ¨¡å¼ã€‚</strong></p>
<h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>esptool é€šè¿‡USBå‘é€äº†ä»€ä¹ˆæ•°æ®ç»™ä¸²å£èŠ¯ç‰‡çš„DTRå’ŒRTSå‘¢ï¼Ÿ</p>
<p>å…ˆæŠŠUSBè½¬ä¸²å£ç”µè·¯çš„åŸç†çœ‹ä¸‹ï¼š</p>
<p><img src="/2024/11/17/2024/esp-Automatic-Bootloader/image-20241119134619149.png" alt="image-20241119134619149"></p>
<p>é¦–å…ˆä»USBåˆ°ä¸²å£èŠ¯ç‰‡CP2102Nåªæœ‰ä¸¤æ ¹ä¿¡å·çº¿ï¼šUSB_DN å’Œ USB_DPã€‚ç„¶åé€šè¿‡ä¸²å£èŠ¯ç‰‡CP2102Nå‡ºæ¥äº†4æ ¹ä¿¡å·çº¿ï¼šRXDã€TXDï¼›DTRï¼ˆData Terminal Readyã€RTSï¼ˆRequest to Sendï¼‰ã€‚å…¶ä¸­RXDå’ŒTXDè¿æ¥åˆ°MCUçš„TXD0å’ŒRXD0ï¼Œè€ŒDTRå’ŒRTSåˆ†åˆ«è¿æ¥åˆ°Q1ï¼ˆNPNä¸‰æç®¡ï¼‰å’ŒQ2ï¼ˆNPNï¼‰çš„åŸºçº§ï¼Œç”¨äºé—´æ¥æ§åˆ¶MCUçš„ENå’ŒIO0ã€‚</p>
<p>esptool ä½¿ç”¨äº† pyserial åº“ï¼Œå¯ä»¥æ‰“å¼€ä¸²å£ï¼Œç„¶åç›´æ¥æ§åˆ¶ DTR å’Œ RTSï¼Œç»è¿‡Q1 å’Œ Q2 çš„ç”µè·¯ç‰¹æ€§é—´æ¥æ§åˆ¶MCU çš„EN å’Œ IO0ï¼Œåªè¦æ§åˆ¶ DTR å’Œ RTS æ»¡è¶³ MCU è¿›å…¥ä¸‹è½½æ¨¡å¼çš„æ¡ä»¶ï¼Œå³å¯ä½¿ MCU è¿›å…¥ä¸‹è½½æ¨¡å¼ã€‚</p>
<p>ç¼–è¯‘ Python ç¨‹åºï¼Œä½¿ç”¨ ESP32 å…ˆè¿›å…¥çƒ§å½•æ¨¡å¼ï¼Œç„¶åé‡å¯ ESP32</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼šç¡®å®šä¸²å£åï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µ </span></span><br><span class="line"><span class="comment">#   1ï¼‰å¯¹äºç»™å®šç›®æ ‡ä¸²å£å(ä¾‹å¦‚ /dev/ttyUSB0 or /dev/ttyACM0)</span></span><br><span class="line"><span class="comment">#   2ï¼‰æ²¡æœ‰æŒ‡å®šç›®æ ‡ä¸²å£åï¼Œéœ€è¦åœ¨è®¡ç®—æœºä¸Šç¼–è¯‘æ‰€æœ‰çš„çš„ä¸²å£ï¼Œç„¶åæŒ‡å®šä¸€ä¸ªå¯ç”¨ä¸²å£å</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼šæ‰“å¼€ä¸²å£</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ä¸²å£Read or Write æ•°æ®</span></span><br><span class="line"><span class="comment"># ç¬¬å››æ­¥ï¼šå…³é—­ä¸²å£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> serial <span class="comment">#å¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_serial_port</span>(<span class="params">port, baudrate=<span class="number">9600</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ‰“å¼€æŒ‡å®šçš„ä¸²å£ã€‚</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param port: ä¸²å£å·ï¼Œä¾‹å¦‚ &#x27;COM1&#x27; æˆ– &#x27;/dev/ttyUSB0&#x27;</span></span><br><span class="line"><span class="string">    :param baudrate: æ³¢ç‰¹ç‡ï¼Œé»˜è®¤ä¸º 9600</span></span><br><span class="line"><span class="string">    :return: Serial å¯¹è±¡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ser = serial.Serial(port, baudrate, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Open port <span class="subst">&#123;port&#125;</span> success&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ser</span><br><span class="line">    <span class="keyword">except</span> serial.SerialException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Open port <span class="subst">&#123;port&#125;</span> fail: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data</span>(<span class="params">ser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä»ä¸²å£è¯»å–æ•°æ®ã€‚</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param ser: Serial å¯¹è±¡</span></span><br><span class="line"><span class="string">    :return: è¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> ser <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> ser.is_open:</span><br><span class="line">        <span class="comment"># è¯»å–ä¸€è¡Œæ•°æ®</span></span><br><span class="line">        line = ser.readline()</span><br><span class="line">        <span class="keyword">if</span> line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Recv Data: <span class="subst">&#123;line.decode(<span class="string">&#x27;utf-8&#x27;</span>).strip()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Not Recv Data&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;serial not open&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data_cb</span>(<span class="params">ser, stop_event</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä»ä¸²å£è¯»å–æ•°æ®çš„å‡½æ•°ï¼Œè¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­ã€‚</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param ser: Serial å¯¹è±¡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        received_data = []</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> stop_event.is_set():</span><br><span class="line">            <span class="keyword">if</span> ser.in_waiting &gt; <span class="number">0</span>:</span><br><span class="line">                line = ser.readline()</span><br><span class="line">                <span class="keyword">if</span> line:</span><br><span class="line">                    data = line.decode(<span class="string">&#x27;utf-8&#x27;</span>).strip()</span><br><span class="line">                    received_data.append(data)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Recv Data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">0.01</span>)  <span class="comment"># é¿å…CPUå ç”¨è¿‡é«˜</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Data reading stopped.&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_data</span>(<span class="params">ser, data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å‘ä¸²å£å‘é€æ•°æ®ã€‚</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param ser: Serial å¯¹è±¡</span></span><br><span class="line"><span class="string">    :param data: è¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> ser <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> ser.is_open:</span><br><span class="line">        <span class="comment"># å‘é€æ•°æ®</span></span><br><span class="line">        ser.write(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Send Data: <span class="subst">&#123;data.strip()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Serial not open&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ClassicReset</span>(<span class="params">ser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Classic reset sequence, sets DTR and RTS lines sequentially.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ser.dtr = <span class="literal">False</span>  <span class="comment"># IO0=HIGH</span></span><br><span class="line">    ser.rts = <span class="literal">True</span>  <span class="comment"># EN=LOW, chip in reset</span></span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    ser.dtr = <span class="literal">True</span>  <span class="comment"># IO0=LOW</span></span><br><span class="line">    ser.rts = <span class="literal">False</span>  <span class="comment"># EN=HIGH, chip out of reset</span></span><br><span class="line">    <span class="comment"># default time (0.05) to wait before releasing boot pin after reset</span></span><br><span class="line">    time.sleep(<span class="number">0.05</span>)</span><br><span class="line">    ser.dtr = <span class="literal">False</span>  <span class="comment"># IO0=HIGH, done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HardReset</span>(<span class="params">ser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Reset sequence for hard resetting the chip.</span></span><br><span class="line"><span class="string">    Can be used to reset out of the bootloader or to restart a running app.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ser.dtr = <span class="literal">False</span></span><br><span class="line">    ser.rts = <span class="literal">True</span>  <span class="comment"># EN-&gt;LOW</span></span><br><span class="line">    <span class="comment"># Give the chip some time to come out of reset,</span></span><br><span class="line">    <span class="comment"># to be able to handle further DTR/RTS transitions</span></span><br><span class="line">    time.sleep(<span class="number">0.2</span>)</span><br><span class="line">    ser.rts = <span class="literal">False</span></span><br><span class="line">    time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># è®¾ç½®ä¸²å£å‚æ•°</span></span><br><span class="line">    port = <span class="string">&#x27;/dev/ttyUSB0&#x27;</span>  <span class="comment"># æ ¹æ®ä½ çš„è®¾å¤‡ä¿®æ”¹æ­¤å€¼</span></span><br><span class="line">    baudrate = <span class="number">115200</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å¼€ä¸²å£</span></span><br><span class="line">    ser = open_serial_port(port, baudrate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ser <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¯»å–ä¸²å£æ•°æ®</span></span><br><span class="line">            stop_event = threading.Event()</span><br><span class="line">            read_thread = threading.Thread(target=read_data_cb, args=(ser, stop_event))</span><br><span class="line">            read_thread.start()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‘é€æ•°æ®</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--&gt; ESP32 autoboot mode&quot;</span>)</span><br><span class="line">            ClassicReset(ser) <span class="comment"># è®¾ç½®DTR å’Œ RTSï¼Œå°†ESP32è¿›å…¥çƒ§å½•æ¨¡å¼</span></span><br><span class="line">            time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--&gt; ESP32 reset&quot;</span>)</span><br><span class="line">            HardReset(ser) <span class="comment"># è®¾ç½®RTSï¼Œå¤ä½ESP32</span></span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="comment"># è¾“å…¥æ•°æ®</span></span><br><span class="line">                user_input = <span class="built_in">input</span>(<span class="string">&quot;Please input send data:&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;quit&#x27;</span>, <span class="string">&#x27;exit&#x27;</span>]:</span><br><span class="line">                    stop_event.<span class="built_in">set</span>() <span class="comment"># é€šçŸ¥å­çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">                    read_thread.join() <span class="comment"># ç­‰å¾…å­çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å‘é€æ•°æ®</span></span><br><span class="line">                write_data(ser, user_input + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Program is interrupted(Ctrl+C) by user&quot;</span>)</span><br><span class="line">            stop_event.<span class="built_in">set</span>() <span class="comment"># é€šçŸ¥å­çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">            read_thread.join() <span class="comment"># ç­‰å¾…å­çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># å…³é—­ä¸²å£</span></span><br><span class="line">            ser.close()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Port <span class="subst">&#123;port&#125;</span> close&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>







<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.muselab-tech.com/esp8266-esp32zi-dong-xia-zai-dian-lu-yuan-li-fen-xi/">ESP8266&#x2F;ESP32è‡ªåŠ¨ä¸‹è½½ç”µè·¯åŸç†åˆ†æ</a></p>
<p><a href="https://docs.espressif.com/projects/esptool/en/latest/esp32/advanced-topics/boot-mode-selection.html">Boot Mode Selection</a></p>
<p><a href="https://github.com/espressif/esptool/tree/master">esptool</a></p>
<p><a href="https://www.cnblogs.com/tangwc/p/18523621">ESP32è‡ªåŠ¨ä¸‹è½½ç”µè·¯</a></p>
<p><a href="https://wzx046.github.io/post/37/">ESP32è‡ªåŠ¨ä¸‹è½½ç”µè·¯åˆ†æ</a></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>esp32</tag>
        <tag>Automatic Bootloader</tag>
      </tags>
  </entry>
  <entry>
    <title>Captive Portal</title>
    <url>/2024/11/16/2024/Captive-Portal/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨æ ¡å›­ã€æœºåœºã€é…’åº—ã€é“¶è¡Œã€å’–å•¡åº—ã€è‚¯å¾·åŸºã€éº¦å½“åŠ³ç­‰åœºæ‰€è¿æ¥ WiFi æ—¶ï¼Œä½ å‘ç°ä¸ç”¨è¾“å…¥WiFi çš„å¯†ç ï¼Œè€Œæ˜¯å¼¹å‡ºä¸€ä¸ªç½‘é¡µã€‚æœ‰çš„éœ€è¦ä½ è¾“å…¥æ‰‹æœºå·å¹¶ç‚¹å‡»è·å–éªŒè¯ç ï¼Œå¹¶å°†é€šè¿‡çŸ­ä¿¡è·å–çš„éªŒè¯ç è¾“å…¥ï¼Œä½ å°±å¯ä»¥æ­£å¸¸ä¸Šç½‘äº†ã€‚æœ‰çš„éœ€è¦ä½ è¾“å…¥æ­£ç¡®çš„è´¦å·å’Œå¯†ç å¹¶ç‚¹å‡»ç™»å½•ï¼Œç„¶åä½ ä¹Ÿå¯ä»¥ä¸Šç½‘ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨å®¶é‡Œè¿æ¥ WiFi æ—¶ï¼Œå¹¶æ²¡æœ‰å¼¹å‡ºæ‰€è°“çš„ç½‘é¡µå‘¢ï¼Ÿç»è¿‡æˆ‘åœ¨æµè§ˆå™¨çš„ç–¯ç‹‚æœç´¢å’Œæµè§ˆï¼ŒåŸæ¥ä½¿ç”¨ä¸€ç§å«åš â€œCaptive Portalâ€ çš„æŠ€æœ¯å®ç°ã€‚</p>
<h2 id="captive-portal"><a href="#captive-portal" class="headerlink" title="captive portal"></a>captive portal</h2><p>captive portalï¼ˆä¸­æ–‡ç§°ä¹‹ä¸º <strong>å¼ºåˆ¶é—¨æˆ·</strong>ï¼‰æ˜¯ä¸€ç§é€šè¿‡ Web æµè§ˆå™¨è®¿é—®çš„ç½‘é¡µï¼Œåœ¨æˆäºˆæ–°è¿æ¥çš„ Wi-Fi æˆ–æœ‰çº¿ç½‘ç»œç”¨æˆ·æ›´å¹¿æ³›çš„ç½‘ç»œèµ„æºè®¿é—®æƒé™ä¹‹å‰ï¼Œä¼šå‘ä»–ä»¬æ˜¾ç¤ºè¯¥ç½‘é¡µã€‚å¼ºåˆ¶é—¨æˆ·é€šå¸¸ç”¨äºæ˜¾ç¤ºç€é™†é¡µæˆ–ç™»å½•é¡µé¢ï¼Œè¯¥é¡µé¢å¯èƒ½è¦æ±‚èº«ä»½éªŒè¯ã€ä»˜æ¬¾ã€æ¥å—æœ€ç»ˆç”¨æˆ·è®¸å¯åè®®å¯æ¥å—ä½¿ç”¨æ”¿ç­–ã€å®Œæˆè°ƒæŸ¥æˆ–æä¾›ä¸»æœºå’Œç”¨æˆ·éƒ½åŒæ„éµå®ˆçš„å…¶ä»–æœ‰æ•ˆå‡­è¯ã€‚å¼ºåˆ¶é—¨æˆ·å¹¿æ³›ç”¨äºå„ç§ç§»åŠ¨å’Œæ­¥è¡Œå®½å¸¦æœåŠ¡ï¼ŒåŒ…æ‹¬æœ‰çº¿å’Œå•†ä¸šæä¾›çš„ Wi-Fi å’Œå®¶åº­çƒ­ç‚¹ã€‚å¼ºåˆ¶é—¨æˆ·è¿˜å¯ç”¨äºæä¾›å¯¹ä¼ä¸šæˆ–ä½å®…æœ‰çº¿ç½‘ç»œçš„è®¿é—®ï¼Œä¾‹å¦‚å…¬å¯“ã€é…’åº—æˆ¿é—´å’Œå•†åŠ¡ä¸­å¿ƒã€‚</p>
<p><img src="/2024/11/16/2024/Captive-Portal/image-20241116191019492.png" alt="image-20241116191019492"></p>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>è‡ªåŠ¨å¼¹å‡ºCaptive Portalè®¤è¯é¡µé¢å®ç°åŸç†ï¼šç»ˆç«¯ï¼ˆæ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ç­‰è®¾å¤‡ï¼‰è¿æ¥åˆ°WiFiåï¼ˆä¸€èˆ¬è¯¥WiFiåŠ å¯†æ–¹å¼ä¸ºOPENï¼‰ï¼Œä¸»åŠ¨å‘å‡ºHTTPçš„æ¢æµ‹è¯·æ±‚æŠ¥æ–‡ï¼Œæ£€æµ‹ç›®çš„åœ°å€æ˜¯å¦å¯è¾¾ï¼Œä»¥åŠå›åº”çš„å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œä»¥æ­¤æ¥åˆ¤æ–­æ¥å…¥çš„ç½‘ç»œæ˜¯å¦éœ€è¦è¿›è¡ŒCaptive Portalè®¤è¯ã€‚ç»ˆç«¯æ¢æµ‹çš„ç›®æ ‡URLä¸€èˆ¬æ˜¯å›ºå®šçš„ç½‘å€ï¼Œå„ç»ˆç«¯æˆ–APPåº”ç”¨å­˜åœ¨å·®å¼‚ã€‚å¦‚æœç›®æ ‡URLä¸å¯è¾¾æˆ–å›åº”å†…å®¹ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆç»ˆç«¯ä¼šè°ƒç”¨æµè§ˆå™¨å†æ¬¡å‘å‡ºHTTPè¯·æ±‚ï¼Œè·¯ç”±å™¨æ‹¦æˆªåˆ°æ­¤è¯·æ±‚è¿›è¡Œé‡å®šå‘ï¼Œå®ç°è‡ªåŠ¨å¼¹å‡ºCaptive Portalè®¤è¯é¡µé¢çš„åŠŸèƒ½ã€‚</p>
<p>æŸäº›ç»ˆç«¯æ— æ³•è‡ªåŠ¨å¼¹å‡ºé¡µé¢çš„åŸå› ï¼š</p>
<ul>
<li>ç»ˆç«¯ä¸ä¼šä¸»åŠ¨å‘å‡ºæ¢æµ‹è¯·æ±‚æŠ¥æ–‡ã€‚</li>
<li>ç»ˆç«¯å¯ä»¥å‘å‡ºä¸€æ¬¡æ¢æµ‹è¯·æ±‚æŠ¥æ–‡ï¼Œä½†æ˜¯ç”±äºæŸäº›å®‰è£…çš„APPå½±å“å¯¼è‡´ç»ˆç«¯æ— æ³•è°ƒç”¨æµè§ˆå™¨å†æ¬¡å‘å‡ºè¯·æ±‚ï¼Œæ— æ³•è‡ªåŠ¨å¼¹å‡ºé¡µé¢ã€‚</li>
<li>å¤§éƒ¨åˆ†å®‰å“æ‰‹æœºï¼Œè‡ªåŠ¨å¼¹portalåŠŸèƒ½ï¼Œä¾èµ–ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»ssidç•Œé¢è¿›è¡Œè§¦å‘ã€‚</li>
</ul>
<p>ä¸åŒå¹³å°å¯¹åº”çš„æµ‹è¯•å›ºå®šç½‘å€å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th><strong>Platform</strong></th>
<th><strong>Test URL</strong></th>
<th><strong>Expected response</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Apple (MacOS&#x2F;IOS Family)</td>
<td><a href="http://captive.apple.com/hotspot-detect.html">http://captive.apple.com/hotspot-detect.html</a></td>
<td>â€œSuccessâ€ (plain text)</td>
</tr>
<tr>
<td>Google (Android&#x2F;ChromeOS)</td>
<td><a href="http://connectivitycheck.gstatic.com/generate_204">http://connectivitycheck.gstatic.com/generate_204</a></td>
<td>HTTP status code 204 with an empty body</td>
</tr>
<tr>
<td>Windows</td>
<td><a href="http://www.msftconnecttest.com/connecttest.txt">http://www.msftconnecttest.com/connecttest.txt</a></td>
<td>â€œMicrosoft Connect Testâ€ (plain text)</td>
</tr>
<tr>
<td>NetworkManager (GNOME)</td>
<td><a href="http://nmcheck.gnome.org/check_network_status.txt">http://nmcheck.gnome.org/check_network_status.txt</a></td>
<td>â€œNetworkManager is onlineâ€ (plain text)</td>
</tr>
<tr>
<td>NetworkManager (KDE Plasma)</td>
<td><a href="http://networkcheck.kde.org/">http://networkcheck.kde.org/</a></td>
<td>â€œOKâ€ (plain text)</td>
</tr>
</tbody></table>
<h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><p>captive portalçš„å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>DNSæ‹¦æˆªï¼šå°†æ‰€æœ‰ DNS è¯·æ±‚æŒ‡å‘è‡ªå·±çš„ portal åœ°å€</li>
<li>HTTPé‡å®šå‘ï¼šç›´æ¥åŠ«æŒ HTTP&#x2F;HTTPS æµé‡ï¼Œå“åº”è‡ªå·±çš„é¡µé¢</li>
</ul>
<p><em>æ³¨æ„ï¼šä»…ç½‘å…³å®ç°äº†Captive Portalè¿˜ä¸å¤Ÿï¼Œè¿˜ä¸èƒ½è‡ªåŠ¨å¼¹å‡ºè®¤è¯é¡µé¢ã€‚éœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒæ‰èƒ½å®ç°åœ¨ç½‘ç»œè¿æ¥åä¸»åŠ¨å¼¹å‡ºè®¤è¯é¡µé¢çš„åŠŸèƒ½ã€‚</em></p>
<h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><p>ä»Šå¤©ï¼ˆ2024-11-17ï¼‰ä¸Šåˆæˆ‘è¿æ¥ä¸Šäº†å›¾ä¹¦é¦†çš„WiFiï¼ˆssid&#x3D;readerï¼‰ï¼Œåœ¨Ubuntuç³»ç»Ÿæ¶ˆæ¯ä¸­å¿ƒä¸Šå¼¹å‡ºäº†Webè®¤è¯æ¶ˆæ¯ï¼Œç‚¹å‡»åå°±å¯ä»¥è·³è½¬åˆ°ç½‘é¡µã€‚æ­¤æ—¶æˆ‘çš„WifIå›¾æ ‡è¿˜æ˜¯å¸¦é—®å·ï¼Œä½†æˆ‘è¾“å…¥æ­£ç¡®çš„è´¦å·å’Œå¯†ç ï¼Œå°±æˆåŠŸè·³è½¬åˆ°å›¾ä¹¦é¦†çš„å®˜ç½‘ä¸»é¡µï¼ŒåŒæ—¶WiFIå›¾æ ‡çš„é—®å·æ¶ˆå¤±ã€‚</p>
<p>æˆ‘ä½¿ç”¨ wireshark æŠŠè¿™ä¸ªè¿‡ç¨‹çš„æ•°æ®åŒ…éƒ½æŠ“ä¸‹æ¥äº†ã€‚å½“æˆ‘ç‚¹å‡» reader WiFiç½‘ç»œæ—¶ï¼Œæ­¤æ—¶æˆ‘å…¶å®å·²ç»è¿æ¥ä¸Šäº† reader WiFiç½‘ç»œï¼Œæˆ‘çš„IPåœ°å€æ˜¯ <code>10.5.243.105</code>ï¼Œåªæ˜¯æ— æ³•æ¥å…¥äº’è”ç½‘ã€‚åœ¨wireshark ä¸­å‡ºç°äº†å¾ˆå¤š mDNS æ•°æ®åŒ…ï¼ŒæŒ‰ç…§æ­£å¸¸çš„æ­¥éª¤ï¼ŒUbuntu åº”è¯¥ä¼šå°è¯•å»è®¿é—®å›ºå®šçš„URLï¼Œé‚£ä¹ˆé¦–å…ˆè¦è¿›è¡ŒDNSè§£æï¼Œæ‰€æœ‰å…ˆæŠŠ DNS æ•°æ®åŒ…è¿‡æ»¤å‡ºæ¥ã€‚</p>
<p>Ubuntu ä¼šå‘å‡º DNS æ•°æ®åŒ…ï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„ä½œç”¨æ˜¯ï¼šè¯·æ±‚æœ¬åœ°ç½‘å…³å¸®æˆ‘è§£æåŸŸå <code>connectivity-check.ubuntu.com</code> ï¼Œå¦‚æœæœ¬åœ°ç½‘å…³ï¼ˆç½‘ç»œIPæ˜¯ <code>10.5.9.9</code>ï¼‰ä¹Ÿä¸çŸ¥é“ï¼Œæ¥ç€æŠ¥æ•°æ®åŒ…è½¬å‘ç»™ä¸Šä¸€çº§ DNS æœåŠ¡å™¨ã€‚å¯æ˜¯ä»æŠ“åŒ…ç»“æœæ¥çœ‹ï¼Œæœ¬åœ°ç½‘ç»œæ˜¾ç„¶æ˜¯çŸ¥é“è¯¥åŸŸåå¯¹åº”çš„IPåœ°å€çš„ã€‚</p>
<p><img src="/2024/11/16/2024/Captive-Portal/image-20241117100111698.png" alt="image-20241117100111698"></p>
<p>Ubuntu æ‹¿åˆ°äº†åŸŸå <code>connectivity-check.ubuntu.com</code> çš„IPåœ°å€ï¼Œæ¥ç€å°±ä¼šå‘å‡º HTTP è¯·æ±‚ï¼ŒURLæ˜¯ <code>http:connectivity-check.ubuntu.com:80</code> ï¼Œæ‰€æœ‰æˆ‘åœ¨ wireshark ä¸­æŠŠ HTTP æ•°æ®åŒ…è¿‡æ»¤å‡ºæ¥ã€‚</p>
<p><img src="/2024/11/16/2024/Captive-Portal/image-20241117102414335.png" alt="image-20241117102414335"></p>
<p>HTTP è¯·æ±‚æˆåŠŸäº†ï¼Œçœ‹ä¸€ä¸‹ HTTP åº”ç­”çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ—¶å€™æœ‰æ„æ€çš„åœ°æ–¹æ¥äº†ï¼ŒHTTP åº”ç­”æŠ¥æ–‡ä¸ºå¦‚ä¸‹éƒ¨åˆ†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Frame 662: 562 bytes on wire (4496 bits), 562 bytes captured (4496 bits) on interface wlp1s0, <span class="built_in">id</span> 0</span><br><span class="line">Ethernet II, Src: HuaweiTe_28:33:a0 (e8:ea:4d:28:33:a0), Dst: 60:e9:aa:d3:81:93 (60:e9:aa:d3:81:93)</span><br><span class="line">Internet Protocol Version 4, Src: 91.189.91.97, Dst: 10.5.243.105</span><br><span class="line">Transmission Control Protocol, Src Port: 80, Dst Port: 42282, Seq: 1, Ack: 88, Len: 508</span><br><span class="line">Hypertext Transfer Protocol</span><br><span class="line">    HTTP/1.1 200 OK\r\n</span><br><span class="line">    Content-Type: text/html\r\n</span><br><span class="line">    Content-Length: 443\r\n</span><br><span class="line">    \r\n</span><br><span class="line">    [HTTP response 1/1]</span><br><span class="line">    [Time since request: 0.003968927 seconds]</span><br><span class="line">    [Request <span class="keyword">in</span> frame: 661]</span><br><span class="line">    [Request URI: http://connectivity-check.ubuntu.com/]</span><br><span class="line">    File Data: 443 bytes</span><br><span class="line">Line-based text data: text/html (9 lines)</span><br><span class="line">    &lt;HTML&gt;\r\n</span><br><span class="line">    &lt;HEAD&gt;\r\n</span><br><span class="line">    &lt;TITLE&gt; Web Authentication Redirect&lt;/TITLE&gt;\r\n</span><br><span class="line">    &lt;META http-equiv=<span class="string">&quot;Cache-control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;\r\n</span><br><span class="line">    &lt;META http-equiv=<span class="string">&quot;Pragma&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;\r\n</span><br><span class="line">    &lt;META http-equiv=<span class="string">&quot;Expires&quot;</span> content=<span class="string">&quot;-1&quot;</span>&gt;\r\n</span><br><span class="line">    &lt;META http-equiv=<span class="string">&quot;refresh&quot;</span> content=<span class="string">&quot;1; URL=http://10.5.12.50:8445/portal?wac%2Dmac=f4fbb823682f&amp;redirect%2Durl=http%3A%2F%2Fconnectivity%2Dcheck%2Eubuntu%2Ecom&amp;ssid=reader&amp;uaddress=10%2E5%2E243%2E105&amp;umac=60e9aad38193&quot;</span>&gt;\r\n</span><br><span class="line">    &lt;/HEAD&gt;\r\n</span><br><span class="line">    &lt;/HTML&gt;\r\n</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è€Œä¸Šè¿°å†…å®¹ä¸­çš„URLå°±æ˜¯Webè®¤è¯ç½‘é¡µï¼Œç”¨æˆ·åªè¦åœ¨Ubuntuçš„æ¶ˆæ¯ä¸­å¿ƒç‚¹å‡»WiFiè®¤è¯æ¶ˆæ¯ï¼Œå°±ä¼šå‘è¿™ä¸ªURLå‘é€HTTPè¯·æ±‚ï¼Œç„¶åå‡ºç°WiFIè®¤è¯é¡µé¢ã€‚</p>
<h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>1ã€å¦‚æœæˆ‘ä¸æƒ³åœ¨Ubuntuå¼€å¯ç½‘ç»œæ£€æµ‹ï¼Œè¯¥å¦‚ä½•è®¾ç½®ï¼Ÿ</p>
<p>å…¶å®åœ¨Ubuntu 22.04 ä¸­ï¼Œç½‘ç»œæ£€æµ‹æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå½“æˆ‘ä»¬è¿æ¥åˆ°ä¸€ä¸ªæœ‰é™ç½‘ç»œæˆ–æ— çº¿ç½‘ç»œæ—¶ï¼ŒUbuntu ä¼šå°è¯•å»è®¿é—®å›ºå®šçš„URLæ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è®¿é—®äº’è”ç½‘ã€‚</p>
<p><img src="/2024/11/16/2024/Captive-Portal/image-20241117110835593.png" alt="image-20241117110835593"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.twomeetings.com/2020-07-24-how-to-build-captive-portal-with-nodogslash/">å¦‚ä½•æ­å»ºç±»ä¼¼éº¦å½“åŠ³åº—ä¸­éœ€ç™»å½•è®¤è¯çš„wifi</a></p>
<p><a href="https://blog.sixiaolong.win/2023/02/06/%E4%BD%BF%E7%94%A8ESP32C3%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%88%B6%E9%97%A8%E6%88%B7%EF%BC%88Captive-Portal%EF%BC%89/">ä½¿ç”¨ESP32C3å¼€å‘æ¿å®ç°ä¸€ä¸ªå¼ºåˆ¶é—¨æˆ·ï¼ˆCaptive Portalï¼‰</a></p>
<p><a href="https://pimylifeup.com/raspberry-pi-wireless-access-point/">æ ‘è“æ´¾æ­å»ºwifiçƒ­ç‚¹</a></p>
<p><a href="https://pimylifeup.com/raspberry-pi-captive-portal/">æ ‘è“æ´¾æ­å»ºcaptive-portal</a></p>
<p><a href="https://github.com/ospanic/Captive_Portal_ESP">Captive_Portal_ESP</a></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>Captive Portal</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: idf project architecture</title>
    <url>/2024/11/15/2024/esp-idf-project-architecture/</url>
    <content><![CDATA[<p><a href="https://www.bilibili.com/video/BV18keGeaEhE/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=a8965eb911e5c2e6ddd23064aced2e6b">å…¥é—¨ ESP-IDF å·¥ç¨‹ç»“æ„ã€æ–°æ‰‹è¶…è¯¦ç»†æ•™ç¨‹ã€‘</a></p>
<blockquote>
<p>ç›®çš„ï¼šæ›´é«˜æ•ˆçš„å¼€å‘å’Œç®¡ç†è‡ªå·±çš„ ESP-IDF å·¥ç¨‹</p>
</blockquote>
<h2 id="å·¥ç¨‹ç»“æ„"><a href="#å·¥ç¨‹ç»“æ„" class="headerlink" title="å·¥ç¨‹ç»“æ„"></a>å·¥ç¨‹ç»“æ„</h2><p>ä¸€ä¸ª <code>ESP-IDF</code> å·¥ç¨‹å¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ª<strong>ç»„ä»¶</strong>çš„é›†åˆã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ç»„ä»¶å‘¢ï¼Ÿ ç»„ä»¶å…¶å®å°±æ˜¯ç‹¬ç«‹çš„ä»£ç æ¨¡å—ï¼Œä¹é‘«æä¾›åŸºç¡€çš„ç³»ç»Ÿç»„ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="/2024/11/15/2024/esp-idf-project-architecture/image-20241130130141239.png" alt="image-20241130130141239"></p>
<p>ä¾‹å¦‚ï¼šå¼€å‘ä¸€ä¸ªæ™ºèƒ½å°ç¯éœ€è¦çš„ç»„ä»¶ï¼š</p>
<ol>
<li>ESP-IDFåŸºç¡€åº“ï¼šæä¾›åŸºæœ¬çš„åŠŸèƒ½åº“å’Œåº•å±‚ç¡¬ä»¶ç»‘å®š</li>
<li>FreeRTOS æ“ä½œç³»ç»Ÿï¼šå®æ—¶æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œç®¡ç†ä¸åŒçš„ä»»åŠ¡</li>
<li>WiFi é©±åŠ¨ï¼šè¿æ¥æ— çº¿ç½‘ç»œï¼Œå‘é€å’Œæ¥å—æ§åˆ¶æŒ‡ä»¤</li>
<li>TCP&#x2F;IP åè®®æ ˆï¼šå¤„ç†ç½‘ç»œé€šä¿¡</li>
<li>åº”ç”¨å±‚åè®®ï¼šå¤„ç†æ¥è‡ªäº‘ç«¯çš„æ§åˆ¶æŒ‡ä»¤</li>
<li>ç¯çš„æ§åˆ¶é©±åŠ¨ï¼šæ§åˆ¶ç¯å¼€&#x2F;å…³å’Œäº®åº¦</li>
<li>ä¸»ç¨‹åºï¼šå°†æ‰€æœ‰ç»„ä»¶æ•´åˆåœ¨ä¸€èµ·ï¼Œå®ç°åŠŸèƒ½é€»è¾‘</li>
</ol>
<p>ä¸€ä¸ªæ ‡å‡†çš„ESP-IDFå·¥ç¨‹åªæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬ä¸€äº›ç»„ä»¶å’Œé…ç½®æ–‡ä»¶ã€‚é€šè¿‡å·¥ç¨‹é¡¶å±‚ <code>CMakeLists.txt</code> æ–‡ä»¶ï¼Œå°†æ‰€æœ‰ç»„ä»¶æ•´åˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡ <code>cmake</code> å·¥å…·ç”Ÿæˆ <code>makefile</code> æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨ <code>ninja (æˆ–make)</code> å·¥å…·æ ¹æ® <code>makefile</code> æ‰§è¡Œç¼–è¯‘ã€é“¾æ¥ç­‰æ­¥éª¤ã€‚CMakeLists.txtçš„ä½ç½®ï¼šå·¥ç¨‹çš„é¡¶å±‚ç›®å½•å†…å’Œå…¶ä»–ç»„ä»¶å†…ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½è¦æœ‰è‡ªå·±çš„CMakeList.txtï¼ŒåŒ…æ‹¬mainç»„ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯¦ç»†æ‰§è¡Œæ­¥éª¤ï¼Œå½“å‰å¤„äºå·¥ç¨‹ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mkdir</span> -p build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -G Ninja</span><br><span class="line">ninja</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ESP-IDF æŠŠä¸Šé¢çš„æ“ä½œæ­¥éª¤å°è£…ä¸€å¥å‘½ä»¤ï¼š<code>idf.py build</code>ã€‚</p>
<h2 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h2><p>ä»¥ <code>hello-world</code> å·¥ç¨‹æ¥è¯´æ˜ ESP-IDF çš„å·¥ç¨‹ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tree -l 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ main</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.c</span><br><span class="line">â””â”€â”€ README.md</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡CMakeLists.txtå¯ä»¥æ³¨å†Œç»„ä»¶ï¼Œå·¥ç¨‹é¡¶å±‚ <code>CMakeLists.txt</code> å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éµå¾ªCMakeLists.txtçš„è¯­æ³•</span></span><br><span class="line"><span class="comment"># æŒ‡å®šcmakeæœ€å°ç‰ˆæœ¬è¦æ±‚</span></span><br><span class="line">cmake_minimum_required(VERSION 3.16)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥cmakeå„ç§åŠŸèƒ½ï¼Œç”¨æ¥é…ç½®é¡¹ç›®å’Œæ£€ç´¢ç»„ä»¶</span></span><br><span class="line">include(<span class="variable">$ENV</span>&#123;IDF_PATH&#125;/tools/cmake/project.cmake)</span><br><span class="line"><span class="comment"># æŒ‡å®šå·¥ç¨‹åç§°ï¼Œç¼–è¯‘åäºŒè¿›åˆ¶çš„åå­—</span></span><br><span class="line">project(hello_world)</span><br></pre></td></tr></table></figure>

<p>è€Œ <code>main/CMakeLists.txt</code> å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mianç»„ä»¶ä¼šé»˜è®¤require IDFçš„ç›¸å…³ç»„ä»¶ä¾èµ–ï¼Œå…¶ä»–ç»„ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¾èµ–</span></span><br><span class="line">idf_component_register(SRCS </span><br><span class="line">							<span class="string">&quot;main.c&quot;</span></span><br><span class="line">                    INCLUDE_DIRS </span><br><span class="line">                    		<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>idf.py set-target esp32</code> ï¼Œè‡ªåŠ¨åˆ›å»º <code>build</code> ç›®å½•ï¼Œå¹¶å°†è¿‡ç¨‹æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸‹ï¼ŒåŒæ—¶å·¥ç¨‹ç›®å½•è‡ªåŠ¨åˆ›å»º <code>sdkconfig</code> æ–‡ä»¶ã€‚</p>
<blockquote>
<p>idf.py set-target æ”¯æŒå“ªäº›ç›®æ ‡èŠ¯ç‰‡ç³»åˆ—ï¼Ÿ æ‰§è¡Œå‘½ä»¤ <code>idf.py --list-targets</code> å°±å¯ä»¥çœ‹åˆ°æ”¯æŒçš„èŠ¯ç‰‡ç³»åˆ—</p>
</blockquote>
<p>æ‰§è¡Œ <code>idf.py menuconfig</code> ï¼Œå‡ºç°ç¼–è¯‘é…ç½®èœå•ï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹é…ç½®é¡¹ã€‚</p>
<p>æ‰§è¡Œ <code>idf.py build</code> ï¼Œå¼€å§‹ç¼–è¯‘ã€‚</p>
<p>æ‰§è¡Œ <code>idf.py -p /dev/ttyUSB0 flash</code> ï¼Œé€šè¿‡æŒ‡å®šçš„ä¸²å£ &#x2F;dev&#x2F;ttyUSB0 å°†å›ºä»¶çƒ§å½•åˆ°ESPç¡¬ä»¶ã€‚</p>
<p>æ‰§è¡Œ <code>idf.py -p /dev/ttyUSB0 monitor</code> ï¼Œé€šè¿‡æŒ‡å®šçš„ä¸²å£ &#x2F;dev&#x2F;ttyUSB0 ç›‘æ§ä¸²å£æ—¥å¿—ã€‚</p>
<p>å…³äºä¸Šè¿°çš„æ„å»ºç³»ç»Ÿçš„æ“ä½œæ­¥éª¤å»ºè®®å‚è€ƒä¹é‘«å®˜æ–¹çš„æ•™ç¨‹ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v4.4/esp32/api-guides/build-system.html">æ„å»ºç³»ç»Ÿï¼ˆCMake ç‰ˆï¼‰</a></p>
<h2 id="å¯¼å…¥ç»„ä»¶"><a href="#å¯¼å…¥ç»„ä»¶" class="headerlink" title="å¯¼å…¥ç»„ä»¶"></a>å¯¼å…¥ç»„ä»¶</h2><p>å¯¼å…¥ç»„ä»¶åˆ° ESP-IDF å·¥ç¨‹çš„æ–¹å¼ï¼š</p>
<ol>
<li>å¯¼å…¥ ESP-IDF æœ¬åœ°æ¡†æ¶ä¸‹ç»„ä»¶ï¼ˆè‡ªåŠ¨å¯¼å…¥ï¼Œæ— éœ€ç”¨æˆ·æ“ä½œï¼‰</li>
<li>é€šè¿‡å·¥ç¨‹ç›®å½•ä¸‹çš„ CMakeLists.txt æŒ‡å®šé¢å¤–çš„ç»„ä»¶</li>
<li>åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»º component æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è‡ªå®šä¹‰ç»„ä»¶æ”¾è¿›æ¥ã€‚è€Œä¸”ä¸éœ€è¦åœ¨å·¥ç¨‹ç›®å½•ä¸‹çš„ CMakeLists.txt ä¸‹å£°æ˜å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç»„ä»¶ã€‚</li>
<li>é€šè¿‡ç»„ä»¶ç®¡ç†å™¨å°†<a href="https://components.espressif.com/">ä¹é‘«å®˜æ–¹ç»„ä»¶ä»“åº“</a>å¯¼å…¥ç»„ä»¶ï¼Œåœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ <code>idf.py add-dependency &quot;[å‘½åç©ºé—´]/&lt;ç»„ä»¶å&gt;[ç‰ˆæœ¬å·]&quot;</code>ï¼Œä¾‹å¦‚ï¼š<code>idf.py add-dependency &quot;espressif/button^3.4.0&quot;</code></li>
</ol>
<p>å¯¹äºç»„ä»¶çš„è¯´æ˜å’Œè§£è¯»ï¼Œå»ºè®®å‚è€ƒä¹é‘«å®˜æ–¹çš„æ•™ç¨‹ï¼š<a href="https://docs.espressif.com/projects/esp-techpedia/zh_CN/latest/esp-friends/advanced-development/component-management.html?highlight=cmakelists%20txt">ç»„ä»¶ç®¡ç†å’Œä½¿ç”¨</a></p>
<h2 id="sdkconfig-defaults"><a href="#sdkconfig-defaults" class="headerlink" title="sdkconfig.defaults"></a>sdkconfig.defaults</h2><p>æ‰§è¡Œ <code>idf.py menuconfig</code> åï¼Œä¼šå°†ç”¨æˆ·ä¿®æ”¹åçš„é…ç½®é¡¹æ›´æ”¹åˆ° <code>sdkconfig</code> æ–‡ä»¶ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·å¸Œæœ›æ–°å»º <code>sdkconfig</code> æ—¶ï¼Œå°±èƒ½å¤Ÿæ ¹æ®é»˜è®¤çš„é…ç½®è½½å…¥sdkconfigæ–‡ä»¶ä¸­ï¼Œè§£å†³æ–¹å¼å°±æ˜¯åˆ©ç”¨ <code>sdkconfig.defaults</code> æ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼šå½“ç”¨æˆ·ä½¿ç”¨çš„å¼€å‘æ¿ ESP-DevKitCï¼Œè¯¥å¼€å‘æ¿çš„flashå¤§å°ï¼Œä»¥åŠæŒ‰é”®å¯¹åº”çš„GPIOéƒ½æ˜¯å›ºå®šå¥½çš„ã€‚åœ¨ç¬¬ä¸€æ¬¡ <code>idf.py menuconfig</code> é…ç½®å¥½åï¼Œæ¥ç€æ‰§è¡Œ <code>idf.py save-defconfig</code> å°±ä¼šåˆ›å»º <code>sdkconfig.defaults</code> æ–‡ä»¶ï¼Œä»¥åçš„å·¥ç¨‹å°±å¯ä»¥æ‹·è´è¿™ä¸ªæ–‡ä»¶ä½¿ç”¨ã€‚</p>
<h2 id="Kconfig"><a href="#Kconfig" class="headerlink" title="Kconfig"></a>Kconfig</h2><p>æ¯ä¸ªç»„ä»¶è¿˜å¯ä»¥åŒ…å«ä¸€ä¸ª <code>Kconfig</code> æ–‡ä»¶ï¼Œå®ƒç”¨äºå®šä¹‰ <code>menuconfig</code> æ—¶å±•ç¤ºçš„ <a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v4.4/esp32/api-guides/build-system.html#component-configuration">ç»„ä»¶é…ç½®</a> é€‰é¡¹ã€‚æŸäº›ç»„ä»¶å¯èƒ½è¿˜ä¼šåŒ…å« <code>Kconfig.projbuild</code> å’Œ <code>project_include.cmake</code> ç‰¹æ®Šæ–‡ä»¶ï¼Œå®ƒä»¬ç”¨äº <a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v4.4/esp32/api-guides/build-system.html#override-project-config">è¦†ç›–é¡¹ç›®çš„éƒ¨åˆ†è®¾ç½®</a>ã€‚</p>
<p>ç»„ä»¶ä¸­ç¼–è¾‘å¥½çš„ <code>Kconfig.projbuild</code> æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>idf.py menuconfig</code> æ¥ä¿®æ”¹Kconfig çš„é…ç½®é¡¹ã€‚</p>
<h2 id="åˆ†åŒºè¡¨"><a href="#åˆ†åŒºè¡¨" class="headerlink" title="åˆ†åŒºè¡¨"></a>åˆ†åŒºè¡¨</h2><blockquote>
<p>åˆ†åŒºè¡¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>æ¯ç‰‡ ESP32 çš„ flash å¯ä»¥åŒ…å«å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œä»¥åŠå¤šç§ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆä¾‹å¦‚æ ¡å‡†æ•°æ®ã€æ–‡ä»¶ç³»ç»Ÿæ•°æ®ã€å‚æ•°å­˜å‚¨æ•°æ®ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ flash çš„ <a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v4.4/esp32/api-reference/kconfig.html#config-partition-table-offset">é»˜è®¤åç§»åœ°å€</a> 0x8000 å¤„çƒ§å†™ä¸€å¼ åˆ†åŒºè¡¨ã€‚</p>
<p>åˆ†åŒºè¡¨çš„é•¿åº¦ä¸º 0xC00 å­—èŠ‚ï¼Œæœ€å¤šå¯ä»¥ä¿å­˜ 95 æ¡åˆ†åŒºè¡¨æ¡ç›®ã€‚MD5æ ¡éªŒå’Œ é™„åŠ åœ¨åˆ†åŒºè¡¨ä¹‹åï¼Œç”¨äºåœ¨è¿è¡Œæ—¶éªŒè¯åˆ†åŒºè¡¨çš„å®Œæ•´æ€§ã€‚åˆ†åŒºè¡¨å æ®äº†æ•´ä¸ª flash æ‰‡åŒºï¼Œå¤§å°ä¸º 0x1000 (4 KB)ã€‚å› æ­¤ï¼Œå®ƒåé¢çš„ä»»ä½•åˆ†åŒºè‡³å°‘éœ€è¦ä½äº (<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/api-reference/kconfig.html#config-partition-table-offset">é»˜è®¤åç§»åœ°å€</a>) + 0x1000 å¤„ï¼Œå³ä» 0x9000 åˆå¼€å§‹ã€‚</p>
<p>å¦‚æœç”¨æˆ·æ²¡æœ‰åœ¨ menuconfig ä¸­é€‰æ‹©ç”¨æˆ·è‡ªå®šä¹‰åˆ†åŒºè¡¨ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨é»˜è®¤çš„åˆ†åŒºè¡¨ï¼Œé»˜è®¤å®šä¹‰çš„flashä¸º2MB</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ESP-IDF Partition Table</span></span><br><span class="line"><span class="comment"># Name,   Type, SubType, Offset,  Size,   Flags</span></span><br><span class="line">nvs,      data, nvs,     0x9000,  0x6000,</span><br><span class="line">phy_init, data, phy,     0xf000,  0x1000,</span><br><span class="line">factory,  app,  factory, 0x10000, 1M,</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰åˆ†åŒºè¡¨ï¼Œé¦–å…ˆåœ¨ menuconfig ä½¿èƒ½ç”¨æˆ·è‡ªå®šä¹‰åˆ†åŒºè¡¨ï¼Œç„¶åè®¾ç½®å®é™…flashå¤§å°ï¼Œæ¥ç€åœ¨é¡¹ç›®é¡¶å±‚æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>partitions.csv</code> æ–‡ä»¶</p>
<p>è¿™é‡Œè¿˜å¯èƒ½æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥å‚è€ƒä¹é‘«å®˜æ–¹æ•™ç¨‹ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/api-reference/storage/spiffs.html">SPIFFS æ–‡ä»¶ç³»ç»Ÿ</a></p>
<p>å…³äºåˆ†åŒºè¡¨çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œè¯·å‚è€ƒä¹é‘«å®˜æ–¹çš„æ•™ç¨‹ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v4.4/esp32/api-guides/partition-tables.html">åˆ†åŒºè¡¨</a></p>
<ul>
<li><p>Name å­—æ®µ</p>
<p>Name å­—æ®µå¯ä»¥æ˜¯ä»»ä½•æœ‰æ„ä¹‰çš„åç§°ï¼Œä½†ä¸èƒ½è¶…è¿‡ 16 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ä¸€ä¸ªç©ºå­—èŠ‚ã€‚</p>
</li>
<li><p>Type å­—æ®µ</p>
<p>Type å­—æ®µå¯ä»¥è®¾ç½®ä¸º appï¼ˆ0x00ï¼‰æˆ–è€… data ï¼ˆ0x01ï¼‰ ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ•°å­— 0<del>254 ï¼ˆæˆ–è€…åå…­è¿›åˆ¶ 0x00</del>0xfeï¼‰ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ 0x00~0x3f ä¸å¯ä»¥ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†é¢„ç•™ç»™ esp-idf çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p><em>æ³¨æ„ï¼šå¯åŠ¨åŠ è½½å™¨å°†å¿½ç•¥ app ï¼ˆ0x00ï¼‰å’Œ dataï¼ˆ0x01ï¼‰ ä»¥å¤–çš„å…¶ä»–åˆ†åŒºç±»å‹ï¼ï¼ï¼</em></p>
</li>
<li><p>SubType å­—æ®µ</p>
<p>SubType å­—æ®µé•¿åº¦ä¸º 8 bitï¼Œå†…å®¹ä¸å…·ä½“åˆ†åŒº Type å­—æ®µæœ‰å…³ã€‚ç›®å‰ esp-idf ä»…ä»…è§„å®šäº† app ï¼ˆ0x00ï¼‰å’Œ dataï¼ˆ0x01ï¼‰ä¸¤ç§åˆ†åŒºç±»å‹çš„å­ç±»å‹å«ä¹‰ã€‚</p>
<ul>
<li><p>å½“ Type è®¾ç½®ä¸º app ï¼ˆ0x00ï¼‰æ—¶ï¼ŒSubType å­—æ®µå¯ä»¥è®¾ç½®ä¸ºï¼šf<em>actoryï¼ˆ0x00ï¼‰ã€ota_0ï¼ˆ0x10ï¼‰ã€â€¦ã€ota_15ï¼ˆ0x1fï¼‰æˆ–è€… testï¼ˆ0x20ï¼‰ã€‚</em></p>
<p><strong>factory ï¼ˆ0x00ï¼‰æ˜¯é»˜è®¤çš„ app åˆ†åŒºã€‚å¯åŠ¨åŠ è½½å™¨å°†é»˜è®¤åŠ è½½è¯¥åº”ç”¨ç¨‹åºã€‚ä½†å¦‚æœå­˜åœ¨ç±»å‹ä¸º data&#x2F;ota åˆ†åŒºï¼Œåˆ™å¯åŠ¨åŠ è½½å™¨å°†åŠ è½½ data&#x2F;ota åˆ†åŒºä¸­çš„æ•°æ®ï¼Œè¿›è€Œåˆ¤æ–­å¯åŠ¨å“ªä¸ª OTA é•œåƒæ–‡ä»¶ã€‚</strong></p>
<p>OTA å‡çº§æ°¸è¿œéƒ½ä¸ä¼šæ›´æ–° factory åˆ†åŒºä¸­çš„å†…å®¹ã€‚å¦‚æœä½ å¸Œæœ›åœ¨ OTA é¡¹ç›®ä¸­é¢„ç•™æ›´å¤š flash ï¼Œå¯ä»¥åˆ é™¤ factory åˆ†åŒºï¼Œè½¬è€Œä½¿ç”¨ ota_0 åˆ†åŒºã€‚</p>
<p>ota_0ï¼ˆ0x10ï¼‰~ ota_15ï¼ˆ0x1fï¼‰ä¸º OTA åº”ç”¨ç¨‹åºåˆ†åŒºï¼Œå¯åŠ¨åŠ è½½å™¨å°†æ ¹æ® OTA æ•°æ®åˆ†åŒºä¸­çš„æ•°æ®æ¥å†³å®šåŠ è½½å“ªä¸ª OTA åº”ç”¨ç¨‹åºåˆ†åŒºä¸­çš„ç¨‹åºã€‚<em>åœ¨ä½¿ç”¨ OTA åŠŸèƒ½æ—¶ï¼Œåº”ç”¨ç¨‹åºåº”è‡³å°‘æ‹¥æœ‰ 2 ä¸ª OTA åº”ç”¨ç¨‹åºåˆ†åŒºï¼ˆå³ ota_0 å’Œ ota_1ï¼‰ã€‚</em></p>
</li>
<li><p>å½“ Type è®¾ç½®ä¸º data ï¼ˆ0x01ï¼‰æ—¶ï¼ŒSubtype å­—æ®µå¯ä»¥è®¾ç½®ä¸ºï¼š<em>otaï¼ˆ0x00ï¼‰ã€phyï¼ˆ0x01ï¼‰ã€nvsï¼ˆ0x02ï¼‰ã€nvs_keysï¼ˆ0x04ï¼‰ ã€æˆ– å…¶ä»–å­ç±»å‹ã€‚</em></p>
<p><strong>ota ï¼ˆ0x00ï¼‰</strong>å³ OTAæ•°æ®åˆ†åŒºï¼Œç”¨äºå­˜å‚¨å½“å‰æ‰€é€‰æ‹©çš„ OTA åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚<strong>è¿™ä¸ªåˆ†åŒºçš„å¤§å°è¦è®¾ç½®ä¸º 0x2000ã€‚</strong></p>
<p><strong>phy ï¼ˆ0x01ï¼‰</strong>ç”¨äºå­˜æ”¾ PHY åˆå§‹åŒ–æ•°æ®ï¼Œä»è€Œä¿è¯å¯ä»¥ä¸ºæ¯ä¸€ä¸ªè®¾å¤‡å•ç‹¬é…ç½® PHYï¼Œè€Œéå¿…é¡»é‡‡ç”¨å›ºä»¶ä¸­çš„ç»Ÿä¸€ PHY åˆå§‹åŒ–æ•°æ®ã€‚é»˜è®¤é…ç½®ä¸‹ï¼Œ phy åˆ†åŒºå¹¶ä¸å¯åŠ¨ï¼Œè€Œæ˜¯ç›´æ¥å°† phy åˆå§‹åŒ–æ•°æ®ç¼–è¯‘è‡³åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€ŒèŠ‚çœåˆ†åŒºè¡¨ç©ºé—´ã€‚å¦‚æœéœ€è¦ä»æ­¤åˆ†åŒºåŠ è½½ phy åˆå§‹åŒ–æ•°æ®ï¼Œæ‰“å¼€é…ç½®èœå•ï¼Œä½¿èƒ½ <code>CONFIG_ESP_PHY_INIT_DATA_IN_PARTITION</code> é€‰é¡¹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨å°† phy åˆå§‹åŒ–æ•°æ®çƒ§å½•è‡³è®¾å¤‡ flash ï¼Œå› ä¸º esp-idf ç¼–è¯‘ç³»ç»Ÿå¹¶ä¸ä¼šè‡ªåŠ¨å®Œæˆè¯¥æ“ä½œã€‚</p>
<p><strong>nvsï¼ˆ0x02ï¼‰</strong>æ˜¯ä¸“é—¨ç”¨äºç»™ <strong>éæ˜“å¤±æ€§å­˜å‚¨ï¼ˆNVSï¼‰API</strong> ä½¿ç”¨çš„åˆ†åŒºã€‚ç”¨äºå­˜å‚¨æ¯å°è®¾å¤‡çš„ PHY æ ¡å‡†æ•°æ®ï¼ˆå¹¶ä¸æ˜¯ PHY åˆå§‹åŒ–æ•°æ®ï¼‰ã€‚ç”¨äºå­˜å‚¨ Wi-Fi æ•°æ®ï¼ˆå¦‚æœç¨‹åºä¸­ä½¿ç”¨äº† <code>esp_wifi_set_storage(WIFI_STORAGE_FLASH)</code> çš„è¯ï¼‰ã€‚NVS API è¿˜å¯ä»¥ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºæ•°æ®ã€‚å¼ºçƒˆå»ºè®®ä¸º NVS åˆ†åŒºåˆ†é…è‡³å°‘ 0x3000 å­—èŠ‚å¤§å°çš„ç©ºé—´ã€‚å¦‚æœä½¿ç”¨ NVS API å­˜å‚¨å¤§é‡æ•°æ®ï¼Œåˆ™éœ€è¦å¢åŠ  nvs åˆ†åŒºçš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 0x6000 å­—èŠ‚ã€‚</p>
<p>nvs_keysï¼ˆ0x04ï¼‰æ˜¯ NVS ç§˜é’¥åˆ†åŒºã€‚ç”¨äºå­˜å‚¨åŠ å¯†ç§˜é’¥ï¼ˆå¦‚æœå¯åŠ¨äº† NVS åŠ å¯†åŠŸèƒ½çš„è¯ï¼‰ã€‚æ­¤åˆ†åŒºåº”è¯¥è‡³å°‘åˆ†é… 0x1000 å­—èŠ‚ï¼ˆå³ 4096 å­—èŠ‚ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li><p>åç§»åœ°å€ï¼ˆOffsetï¼‰å’Œ å¤§å°ï¼ˆSizeï¼‰å­—æ®µ</p>
<ul>
<li>åç§»åœ°å€è¡¨ç¤º SPI flash ä¸­çš„åˆ†åŒºåœ°å€ï¼Œæ‰‡åŒºå¤§å°ä¸º 0x1000ï¼ˆ4KBï¼‰ã€‚å› æ­¤ï¼Œåç§»åœ°å€å¿…é¡»æ˜¯ 4KB çš„æ•´æ•°å€ã€‚</li>
<li>è‹¥ csv æ–‡ä»¶ä¸­çš„åˆ†åŒºåç§»åœ°å€ä¸ºç©ºï¼Œåˆ™è¯¥åˆ†åŒºä¼šæ¥åœ¨å‰ä¸€ä¸ªåˆ†åŒºä¹‹åï¼›è‹¥ä¸ºé¦–ä¸ªåˆ†åŒºï¼Œåˆ™æ¥åœ¨åˆ†åŒºè¡¨ä¹‹åã€‚</li>
<li><strong>app åˆ†åŒºçš„åç§»åœ°å€å¿…é¡»ä¸ 0x10000ï¼ˆ64KBï¼‰å¯¹é½ã€‚</strong></li>
<li>è‹¥å¯åŠ¨äº†å®‰å…¨å¯åŠ¨ V1ï¼ˆSecure Bootï¼‰ï¼Œåˆ™ app åˆ†åŒºçš„å¤§å°ä¸ 0x10000ï¼ˆ64KBï¼‰å¯¹é½ã€‚</li>
<li>app åˆ†åŒºçš„å¤§å°å’Œåç§»åœ°å€å¯ä»¥é‡‡ç”¨ <code>åè¿›åˆ¶æ•°</code> æˆ– <code>ä»¥0xä¸ºå‰ç¼€çš„åå…­è¿›åˆ¶æ•°</code>ï¼Œä¸”æ”¯æŒ K æˆ– M çš„å€æ•°å•ä½ã€‚</li>
</ul>
</li>
<li><p>Flags å­—æ®µ</p>
<p>ç›®å‰ Flags å­—æ®µä»…æ”¯æŒ <code>encrypted</code> å’Œ <code>readonly</code>ã€‚å¦‚æœ Flags å­—æ®µè®¾ç½®ä¸º <code>encrypted</code> ï¼Œä¸”å¯ç”¨äº† flash åŠ å¯†åŠŸèƒ½ï¼Œåˆ™è¯¥åˆ†åŒºå°†ä¼šè¢«åŠ å¯†ã€‚<em>æ³¨æ„ï¼šæ— è®ºæ˜¯å¦è®¾ç½® Flags å­—æ®µï¼Œapp åˆ†åŒºéƒ½å°†ä¿æŒåŠ å¯†ã€‚</em></p>
<p>å¦‚æœ Flags å­—æ®µè®¾ç½®ä¸º <code>readonly</code> ï¼Œåˆ™è¯¥åˆ†åŒºä¸ºåªè¯»åˆ†åŒºã€‚readonly æ ‡è®°ä»…æ”¯æŒ é™¤ ota å’Œ coredump å­ç±»å‹å¤–çš„ data åˆ†åŒºã€‚ä½¿ç”¨ readonly æ ‡è®°ï¼Œé˜²æ­¢æ„å¤–å†™å…¥ å¦‚å‡ºå‚æ•°æ®åˆ†åŒºç­‰åŒ…å«è®¾å¤‡ç‰¹å®šé…ç½®æ•°æ®çš„åˆ†åŒºã€‚ </p>
<p>å¯ä»¥ä½¿ç”¨å†’å·è¿æ¥ä¸åŒçš„æ ‡è®°ï¼Œæ¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ ‡è®°ï¼Œä¾‹å¦‚ <code>encrypted:readonly</code>ã€‚</p>
</li>
</ul>
<h3 id="å†…ç½®åˆ†åŒºè¡¨"><a href="#å†…ç½®åˆ†åŒºè¡¨" class="headerlink" title="å†…ç½®åˆ†åŒºè¡¨"></a>å†…ç½®åˆ†åŒºè¡¨</h3><p>ESP-IDF æä¾›äº†å†…ç½®åˆ†åŒºè¡¨ï¼Œç”¨æˆ·é€šè¿‡ <code>idf.py menuconfig</code> å‹¾é€‰å³å¯ã€‚â€Single factory app, no OTAâ€ åˆ†åŒºè¡¨ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ESP-IDF Partition Table</span><br><span class="line"># Name,   Type, SubType, Offset,  Size,   Flags</span><br><span class="line">nvs,      data, nvs,     0x9000,  0x6000,</span><br><span class="line">phy_init, data, phy,     0xf000,  0x1000,</span><br><span class="line">factory,  app,  factory, 0x10000, 1M,</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨ flash çš„ 0x10000ï¼ˆå³64 KBï¼‰åç§»åœ°å€å¤„å­˜æ”¾ä¸€ä¸ªæ ‡è®°ä¸º â€œfactoryâ€ çš„äºŒè¿›åˆ¶åº”ç”¨ç¨‹åºï¼Œä¸”å¯åŠ¨åŠ è½½å™¨é»˜è®¤åŠ è½½è¿™ä¸ªç¨‹åºã€‚</li>
<li>åˆ†åŒºè¡¨ä¸­è¿˜å®šä¹‰äº†ä¸¤ä¸ªæ•°æ®åŒºåŸŸï¼Œåˆ†åˆ«ç”¨äºå­˜å‚¨ NVS åº“ä¸“ç”¨åˆ†åŒºå’Œ PHY åˆå§‹åŒ–æ•°æ®ã€‚</li>
</ul>
<p>â€œFactory app, two OTA definitionsâ€ åˆ†åŒºè¡¨ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ESP-IDF Partition Table</span><br><span class="line"># Name,   Type, SubType, Offset,  Size, Flags</span><br><span class="line">nvs,      data, nvs,     0x9000,  0x4000,</span><br><span class="line">otadata,  data, ota,     0xd000,  0x2000,</span><br><span class="line">phy_init, data, phy,     0xf000,  0x1000,</span><br><span class="line">factory,  app,  factory, 0x10000,  1M,</span><br><span class="line">ota_0,    app,  ota_0,   0x110000, 1M,</span><br><span class="line">ota_1,    app,  ota_1,   0x210000, 1M,</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ†åŒºè¡¨ä¸­å®šä¹‰äº†ä¸‰ä¸ªåº”ç”¨ç¨‹åºåˆ†åŒºï¼Œè¿™ä¸‰ä¸ªåˆ†åŒºçš„ç±»å‹éƒ½è¢«è®¾ç½®ä¸º â€œappâ€ ï¼Œä½†å…·ä½“ app ç±»å‹ä¸åŒã€‚å…¶ä¸­ä½äº 0x10000 åç§»åœ°å€å¤„çš„ä¸ºå‡ºå‚åº”ç”¨ç¨‹åºï¼ˆfactoryï¼‰ï¼Œå…¶ä½™ä¸¤ä¸ªä¸º OTA åº”ç”¨ç¨‹åºï¼ˆota_0, ota_1ï¼‰ã€‚</li>
<li>æ–°å¢äº†ä¸€ä¸ªåä¸º â€œotadataâ€ çš„æ•°æ®åˆ†åŒºï¼Œç”¨äºä¿å­˜ OTA å‡çº§æ—¶éœ€è¦çš„æ•°æ®ã€‚å¯åŠ¨åŠ è½½å™¨ä¼šæŸ¥è¯¢è¯¥åˆ†åŒºçš„æ•°æ®ï¼Œä»¥åˆ¤æ–­åº”è¯¥ä»å“ªä¸ª OTA åº”ç”¨ç¨‹åºåˆ†åŒºåŠ è½½ç¨‹åºã€‚å¦‚æœ â€œotadataâ€ åˆ†åŒºä¸ºç©ºï¼Œåˆ™ä¼šæ‰§è¡Œå‡ºå‚ç¨‹åºã€‚</li>
</ul>
<h3 id="è‡ªå®šä¹‰åˆ†åŒºè¡¨"><a href="#è‡ªå®šä¹‰åˆ†åŒºè¡¨" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒºè¡¨"></a>è‡ªå®šä¹‰åˆ†åŒºè¡¨</h3><p>é™¤äº†ä½¿ç”¨ ESP-IDF çš„å†…ç½®åˆ†åŒºè¡¨å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰åˆ†åŒºè¡¨ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Name,   Type, SubType,  Offset,   Size,  Flags</span><br><span class="line">nvs,      data, nvs,      0x9000,  0x4000</span><br><span class="line">otadata,  data, ota,      0xd000,  0x2000</span><br><span class="line">phy_init, data, phy,      0xf000,  0x1000</span><br><span class="line">factory,  app,  factory,  0x10000,  1M</span><br><span class="line">ota_0,    app,  ota_0,    ,         1M</span><br><span class="line">ota_1,    app,  ota_1,    ,         1M</span><br><span class="line">nvs_key,  data, nvs_keys, ,        0x1000</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–°å¢äº†ä¸€ä¸ªåä¸º â€œnvs_keyâ€ çš„æ•°æ®åˆ†åŒºï¼Œå¤§å°ä¸º 4KBã€‚</li>
<li>å…¶ä¸­ä¸‰ä¸ªåˆ†åŒºçš„ <code>Offset</code> å­—æ®µå¯ä»¥ä¸ºç©ºï¼Œå› ä¸º <code>gen_esp32part.py</code> å·¥å…·ä¼šä»åˆ†åŒºè¡¨ä½ç½®çš„åå°å¼€å§‹è‡ªåŠ¨è®¡ç®—å¹¶å¡«å……åˆ†åŒºçš„åç§»åœ°å€ï¼Œé€šçŸ¥ç¡®ä¿æ¯ä¸ªåˆ†åŒºçš„åç§»åœ°å€æ­£ç¡®å¯¹é½ã€‚</li>
</ul>
<h3 id="ç”ŸæˆäºŒè¿›åˆ¶åˆ†åŒºè¡¨"><a href="#ç”ŸæˆäºŒè¿›åˆ¶åˆ†åŒºè¡¨" class="headerlink" title="ç”ŸæˆäºŒè¿›åˆ¶åˆ†åŒºè¡¨"></a>ç”ŸæˆäºŒè¿›åˆ¶åˆ†åŒºè¡¨</h3><p>çƒ§å†™åˆ° ESP32 ä¸­çš„åˆ†åŒºè¡¨é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œä¸æ˜¯ csv æ–‡ä»¶æœ¬èº«ã€‚partition_table&#x2F;gen_esp32part.py å·¥å…·å¯ä»¥å®ç° csv æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¹‹é—´çš„è½¬æ¢ã€‚</p>
<p>å¦‚æœåœ¨é¡¹ç›®é…ç½®èœå• <code>idf.py menuconfig</code> ä¸­è®¾ç½®äº†åˆ†åŒºè¡¨ csv æ–‡ä»¶çš„åç§°ï¼Œç„¶åæ„å»ºé¡¹ç›® <code>idf.py build</code> æˆ– æ‰§è¡Œ <code>idf.py partition-table</code> ã€‚è¿™æ—¶ï¼Œè½¬æ¢å°†åœ¨ç¼–è¯‘è¿‡ç¨‹è‡ªåŠ¨å®Œæˆã€‚</p>
<ul>
<li><p>æ‰‹åŠ¨å°† csv æ–‡ä»¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python gen_esp32part.py input_partitions.csv binary_partitions.bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰‹åŠ¨å°†äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸ºcsv æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python gen_esp32part.py binary_partitions.bin input_partitions.csv</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰“å°äºŒè¿›åˆ¶åˆ†åŒºè¡¨çš„å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">idf.py partition-table</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">python gen_esp32part.py binary_partitions.bin</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="åˆ†åŒºå¤§å°æ£€æŸ¥"><a href="#åˆ†åŒºå¤§å°æ£€æŸ¥" class="headerlink" title="åˆ†åŒºå¤§å°æ£€æŸ¥"></a>åˆ†åŒºå¤§å°æ£€æŸ¥</h3><p>esp-idf æ„å»ºç³»ç»Ÿå°†è‡ªåŠ¨æ£€æŸ¥ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ä¸å¯ç”¨åˆ†åŒºå¤§å°æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶å¤ªå¤§ï¼Œåˆ™ä¼šæ„å»ºå¤±è´¥å¹¶æŠ¥é”™æç¤ºã€‚</p>
<h3 id="MD5æ ¡éªŒå’Œ"><a href="#MD5æ ¡éªŒå’Œ" class="headerlink" title="MD5æ ¡éªŒå’Œ"></a>MD5æ ¡éªŒå’Œ</h3><p>äºŒè¿›åˆ¶æ ¼å¼çš„åˆ†åŒºè¡¨ä¸­å«æœ‰ä¸€ä¸ª MD5 æ ¡éªŒå’Œã€‚è¿™ä¸ª MD5 æ ¡éªŒå’Œæ˜¯æ ¹æ®åˆ†åŒºè¡¨å†…å®¹è®¡ç®—çš„ï¼Œå¯åœ¨è®¾å¤‡å¯åŠ¨é˜¶æ®µç”¨äºéªŒè¯åˆ†åŒºè¡¨çš„å®Œæ•´æ€§ã€‚</p>
<h3 id="çƒ§å†™åˆ†åŒºè¡¨"><a href="#çƒ§å†™åˆ†åŒºè¡¨" class="headerlink" title="çƒ§å†™åˆ†åŒºè¡¨"></a>çƒ§å†™åˆ†åŒºè¡¨</h3><p>ä½¿ç”¨ esptool.py å·¥å…·çƒ§å†™åˆ†åŒºè¡¨ï¼Œå‘½ä»¤ï¼š<code>idf.py partition-flash</code>ã€‚æˆ–è€… æ‰§è¡Œå‘½ä»¤ <code>idf.py flash</code> ï¼Œçƒ§å†™æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬åˆ†åŒºè¡¨ã€‚</p>
<h2 id="OTA"><a href="#OTA" class="headerlink" title="OTA"></a>OTA</h2><p>OTAï¼ˆOver-The-Airï¼‰å‡çº§æœºåˆ¶å¯ä»¥è®©è®¾å¤‡åœ¨å›ºä»¶ <strong>æ­£å¸¸è¿è¡Œæ—¶</strong> é€šè¿‡Wi-Fiã€è“ç‰™æˆ–ä»¥å¤ªç½‘ æ¥æ”¶æ•°æ®è¿›è¡Œè‡ªæˆ‘æ›´æ–°ã€‚</p>
<p>è¦è¿è¡Œ OTA æœºåˆ¶ï¼Œéœ€è¦é…ç½®è®¾å¤‡çš„åˆ†åŒºè¡¨ï¼Œè¯¥åˆ†åŒºè¡¨è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ª OTA åº”ç”¨ç¨‹åºåˆ†åŒºï¼ˆå³ ota_0 å’Œ ota_1ï¼‰å’Œ ä¸€ä¸ª OTA æ•°æ®åˆ†åŒºã€‚</p>
<p>OTA åŠŸèƒ½å¯åŠ¨åï¼Œå‘å½“å‰ <strong>æœªç”¨äºå¯åŠ¨çš„ OTA åº”ç”¨ç¨‹åºåˆ†åŒº</strong> å†™å…¥æ–°çš„åº”ç”¨å›ºä»¶é•œåƒã€‚é•œåƒéªŒè¯åï¼Œ OTA æ•°æ®åˆ†åŒºæ›´æ–°ï¼ŒæŒ‡å®šåœ¨ä¸‹ä¸€æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨æ–°é•œåƒã€‚</p>
<h3 id="OTA-æ•°æ®åˆ†åŒº"><a href="#OTA-æ•°æ®åˆ†åŒº" class="headerlink" title="OTA æ•°æ®åˆ†åŒº"></a>OTA æ•°æ®åˆ†åŒº</h3><p>æ‰€æœ‰ä½¿ç”¨ OTA åŠŸèƒ½é¡¹ç›®ï¼Œå…¶åˆ†åŒºè¡¨ <em><strong>å¿…é¡»</strong></em> åŒ…å«ä¸€ä¸ª OTA æ•°æ®åˆ†åŒºï¼ŒType å­—æ®µä¸º dataï¼ŒSubType å­—æ®µä¸º otaã€‚</p>
<p>å·¥å‚å¯åŠ¨è®¾ç½®ä¸‹ï¼ŒOTA æ•°æ®åˆ†åŒºä¸­åº”æ²¡æœ‰æ•°æ®ã€‚å¦‚æœåˆ†åŒºè¡¨ä¸­æœ‰å·¥å‚åº”ç”¨ç¨‹åºï¼Œesp-idf å¼•å¯¼åŠ è½½ç¨‹åºä¼šå¯åŠ¨å·¥å‚åº”ç”¨ç¨‹åºã€‚å¦‚æœåˆ†åŒºè¡¨æ²¡æœ‰å·¥å‚åº”ç”¨ç¨‹åºï¼Œåˆ™å¯åŠ¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„ OTA åˆ†åŒºï¼Œé€šå¸¸æ˜¯ ota_0ã€‚</p>
<p>ç¬¬ä¸€æ¬¡ OTA å‡çº§åï¼ŒOTA æ•°æ®åˆ†åŒºæ›´æ–°ï¼ŒæŒ‡å®šä¸‹ä¸€æ¬¡å¯åŠ¨å“ªä¸ª OTA åº”ç”¨ç¨‹åºåˆ†åŒºã€‚</p>
<p>OTA æ•°æ®åˆ†åŒºçš„å®¹é‡æ˜¯ 2 ä¸ª flash æ‰‡åŒºçš„å¤§å°ï¼Œå³0x2000 å­—èŠ‚ï¼ˆ8 KBï¼‰ï¼Œé˜²æ­¢å†™å…¥æ—¶ç”µæºæ•…éšœå¼•å‘é—®é¢˜ã€‚ä¸¤ä¸ªæ‰‡åŒºå•ç‹¬æ“¦é™¤ã€å†™å…¥åŒ¹é…æ•°æ®ï¼Œè‹¥å­˜åœ¨ä¸ä¸€è‡´ï¼Œåˆ™ç”¨è®¡æ•°å™¨å­—æ®µåˆ¤å®šæŒ‰ä¸ªæ‰‡åŒºä¸ºæœ€æ–°æ•°æ®ã€‚</p>
<h3 id="åº”ç”¨ç¨‹åºå›æ»š"><a href="#åº”ç”¨ç¨‹åºå›æ»š" class="headerlink" title="åº”ç”¨ç¨‹åºå›æ»š"></a>åº”ç”¨ç¨‹åºå›æ»š</h3><p>åº”ç”¨ç¨‹åºå›æ»šçš„ä¸»è¦ç›®çš„ï¼šç¡®ä¿è®¾å¤‡åœ¨æ›´æ–°åæ­£å¸¸å·¥ä½œã€‚å¦‚æœæ–°ç‰ˆåº”ç”¨ç¨‹åºå‡ºç°ä¸¥é‡æ•…éšœï¼Œè¯¥åŠŸèƒ½ç§‘ä½¿è®¾å¤‡å›æ»šåˆ°ä¹‹å‰æ­£å¸¸è¿è¡Œçš„åº”ç”¨ç‰ˆæœ¬ã€‚</p>
<p>åœ¨ä½¿èƒ½å›æ»šå¹¶ä¸” OTA å‡çº§åº”ç”¨ç¨‹åºè‡³æ–°ç‰ˆæœ¬åï¼Œ å¯èƒ½å‡ºç°çš„ç»“æœï¼š</p>
<ul>
<li><p>åº”ç”¨ç¨‹åºè¿è¡Œæ­£å¸¸</p>
<p><code>esp_ota_mark_app_valid_cancel_rollback()</code> å°†æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçŠ¶æ€æ ‡è®°ä¸º <code>ESP_OTA_IMG_VALID</code>ï¼Œå¯åŠ¨æ­¤åº”ç”¨ç¨‹åºæ— é™åˆ¶ã€‚</p>
</li>
<li><p>åº”ç”¨ç¨‹åºå‡ºç°ä¸¥é‡æ•…éšœï¼Œæ— æ³•ç»§ç»­å·¥ä½œï¼Œå¿…é¡»å›æ»šåˆ° OTA å‡çº§ä¹‹å‰çš„ç‰ˆæœ¬</p>
<p><code>esp_ota_mark_app_invalid_rollback_and_reboot()</code> å°†æ­£åœ¨è¿è¡Œçš„ç‰ˆæœ¬æ ‡è®°ä¸º <code>ESP_OTA_IMG_INVALID</code> ï¼Œç„¶åç³»ç»Ÿå¤ä½ã€‚å¼•å¯¼åŠ è½½ç¨‹åºä¸ä¼šé€‰æ‹©æ¬¡ç‰ˆæœ¬ï¼Œè€Œæ˜¯å¯åŠ¨ OTA å‡çº§ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>å¦‚æœ <code>CONFIG_BOOTLOADER_APP_ROLLBACK_ENABLE</code> ä½¿èƒ½ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰ä½¿èƒ½çš„ï¼‰ï¼Œåˆ™æ— éœ€è°ƒç”¨å‡½æ•°ä¾¿å¯ç³»ç»Ÿå¤ä½ï¼Œå¹¶å›æ»šåˆ° OTA å‡çº§ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<h3 id="OTAå·¥å…·"><a href="#OTAå·¥å…·" class="headerlink" title="OTAå·¥å…·"></a>OTAå·¥å…·</h3><p>app_update ç»„ä»¶ä¸­æœ‰ <code>app_update/otatool.py</code> å·¥å…·ï¼Œç”¨äºåœ¨ç›®æ ‡è®¾å¤‡å®Œæˆ OTA åˆ†åŒºç›¸å…³çš„æ“ä½œï¼š</p>
<ul>
<li>è¯»å– otadata åˆ†åŒº</li>
<li>æ“¦é™¤ otadata åˆ†åŒºï¼Œå°†è®¾å¤‡å¤ä½è‡³å·¥å‚åº”ç”¨ç¨‹åº</li>
<li>åˆ‡æ¢ OTA åˆ†åŒº</li>
<li>æ“¦é™¤ OTA åˆ†åŒº</li>
<li>å†™å…¥ OTA åˆ†åŒº</li>
<li>è¯»å– OTA åˆ†åŒº</li>
</ul>
<h2 id="å­˜å‚¨å™¨ç±»å‹"><a href="#å­˜å‚¨å™¨ç±»å‹" class="headerlink" title="å­˜å‚¨å™¨ç±»å‹"></a>å­˜å‚¨å™¨ç±»å‹</h2><p>esp-idf åŒºåˆ†äº†æŒ‡ä»¤æ€»çº¿ï¼ˆIRAMã€IROMã€RTC FAST memoryï¼‰å’Œ æ•°æ®æ€»çº¿ï¼ˆDRAMã€DROMï¼‰ã€‚</p>
<p>æŒ‡ä»¤å­˜å‚¨å™¨æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œåªèƒ½é€šè¿‡ 4 å­—èŠ‚å¯¹é½è¯»å–æˆ–å†™å…¥ã€‚</p>
<p>æ•°æ®å­˜å‚¨å™¨ä¸å¯æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡å•ç‹¬çš„å­—èŠ‚æ“ä½œè®¿é—®ã€‚</p>
<h3 id="DRAM"><a href="#DRAM" class="headerlink" title="DRAM"></a>DRAM</h3><p>éå¸¸é‡é™æ€æ•°æ®ï¼ˆ.dataæ®µï¼‰å’Œ é›¶åˆå§‹åŒ–æ•°æ®ï¼ˆ.bssæ®µï¼‰ç”±é“¾æ¥å™¨æ”¾å…¥å†…éƒ¨ SRAM ä½œä¸ºæ•°æ®å­˜å‚¨ã€‚æ­¤åŒºåŸŸä¸­çš„å‰©ä½™ç©ºé—´å¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç”¨ä½œå † heapã€‚</p>
<p>å¦‚æœä½¿ç”¨è“ç‰™å †æ ˆï¼Œå†…éƒ¨ DRAM åŒºåŸŸçš„å¯ç”¨å¤§å°å°†å‡å°‘ 64 KBã€‚</p>
<p>å¦‚æœä½¿ç”¨å†…å­˜è·Ÿè¸ªåŠŸèƒ½ï¼Œå†…éƒ¨ DRAM åŒºåŸŸçš„å¯ç”¨å¤§å°å°†å‡å°‘ 16 KB æˆ–è€… 32 KBã€‚</p>
<blockquote>
<p><strong>ESP32 ä¸Šæœ‰ 520 KB çš„å¯ç”¨ SRAMï¼Œå…¶ä¸­320 KBçš„DRAM å’Œ 200 KBçš„IRAMã€‚ä½†æ˜¯ç”±äºæŠ€æœ¯é™åˆ¶ï¼Œç”¨äºé™æ€åˆ†åŒºçš„DRAM æœ€å¤šå¯ä¸º 160 KBï¼Œå‰©ä½™çš„ 160 KB åªèƒ½åœ¨è¿è¡Œæ—¶åˆ†é…ä¸ºå † heapã€‚</strong></p>
</blockquote>
<h3 id="IRAM"><a href="#IRAM" class="headerlink" title="IRAM"></a>IRAM</h3><p>esp-idf å°†å†…éƒ¨ SRAM0 çš„éƒ¨åˆ†åŒºåŸŸåˆ†é…ä¸º æŒ‡ä»¤RAMã€‚</p>
<ul>
<li>å¦‚æœåœ¨æ³¨å†Œä¸­æ–­å¤„ç†ç¨‹åºæ—¶ï¼Œä½¿ç”¨äº† <code>ESP_INTR_FLAG_IRAM</code> ï¼Œåˆ™ä¸­æ–­å¤„ç†ç¨‹åºå¿…é¡»æ”¾å…¥ IRAMã€‚</li>
<li>å¯å°†ä¸€äº›æ—¶åºå…³é”®ä»£ç æ”¾å…¥IRAMï¼Œä»¥å‡å°‘ä» flash  ä¸­åŠ è½½ä»£ç é€ æˆçš„ç›¸å…³æŸå¤±ã€‚</li>
</ul>
<p>ç¼–è¯‘ hello_world é¡¹ç›®æ—¶ï¼Œæ‰§è¡Œ <code>idf.py size</code> æŸ¥çœ‹ DRAMã€IRAM å’Œ flash çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Total sizes:</span><br><span class="line">Used static DRAM:   10956 bytes ( 169780 remain, 6.1% used)</span><br><span class="line">      .data size:    8716 bytes</span><br><span class="line">      .bss  size:    2240 bytes</span><br><span class="line">Used static IRAM:   51074 bytes (  79998 remain, 39.0% used)</span><br><span class="line">      .text size:   50047 bytes</span><br><span class="line">   .vectors size:    1027 bytes</span><br><span class="line">Used Flash size :  116999 bytes</span><br><span class="line">           .text:   79067 bytes</span><br><span class="line">         .rodata:   37676 bytes</span><br><span class="line">Total image size:  176789 bytes (.bin may be padded larger)</span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>ESP-IDF</tag>
      </tags>
  </entry>
  <entry>
    <title>WiFi Easy Connect</title>
    <url>/2024/11/15/2024/WiFi-Easy-Connect/</url>
    <content><![CDATA[<h2 id="WPS"><a href="#WPS" class="headerlink" title="WPS"></a>WPS</h2><p><strong>WPSï¼ˆWi-Fi Protected Setupï¼ŒWi-Fiå®‰å…¨é˜²æŠ¤è®¾å®šï¼‰</strong>æ˜¯ç”±Wi-Fiè”ç›Ÿæ¨å‡ºçš„å…¨æ–°æ ‡å‡†ï¼Œ2018å¹´æ¨å‡ºè¯¥æ ‡å‡†çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†è§£å†³é•¿ä¹…ä»¥æ¥æ— çº¿ç½‘ç»œåŠ å¯†è®¤è¯è®¾å®šçš„æ­¥éª¤è¿‡äºç¹æ‚ä¹‹å¼Šç—…ã€‚WPSç®€åŒ–äº†Wi-Fiçš„å®‰å…¨è®¾ç½®å’Œç½‘ç»œç®¡ç†ï¼Œå®ƒæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š<strong>ä¸ªäººè¯†åˆ«ç ï¼ˆPINï¼‰æ¨¡å¼</strong> ã€ <strong>æŒ‰é’®ï¼ˆPBCï¼‰æ¨¡å¼</strong> å’Œ <strong>NFCæ¨¡å¼</strong> ã€‚</p>
<p><img src="/2024/11/15/2024/WiFi-Easy-Connect/image-20241105144735611.png" alt="image-20241105144735611"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾å¤‡æ”¯æŒWPSåŠŸèƒ½ï¼ˆwps clientï¼‰ï¼Œè€Œä¸”è¦æ±‚è·¯ç”±å™¨ä¹Ÿæ”¯æŒWPSåŠŸèƒ½ï¼ˆwps serverï¼‰ã€‚</em></p>
<h2 id="WiFi-Easy-Connect"><a href="#WiFi-Easy-Connect" class="headerlink" title="WiFi Easy Connect"></a>WiFi Easy Connect</h2><p><strong><a href="https://www.wi-fi.org/zh-hans/file/wi-fi-certified-easy-connect-jishugaishu-2022">WiFi Easy Connect</a></strong> ï¼ˆä¹Ÿç§°ä¸ºè®¾å¤‡é…ç½®åè®® ï¼ŒDPPï¼‰ä¹Ÿæ˜¯æœ‰Wi-Fi Allianceï¼ˆWi-Fiè”ç›Ÿï¼Œç®€ç§°WFAï¼‰æ¨å‡ºçš„æ ‡å‡†ï¼Œç”¨äºæ›¿ä»£ Wi-Fi ä¿æŠ¤è®¾ç½® (WPS)ã€‚Wi-Fi Easy ConnectæŠ€æœ¯æé«˜äº†å®‰å…¨çš„ç½‘ç»œæ¥å…¥æ ‡å‡†ï¼Œæé«˜äº†æ˜“ç”¨æ€§ä»¥æå‡ç”¨æˆ·å°†è®¾å¤‡è¿æ¥åˆ°Wi-Fiç½‘ç»œçš„ä½“éªŒã€‚é€šè¿‡ä½¿ç”¨QRä»£ç å’Œç”¨æˆ·é€‰æ‹©çš„è®¾å¤‡æ¥ç®¡ç†ç½‘ç»œæ¥å…¥ï¼Œç”¨æˆ·ç•Œé¢æœ‰é™æˆ–æ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„è®¾å¤‡ä¹Ÿèƒ½è½»æ¾æ¥å…¥ï¼Œä¾‹å¦‚æ™ºèƒ½å®¶å±…å’Œç‰©è”ç½‘ï¼ˆIoTï¼‰äº§å“ã€‚</p>
<p>Wi-Fi Easy Connectä¸­åŒ…å«ä¸¤ä¸ªè§’è‰²ç±»å‹ï¼š</p>
<ul>
<li>Configuratorï¼šå¯ä»¥æ˜¯æ‰‹æœºã€å¹³æ¿ç­‰ç§»åŠ¨è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºï¼ŒAPçš„Webæ¥å£æˆ–åº”ç”¨ç¨‹åºæ¥å£ã€‚</li>
<li>Enrolleeï¼šé™¤Configuratorå¤–çš„å…¶ä»–éƒ½æ˜¯Enrolleeã€‚</li>
</ul>
<p><em>Tipsï¼š</em></p>
<p><em>1ã€WPS åœ¨ Android 9 ä¸­å·²å¼ƒç”¨ï¼ŒWiFi Easy Connectåœ¨ Android 10åŠå…¶æ›´åçš„ç‰ˆæœ¬æ‰æ”¯æŒã€‚</em></p>
<p><em>2ã€DPPï¼Œå³Device Provisioning Protocol</em></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šæå‡ºWiFi Easy Connect?</strong></p>
<p>å¯¹äºæ™ºèƒ½å®¶å±…å’Œç‰©è”ç½‘ï¼ˆIoTï¼‰å¸‚åœºæ›´æ˜¯è¿™æ ·ï¼Œè¿™äº›å¸‚åœºä¸Šé‡‡ç”¨çš„è®¾å¤‡ï¼Œæœ‰äº›æ˜¯ <strong>ç”¨æˆ·ç•Œé¢å—é™æˆ–æ ¹æœ¬æ²¡æœ‰ç”¨æˆ·ç•Œé¢</strong>ã€‚ä¸ºäº†å°†Wi-Fiè®¾å¤‡è¿å…¥ç½‘ç»œè€Œå¯¹å…¶åŠ ä»¥é…ç½®æ—¶ï¼Œéœ€è¦å‘è®¾å¤‡æä¾›ç½‘ç»œä¿¡æ¯å’Œå®‰å…¨è¯ä¹¦ã€‚å°†ç”¨æˆ·ç•Œé¢å—é™æˆ–æ ¹æœ¬æ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„è®¾å¤‡è¿å…¥ç½‘ç»œæ—¶ï¼Œå…¶è¿‡ç¨‹å¯èƒ½éå¸¸ç¹çï¼Œè€Œä¸”ç¹çç¨‹åº¦è§†å‚å•†å®ç°æ–¹æ¡ˆçš„ä¸åŒè€Œä¸åŒã€‚ä¸ºé…ç½®Wi-Fiè®¾å¤‡æä¾›æ ‡å‡†åŒ–çš„ç®€ä¾¿æ–¹æ³•ï¼Œå¯ä½¿ç”¨æˆ·åœ¨é€‰æ‹©ä¸åŒå‚å•†çš„äº§å“æ—¶ï¼Œæœ‰æ›´å¤§çš„ä½™åœ°ï¼Œå¹¶åœ¨æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿå†…æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>å¦‚ä½•åˆ©ç”¨WiFi Easy Connectä¸ºè®¾å¤‡é…ç½‘å‘¢ï¼Ÿ</strong></p>
<p>Wi-Fi Easy Connectâ„¢ä¸ºä»¥æ›´ç®€ä¾¿çš„æ–¹å¼é…ç½®Wi-Fiè®¾å¤‡å»ºç«‹äº†ä¸€ç§æ ‡å‡†åŒ–çš„æœºåˆ¶ï¼Œä»è€Œä½¿è®¾å¤‡é…ç½®æ¯«ä¸è´¹åŠ›ï¼Œä»…éœ€ç”¨ æ™ºèƒ½æ‰‹æœºæ‰«æäº§å“çš„ â€œå¿«é€Ÿå“åº”ï¼ˆQRï¼‰â€ç ï¼Œæˆ–è€…ä½¿ç”¨è¿‘è·ç¦»æ— çº¿é€šä¿¡ï¼ˆNFCï¼‰æ ‡ç­¾ï¼Œå°±å¯ä½¿è¯¥äº§å“è¿å…¥Wi-Fiç½‘ç»œã€‚</p>
<p><img src="/2024/11/15/2024/WiFi-Easy-Connect/image-20241118135015436.png" alt="image-20241118135015436"></p>
<p>å…·ä½“æ“ä½œè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>é…ç½®AP</p>
<p>é¦–å…ˆç”¨æˆ·å¯ä»¥ä½¿ç”¨æ‰‹æœºï¼ˆConfiguratorè§’è‰²ï¼‰ç­‰è®¾å¤‡æ‰«æAPï¼ˆä¸€èˆ¬æŒ‡æ”¯æŒwifi easy connectåŠŸèƒ½çš„è·¯ç”±å™¨ï¼‰ä¸Šçš„äºŒç»´ç ï¼Œé€šè¿‡è®¾å¤‡é…ç½®åè®®ï¼ˆDevice Provisioning Protocolï¼ŒDPPï¼‰æ¥é…ç½®APä½¿å…¶åˆ›å»ºç½‘ç»œã€‚</p>
</li>
<li><p>é…ç½®è®¾å¤‡</p>
<p>å½“æ‰‹æœºä¸è·¯ç”±å™¨ç½‘ç»œå»ºç«‹åï¼Œå°±å¯ä»¥å¼€å§‹é…ç½®å…¶ä»–å®¢æˆ·ç«¯è®¾å¤‡äº†ã€‚å¯ä»¥é€šè¿‡æ‰‹æœºæ‰«æå¾…é…ç½‘è®¾å¤‡çš„äºŒç»´ç ï¼ˆåŒ…å«è®¾å¤‡çš„å…¬é’¥ã€ä¿¡é“ã€MACåœ°å€ç­‰ä¿¡æ¯ï¼‰ï¼Œæ¯ä¸ªè®¾å¤‡ï¼ˆå¾…é…ç½‘è®¾å¤‡ï¼‰éƒ½å°†è·å¾—è‡ªå·±ç‰¹æœ‰çš„é…ç½®ç”¨ä»¥åŠ å…¥ç½‘ç»œã€‚åŒæ—¶ï¼Œä¼šç”Ÿæˆå±äºè¯¥è®¾å¤‡ä¸ç½‘ç»œé—´ç‹¬ç‰¹çš„å®‰å…¨è¯ä¹¦ï¼Œä¿æŠ¤åŒæ–¹çš„é€šä¿¡ã€‚</p>
</li>
<li><p>è®¾å¤‡è¿æ¥åˆ°ç½‘ç»œ</p>
<p>ä¸€æ—¦é…ç½®å®Œæˆï¼Œè®¾å¤‡å°±ä¼šä½¿ç”¨å¾—åˆ°çš„é…ç½®ä¿¡æ¯å»å°è¯•è¿æ¥ç›®æ ‡æ— çº¿ç½‘ç»œã€‚</p>
</li>
</ul>
<p><em>æ³¨æ„ï¼šä½¿ç”¨WiFi easy connectåŠŸèƒ½ï¼Œéœ€è¦è·¯ç”±å™¨å’Œæ‰‹æœºã€ç»ˆç«¯å‡æ”¯æŒWiFi easy connect</em></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/api-reference/network/esp_dpp.html">Wi-Fi Easy Connect (DPP) for ESP32</a></p>
<p><a href="https://community.tp-link.com/en/home/stories/detail/1056">Wi-Fi Easy Connect æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨</a></p>
<p><a href="https://juejin.cn/post/7354940558672707593">ä»Androidè§†è§’å…¨é¢è§£è¯»Wifi Easy Connect</a></p>
<p><a href="https://www.wi-fi.org/beacon/dan-harkins/wi-fi-easy-connect-simple-and-secure-onboarding-for-iot">Wi-Fi Easy Connectâ„¢ï¼šç®€å•ã€å®‰å…¨çš„ç‰©è”ç½‘æ¥å…¥</a></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>wifi easy connect</tag>
        <tag>wps</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: idf.py command</title>
    <url>/2024/11/13/2024/esp-idf-py-command/</url>
    <content><![CDATA[<h2 id="esp-idf"><a href="#esp-idf" class="headerlink" title="esp-idf"></a>esp-idf</h2><blockquote>
<p><a href="https://www.espressif.com/zh-hans/products/sdks/esp-idf">esp-idf</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>ESP-IDF æ˜¯ä¹é‘«å®˜æ–¹çš„ç‰©è”ç½‘å¼€å‘æ¡†æ¶ï¼Œé€‚ç”¨äº ESP32ã€ESP32-Sã€ESP32-C å’Œ ESP32-H ç³»åˆ— SoCã€‚</p>
<ul>
<li>ESP-IDF ç›¸å…³èµ„æºå·²åœ¨ GitHub ä¸Š<strong>å…è´¹å¼€æ”¾</strong>ã€‚ç”¨æˆ·å¯åœ¨ Apache 2.0 è®¸å¯ä¸‹ä»¥æºä»£ç å½¢å¼è·å– ESP-IDF çš„å¤§å¤šæ•°ç»„ä»¶ï¼Œæˆ–é€šè¿‡å…¼å®¹è®¸å¯è¯è·å–ç¬¬ä¸‰æ–¹ç»„ä»¶ã€‚</li>
<li>ESP-IDF å…·æœ‰æ¸…æ™°ã€ä¸¥æ ¼çš„å‘å¸ƒæµç¨‹å’Œæ”¯æŒç­–ç•¥ï¼Œç¡®ä¿ç”¨æˆ·é€‰æ‹©ä½¿ç”¨ç¨³å®šçš„å‘å¸ƒç‰ˆæœ¬ï¼Œå¹¶å¯æŒç»­è·å¾—é€‚ç”¨äºå…¶åº”ç”¨çš„é‡è¦ä¿®å¤ç¨‹åºã€‚æ¯ä¸ªç¨³å®šçš„å‘å¸ƒç‰ˆæœ¬å‡ç»è¿‡ä¸¥æ ¼çš„æµ‹è¯•æµç¨‹ï¼Œä»¥ç¡®ä¿<strong>ç‰ˆæœ¬ç¨³å®š</strong>ï¼Œå®¢æˆ·å¯å¿«é€Ÿå®ç°é‡äº§ã€‚</li>
<li>ESP-IDF é›†æˆäº†<strong>å¤§é‡çš„è½¯ä»¶ç»„ä»¶</strong>ï¼ŒåŒ…æ‹¬ RTOSã€å¤–è®¾é©±åŠ¨ç¨‹åºã€ç½‘ç»œæ ˆã€å¤šç§åè®®å®ç°æŠ€æœ¯ä»¥åŠå¸¸è§åº”ç”¨ç¨‹åºçš„ä½¿ç”¨åŠ©æ‰‹ã€‚å®ƒæä¾›äº†å…¸å‹åº”ç”¨ç¨‹åºæ‰€éœ€çš„å¤§éƒ¨åˆ†æ„å»ºå—ï¼Œç”¨æˆ·åœ¨å¼€å‘åº”ç”¨æ—¶åªéœ€ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å³å¯ã€‚ ESP-IDF ä¸ä»…å…·æœ‰å…è´¹å¼€æºçš„å¼€å‘å·¥å…·ï¼Œè¿˜æ”¯æŒ <strong>Eclipse</strong> å’Œ <strong>VSCode</strong> ç­‰ IDEï¼Œç¡®ä¿å…¶æ˜“äºå¼€å‘äººå‘˜ä½¿ç”¨ã€‚</li>
<li>ESP-IDF æä¾›è¯¦å°½çš„<strong>è½¯ä»¶ç»„ä»¶ä½¿ç”¨</strong>å’Œ<strong>è®¾è®¡æ–‡æ¡£</strong>ï¼Œæœ‰åŠ©äºå¼€å‘äººå‘˜å……åˆ†ç†è§£ ESP-IDF åŠŸèƒ½ï¼Œå¹¶ä»ä¸­æŒ‘é€‰æœ€é€‚åˆæ„å»ºå…¶åº”ç”¨ç¨‹åºçš„æ¨¡å—ã€‚ESP-IDF åŒ…å« 100 å¤šä¸ªç¤ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜äº†å…¶ç»„ä»¶åŠç¡¬ä»¶å¤–è®¾çš„åŠŸèƒ½å’Œç”¨æ³•ã€‚å®ƒä»¬ç»è¿‡äº†ä¸¥æ ¼çš„æµ‹è¯•å’Œç»´æŠ¤ï¼Œæ˜¯ç”¨æˆ·å¼€å¯åº”ç”¨å¼€å‘çš„æœ‰æ•ˆå‚è€ƒã€‚</li>
</ul>
<h2 id="idfå¸¸ç”¨å‘½ä»¤"><a href="#idfå¸¸ç”¨å‘½ä»¤" class="headerlink" title="idfå¸¸ç”¨å‘½ä»¤"></a>idfå¸¸ç”¨å‘½ä»¤</h2><p>ä½¿ç”¨ <code>idf.py</code> å‘½ä»¤å³å¯æ˜¾ç¤ºå¸®åŠ©æç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Options:</span><br><span class="line">--version				# æ˜¾ç¤ºidfç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">--list-targets			# æ˜¾ç¤ºæ”¯æŒçš„SoC</span><br><span class="line">--ccache / --no-ccache	# åœ¨ç¼–è¯‘æ˜¯æ˜¯å¦å¯ç”¨ccacheç¯å¢ƒä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚</span><br><span class="line">-p PATH 				# æŒ‡å®šä¸²å£è·¯å¾„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Commands:</span><br><span class="line">clean		# ä»buildç›®å½•åˆ é™¤ç¼–è¯‘è¾“å‡ºæ–‡ä»¶</span><br><span class="line">fullclean	# åˆ é™¤æ•´ä¸ªbuildç›®å½•ä¸­çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">set-target	# è®¾ç½®ç¼–è¯‘ç›®æ ‡SoC</span><br><span class="line">menuconfig	# æ‰“å¼€é¡¹ç›®é…ç½®èœå•</span><br><span class="line">erase-flash	# æ“¦é™¤æ•´ä¸ªflash</span><br><span class="line">flash		# çƒ§å½•å›ºä»¶</span><br><span class="line">monitor 	# æ˜¾ç¤ºä¸²å£æ—¥å¿—è¾“å‡º</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>esp-idf</tag>
      </tags>
  </entry>
  <entry>
    <title>USB-OTG</title>
    <url>/2024/11/08/2024/USB-OTG/</url>
    <content><![CDATA[<h2 id="USB"><a href="#USB" class="headerlink" title="USB"></a>USB</h2><blockquote>
<p><a href="https://zh.wikipedia.org/wiki/USB">USB</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>USBï¼ˆUniversal Serial Busï¼‰æ˜¯ä¸€ç§é€šç”¨çš„æ€»çº¿æ ‡å‡†ï¼Œç”¨äºè¿æ¥ä¸»æœºå’Œå¤–è®¾è®¾å¤‡ã€‚<strong>USB ä¸»æœºï¼ˆUSB Hostï¼‰</strong>å¯ä»¥é€šè¿‡ USB æ¥å£ä¸ <strong>USB è®¾å¤‡ï¼ˆUBS Deviceï¼‰</strong>è¿æ¥ï¼Œå®ç° <strong>æ•°æ®ä¼ è¾“ã€ç”µæºä¾›ç»™</strong> ç­‰åŠŸèƒ½ã€‚</p>
<p>USB IFï¼ˆUSB Implementers Forumï¼‰æ˜¯ USB æ ‡å‡†çš„åˆ¶å®šè€…ï¼Œå®ƒåˆ¶å®šäº† USB æ ‡å‡†ï¼ŒåŒ…æ‹¬ USB 1.1ã€USB 2.0ã€USB 3.0 ç­‰ï¼Œå®šä¹‰äº† USB æ¥å£çš„ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ç­‰åè®®ï¼Œä»¥åŠ USB è®¾å¤‡ç±»ï¼ˆDevice Classï¼‰æ ‡å‡†ï¼Œå¸¸è§çš„è®¾å¤‡ç±»åŒ…æ‹¬ HIDï¼ˆHuman Interface Deviceï¼Œäººæœºæ¥å£è®¾å¤‡ï¼‰ã€MSCï¼ˆMass Storage Classï¼Œå¤§å®¹é‡å­˜å‚¨è®¾å¤‡ï¼‰ã€CDCï¼ˆCommunication Device Classï¼Œé€šä¿¡è®¾å¤‡ï¼‰ã€Audioã€Video ç­‰ã€‚</p>
<p><strong>USBåè®®ç‰ˆæœ¬ï¼ˆåè®®ç‰ˆæœ¬å‘ä¸‹å…¼å®¹ï¼‰ï¼š</strong></p>
<ul>
<li>USB 1.0&#x2F;1.1(low&#x2F;full speed)ï¼Œä¼ è¾“é€Ÿç‡æœ€å¤§ä¸º12Mbps</li>
<li>USB 2.0(high speed)ï¼Œä¼ è¾“é€Ÿç‡æœ€å¤§480Mbps</li>
<li>USB 3.0(super speed)ï¼Œä¼ è¾“é€Ÿç‡æœ€å¤§5Gbps</li>
</ul>
<p><strong>USBæ¥å£ç±»å‹ï¼š</strong></p>
<ul>
<li>Type Aï¼Œå³ä½¿æˆ‘ä»¬ç”µè„‘ä¸Šçš„é‚£ç§æ¥å£ã€‚</li>
<li>Type Bï¼Œä¸å¤ªå¸¸è§ï¼Œæ¯”è¾ƒæ–¹æ­£çš„Tå‹æ¥å£ï¼Œæœ‰çš„åµŒå…¥å¼å¼€å‘æ¿ä¼šç”¨ã€‚</li>
<li>Type Cï¼Œ2013å¹´å…¬å¸ƒè¯¥æ¥å£ç±»å‹ï¼Œç°åœ¨å¼€å§‹æµè¡Œèµ·æ¥äº†ï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç›²æ’ï¼Œè€Œä¸ç”¨åŒºåˆ†æ­£åã€‚åç»­ç”µå­äº§å“æ¥å£å°†å®ç° Typc-C æ¥å£å¤§ä¸€ç»Ÿã€‚</li>
<li>Micro&#x2F;miniï¼Œæ—©æœŸçš„å®‰å“æ‰‹æœºä¸Šä½¿ç”¨Micro USBæ¯”è¾ƒå¸¸è§ã€‚</li>
</ul>
<p>USBå„ç§æ¥å£å›¾ç‰‡ï¼š<a href="https://www.usbzh.com/article/detail-144.html">https://www.usbzh.com/article/detail-144.html</a></p>
<p><img src="/2024/11/08/2024/USB-OTG/bcd5da92bffa7b9eb7b092bc9d9428b9.jpg" alt="bcd5da92bffa7b9eb7b092bc9d9428b9"></p>
<p>å¼•è„šï¼š</p>
<p><img src="/2024/11/08/2024/USB-OTG/IMG_1552.PNG" alt="IMG_1552"></p>
<p><strong>USB Deviceï¼š</strong></p>
<p>USB Device æ˜¯è¿æ¥åˆ°USB Hostçš„å¤–è®¾ï¼Œå®ƒå“åº”Hostçš„å‘½ä»¤å’Œè¯·æ±‚ï¼Œæä¾›ç‰¹å®šçš„åŠŸèƒ½æˆ–æœåŠ¡ã€‚USB Deviceå¯ä»¥æ˜¯ç®€å•çš„è¾“å…¥è®¾å¤‡ï¼ˆå¦‚é”®ç›˜ã€é¼ æ ‡ï¼‰ã€å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚Uç›˜ã€å¤–ç½®ç¡¬ç›˜ï¼‰ã€æ‰“å°æœºã€æ‘„åƒå¤´ç­‰ã€‚</p>
<p><strong>USB Hostï¼š</strong></p>
<p>USB Host æ˜¯USBé€šä¿¡ä¸­çš„æ§åˆ¶è€…ï¼Œè´Ÿè´£åˆå§‹åŒ–å’Œç®¡ç†æ‰€æœ‰USBé€šä¿¡ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªè®¡ç®—è®¾å¤‡ï¼Œå¦‚ä¸ªäººè®¡ç®—æœºã€ç¬”è®°æœ¬ç”µè„‘ã€å¹³æ¿ç”µè„‘æˆ–æŸäº›åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¦‚æ”¯æŒUSB OTGçš„å¾®æ§åˆ¶å™¨ï¼‰ã€‚</p>
<p><strong>USB OTGï¼š</strong></p>
<p>USB On-The-Go é€šå¸¸ç¼©å†™ä¸º<strong>USB OTG</strong>ï¼Œæ˜¯<a href="https://zh.wikipedia.org/wiki/USB_2.0">USB 2.0</a>è§„æ ¼çš„è¡¥å……æ ‡å‡†ã€‚å®ƒå¯ä½¿USBè®¾å¤‡ï¼Œä¾‹å¦‚æ’­æ”¾å™¨æˆ–æ‰‹æœºï¼Œä»USBå‘¨è¾¹è®¾å¤‡å˜ä¸ºUSBä¸»æœºï¼Œä¸å…¶ä»–USBè®¾å¤‡è¿æ¥é€šä¿¡ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›æ”¯æŒOTGçš„USBè®¾å¤‡å’ŒUSBä¸»æœºï¼ˆä¾‹å¦‚ï¼šPCï¼‰ï¼Œä»ç„¶ä½œä¸ºUSBå‘¨è¾¹è®¾å¤‡ä½¿ç”¨ã€‚</p>
<p>æ”¯æŒOTGçš„è®¾å¤‡ï¼Œå¦‚USBæ‰“å°æœºï¼Œå¯ä»¥ä¸è¿æ¥ç”µè„‘çš„æƒ…å†µä¸‹ç›´æ¥æ¥å…¥Uç›˜æ¥è¯»å–è®¾å¤‡å†…æ–‡ä»¶è¿›è¡Œæ‰“å°ï¼›æˆ–å¹³æ¿ç”µè„‘å¯ä»¥ç›´æ¥æ¥å…¥USBå­˜å‚¨ç¢Ÿã€é”®ç›˜æˆ–é¼ æ ‡æ¥æ‰©å……å¤–ç•Œç¡¬ä»¶åŠŸèƒ½ã€‚</p>
<h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p> <strong>1ã€USB Type-C OTG å£è‡ªèº«æ€ä¹ˆåˆ¤æ–­å½“å‰åªæ˜¯ä¾›ç”µï¼Œè¿˜æ˜¯æ—¢ä¾›ç”µåˆä¼ è¾“æ•°æ®ï¼Ÿ</strong></p>
<p><img src="/2024/11/08/2024/USB-OTG/image-20241111173957481.png" alt="image-20241111173957481"></p>
<p><img src="/2024/11/08/2024/USB-OTG/image-20241111105502903.png" alt="image-20241111105502903"></p>
<ul>
<li>CCçº¿ï¼ˆCC1æˆ–CC2ï¼‰ï¼šCCçº¿ç”¨äºåå•†ç”µæºè§’è‰²å’Œæ•°æ®è§’è‰²ï¼Œä»¥åŠæ£€æµ‹è¿æ¥çš„è®¾å¤‡ç±»å‹ï¼ˆç”µæºé€‚é…å™¨æˆ–USBè®¾å¤‡ï¼‰ã€‚ç”µæºé€‚é…å™¨é€šå¸¸åªæä¾›ç”µæºï¼Œä¸æ”¯æŒæ•°æ®ä¼ è¾“ã€‚USBè®¾å¤‡ä¼šé€šè¿‡CCçº¿ä¸USB Hostè¿›è¡Œé€šä¿¡ï¼Œåå•†ç”µæºå’Œæ•°æ®è§’è‰²ã€‚</li>
<li>VBUSçº¿ï¼šé€šè¿‡æ£€æµ‹VBUSçº¿æœ‰5Vç”µå‹æ¥ç¡®è®¤è¿æ¥çš„è®¾å¤‡æä¾›ç”µæºã€‚</li>
<li>D+å’ŒD-çº¿ï¼šä¸¤æ ¹æŸ¥åˆ†ä¿¡å·çº¿ï¼Œæ”¯æŒUSB2.0ç”¨äºä¼ è¾“é«˜é€Ÿæ•°å­—ä¿¡å·ï¼Œæœ€é«˜ä¼ è¾“é€Ÿç‡å¯è¾¾480 Mbpsã€‚æˆ–æ”¯æŒType-C è€³æœºçš„å·¦å³å£°é“ä¿¡å·ã€‚</li>
<li>TXå’ŒRXï¼šæ”¯æŒUSB 3.2&#x2F;4.0 ä¿¡å·ä¼ è¾“</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.espressif.com/projects/esp-iot-solution/zh_CN/latest/usb/usb_overview/usb_overview.html"><strong>ESP USB å¤–è®¾ä»‹ç»</strong></a></p>
<p><a href="https://www.cnblogs.com/bujidao1128/p/18307221">Type-cæ¥å£åŠå…¶åè®®ä»‹ç»</a></p>
<p><a href="https://nihil.cc/posts/usb/">USB 2.0 ä¸ USB 3.2</a></p>
<p><a href="https://www.espressif.com/zh-hans/solutions/peripherals/usb-solutions">ESP USBæ–¹æ¡ˆ</a></p>
<p><a href="https://blog.csdn.net/jia_weihui/article/details/128562625">OTGç¡¬ä»¶æ£€æµ‹ç”µè·¯</a></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>USB OTG</tag>
      </tags>
  </entry>
  <entry>
    <title>mDNS</title>
    <url>/2024/11/05/2024/mDNS/</url>
    <content><![CDATA[<h2 id="mDNS"><a href="#mDNS" class="headerlink" title="mDNS"></a>mDNS</h2><p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œå¤šæ’­DNSï¼ˆMulticast DNSï¼ŒmDNSï¼‰åè®®å°†ä¸»æœºåï¼ˆhostnameï¼‰è§£æä¸ºä¸åŒ…å«æœ¬åœ°åç§°æœåŠ¡å™¨ç«¯çš„å°å‹ç½‘ç»œä¸­çš„IPåœ°å€ï¼Œæ—¨åœ¨æä¾› <strong>æœ¬åœ°ç½‘ç»œæœåŠ¡</strong> å’Œ <strong>ä¸»æœºå‘ç°</strong>ã€‚è¿™æ˜¯ä¸€ç§é›¶é…ç½®çš„æœåŠ¡å™¨ç«¯ï¼ŒmDNSä¸ä¼ ç»ŸåŸŸåè§£ææœåŠ¡ï¼ˆDNSï¼‰æœ‰ç€åŸºæœ¬ç›¸åŒçš„ç¼–ç¨‹æ¥å£ã€æ•°æ®åŒ…æ ¼å¼å’Œæ“ä½œæ–¹å¼ã€‚</p>
<p>mDNSç”±Bill Woodcockå’ŒBill Manningäº2000å¹´åœ¨IETFä¸­é¦–æ¬¡æå‡ºï¼Œåœ¨2013å¹´æœ€ç»ˆç”±Stuart Cheshireå’ŒMarc Krochmalä½œä¸ºæ ‡å‡†åè®®å‘å¸ƒåœ¨ <strong>RFC 6762</strong>ï¼Œå¹¶ç”±<strong>Apple Bonjour</strong>å’Œ<strong>å¼€æºAvahi</strong> è½¯ä»¶åŒ…å®ç°ï¼ŒåŒ…å«åœ¨å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆä¸­ï¼ˆä¾‹å¦‚Ubuntu 22.04ï¼‰ã€‚</p>
<p>mDNS æ˜¯æœ¬åœ°ç½‘ç»œçš„åŸŸåè§£æåè®®ï¼Œä½¿ç”¨ <strong>5353</strong> ç«¯å£ï¼Œç»„æ’­åœ°å€æ˜¯ <strong>224.0.0.251</strong>ï¼Œæ˜¯è¿è¡Œäº <strong>UDP</strong> ä¹‹ä¸Šçš„åº”ç”¨åè®®ã€‚ä¸åŒäºä¼ ç»Ÿçš„DNSåè®®ï¼ŒmDNSåè®®ä¸éœ€è¦DNSæœåŠ¡å™¨ç«¯è¿›è¡ŒåŸŸåè§£æï¼Œå¯èŠ‚çœæœ¬åœ°ç½‘ç»œçš„åŸŸåæœåŠ¡å™¨ç«¯é…ç½®ã€‚</p>
<p>å¦‚æœä¸»æœºæŸ¥è¯¢ä¸€ä¸ªåŸŸåï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåŒºåˆ†è¯¥åŸŸåæ˜¯DNSåŸŸåè¿˜æ˜¯mDNSåŸŸåå‘¢ï¼ŸmDNSåŸŸåä¸DNSåŸŸåæ˜¯é€šè¿‡åç¼€.localåŒºåˆ†çš„ã€‚</p>
<h2 id="DNS-SD"><a href="#DNS-SD" class="headerlink" title="DNS-SD"></a>DNS-SD</h2><p><a href="http://www.dns-sd.org/">DNS-SD</a>ï¼ˆDNS-Based Service Discoveryï¼Œå³åŸºäºDNSçš„æœåŠ¡å‘ç°ï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œåè®®æ¡†æ¶ï¼Œå®ƒåŸºäºmDNSå®ç°ã€‚DNS-SDä¸»è¦ç”¨äºåœ¨æœ¬åœ°ç½‘ç»œä¸­è‡ªåŠ¨å‘ç°å¹¶ä½¿ç”¨ç½‘ç»œæœåŠ¡ï¼Œå¦‚æ‰“å°æœºã€æ–‡ä»¶å…±äº«ã€åª’ä½“æ’­æ”¾ç­‰ã€‚</p>
<h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>DNS-SDå€ŸåŠ©äºå¤šæ’­DNSï¼ˆmDNSï¼‰ï¼Œåœ¨æœ¬åœ°ç½‘ç»œï¼ˆlocal networkï¼‰å†…è¿›è¡ŒæœåŠ¡çš„å‘ç°å’Œå‘å¸ƒã€‚ä»¥ä¸‹æ˜¯DNS-SDçš„åŸºæœ¬å·¥ä½œåŸç†ï¼š</p>
<ol>
<li><strong>æœåŠ¡æ³¨å†Œ</strong>ï¼š<br>æœåŠ¡æä¾›è€…è‡ªæ³¨å†Œã€‚è¯¥ä¿¡æ¯é€šå¸¸åŒ…æ‹¬æœåŠ¡åç§°ã€ç±»å‹ï¼ˆå¦‚ â€œ_http._tcpâ€ï¼‰ã€ç«¯å£å·ã€åŠå…¶ä»–é™„åŠ å‚æ•°ã€‚</li>
<li><strong>æœåŠ¡å‘ç°</strong>ï¼š<br>å®¢æˆ·ç«¯åœ¨æœ¬åœ°ç½‘ç»œä¸­æŸ¥è¯¢ç‰¹å®šç±»å‹çš„æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¹¿æ’­ä¸€ä¸ªæŸ¥è¯¢ï¼Œæƒ³æ‰¾åˆ°æ‰€æœ‰çš„ â€œ_http._tcpâ€ æœåŠ¡ã€‚å…¶å®ƒè®¾å¤‡æ”¶åˆ°è¿™ä¸ªæŸ¥è¯¢åï¼Œä¼šå“åº”å…¶æä¾›çš„æœåŠ¡ä¿¡æ¯ã€‚</li>
<li><strong>æœåŠ¡è§£æ</strong>ï¼š<br>å®¢æˆ·ç«¯åœ¨å‘ç°æœåŠ¡åï¼Œå¯ä»¥è¿›ä¸€æ­¥è§£æè·å–å…·ä½“çš„æœåŠ¡ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œä»æœåŠ¡åç§°è§£æå‡ºå…·ä½“çš„ IP åœ°å€å’Œç«¯å£å·ã€‚</li>
</ol>
<h3 id="DNS-SD-è®°å½•ç±»å‹"><a href="#DNS-SD-è®°å½•ç±»å‹" class="headerlink" title="DNS-SD è®°å½•ç±»å‹"></a>DNS-SD è®°å½•ç±»å‹</h3><p>DNS-SD ä¸­é‡‡ç”¨äº†å¤šä¸ªç‰¹å®šçš„ DNS è®°å½•ç±»å‹æ¥è¿›è¡ŒæœåŠ¡çš„å‘ç°å’Œä¿¡æ¯ä¼ é€’ï¼š</p>
<ul>
<li><strong>PTR è®°å½•</strong>ï¼šç”¨äºæšä¸¾ç½‘ç»œä¸­ <em>æŸä¸€ç±»å‹</em> çš„æ‰€æœ‰æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œâ€_http._tcp.localâ€ PTR è®°å½•åˆ—å‡ºäº†ç½‘ç»œä¸­æ‰€æœ‰çš„ HTTP æœåŠ¡ã€‚</li>
<li><strong>SRV è®°å½•</strong>ï¼šæä¾›å…·ä½“çš„æœåŠ¡ä¸»æœºåå’Œç«¯å£ä¿¡æ¯ï¼›æ¯ä¸ªæœåŠ¡æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª SRV è®°å½•ã€‚</li>
<li><strong>TXT è®°å½•</strong>ï¼šç”¨æ¥å­˜å‚¨ä¸æœåŠ¡ç›¸å…³çš„ä»»æ„æ–‡æœ¬ä¿¡æ¯ï¼Œå¦‚æœåŠ¡çš„é…ç½®é€‰é¡¹ç­‰ã€‚</li>
<li><strong>A&#x2F;AAAA è®°å½•</strong>ï¼šå°†æœåŠ¡ä¸»æœºåè§£æä¸ºä¸€ä¸ªæˆ–å¤šä¸ª IP åœ°å€ï¼Œå…¶ä¸­Aè®°å½•ä¸ºIPv4åœ°å€ï¼ŒAAAAè®°å½•ä¸ºIPv6åœ°å€ã€‚</li>
</ul>
<h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><ul>
<li><strong>å±€åŸŸç½‘èŒƒå›´</strong>ï¼šDNS-SD å’Œ mDNS ä¸€èˆ¬åªåœ¨å±€åŸŸç½‘å†…å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨å¤šæ’­åœ°å€ã€‚</li>
<li><strong>åç§°å†²çª</strong>ï¼šå¤šä¸ªè®¾å¤‡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…æä¾›ç›¸åŒåç§°æœåŠ¡æ—¶ï¼Œä¼šå‘ç”Ÿåç§°å†²çªï¼Œéœ€è¦è¿›è¡Œåç§°åˆ†é…å’Œå†²çªè§£å†³æœºåˆ¶ã€‚</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>DNS-SD è¢«å¹¿æ³›åº”ç”¨äºå„ç§éœ€è¦è‡ªåŠ¨å‘ç°ç½‘ç»œæœåŠ¡çš„åº”ç”¨ç¯å¢ƒï¼Œå¦‚å®¶åº­ç½‘ç»œã€åŠå…¬å®¤å±€åŸŸç½‘ã€å¤šåª’ä½“è®¾å¤‡è¿æ¥ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>Apple çš„ Bonjour æœåŠ¡å‘ç°æŠ€æœ¯å°±æ˜¯åŸºäº DNS-SD å’Œ mDNS å®ç°çš„ã€‚</li>
<li>å„ç§æ™ºèƒ½å®¶å±…è®¾å¤‡å’Œ IoT è®¾å¤‡çš„äº’è”äº’é€šï¼Œæ¯”å¦‚Matterã€Home Assistantã€‚</li>
</ul>
<h3 id="DNS-SDè®¾å¤‡å‘ç°"><a href="#DNS-SDè®¾å¤‡å‘ç°" class="headerlink" title="DNS-SDè®¾å¤‡å‘ç°"></a>DNS-SDè®¾å¤‡å‘ç°</h3><p>ä¾‹1ï¼šæˆ‘æƒ³æŸ¥è¯¢æœ¬åœ°å±€åŸŸç½‘æ‰€æœ‰ï¼ˆå…¨å±€æœç´¢ï¼‰çš„ <strong>smb</strong> æœåŠ¡ï¼Œå³æŸ¥è¯¢PTRï¼š<code>_smb._tcp.local</code>ï¼Œè‹¥å­˜åœ¨è¯¥æœåŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›å¹¶è§£æç»“æœï¼ˆSRVã€A&#x2F;AAAAã€TXTï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I (641773) mdns-test: Query PTR: _smb._tcp.local</span><br><span class="line">1: Interface: WIFI_STA_DEF, Type: V4, TTL: 120</span><br><span class="line">  PTR : raspberrypi._smb._tcp</span><br><span class="line">  SRV : raspberrypi.local:445</span><br><span class="line">  A   : 192.168.0.210</span><br><span class="line">  AAAA: fe80:0000:0000:0000:0145:95a9:8787:0030</span><br></pre></td></tr></table></figure>

<p>ä¾‹2ï¼šæˆ‘æƒ³æŸ¥è¯¢æœ¬åœ°å±€åŸŸç½‘æ‰€æœ‰çš„ <strong>http</strong> æœåŠ¡ï¼Œå³æŸ¥è¯¢PTRï¼š<code>_http._tcp.local</code>ï¼Œè‹¥å­˜åœ¨è¯¥æœåŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›å¹¶è§£æç»“æœï¼ˆSRVã€A&#x2F;AAAAã€TXTï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I (651073) mdns-test: Lookup selfhosted service: _http._tcp.local</span><br><span class="line">  PTR : ESP32-WebServer._http._tcp</span><br><span class="line">  SRV : esp32-mdns.local:80</span><br><span class="line">  TXT : [3] p=password(8); u=user(4); board=esp32(5); </span><br><span class="line">  PTR : ESP32-WebServer1._http._tcp</span><br><span class="line">  SRV : esp32-mdns.local:80</span><br><span class="line">  TXT : [2] u=admin(5); path=/foobar(7); </span><br></pre></td></tr></table></figure>

<p>ä¾‹3ï¼šæˆ‘æƒ³æŸ¥è¯¢æœ¬åœ°å±€åŸŸç½‘æ‰€æœ‰çš„ <strong>HomeAssistant</strong> æœåŠ¡ï¼Œå³æŸ¥è¯¢PTRï¼š<code>_home-assistant._tcp</code>ï¼Œè‹¥å­˜åœ¨è¯¥æœåŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›å¹¶è§£æç»“æœã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">I (42702) mdns-test: Query PTR: _home-assistant._tcp.local</span><br><span class="line">1: Interface: WIFI_STA_DEF, Type: V6, TTL: 120</span><br><span class="line">  PTR : MyHome._home-assistant._tcp</span><br><span class="line">  SRV : ab96469f357e444280b0182d96da73b3.local:8123</span><br><span class="line">  TXT : [7] location_name=MyHome(6); uuid=ab96469f357e444280b0182d96da73b3(32); version=2024.11.3(9); external_url=NULL(0); internal_url=http://192.168.5.193:8123(25); base_url=http://192.168.5.193:8123(25); requires_api_password=True(4); </span><br><span class="line">  AAAA: fdfc:869c:9ebb:0000:0000:0000:0000:0936</span><br><span class="line">  A   : 192.168.5.193</span><br><span class="line">  AAAA: fdfc:869c:9ebb:0000:c1a5:a79e:bc90:54b8</span><br><span class="line">  AAAA: fe80:0000:0000:0000:2498:72a5:dcc1:61e8</span><br><span class="line">2: Interface: WIFI_STA_DEF, Type: V4, TTL: 120</span><br><span class="line">  PTR : MyHome._home-assistant._tcp</span><br><span class="line">  SRV : ab96469f357e444280b0182d96da73b3.local:8123</span><br><span class="line">  TXT : [7] location_name=MyHome(6); uuid=ab96469f357e444280b0182d96da73b3(32); version=2024.11.3(9); external_url=NULL(0); internal_url=http://192.168.5.193:8123(25); base_url=http://192.168.5.193:8123(25); requires_api_password=True(4); </span><br><span class="line">  AAAA: fdfc:869c:9ebb:0000:0000:0000:0000:0936</span><br><span class="line">  A   : 192.168.5.193</span><br><span class="line">  AAAA: fdfc:869c:9ebb:0000:c1a5:a79e:bc90:54b8</span><br><span class="line">  AAAA: fe80:0000:0000:0000:2498:72a5:dcc1:61e8</span><br></pre></td></tr></table></figure>





<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>mDNSç¤ºä¾‹ï¼š<a href="https://github.com/espressif/esp-protocols/tree/master/components/mdns/examples/query_advertise">query_advertise</a></p>
<p>å½“è®¾å¤‡ï¼ˆä¾‹å¦‚esp32-c3ï¼‰å’ŒPCå¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘ï¼Œé‚£ä¹ˆPCå¦‚ä½•æ‰¾åˆ°è®¾å¤‡çš„IPåœ°å€å‘¢ï¼Ÿ æ­¤æ—¶mDNSå°±èµ·ä½œç”¨äº†ï¼Œè®¾å¤‡å¯ç”¨äº†mDNSæœåŠ¡ï¼Œå½“è¿æ¥ä¸Šè·¯ç”±å™¨åï¼Œè®¾å¤‡ä¼šå‘å±€åŸŸç½‘ç»„æ’­åœ°å€å‘é€ç»„æ’­æŠ¥æ–‡ï¼šâ€œæˆ‘æ˜¯è°ï¼Œæˆ‘çš„IPåœ°å€æ˜¯å¤šå°‘ï¼Œæˆ‘æä¾›çš„æœåŠ¡å’Œç«¯å£å·æ˜¯å¤šå°‘â€ã€‚å¦‚æœPCæƒ³è¦æŸ¥è¯¢mDNSåŸŸåï¼Œä¼šå…ˆæŸ¥è¯¢è‡ªå·±çš„ç¼“å­˜ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç›®æ ‡mDNSåŸŸåï¼Œåˆ™ä¼šå‘å±€åŸŸç½‘ç»„æ’­æŸ¥è¯¢ç›®æ ‡mDNSåŸŸåï¼ˆesp32-mdns.localï¼‰çš„IPæ˜¯å¤šå°‘ï¼Œä»¥åŠæä¾›çš„æœåŠ¡ï¼ˆserviceï¼‰å’Œç«¯å£ï¼ˆportï¼‰æ˜¯å¤šå°‘ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">I (373) mdns-test: mdns hostname <span class="built_in">set</span> to: [esp32-mdns]</span><br><span class="line"></span><br><span class="line">I (613) example_connect: Connecting to ZTE_5GCPE_F876...</span><br><span class="line">I (613) example_connect: Waiting <span class="keyword">for</span> IP(s)</span><br><span class="line">I (3323) wifi:new:&lt;7,1&gt;, old:&lt;1,0&gt;, ap:&lt;255,255&gt;, sta:&lt;7,1&gt;, prof:1</span><br><span class="line">I (3323) wifi:state: init -&gt; auth (b0)</span><br><span class="line">I (3333) wifi:state: auth -&gt; assoc (0)</span><br><span class="line">I (3363) wifi:state: assoc -&gt; run (10)</span><br><span class="line">I (3383) wifi:connected with ZTE_5GCPE_F876, aid = 1, channel 7, 40U, bssid = b0:0a:d5:75:f8:76</span><br><span class="line">I (3393) wifi:security: WPA2-PSK, phy: bgn, rssi: -58</span><br><span class="line">I (3393) wifi:pm start, <span class="built_in">type</span>: 1</span><br><span class="line"></span><br><span class="line">I (3393) wifi:dp: 1, bi: 102400, li: 3, scale listen interval from 307200 us to 307200 us</span><br><span class="line">I (3403) wifi:<span class="built_in">set</span> rx beacon pti, rx_bcn_pti: 0, bcn_timeout: 25000, mt_pti: 0, mt_time: 10000</span><br><span class="line">I (3593) wifi:dp: 5, bi: 102400, li: 5, scale listen interval from 307200 us to 512000 us</span><br><span class="line">I (3593) wifi:AP<span class="string">&#x27;s beacon interval = 102400 us, DTIM period = 5</span></span><br><span class="line"><span class="string">I (5373) example_connect: Got IPv6 event: Interface &quot;example_netif_sta&quot; address: fe80:0000:0000:0000:f29e:9eff:fe99:1260, type: ESP_IP6_ADDR_IS_LINK_LOCAL</span></span><br><span class="line"><span class="string">I (6483) wifi:&lt;ba-add&gt;idx:0 (ifx:0, b0:0a:d5:75:f8:76), tid:0, ssn:0, winSize:64</span></span><br><span class="line"><span class="string">I (7413) esp_netif_handlers: example_netif_sta ip: 192.168.0.169, mask: 255.255.255.0, gw: 192.168.0.1</span></span><br><span class="line"><span class="string">I (7413) example_connect: Got IPv4 event: Interface &quot;example_netif_sta&quot; address: 192.168.0.169</span></span><br><span class="line"><span class="string">I (7423) example_common: Connected to example_netif_sta</span></span><br><span class="line"><span class="string">I (7423) example_common: - IPv4 address: 192.168.0.169,</span></span><br><span class="line"><span class="string">I (7433) example_common: - IPv6 address: fe80:0000:0000:0000:f29e:9eff:fe99:1260, type: ESP_IP6_ADDR_IS_LINK_LOCAL</span></span><br><span class="line"><span class="string">I (7443) gpio: GPIO[9]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:0 </span></span><br><span class="line"><span class="string">I (7453) main_task: Returned from app_main()</span></span><br><span class="line"><span class="string">I (623103) mdns-test: Query both A and AAA: esp32-mdns.local</span></span><br><span class="line"><span class="string">I (624203) mdns-test: Query A esp32-mdns.local finished</span></span><br><span class="line"><span class="string">I (624203) mdns-test: Query AAAA esp32-mdns.local finished</span></span><br><span class="line"><span class="string">I (624253) mdns-test: Query A: esp32.local</span></span><br><span class="line"><span class="string">W (626273) mdns-test: ESP_ERR_NOT_FOUND: Host was not found!</span></span><br><span class="line"><span class="string">I (626273) mdns-test: Query PTR: _arduino._tcp.local</span></span><br><span class="line"><span class="string">W (629373) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (629373) mdns-test: Query PTR: _http._tcp.local</span></span><br><span class="line"><span class="string">W (632473) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (632473) mdns-test: Query PTR: _printer._tcp.local</span></span><br><span class="line"><span class="string">W (635573) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (635573) mdns-test: Query PTR: _ipp._tcp.local</span></span><br><span class="line"><span class="string">W (638673) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (638673) mdns-test: Query PTR: _afpovertcp._tcp.local</span></span><br><span class="line"><span class="string">W (641773) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (641773) mdns-test: Query PTR: _smb._tcp.local</span></span><br><span class="line"><span class="string">1: Interface: WIFI_STA_DEF, Type: V4, TTL: 120</span></span><br><span class="line"><span class="string">  PTR : raspberrypi._smb._tcp</span></span><br><span class="line"><span class="string">  SRV : raspberrypi.local:445</span></span><br><span class="line"><span class="string">  A   : 192.168.0.210</span></span><br><span class="line"><span class="string">  AAAA: fe80:0000:0000:0000:0145:95a9:8787:0030</span></span><br><span class="line"><span class="string">2: Interface: WIFI_STA_DEF, Type: V6, TTL: 120</span></span><br><span class="line"><span class="string">  PTR : raspberrypi._smb._tcp</span></span><br><span class="line"><span class="string">  SRV : raspberrypi.local:445</span></span><br><span class="line"><span class="string">  AAAA: fe80:0000:0000:0000:0145:95a9:8787:0030</span></span><br><span class="line"><span class="string">I (644893) mdns-test: Query PTR: _ftp._tcp.local</span></span><br><span class="line"><span class="string">W (647973) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (647973) mdns-test: Query PTR: _nfs._tcp.local</span></span><br><span class="line"><span class="string">W (651073) mdns-test: No results found!</span></span><br><span class="line"><span class="string">I (651073) mdns-test: Lookup selfhosted service: _http._tcp.local</span></span><br><span class="line"><span class="string">  PTR : ESP32-WebServer._http._tcp</span></span><br><span class="line"><span class="string">  SRV : esp32-mdns.local:80</span></span><br><span class="line"><span class="string">  TXT : [3] p=password(8); u=user(4); board=esp32(5); </span></span><br><span class="line"><span class="string">  PTR : ESP32-WebServer1._http._tcp</span></span><br><span class="line"><span class="string">  SRV : esp32-mdns.local:80</span></span><br><span class="line"><span class="string">  TXT : [2] u=admin(5); path=/foobar(7); </span></span><br></pre></td></tr></table></figure>



<h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><p><img src="/2024/11/05/2024/mDNS/image-20241107103144932.png" alt="image-20241107103144932"></p>
<h2 id="çŒœæƒ³"><a href="#çŒœæƒ³" class="headerlink" title="çŒœæƒ³"></a>çŒœæƒ³</h2><p>1ã€å¦‚æœå°†esp32 mDNS demoå›ºä»¶çƒ§å½•åˆ°ç›¸åŒçš„å¼€å‘æ¿ï¼Œé‚£ä¹ˆç†è®ºä¸Šä¸¤å—å¼€å‘æ¿è®¾ç½®çš„æœ¬åœ°mDNSåŸŸååº”è¯¥éƒ½æ˜¯ <code>esp32-mdns.local</code></p>
<p>éªŒè¯ç»“æœï¼šå®é™…çš„ç»“æœè·ŸçŒœæƒ³ä¸ä¸€è‡´ï¼Œå¼€å‘æ¿Açš„æœ¬åœ°mDNSåŸŸåæ˜¯ <code>esp32-mdns.local</code>ï¼Œè€Œå¼€å‘æ¿Bçš„æœ¬åœ°mDNSåŸŸåæ˜¯ <code>esp32-mdns-2.local</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡å’Œå¼€å‘æ¿åœ¨åŒä¸€å±€åŸŸç½‘çš„PCåˆ©ç”¨avahi-browse</span></span><br><span class="line">$ avahi-browse -a -r -l</span><br><span class="line">= wlp1s0 IPv4 ESP32-WebServer1-10                           Web Site             <span class="built_in">local</span></span><br><span class="line">   hostname = [esp32-mdns.local]</span><br><span class="line">   address = [192.168.0.169]</span><br><span class="line">   port = [80]</span><br><span class="line">   txt = [<span class="string">&quot;path=/foobar&quot;</span> <span class="string">&quot;u=admin&quot;</span>]</span><br><span class="line">= wlp1s0 IPv4 ESP32-WebServer1                              Web Site             <span class="built_in">local</span></span><br><span class="line">   hostname = [esp32-mdns-2.local]</span><br><span class="line">   address = [192.168.0.155]</span><br><span class="line">   port = [80]</span><br><span class="line">   txt = [<span class="string">&quot;path=/foobar&quot;</span> <span class="string">&quot;u=admin&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2ã€é€šè¿‡mDNSå¯ä»¥è·å–å±€åŸŸç½‘å†…çš„ä¸»æœºåå’ŒIPï¼Œé‚£ä¹ˆè¿˜èƒ½è·å–ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</p>
<p>è¿˜æ˜¯ä»¥ â€œesp32 mDNS demoâ€ ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹åœ¨å‘å¸ƒmDNSç»„æ’­æ•°æ®åŒ…éœ€è¦è®¾ç½®å“ªäº›ä¸œè¥¿ã€‚</p>
<ul>
<li><p>mDNSå±æ€§</p>
<ul>
<li><code>hostname</code>ï¼šè®¾å¤‡ä¼šå»å“åº”çš„ä¸»æœºåï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œä¼šæ ¹æ®è®¾å¤‡çš„ç½‘ç»œæ¥å£åå®šä¹‰ <code>hostname</code> ã€‚ä¾‹å¦‚ï¼Œ<code>my-esp32</code> ä¼šè¢«è§£æä¸º <code>my-esp32.local</code>ã€‚</li>
<li><code>default_instance</code>ï¼šé»˜è®¤å®ä¾‹åï¼ˆå³æ˜“è®°çš„è®¾å¤‡åï¼‰ï¼Œä¾‹å¦‚ <code>Jhon&#39;s ESP32 Thing</code>ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå°†ä¼šä½¿ç”¨ <code>hostname</code>ã€‚</li>
</ul>
</li>
<li><p>mDNSæœåŠ¡ï¼ˆ DNS-Based Service Discoveryï¼ŒDNS-SDï¼‰</p>
<p>mDNS å¯ä»¥å¹¿æ’­è®¾å¤‡èƒ½å¤Ÿæä¾›çš„ç½‘ç»œæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯ä¸ªæœåŠ¡ä¼šç”±ä»¥ä¸‹å±æ€§æ„æˆï¼š</p>
<ul>
<li><code>instance_name</code>ï¼šå®ä¾‹åï¼ˆå³æ˜“è®°çš„æœåŠ¡åï¼‰ï¼Œä¾‹å¦‚ <code>Jhon&#39;s ESP32 Web Server</code>ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œä¼šä½¿ç”¨ <code>default_instance</code>ã€‚</li>
<li><code>service_type</code>ï¼šï¼ˆå¿…éœ€ï¼‰æœåŠ¡ç±»å‹ï¼Œä»¥ä¸‹åˆ’çº¿ä¸ºå‰ç¼€ï¼Œ<a href="http://www.dns-sd.org/serviceTypes.html">è¿™é‡Œ</a> åˆ—å‡ºäº†å¸¸è§çš„ç±»å‹ã€‚</li>
<li><code>proto</code>ï¼šï¼ˆå¿…éœ€ï¼‰æœåŠ¡è¿è¡Œæ‰€ä¾èµ–çš„åè®®ï¼Œä»¥ä¸‹åˆ’çº¿ä¸ºå‰ç¼€ï¼Œä¾‹å¦‚ <code>_tcp</code> æˆ–è€… <code>_udp</code>ã€‚</li>
<li><code>port</code>ï¼šï¼ˆå¿…éœ€ï¼‰æœåŠ¡è¿è¡Œæ‰€ç”¨çš„ç«¯å£å·ã€‚</li>
<li><code>txt</code>ï¼šå½¢å¦‚ <code>&#123;var, val&#125;</code> çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œç”¨äºå®šä¹‰æœåŠ¡çš„å±æ€§ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼šå¯ä»¥å‘å¸ƒä¸€ä¸ªhttpæœåŠ¡ï¼š<code>http://esp32-mdns.local:80/foobar</code></p>
</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.waynecommand.com/post/mdns">1ã€multicast DNS</a></p>
<p><a href="https://blog.csdn.net/Marchtwentytwo/article/details/122770716">2ã€ESP mDNS å­¦ä¹ </a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>mDNS</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: Wi-Fi network configuration</title>
    <url>/2024/11/05/2024/esp-Wi-Fi-network-configuration/</url>
    <content><![CDATA[<h2 id="Wi-Fié…ç½‘"><a href="#Wi-Fié…ç½‘" class="headerlink" title="Wi-Fié…ç½‘"></a>Wi-Fié…ç½‘</h2><blockquote>
<p>ä»€ä¹ˆæ˜¯WiFié…ç½‘ï¼Ÿ</p>
</blockquote>
<p>Wi-Fié…ç½‘æ˜¯æŒ‡å¤–éƒ¨å‘Wi-Fiè®¾å¤‡æä¾› SSID å’Œå¯†ç ï¼Œä»¥ä¾¿Wi-Fiè®¾å¤‡å¯ä»¥è¿æ¥åˆ°æŒ‡å®šçš„APå¹¶åŠ å…¥APæ‰€å»ºç«‹çš„Wi-Fiç½‘ç»œã€‚</p>
<p>Wi-Fié…ç½‘çš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡å„ç§æ–¹æ³•ï¼Œå°†è¦è¿æ¥çš„APçš„SSIDå’Œå¯†ç å‘é€åˆ°éœ€è¦è”ç½‘çš„Wi-Fiè®¾å¤‡ï¼Œç„¶åç”±Wi-Fiè®¾å¤‡å»è¿æ¥æŒ‡å®šçš„Wi-Fiç½‘ç»œï¼Œè¾¾åˆ°æ¥å…¥å±€åŸŸç½‘æˆ–äº’è”ç½‘çš„ç›®çš„ã€‚</p>
<p>Wi-Fié…ç½‘çš„å®ç°æ–¹å¼æœ‰ï¼š<strong>SoftAPé…ç½‘ã€ä¸€é”®é…ç½‘ã€è“ç‰™é…ç½‘ã€å…¶ä»–æ–¹å¼é…ç½‘</strong>ã€‚</p>
<h3 id="SoftAPé…ç½‘"><a href="#SoftAPé…ç½‘" class="headerlink" title="SoftAPé…ç½‘"></a>SoftAPé…ç½‘</h3><p>SoftAPé…ç½‘åˆç§°ä¸ºä¼ ç»Ÿé…ç½‘ã€‚</p>
<p>å·¥ä½œæµç¨‹ï¼šé¦–å…ˆï¼Œå¾…é…ç½‘çš„Wi-Fiè®¾å¤‡è‡ªèº«ä¼šå»ºç«‹ä¸€ä¸ªAPï¼Œç”¨æˆ·å°†æ™ºèƒ½æ‰‹æœºè¿æ¥åˆ°è¿™ä¸ªAPã€‚ç„¶åï¼Œæ™ºèƒ½æ‰‹æœºä¸­çš„APPå°†è¦è¿æ¥çš„SSIDå’Œå¯†ç å‘é€ç»™å¾…é…ç½‘çš„Wi-Fiè®¾å¤‡ï¼Œå¾…é…ç½‘çš„Wi-Fiè®¾å¤‡æ”¶åˆ°ä¿¡æ¯åï¼Œæ‰¾åˆ°å¯¹åº”çš„APå¹¶ä¸ä¹‹è¿æ¥ï¼Œå®Œæˆé…ç½‘ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105142135546.png" alt="image-20241105142135546"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾å¤‡æ”¯æŒ APæ¨¡å¼ å’Œ Stationæ¨¡å¼ã€‚å¯ç”¨APæ¨¡å¼ï¼Œæ™ºèƒ½æ‰‹æœºå¯ä»¥è¿æ¥Wi-Fiè®¾å¤‡å‘å‡ºçš„çƒ­ç‚¹ï¼›å¯ç”¨Stationæ¨¡å¼ï¼ŒWi-Fiè®¾å¤‡å¯ä»¥è¿æ¥åˆ°è·¯ç”±å™¨å‘å‡ºçš„çƒ­ç‚¹ã€‚</em></p>
<h3 id="ä¸€é”®é…ç½‘"><a href="#ä¸€é”®é…ç½‘" class="headerlink" title="ä¸€é”®é…ç½‘"></a>ä¸€é”®é…ç½‘</h3><p>ä¸€é”®é…ç½‘æ˜¯æŒ‡æ™ºèƒ½æ‰‹æœºå°†SSIDå’Œå¯†ç æŒ‰ç…§ä¸€å®šçš„ç¼–ç æ ¼å¼å¡«å……åœ¨MACåŒ…ä¸­<strong>ä¸åŠ å¯†</strong>çš„åŒ…å¤´éƒ¨åˆ†ï¼Œå¹¶é‡‡ç”¨<strong>å¹¿æ’­æˆ–ç»„æ’­</strong>æ–¹å¼å‘é€æ•°æ®åŒ…ï¼ŒWi-Fiè®¾å¤‡ç›‘å¬æ— çº¿ä¿¡é“ä¸­çš„å¹¿æ’­åŒ…æˆ–ç»„æ’­åŒ…ï¼Œç„¶åä»æ•°æ®åŒ…çš„å¤´éƒ¨è§£æå‡ºSSIDå’Œå¯†ç ï¼Œæœ€åå»è¿æ¥SSIDå¯¹åº”çš„Wi-Fiã€‚ä¸€èˆ¬éœ€è¦åœ¨å‘é€SSIDå’Œå¯†ç çš„è®¾å¤‡ä¸Šå®‰è£…ä¸€ä¸ªAppï¼Œè¯¥Appå®ç°äº†å’ŒWi-Fiè®¾å¤‡ä¹‹é—´å‘é€SSIDå’Œå¯†ç çš„åè®®äº¤äº’ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105142652143.png" alt="image-20241105142652143"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾å¤‡è‡³å°‘æ”¯æŒStationæ¨¡å¼</em></p>
<h3 id="è“ç‰™é…ç½‘"><a href="#è“ç‰™é…ç½‘" class="headerlink" title="è“ç‰™é…ç½‘"></a>è“ç‰™é…ç½‘</h3><p>å¾…é…ç½‘çš„Wi-Fiè®¾å¤‡ä¼šå»ºç«‹ä¸€ä¸ªè“ç‰™çš„Profileï¼Œå‘è“ç‰™ä¿¡é“ä¸€ç›´å¹¿æ’­æ•°æ®ï¼Œç”¨æˆ·å°†æ™ºèƒ½æ‰‹æœºæˆ–å…¶ä»–å¯ä»¥å…·å¤‡äººæœºäº¤äº’åŠŸèƒ½çš„è®¾å¤‡ï¼ˆå¦‚å¹³æ¿ç”µè„‘ç­‰ï¼‰é€šè¿‡è“ç‰™ä¿¡é“è¿æ¥åˆ°è®¾å¤‡ï¼Œç„¶åé€šè¿‡è“ç‰™å°†è¦è¿æ¥çš„ä¿¡æ¯å‘é€ç»™å¾…é…ç½‘çš„Wi-Fiè®¾å¤‡ã€‚å¾…é…ç½‘çš„Wi-Fiè®¾å¤‡æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œæ‰¾åˆ°å¯¹åº”çš„APå¹¶ä¸»åŠ¨ä¸ä¹‹è¿æ¥ï¼Œå®Œæˆé…ç½‘ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105143818868.png" alt="image-20241105143818868"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾ç½®è‡³å°‘æ”¯æŒStationæ¨¡å¼ï¼ŒåŒæ—¶å…·å¤‡BLEåŠŸèƒ½ã€‚</em></p>
<h3 id="å…¶ä»–æ–¹å¼é…ç½‘"><a href="#å…¶ä»–æ–¹å¼é…ç½‘" class="headerlink" title="å…¶ä»–æ–¹å¼é…ç½‘"></a>å…¶ä»–æ–¹å¼é…ç½‘</h3><p>å…¶ä»–æ–¹å¼é…ç½‘åŒ…æ‹¬ï¼šç›´æ¥é…ç½‘ã€è·¯ç”±å™¨é…ç½‘ã€é›¶é…ï¼ˆZeroconfigï¼‰é…ç½‘ã€æ‰‹æœºAPé…ç½‘</p>
<h4 id="ç›´æ¥é…ç½‘"><a href="#ç›´æ¥é…ç½‘" class="headerlink" title="ç›´æ¥é…ç½‘"></a>ç›´æ¥é…ç½‘</h4><p>ç›´æ¥é…ç½‘æ˜¯æŒ‡é€šè¿‡<strong>UARTã€SPIã€SDIOã€I2C</strong>ç­‰å¤–è®¾æ¥å£ï¼Œéµå¾ªä¸€å®šçš„é€šä¿¡åè®®ï¼Œå°†SSIDå’Œå¯†ç ç›´æ¥å‘é€ç»™Wi-Fiè®¾å¤‡ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿç§°ä¸ºæœ‰çº¿é…ç½‘ã€‚Wi-Fiè®¾å¤‡åœ¨æ”¶åˆ°SSIDå’Œå¯†ç åè¿æ¥APï¼Œå¹¶å°†è¿æ¥çš„ç»“æœä»ä¸»æœºæ¥å£è¿”å›ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105144552396.png" alt="image-20241105144552396"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾å¤‡å¼•å‡ºå¤–è®¾çš„GPIOæ¥å£ã€‚</em></p>
<h4 id="è·¯ç”±å™¨é…ç½‘"><a href="#è·¯ç”±å™¨é…ç½‘" class="headerlink" title="è·¯ç”±å™¨é…ç½‘"></a>è·¯ç”±å™¨é…ç½‘</h4><p><strong>WPSï¼ˆWi-Fi Protected Setupï¼ŒWi-Fiå®‰å…¨é˜²æŠ¤è®¾å®šï¼‰</strong>æ˜¯ç”±Wi-Fiè”ç›Ÿæ¨å‡ºçš„å…¨æ–°æ ‡å‡†ï¼Œæ¨å‡ºè¯¥æ ‡å‡†çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†è§£å†³é•¿ä¹…ä»¥æ¥æ— çº¿ç½‘ç»œåŠ å¯†è®¤è¯è®¾å®šçš„æ­¥éª¤è¿‡äºç¹æ‚ä¹‹å¼Šç—…ã€‚WPSç®€åŒ–äº†Wi-Fiçš„å®‰å…¨è®¾ç½®å’Œç½‘ç»œç®¡ç†ï¼Œå®ƒæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š<strong>ä¸ªäººè¯†åˆ«ç ï¼ˆPINï¼‰æ¨¡å¼</strong> å’Œ <strong>æŒ‰é’®ï¼ˆPBCï¼‰æ¨¡å¼</strong>ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105144735611.png" alt="image-20241105144735611"></p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œè¦æ±‚Wi-Fiè®¾å¤‡æ”¯æŒWPSåŠŸèƒ½ï¼ˆwps clientï¼‰ï¼Œè€Œä¸”è¦æ±‚è·¯ç”±å™¨ä¹Ÿæ”¯æŒWPSåŠŸèƒ½ï¼ˆwps serverï¼‰ã€‚</em></p>
<h4 id="é›¶é…ï¼ˆZeroconfigï¼‰é…ç½‘"><a href="#é›¶é…ï¼ˆZeroconfigï¼‰é…ç½‘" class="headerlink" title="é›¶é…ï¼ˆZeroconfigï¼‰é…ç½‘"></a>é›¶é…ï¼ˆZeroconfigï¼‰é…ç½‘</h4><p>é›¶é…é…ç½‘çš„æœ¬è´¨æ˜¯ç”¨ä¸€å°å·²è”ç½‘çš„è®¾å¤‡ç»™å¦å¤–ä¸€å°è®¾å¤‡é…ç½‘ï¼Œåœ¨æ•´ä¸ªç¯èŠ‚ä¸­ï¼Œæ™ºèƒ½æ‰‹æœºè¿™ä¸ªè§’è‰²ç”¨åˆ«çš„è®¾å¤‡æ›¿æ¢æ‰äº†ï¼Œå¦‚æ™ºèƒ½éŸ³ç®±ç­‰ã€‚</p>
<p>å¾…é…ç½‘çš„Wi-Fiè®¾å¤‡è¿›å…¥é…ç½‘çŠ¶æ€ï¼Œå¹¶å°†è‡ªå·±çš„MACåœ°å€é€šè¿‡è‡ªå®šä¹‰æŠ¥æ–‡çš„æ–¹å¼å‘é€å‡ºå»ï¼Œæ­¤æ—¶è·¯ç”±å™¨ä¸‹æ”¯æŒçš„é›¶é…é…ç½‘è®¾å¤‡å°±å¯ä»¥è·å–åˆ°å¾…é…ç½‘è®¾å¤‡çš„MACåœ°å€ï¼ŒåŒæ—¶å·²è”ç½‘è®¾å¤‡ä¼šå°†è‡ªå·±ä¿å­˜çš„è·¯ç”±å™¨SSIDå’Œå¯†ç é€šè¿‡è‡ªå®šä¹‰æŠ¥æ–‡å‘é€ç»™å¾…é…ç½‘è®¾å¤‡ï¼Œå¹¶ç­‰å¾…å¾…é…ç½‘è®¾å¤‡è¿æ¥ä¸Šç½‘ç»œï¼Œè¿›è¡Œå¤–ç½‘ç»‘å®šç­‰æµç¨‹ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105145445101.png" alt="image-20241105145445101"></p>
<h4 id="æ‰‹æœºAPé…ç½‘"><a href="#æ‰‹æœºAPé…ç½‘" class="headerlink" title="æ‰‹æœºAPé…ç½‘"></a>æ‰‹æœºAPé…ç½‘</h4><p>æ‰‹æœºAPé…ç½‘æ˜¯å°†æ™ºèƒ½æ‰‹æœºè®¾ç½®æˆä¸€ä¸ªå…·æœ‰ç‰¹å®šåå­—å’Œå¯†ç çš„APï¼Œç„¶åè®©å¾…é…ç½‘è®¾å¤‡è¿æ¥æ™ºèƒ½æ‰‹æœºï¼Œå†å‘é€å’Œæ¥æ”¶é…ç½‘ç»‘å®šä¿¡æ¯ã€‚</p>
<p><img src="/2024/11/05/2024/esp-Wi-Fi-network-configuration/image-20241105145735981.png" alt="image-20241105145735981"></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>WiFié…ç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: flash search and configure</title>
    <url>/2024/11/04/2024/esp-flash-search-and-configure/</url>
    <content><![CDATA[<p>ä¸²å£æ—¥å¿—æŠ¥è­¦å‘Šï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">spi_flash: Detected size(4096k) larger than the size <span class="keyword">in</span> the binary image header(2048k). Using the size <span class="keyword">in</span> the binary image header.</span><br></pre></td></tr></table></figure>

<p>åŸå› ï¼šç¡¬ä»¶flashä¸º4MBï¼Œè€Œç¼–è¯‘å›ºä»¶çš„é…ç½®flashä¸º2MBï¼Œå¯¼è‡´æŠ¥è­¦å‘Šã€‚</p>
<h2 id="æŸ¥è¯¢flashå¤§å°"><a href="#æŸ¥è¯¢flashå¤§å°" class="headerlink" title="æŸ¥è¯¢flashå¤§å°"></a>æŸ¥è¯¢flashå¤§å°</h2><p>é€šè¿‡esptool.pyå·¥å…·å¯ä»¥æŸ¥è¯¢flashä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ esptool.py flash_id</span><br><span class="line">esptool.py v4.7.0</span><br><span class="line">Found 33 serial ports</span><br><span class="line">Serial port /dev/ttyUSB0</span><br><span class="line">Connecting....</span><br><span class="line">Detecting chip <span class="built_in">type</span>... Unsupported detection protocol, switching and trying again...</span><br><span class="line">Connecting...</span><br><span class="line">Detecting chip <span class="built_in">type</span>... ESP32</span><br><span class="line">Chip is ESP32-D0WD-V3 (revision v3.0)</span><br><span class="line">Features: WiFi, BT, Dual Core, 240MHz, VRef calibration <span class="keyword">in</span> efuse, Coding Scheme None</span><br><span class="line">Crystal is 40MHz</span><br><span class="line">MAC: 40:22:d8:<span class="built_in">fc</span>:d1:<span class="built_in">fc</span></span><br><span class="line">Uploading stub...</span><br><span class="line">Running stub...</span><br><span class="line">Stub running...</span><br><span class="line">Manufacturer: 5e</span><br><span class="line">Device: 4016</span><br><span class="line">Detected flash size: 4MB</span><br><span class="line">Hard resetting via RTS pin...</span><br></pre></td></tr></table></figure>

<p>Detected flash size: 4MBï¼Œå°±æ˜¯å®é™…çš„flashå¤§å°ã€‚</p>
<h2 id="è®¾ç½®flashå¤§å°"><a href="#è®¾ç½®flashå¤§å°" class="headerlink" title="è®¾ç½®flashå¤§å°"></a>è®¾ç½®flashå¤§å°</h2><p>é€šè¿‡ <code>idf.py menuconfig</code> èœå•ä¿®æ”¹flashçš„å¤§å°ã€‚</p>
<p>æ“ä½œè¿‡ç¨‹ï¼šâ€Serial flasher configâ€ â€“&gt; â€œFlash sizeâ€ â€“&gt; â€œ4Mâ€ï¼Œç„¶åä¿å­˜é€€å‡ºã€‚</p>
<p><img src="/2024/11/04/2024/esp-flash-search-and-configure/image-20241105114934762.png" alt="image-20241105114934762"></p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>esp32c3</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 22.04: smb</title>
    <url>/2024/11/04/2024/Ubuntu-22-04-smb/</url>
    <content><![CDATA[<h2 id="å®‰è£…smb"><a href="#å®‰è£…smb" class="headerlink" title="å®‰è£…smb"></a>å®‰è£…smb</h2><p>åœ¨Ubuntu 22.04 å®‰è£…smbæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> apt update</span><br><span class="line">$ <span class="built_in">sudo</span> apt install smb</span><br></pre></td></tr></table></figure>

<p>åœ¨ test ç”¨æˆ·å®¶ç›®å½•ä¸‹åˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /home/test/Share</span><br><span class="line">$ <span class="built_in">chmod</span> 755 /home/test/Share</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>/etc/samba/smb.conf</code> æ–‡ä»¶æœ«å°¾æ–°å¢å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Ubuntu_22.04]</span><br><span class="line">   comment = Samba</span><br><span class="line">   path = /home/test/Share</span><br><span class="line">   public = yes</span><br><span class="line">   writable = yes</span><br><span class="line">   available = yes</span><br><span class="line">   browseable = yes</span><br><span class="line">   valid users = test</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å°†å·²åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ ä¸ºsmbç”¨æˆ·ï¼ˆå½“å‰ç”¨æˆ·æ˜¯ï¼štestï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo smbpasswd -a test</span><br></pre></td></tr></table></figure>

<p>é˜²ç«å¢™æ”¾è¡Œsmbç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow smb</span><br></pre></td></tr></table></figure>

<p>é‡å¯smbæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart smb.service</span><br></pre></td></tr></table></figure>



<h2 id="è®¿é—®smb"><a href="#è®¿é—®smb" class="headerlink" title="è®¿é—®smb"></a>è®¿é—®smb</h2><p>åœ¨iPadä¸­æ‰“å¼€ â€œæ–‡ä»¶Appâ€ ï¼Œç‚¹å‡»å³ä¸Šè§’â€¦ï¼Œæ¥ç€å¯ä»¥ç‚¹å‡»â€è¿æ¥æœåŠ¡å™¨â€ï¼Œè¾“å…¥ï¼š<code>smb://&lt;xxx.xxx.xxx.xxx&gt;</code></p>
<p><img src="/2024/11/04/2024/Ubuntu-22-04-smb/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20241104202501.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20241104202501"></p>
<p>ç„¶åè¾“å…¥testçš„ç”¨æˆ·åå’Œå¯†ç ï¼š</p>
<p><img src="/2024/11/04/2024/Ubuntu-22-04-smb/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20241104202804.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20241104202804"></p>
<p>æ¥ç€å°±è¿›å…¥äº†smbæœåŠ¡å™¨çš„å…±äº«æ–‡ä»¶å¤¹</p>
<p><img src="/2024/11/04/2024/Ubuntu-22-04-smb/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20241104202535.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20241104202535"></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>smb</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux: grub</title>
    <url>/2024/11/03/2024/Linux-grub/</url>
    <content><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ç”±äºæœªçŸ¥åŸå› ï¼ˆ 1ã€æˆ‘çŒœæµ‹æ˜¯å‡çº§äº†å†…æ ¸ï¼Œä¸”å†…æ ¸æˆä¸º grub é»˜è®¤å¯åŠ¨é¡¹ï¼› 2ã€ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘åˆ é™¤äº†<code>/lib/modules/6.8.0-48-generic</code> è¿™ä¸ªç›®å½•ï¼‰ï¼Œå¯¼è‡´Ubuntu 22.04å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼šFailed to start load kernel modulesã€‚</p>
<p>è¿™è®©æˆ‘æœ‰ç‚¹æ…Œï¼Œæ¯•ç«Ÿé‡è£…ç³»ç»Ÿå¯¹æˆ‘æ¥è¯´ä¸éš¾ï¼Œä½†æ˜¯ç³»ç»Ÿå†…çš„è½¯ä»¶å®‰è£…å’Œæ•°æ®éƒ½æ˜¯éå¸¸ç¹ççš„ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œè‚¯å®šä¸ä¼šåšè¿™æ ·çš„äº‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åªèƒ½æŸ¥çœ‹åŸå› ï¼Œå¹¶å¯»æ±‚å…¶ä»–è§£å†³æ–¹æ³•ã€‚</p>
<h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>é¦–å…ˆï¼Œæˆ‘é€šè¿‡ç‰©ç†æŒ‰é”®å¼ºåˆ¶å…³æœºï¼Œæ¥ç€å¯åŠ¨è®¡ç®—æœºï¼Œå‘ç°å‡ºç°äº†grubèœå•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*Ubuntu</span><br><span class="line">Advanced options <span class="keyword">for</span> Ubuntu</span><br><span class="line">Memory <span class="built_in">test</span> (memtest86+)</span><br><span class="line">Memory <span class="built_in">test</span> (memtest86+, serial console 115200)</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤çš„ubuntuæ˜¯å¯åŠ¨å¤±è´¥çš„ï¼Œæ‰€ä»¥é€‰æ‹© <code>Advanced options for Ubuntu</code> è¿›å…¥å­èœå•ï¼Œæ˜¾ç¤ºäº†å¤šä¸ªå†…æ ¸é€‰é¡¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*Ubuntu, with Linux 6.8.0-48-generic</span><br><span class="line">Ubuntu, with Linux 6.8.0-48-generic (recovery mode)</span><br><span class="line">Ubuntu, with Linux 6.8.0-47-generic</span><br><span class="line">Ubuntu, with Linux 6.8.0-47-generic (recovery mode)</span><br></pre></td></tr></table></figure>

<p><strong>å…¶å®ï¼Œé»˜è®¤å¯åŠ¨çš„Ubuntuå†…æ ¸å°±æ˜¯Linux 6.8.0-48-genericï¼Œä½†æ˜¯å¤±è´¥äº†ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©äº†<code>Ubuntu, with Linux 6.8.0-47-generic</code> ï¼Œç„¶åå°±æ­£å¸¸å¯åŠ¨äº†ã€‚</strong></p>
<p>ä»¥ä¸Šå°±æ˜¯è§£å†³è¿‡ç¨‹ï¼Œä½†æ˜¯æ²¡æœ‰åŸç†æ€§çš„ä¸œè¥¿ã€‚ä¸ºäº†è¿›ä¸€æ­¥å¯¹äºè®¡ç®—æœºå¼€æœºå¯åŠ¨æµç¨‹çš„ç†è§£ï¼Œè¿˜æ˜¯è¦æ¥ç€ç ”ç©¶ã€‚</p>
<h2 id="grub-èœå•"><a href="#grub-èœå•" class="headerlink" title="grub èœå•"></a>grub èœå•</h2><blockquote>
<p><a href="https://www.gnu.org/software/grub/">grub</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>GNU GRUB æ˜¯ä¸€ä¸ª<a href="http://www.gnu.org/software/grub/manual/multiboot/multiboot.html">å¤šå¼•å¯¼å¯åŠ¨</a> åŠ è½½ç¨‹åºã€‚å®ƒæºè‡ª GRUBï¼ˆ<strong>GRand Unified Bootloaderï¼‰</strong>ï¼Œæœ€åˆç”± Erich Stefan Boleyn è®¾è®¡å’Œå®ç°ã€‚å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBootloaderï¼‰æœ‰å¾ˆå¤šç§ï¼Œç°å¦‚ä»Šåœ¨å„ç§Linuxå‘è¡Œç‰ˆä¸ŠåŸºæœ¬éƒ½ä½¿ç”¨ grub2 ä½œä¸ºå¼•å¯¼åŠ è½½ç¨‹åºã€‚</p>
<p>æ­£å¸¸è¿›å…¥è®¡ç®—æœºåï¼ŒæŸ¥çœ‹å®‰è£…äº†å¤šä¸ªlinux imageæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dpkg --get-selections | grep linux-image</span><br><span class="line">linux-image-6.5.0-18-generic			deinstall</span><br><span class="line">linux-image-6.5.0-45-generic			deinstall</span><br><span class="line">linux-image-6.8.0-40-generic			deinstall</span><br><span class="line">linux-image-6.8.0-45-generic			deinstall</span><br><span class="line">linux-image-6.8.0-47-generic			install</span><br><span class="line">linux-image-6.8.0-48-generic			install</span><br><span class="line">linux-image-generic-hwe-22.04			install</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æŸ¥çœ‹linux-imageçš„ä½ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dpkg -L linux-image-6.8.0-47-generic</span><br><span class="line">/.</span><br><span class="line">/boot</span><br><span class="line">/boot/vmlinuz-6.8.0-47-generic</span><br><span class="line">/usr</span><br><span class="line">/usr/share</span><br><span class="line">/usr/share/doc</span><br><span class="line">/usr/share/doc/linux-image-6.8.0-47-generic</span><br><span class="line">/usr/share/doc/linux-image-6.8.0-47-generic/changelog.Debian.gz</span><br><span class="line">/usr/share/doc/linux-image-6.8.0-47-generic/copyright</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç¡®è®¤ <code>/boot/vmlinuz-6.8.0-47-generic</code> å°±æ˜¯å†…æ ¸æ–‡ä»¶çš„ä½ç½®ï¼Œå½“ç„¶ <code>/boot</code> ç›®å½•ä¸‹è¿˜æœ‰å…¶ä»–å†…æ ¸æ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$/usr/share/doc# ll /boot</span><br><span class="line">total 187836</span><br><span class="line">drwxr-xr-x  5 root root     4096 11æœˆ  1 06:59 ./</span><br><span class="line">drwxr-xr-x 21 root root     4096  9æœˆ 13 10:40 ../</span><br><span class="line">-rw-r--r--  1 root root   287058 10æœˆ  2 22:39 config-6.8.0-47-generic</span><br><span class="line">-rw-r--r--  1 root root   287024 10æœˆ  7 17:56 config-6.8.0-48-generic</span><br><span class="line">drwx------  3 root root     4096  1æœˆ  1  1970 efi/</span><br><span class="line">drwxr-xr-x  5 root root     4096 11æœˆ  1 20:13 grub/</span><br><span class="line">lrwxrwxrwx  1 root root       27 11æœˆ  1 06:58 initrd.img -&gt; initrd.img-6.8.0-48-generic</span><br><span class="line">-rw-r--r--  1 root root 72002483 10æœˆ 21 09:59 initrd.img-6.8.0-47-generic</span><br><span class="line">-rw-r--r--  1 root root 72011182 11æœˆ  1 06:58 initrd.img-6.8.0-48-generic</span><br><span class="line">lrwxrwxrwx  1 root root       27 11æœˆ  1 06:58 initrd.img.old -&gt; initrd.img-6.8.0-47-generic</span><br><span class="line">drwx------  2 root root    16384  8æœˆ  8 09:53 lost+found/</span><br><span class="line">-rw-r--r--  1 root root   182800  2æœˆ  7  2022 memtest86+.bin</span><br><span class="line">-rw-r--r--  1 root root   184476  2æœˆ  7  2022 memtest86+.elf</span><br><span class="line">-rw-r--r--  1 root root   184980  2æœˆ  7  2022 memtest86+_multiboot.bin</span><br><span class="line">-rw-------  1 root root  8657806 10æœˆ  2 22:39 System.map-6.8.0-47-generic</span><br><span class="line">-rw-------  1 root root  8659561 10æœˆ  7 17:56 System.map-6.8.0-48-generic</span><br><span class="line">lrwxrwxrwx  1 root root       24 11æœˆ  1 06:58 vmlinuz -&gt; vmlinuz-6.8.0-48-generic</span><br><span class="line">-rw-------  1 root root 14911880 10æœˆ  2 22:43 vmlinuz-6.8.0-47-generic</span><br><span class="line">-rw-------  1 root root 14915976 10æœˆ  7 17:58 vmlinuz-6.8.0-48-generic</span><br><span class="line">lrwxrwxrwx  1 root root       24 11æœˆ  1 06:58 vmlinuz.old -&gt; vmlinuz-6.8.0-47-generic</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ <code>/boot</code> ç›®å½•ä¸‹çš„ä¿¡æ¯æ¥çœ‹ï¼Œè¿™ä¸å°±æ˜¯ grub èœå•é‡Œé¢çš„ä¸œè¥¿å˜›ã€‚é‚£ä¹ˆå°±ä¸‹æ¥åªè¦åœ¨ grub.conf æ‰¾åˆ°èœå•æ’åˆ—å°±å¥½äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çœç•¥...</span></span><br><span class="line">menuentry <span class="string">&#x27;Ubuntu&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-simple-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">	recordfail</span><br><span class="line">	load_video</span><br><span class="line">	gfxmode <span class="variable">$linux_gfx_mode</span></span><br><span class="line">	insmod gzio</span><br><span class="line">	<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">	insmod part_gpt</span><br><span class="line">	insmod ext2</span><br><span class="line">	search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">	linux	/vmlinuz-6.8.0-48-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro  quiet splash <span class="variable">$vt_handoff</span></span><br><span class="line">	initrd	/initrd.img-6.8.0-48-generic</span><br><span class="line">&#125;</span><br><span class="line">submenu <span class="string">&#x27;Advanced options for Ubuntu&#x27;</span> <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-advanced-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">	menuentry <span class="string">&#x27;Ubuntu, with Linux 6.8.0-48-generic&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-6.8.0-48-generic-advanced-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">		recordfail</span><br><span class="line">		load_video</span><br><span class="line">		gfxmode <span class="variable">$linux_gfx_mode</span></span><br><span class="line">		insmod gzio</span><br><span class="line">		<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">		insmod part_gpt</span><br><span class="line">		insmod ext2</span><br><span class="line">		search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading Linux 6.8.0-48-generic ...&#x27;</span></span><br><span class="line">		linux	/vmlinuz-6.8.0-48-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro  quiet splash <span class="variable">$vt_handoff</span></span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading initial ramdisk ...&#x27;</span></span><br><span class="line">		initrd	/initrd.img-6.8.0-48-generic</span><br><span class="line">	&#125;</span><br><span class="line">	menuentry <span class="string">&#x27;Ubuntu, with Linux 6.8.0-48-generic (recovery mode)&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-6.8.0-48-generic-recovery-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">		recordfail</span><br><span class="line">		load_video</span><br><span class="line">		insmod gzio</span><br><span class="line">		<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">		insmod part_gpt</span><br><span class="line">		insmod ext2</span><br><span class="line">		search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading Linux 6.8.0-48-generic ...&#x27;</span></span><br><span class="line">		linux	/vmlinuz-6.8.0-48-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro recovery nomodeset dis_ucode_ldr </span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading initial ramdisk ...&#x27;</span></span><br><span class="line">		initrd	/initrd.img-6.8.0-48-generic</span><br><span class="line">	&#125;</span><br><span class="line">	menuentry <span class="string">&#x27;Ubuntu, with Linux 6.8.0-47-generic&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-6.8.0-47-generic-advanced-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">		recordfail</span><br><span class="line">		load_video</span><br><span class="line">		gfxmode <span class="variable">$linux_gfx_mode</span></span><br><span class="line">		insmod gzio</span><br><span class="line">		<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">		insmod part_gpt</span><br><span class="line">		insmod ext2</span><br><span class="line">		search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading Linux 6.8.0-47-generic ...&#x27;</span></span><br><span class="line">		linux	/vmlinuz-6.8.0-47-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro  quiet splash <span class="variable">$vt_handoff</span></span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading initial ramdisk ...&#x27;</span></span><br><span class="line">		initrd	/initrd.img-6.8.0-47-generic</span><br><span class="line">	&#125;</span><br><span class="line">	menuentry <span class="string">&#x27;Ubuntu, with Linux 6.8.0-47-generic (recovery mode)&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-6.8.0-47-generic-recovery-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">		recordfail</span><br><span class="line">		load_video</span><br><span class="line">		insmod gzio</span><br><span class="line">		<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">		insmod part_gpt</span><br><span class="line">		insmod ext2</span><br><span class="line">		search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading Linux 6.8.0-47-generic ...&#x27;</span></span><br><span class="line">		linux	/vmlinuz-6.8.0-47-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro recovery nomodeset dis_ucode_ldr </span><br><span class="line">		<span class="built_in">echo</span>	<span class="string">&#x27;Loading initial ramdisk ...&#x27;</span></span><br><span class="line">		initrd	/initrd.img-6.8.0-47-generic</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># çœç•¥...</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¿¡æ¯å°±æ›´åŠ å®Œæ•´äº†ï¼Œè®¡ç®—æœºå¯åŠ¨æ—¶ gurb èœå•å°±æ˜¯æŒ‰ç…§è¿™ä¸ªé…ç½®æ–‡ä»¶è¾“å‡ºçš„ã€‚æ—¢ç„¶ grub èœå•ä¸­Ubuntué»˜è®¤å†…æ ¸ linuz-6.8.0-48-generic å¯åŠ¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¿®æ”¹ä¸º linuz-6.8.0-47-genericã€‚</p>
<p>ç¼–è¾‘ &#x2F;boot&#x2F;grub&#x2F;grub.confï¼Œä»…ä¿®æ”¹Ubuntuèœå•é‡Œé¢çš„å†…å®¹ï¼Œå…¶ä»–å†…å®¹ä¸åšä¿®æ”¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">menuentry <span class="string">&#x27;Ubuntu&#x27;</span> --class ubuntu --class gnu-linux --class gnu --class os <span class="variable">$menuentry_id_option</span> <span class="string">&#x27;gnulinux-simple-78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b&#x27;</span> &#123;</span><br><span class="line">	recordfail</span><br><span class="line">	load_video</span><br><span class="line">	gfxmode <span class="variable">$linux_gfx_mode</span></span><br><span class="line">	insmod gzio</span><br><span class="line">	<span class="keyword">if</span> [ x<span class="variable">$grub_platform</span> = xxen ]; <span class="keyword">then</span> insmod xzio; insmod lzopio; <span class="keyword">fi</span></span><br><span class="line">	insmod part_gpt</span><br><span class="line">	insmod ext2</span><br><span class="line">	search --no-floppy --fs-uuid --<span class="built_in">set</span>=root 0691b564-31ef-421c-9b8e-c7e498f0a651</span><br><span class="line">	linux	/vmlinuz-6.8.0-47-generic root=UUID=78ef3df0-dd4a-47f6-a7f9-4cda535dfe1b ro  quiet splash <span class="variable">$vt_handoff</span></span><br><span class="line">	initrd	/initrd.img-6.8.0-47-generic</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€é‡å¯è®¡ç®—æœºï¼Œgrub é»˜è®¤ä½¿ç”¨ linuz-6.8.0-47-generic å†…æ ¸æ–‡ä»¶ï¼ˆå› ä¸ºé€‰æ‹©è¿™ä¸ªå¯ä»¥æ­£å¸¸è¿›å…¥ç³»ç»Ÿï¼‰ï¼Œç›´æ¥è¿›å…¥åˆ°ç”¨æˆ·ç™»å½•ç•Œé¢ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>grub</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 22.04: ch34x UART Error</title>
    <url>/2024/10/31/2024/Ubuntu-22-04-ch34x-UART-Error/</url>
    <content><![CDATA[<p>USB-TTLæ¨¡å—æ¥å…¥PCåï¼Œæ— æ³•è¯†åˆ«ä¸ºæ­£å¸¸çš„USBæ¥å£ã€‚æ¥ç€ä¸€ç³»åˆ—é—®é¢˜æ’æŸ¥è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>ç¡®è®¤USB-TTLæ¨¡å—æ˜¯å¦è¢«è¯†åˆ«</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~$ lsusb</span><br><span class="line">Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 003 Device 003: ID 27c6:5125 Shenzhen Goodix Technology Co.,Ltd. Goodix Fingerprint Device </span><br><span class="line">Bus 003 Device 002: ID 0489:e0df Foxconn / Hon Hai </span><br><span class="line">Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 002 Device 011: ID 0b95:1790 ASIX Electronics Corp. AX88179 Gigabit Ethernet</span><br><span class="line">Bus 002 Device 010: ID 05e3:0626 Genesys Logic, Inc. USB3.1 Hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 005: ID 13d3:56f8 IMC Networks ov9734_azurewave_camera</span><br><span class="line">Bus 001 Device 003: ID 046d:c52f Logitech, Inc. Unifying Receiver</span><br><span class="line">Bus 001 Device 019: ID 10c4:ea60 Silicon Labs CP210x UART Bridge</span><br><span class="line">Bus 001 Device 028: ID 1a86:7523 QinHeng Electronics CH340 serial converter</span><br><span class="line">Bus 001 Device 020: ID 2207:0006 Fuzhou Rockchip Electronics Company rk3xxx</span><br><span class="line">Bus 001 Device 018: ID 05e3:0610 Genesys Logic, Inc. Hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>QinHeng Electronics CH340 serial converter</code>ï¼šè¡¨ç¤ºå·²ç»è¢«è¯†åˆ«äº†</p>
</li>
<li><p>ç¡®è®¤ch34xé©±åŠ¨æ˜¯å¦å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~$ lsmod | grep usbserial</span><br><span class="line">usbserial              69632  2 cp210x,ch341</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨è¿™ç§æ–¹å¼æŸ¥è¯¢</span></span><br><span class="line">pi@localhost:~$ <span class="built_in">ls</span> /lib/modules/$(<span class="built_in">uname</span> -r)/kernel/drivers/usb/serial</span><br><span class="line">aircable.ko    digi_acceleport.ko  io_ti.ko        kl5kusb105.ko  navman.ko   qcserial.ko      ti_usb_3410_5052.ko   whiteheat.ko</span><br><span class="line">ark3116.ko     empeg.ko            ipaq.ko         kobil_sct.ko   omninet.ko  quatech2.ko      upd78f0730.ko         wishbone-serial.ko</span><br><span class="line">belkin_sa.ko   f81232.ko           ipw.ko          mct_u232.ko    opticon.ko  safe_serial.ko   usb_debug.ko          xr_serial.ko</span><br><span class="line">ch341.ko       f81534.ko           ir-usb.ko       metro-usb.ko   option.ko   sierra.ko        usbserial.ko          xsens_mt.ko</span><br><span class="line">cp210x.ko      ftdi_sio.ko         iuu_phoenix.ko  mos7720.ko     oti6858.ko  spcp8x5.ko       usb-serial-simple.ko</span><br><span class="line">cyberjack.ko   garmin_gps.ko       keyspan.ko      mos7840.ko     pl2303.ko   ssu100.ko        usb_wwan.ko</span><br><span class="line">cypress_m8.ko  io_edgeport.ko      keyspan_pda.ko  mxuport.ko     qcaux.ko    symbolserial.ko  visor.ko</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>cp210x,ch341</code>ï¼šè¡¨ç¤ºå·²ç»åŠ è½½äº†cp210xé©±åŠ¨å’Œch341é©±åŠ¨</p>
</li>
<li><p><strong>æŸ¥çœ‹å…³äºttyçš„ç³»ç»Ÿæ—¥å¿—ï¼ˆé‡ç‚¹é—®é¢˜ï¼‰</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~$ <span class="built_in">sudo</span> dmesg | grep <span class="built_in">tty</span></span><br><span class="line">[290153.696478] usb 1-2.2: ch341-uart converter now attached to ttyUSB0</span><br><span class="line">[290154.264259] usb 1-2.2: usbfs: interface 0 claimed by ch341 <span class="keyword">while</span> <span class="string">&#x27;brltty&#x27;</span> sets config <span class="comment">#1</span></span><br><span class="line">[290154.266443] ch341-uart ttyUSB0: ch341-uart converter now disconnected from ttyUSB0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨æµè§ˆå™¨ä¸Šæ‰¾åˆ°äº† <a href="https://cn.linuxos.info/command/brltty">brltty</a> è¿™ä¸ªè¿›ç¨‹å¯¼è‡´USB-TTLè½¬æ¢å¤±è´¥äº†ã€‚</p>
<p><strong>brltty</strong> æ˜¯ä¸€ä¸ªåå°è¿›ç¨‹ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œå®ƒä½¿ç”¨å¯åˆ·æ–°çš„ç›²æ–‡æ˜¾ç¤ºå™¨ä¸ºç›²äººæä¾›å¯¹æ§åˆ¶å°å±å¹•ï¼ˆåœ¨æ–‡æœ¬æ¨¡å¼ä¸‹ï¼‰çš„è®¿é—®ã€‚å®ƒé©±åŠ¨ç›²æ–‡æ˜¾ç¤ºå™¨ï¼Œå¹¶æä¾›å®Œæ•´çš„å±å¹•æŸ¥çœ‹åŠŸèƒ½ã€‚ä¸€äº›è¯­éŸ³åŠŸèƒ½ä¹Ÿè¢«çº³å…¥å…¶ä¸­ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼šå¸è½½brlttyï¼Œæ‰§è¡Œå‘½ä»¤ <code>sudo apt remove brltty</code></p>
<p>å†æ¬¡æŸ¥è¯¢ <code>/dev/ttyUSB0</code> æ˜¯å¦å­˜åœ¨äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~$  <span class="built_in">sudo</span> <span class="built_in">ls</span> /dev/ttyU*</span><br><span class="line">/dev/ttyUSB0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æ˜¯è¿™ç§åŸå› å¼•èµ·çš„ï¼Œé‚£ä¹ˆå°±å¯èƒ½æ˜¯ch34xé©±åŠ¨å¤ªæ—§äº†ï¼Œéœ€è¦æ›´æ–°é©±åŠ¨ç¨‹åºã€‚å¯ä»¥åˆ°è¿™ä¸ªåœ°å€å»ä¸‹è½½é©±åŠ¨ï¼š<a href="https://www.wch.cn/downloads/CH341SER_LINUX_ZIP.html">CH341SER_LINUX.ZIP</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>UART</tag>
        <tag>ch34x</tag>
      </tags>
  </entry>
  <entry>
    <title>DBUS: busctl tool</title>
    <url>/2024/10/31/2024/DBUS-busctl-tool/</url>
    <content><![CDATA[<h2 id="busctl"><a href="#busctl" class="headerlink" title="busctl"></a>busctl</h2><blockquote>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/busctl.html">busctl</a>æ˜¯ä»€ä¹ˆçš„ï¼Ÿ</p>
</blockquote>
<p>busctl å¯ç”¨äºè‡ªçœå’Œç›‘æ§ D-Bus æ€»çº¿ã€‚</p>
<p><strong>busctlç”¨æ³•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">busctl [OPTIONS...] COMMAND ...</span><br><span class="line"></span><br><span class="line">Introspect the D-Bus IPC bus.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  list                     List bus names</span><br><span class="line">  status [SERVICE]         Show bus service, process or bus owner credentials</span><br><span class="line">  monitor [SERVICE...]     Show bus traffic</span><br><span class="line">  capture [SERVICE...]     Capture bus traffic as pcap</span><br><span class="line">  tree [SERVICE...]        Show object tree of service</span><br><span class="line">  introspect SERVICE OBJECT [INTERFACE]</span><br><span class="line">  call SERVICE OBJECT INTERFACE METHOD [SIGNATURE [ARGUMENT...]]</span><br><span class="line">                           Call a method</span><br><span class="line">  emit OBJECT INTERFACE SIGNAL [SIGNATURE [ARGUMENT...]]</span><br><span class="line">                           Emit a signal</span><br><span class="line">  get-property SERVICE OBJECT INTERFACE PROPERTY...</span><br><span class="line">                           Get property value</span><br><span class="line">  set-property SERVICE OBJECT INTERFACE PROPERTY SIGNATURE ARGUMENT...</span><br><span class="line">                           Set property value</span><br><span class="line">  <span class="built_in">help</span>                     Show this <span class="built_in">help</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="æŸ¥è¯¢æ‰€æœ‰çš„bus-name"><a href="#æŸ¥è¯¢æ‰€æœ‰çš„bus-name" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰çš„bus name"></a>æŸ¥è¯¢æ‰€æœ‰çš„bus name</h3><p>æ‰§è¡Œå‘½ä»¤ï¼š<code>busctl list --no-pager --system</code></p>
<p><em>æ³¨æ„ï¼šâ€“no-pager å‚æ•°è¡¨ç¤ºä¸åˆ†é¡µæ˜¾ç¤ºï¼Œâ€“systemc å‚æ•°è¡¨ç¤ºé“¾æ¥åˆ°ç³»ç»Ÿbus</em></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">NAME                            PID PROCESS         USER             CONNECTION    UNIT                                  SESSION DESCRIPTION</span><br><span class="line">:1.0                            123 dbus-broker-lau root             :1.0          dbus-broker.service                   -       -          </span><br><span class="line">:1.1                              1 systemd         root             :1.1          init.scope                            -       -          </span><br><span class="line">:1.11                           573 rauc            root             :1.11         rauc.service                          -       -          </span><br><span class="line">:1.15                           622 systemd-timesyn systemd-timesync :1.15         systemd-timesyncd.service             -       -          </span><br><span class="line">:1.19                          1042 python3         root             :1.19         docker-007b2d3a171bb6c083dc68968a4f6â€¦ -       -          </span><br><span class="line">:1.2                            135 udisksd         root             :1.2          udisks2.service                       -       -          </span><br><span class="line">:1.28                          1624 coredns         root             :1.28         docker-30807294999a70b11bed61212f49câ€¦ -       -          </span><br><span class="line">:1.3                            287 os-agent        root             :1.3          haos-agent.service                    -       -          </span><br><span class="line">:1.33                          1944 pulseaudio      root             :1.33         docker-f3b5cb4c6d236b78db17af3dcab3bâ€¦ -       -          </span><br><span class="line">:1.4                            517 systemd-resolve systemd-resolve  :1.4          systemd-resolved.service              -       -          </span><br><span class="line">:1.6                            532 systemd-logind  root             :1.6          systemd-logind.service                -       -          </span><br><span class="line">:1.7                            533 wpa_supplicant  root             :1.7          wpa_supplicant.service                -       -          </span><br><span class="line">:1.8                            520 NetworkManager  root             :1.8          NetworkManager.service                -       -          </span><br><span class="line">:1.831                         4650 busctl          root             :1.831        dropbear.service                      -       -          </span><br><span class="line">de.pengutronix.rauc             573 rauc            root             :1.11         rauc.service                          -       -          </span><br><span class="line">fi.w1.wpa_supplicant1           533 wpa_supplicant  root             :1.7          wpa_supplicant.service                -       -          </span><br><span class="line">io.hass.os                      287 os-agent        root             :1.3          haos-agent.service                    -       -          </span><br><span class="line">org.bluez                         - -               -                (activatable) -                                     -       -          </span><br><span class="line">org.freedesktop.DBus              1 systemd         root             -             init.scope                            -       -          </span><br><span class="line">org.freedesktop.NetworkManager  520 NetworkManager  root             :1.8          NetworkManager.service                -       -          </span><br><span class="line">org.freedesktop.UDisks2         135 udisksd         root             :1.2          udisks2.service                       -       -          </span><br><span class="line">org.freedesktop.hostname1         - -               -                (activatable) -                                     -       -          </span><br><span class="line">org.freedesktop.login1          532 systemd-logind  root             :1.6          systemd-logind.service                -       -          </span><br><span class="line">org.freedesktop.nm_dispatcher     - -               -                (activatable) -                                     -       -          </span><br><span class="line">org.freedesktop.nm_priv_helper    - -               -                (activatable) -                                     -       -          </span><br><span class="line">org.freedesktop.resolve1        517 systemd-resolve systemd-resolve  :1.4          systemd-resolved.service              -       -          </span><br><span class="line">org.freedesktop.systemd1          1 systemd         root             :1.1          init.scope                            -       -          </span><br><span class="line">org.freedesktop.timedate1         - -               -                (activatable) -                                     -       -          </span><br><span class="line">org.freedesktop.timesync1       622 systemd-timesyn systemd-timesync :1.15         systemd-timesyncd.service             -       -          </span><br><span class="line">org.pulseaudio.Server          1944 pulseaudio      root             :1.33         docker-f3b5cb4c6d236b78db17af3dcab3bâ€¦ -       -          </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢æŒ‡å®šbus-nameçš„å¯¹è±¡ä¿¡æ¯"><a href="#æŸ¥è¯¢æŒ‡å®šbus-nameçš„å¯¹è±¡ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢æŒ‡å®šbus nameçš„å¯¹è±¡ä¿¡æ¯"></a>æŸ¥è¯¢æŒ‡å®šbus nameçš„å¯¹è±¡ä¿¡æ¯</h3><p>æ‰§è¡Œå‘½ä»¤ï¼š<code>busctl introspect fi.w1.wpa_supplicant1 /fi/w1/wpa_supplicant1</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">NAME                                TYPE      SIGNATURE RESULT/VALUE                            FLAGS</span><br><span class="line">fi.w1.wpa_supplicant1               interface -         -                                       -</span><br><span class="line">.CreateInterface                    method    a&#123;sv&#125;     o                                       -</span><br><span class="line">.ExpectDisconnect                   method    -         -                                       -</span><br><span class="line">.GetInterface                       method    s         o                                       -</span><br><span class="line">.RemoveInterface                    method    o         -                                       -</span><br><span class="line">.Capabilities                       property  as        6 <span class="string">&quot;ap&quot;</span> <span class="string">&quot;p2p&quot;</span> <span class="string">&quot;pmf&quot;</span> <span class="string">&quot;ft&quot;</span> <span class="string">&quot;sha384&quot;</span> <span class="string">&quot;owe&quot;</span>  emits-change</span><br><span class="line">.DebugLevel                         property  s         <span class="string">&quot;info&quot;</span>                                  emits-change writable</span><br><span class="line">.DebugShowKeys                      property  b         <span class="literal">false</span>                                   emits-change writable</span><br><span class="line">.DebugTimestamp                     property  b         <span class="literal">false</span>                                   emits-change writable</span><br><span class="line">.EapMethods                         property  as        1 <span class="string">&quot;WSC&quot;</span>                                 emits-change</span><br><span class="line">.Interfaces                         property  ao        1 <span class="string">&quot;/fi/w1/wpa_supplicant1/Interfaces/0&quot;</span> emits-change</span><br><span class="line">.InterfaceAdded                     signal    oa&#123;sv&#125;    -                                       -</span><br><span class="line">.InterfaceRemoved                   signal    o         -                                       -</span><br><span class="line">.PropertiesChanged                  signal    a&#123;sv&#125;     -                                       -</span><br><span class="line">org.freedesktop.DBus.Introspectable interface -         -                                       -</span><br><span class="line">.Introspect                         method    -         s                                       -</span><br><span class="line">org.freedesktop.DBus.Properties     interface -         -                                       -</span><br><span class="line">.Get                                method    ss        v                                       -</span><br><span class="line">.GetAll                             method    s         a&#123;sv&#125;                                   -</span><br><span class="line">.Set                                method    ssv       -                                       -</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>IPC</category>
      </categories>
  </entry>
  <entry>
    <title>NetworkManager Application</title>
    <url>/2024/10/31/2024/NetworkManager-Application/</url>
    <content><![CDATA[<h2 id="NetworkManager"><a href="#NetworkManager" class="headerlink" title="NetworkManager"></a>NetworkManager</h2><blockquote>
<p><a href="https://networkmanager.dev/docs/api/latest/NetworkManager.html">NetworkManager</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>NetworkManager å®ˆæŠ¤ç¨‹åºå°è¯•é€šè¿‡ç®¡ç†ä¸»ç½‘ç»œè¿æ¥å’Œå…¶ä»–ç½‘ç»œæ¥å£ï¼ˆå¦‚ä»¥å¤ªç½‘ã€Wi-Fi å’Œç§»åŠ¨å®½å¸¦è®¾å¤‡ï¼‰æ¥ä½¿ç½‘ç»œé…ç½®å’Œæ“ä½œå°½å¯èƒ½è½»æ¾å’Œè‡ªåŠ¨åŒ–ã€‚å½“ä»»ä½•ç½‘ç»œè®¾å¤‡çš„è¿æ¥å¯ç”¨æ—¶ï¼ŒNetworkManager å°†è¿æ¥è¯¥è®¾å¤‡ï¼Œé™¤éè¯¥è¡Œä¸ºè¢«ç¦ç”¨ã€‚æœ‰å…³ç½‘ç»œçš„ä¿¡æ¯é€šè¿‡ D-Bus æ¥å£å¯¼å‡ºåˆ°ä»»ä½•æ„Ÿå…´è¶£çš„åº”ç”¨ç¨‹åºï¼Œä»è€Œæä¾›ä¸°å¯Œçš„ API æ¥æ£€æŸ¥å’Œæ§åˆ¶ç½‘ç»œè®¾ç½®å’Œæ“ä½œã€‚</p>
<h2 id="D-Bus-API"><a href="#D-Bus-API" class="headerlink" title="D-Bus API"></a>D-Bus API</h2><h2 id="libnm"><a href="#libnm" class="headerlink" title="libnm"></a>libnm</h2><blockquote>
<p><a href="https://networkmanager.dev/docs/libnm/latest/ref-overview.html">libnm</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>libnm æ˜¯ NetworkManagerï¼ˆæ ‡å‡† Linux ç½‘ç»œç®¡ç†æœåŠ¡ï¼‰çš„å®¢æˆ·ç«¯åº“ã€‚NetworkManager æ”¯æŒå„ç§ç½‘ç»œé…ç½®æ–¹æ¡ˆã€ç¡¬ä»¶è®¾å¤‡å’Œåè®®ç³»åˆ—ã€‚å¤§å¤šæ•°åŠŸèƒ½éƒ½é€šè¿‡ <a href="https://networkmanager.dev/docs/api/latest/spec.html">D-Bus API</a>å…¬å¼€ï¼Œä»è€Œå…è®¸å…¶ä»–å·¥å…·ä½¿ç”¨ NetworkManager æä¾›çš„åŠŸèƒ½ã€‚</p>
<p>libnm ä¸º NetworkManager æä¾›çš„åŠŸèƒ½æä¾›äº† C è¯­è¨€ç»‘å®šï¼Œå…¶ä»–è¯­è¨€è¿è¡Œæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p>
<p>libnm ä¸ NetworkManager æä¾›çš„å®é™… D-Bus API æ˜ å°„å¾—ç›¸å½“ç´§å¯†ï¼Œå°†è¿œç¨‹ D-Bus å¯¹è±¡åŒ…è£…ä¸ºæœ¬æœº GObjectï¼Œå°† D-Bus ä¿¡å·å’Œå±æ€§æ˜ å°„åˆ° GObject ä¿¡å·å’Œå±æ€§ï¼Œå¹¶æä¾›æœ‰ç”¨çš„è®¿é—®å™¨å’Œå®ç”¨å‡½æ•°ã€‚ä½†æ˜¯ï¼Œä¸æ—§çš„ libnm-util&#x2F;libnm-glib API ä¸åŒï¼Œä¸ D-Bus API çš„æ˜ å°„å¹¶ä¸ç²¾ç¡®ï¼Œå¹¶ä¸” D-Bus API çš„å„ç§ä¸ä¾¿ä¹‹å¤„å’Œå†å²å¼‚å¸¸éƒ½è¢«æ©ç›–äº†ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ libnm å¯¹è±¡ç»“æ„çš„ç²—ç•¥æ¦‚è¿°ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒçš„å„ä¸ªéƒ¨åˆ†ï¼š</p>
<p><img src="/2024/10/31/2024/NetworkManager-Application/image-20241031145554396.png" alt="image-20241031145554396"></p>
]]></content>
      <categories>
        <category>Wi-Fi</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>NetworkManager</tag>
        <tag>Network</tag>
      </tags>
  </entry>
  <entry>
    <title>wpa-supplicant applicant: Scan Method</title>
    <url>/2024/10/30/2024/wpa-supplicant-applicant-Scan-Method/</url>
    <content><![CDATA[<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä»£ç è¿‡ç¨‹ï¼š</p>
<ul>
<li>æ³¨å†Œä¿¡å·å›è°ƒå‡½æ•°</li>
<li>åˆ›å»ºgdbusè¿æ¥</li>
<li>åˆ›å»ºgdbusäº‹ä»¶å¾ªç¯</li>
<li>è·å–wlan0çš„å¯¹è±¡è·¯å¾„ï¼ˆè¿™ä¸€æ­¥æ¯”è¾ƒå…³é”®ï¼Œåé¢Scanæ–¹æ³•éœ€è¦wlan0çš„å¯¹è±¡è·¯å¾„ä½œä¸ºå‚æ•°ä¼ å…¥ï¼‰</li>
<li>åˆ†åˆ«è®¢é˜…ScanDone ä¿¡å·ã€BSSAdded ä¿¡å·ã€BSSRemoved ä¿¡å·ã€PropertiesChanged ä¿¡å·</li>
<li>è°ƒç”¨Scanæ–¹æ³•</li>
<li>å¯åŠ¨gdbusäº‹ä»¶å¾ªç¯</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">gcc src/main.c -o wpa-ctl \</span></span><br><span class="line"><span class="comment">	`pkg-config --cflags --libs gio-2.0`\</span></span><br><span class="line"><span class="comment">	`pkg-config --cflags --libs glib-2.0`\</span></span><br><span class="line"><span class="comment">	`pkg-config --cflags --libs dbus-1`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">GMainLoop *g_loop;</span><br><span class="line">GDBusConnection *g_gdbus_con;</span><br><span class="line"></span><br><span class="line">guint g_prop_changed;</span><br><span class="line">guint g_scan_done;</span><br><span class="line">guint g_bss_removed;</span><br><span class="line">guint g_bss_added;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wpa_property_value</span><span class="params">(<span class="type">const</span> gchar *key, GVariant *value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> gchar *type = g_variant_get_type_string(value);</span><br><span class="line">	<span class="comment">// g_printf(&quot;type: %s\n&quot;, type);</span></span><br><span class="line">	g_printf(<span class="string">&quot;\t%s(%s) : &quot;</span>, key, type);</span><br><span class="line">	<span class="keyword">switch</span>(*type) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>: <span class="comment">// object_path</span></span><br><span class="line">			g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_get_string(value, <span class="literal">NULL</span>));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>: <span class="comment">// string</span></span><br><span class="line">			g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_get_string(value, <span class="literal">NULL</span>));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>: <span class="comment">// boolean</span></span><br><span class="line">			g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_get_boolean(value)? <span class="string">&quot;true&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">			g_printf(<span class="string">&quot;%#x\n&quot;</span>, g_variant_get_byte(value));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>: <span class="comment">// uint32</span></span><br><span class="line">			g_printf(<span class="string">&quot;%d\n&quot;</span>, g_variant_get_uint32(value));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>: <span class="comment">// int16</span></span><br><span class="line">			g_printf(<span class="string">&quot;%hd\n&quot;</span>, g_variant_get_int16(value));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;q&#x27;</span>: <span class="comment">// uint16</span></span><br><span class="line">			g_printf(<span class="string">&quot;%u\n&quot;</span>, g_variant_get_uint16(value));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>: <span class="comment">// int32</span></span><br><span class="line">			g_printf(<span class="string">&quot;%d\n&quot;</span>, g_variant_get_int32(value));</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>: <span class="comment">// array,[]</span></span><br><span class="line">		<span class="comment">/* TODO Handling only &#x27;as&#x27;, but not array of dicts */</span></span><br><span class="line">			<span class="keyword">if</span>(!g_strcmp0(type, <span class="string">&quot;as&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">				gchar *uuid;</span><br><span class="line">				GVariantIter i;</span><br><span class="line">				g_variant_iter_init(&amp;i, value);</span><br><span class="line">				<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;s&quot;</span>, &amp;uuid))</span><br><span class="line">				&#123;</span><br><span class="line">					g_printf(<span class="string">&quot;\t\t%s\n&quot;</span>, uuid);</span><br><span class="line">					g_free(uuid);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (!g_strcmp0(type, <span class="string">&quot;ay&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				guint8 byte;</span><br><span class="line">				GVariantIter i;</span><br><span class="line">				g_variant_iter_init(&amp;i, value);</span><br><span class="line">				gsize size = g_variant_iter_n_children(&amp;i);</span><br><span class="line">				<span class="keyword">if</span> (!g_strcmp0(<span class="string">&quot;SSID&quot;</span>, key))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;y&quot;</span>, &amp;byte))</span><br><span class="line">						g_printf(<span class="string">&quot;%c&quot;</span>, byte);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (!g_strcmp0(<span class="string">&quot;BSSID&quot;</span>, key))</span><br><span class="line">				&#123;</span><br><span class="line">					guint8 cnt = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;y&quot;</span>, &amp;byte))</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span> (cnt == size <span class="number">-1</span>)</span><br><span class="line">							g_printf(<span class="string">&quot;%02X&quot;</span>, byte);</span><br><span class="line">						<span class="keyword">else</span></span><br><span class="line">							g_printf(<span class="string">&quot;%02X-&quot;</span>, byte);</span><br><span class="line">						cnt++;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;y&quot;</span>, &amp;byte))</span><br><span class="line">						g_printf(<span class="string">&quot;0x%x &quot;</span>, byte);</span><br><span class="line">				&#125;</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (!g_strcmp0(type, <span class="string">&quot;ao&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">				gchar *opath;</span><br><span class="line">				GVariantIter i;</span><br><span class="line">				g_variant_iter_init(&amp;i, value);</span><br><span class="line">				<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;o&quot;</span>, &amp;opath))</span><br><span class="line">				&#123;</span><br><span class="line">					g_printf(<span class="string">&quot;\t\t%s\n&quot;</span>, opath);</span><br><span class="line">					g_free(opath);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (!g_strcmp0(type, <span class="string">&quot;au&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				guint32 rate = <span class="number">0</span>;</span><br><span class="line">				GVariantIter i;</span><br><span class="line">				g_variant_iter_init(&amp;i, value);</span><br><span class="line">				<span class="keyword">while</span>(g_variant_iter_next(&amp;i, <span class="string">&quot;u&quot;</span>, &amp;rate))</span><br><span class="line">					g_printf(<span class="string">&quot;%u &quot;</span>, rate);</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (!g_strcmp0(type, <span class="string">&quot;a&#123;sv&#125;&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">				GVariantIter iter;</span><br><span class="line">    			GVariant *prop_val;</span><br><span class="line">				gchar *prop_name;</span><br><span class="line">				g_variant_iter_init(&amp;iter, value);</span><br><span class="line">				<span class="keyword">while</span> (g_variant_iter_next (&amp;iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;prop_name, &amp;prop_val))</span><br><span class="line">				&#123;</span><br><span class="line">					g_printf(<span class="string">&quot;\t\t%s: &quot;</span>, prop_name);</span><br><span class="line">					<span class="keyword">if</span> (g_variant_is_of_type(prop_val, G_VARIANT_TYPE_STRING))</span><br><span class="line">					&#123;</span><br><span class="line">						g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_get_string(prop_val, <span class="literal">NULL</span>));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> (g_variant_is_of_type(prop_val, G_VARIANT_TYPE_STRING_ARRAY))</span><br><span class="line">					&#123;</span><br><span class="line">						gchar *str;</span><br><span class="line">						GVariantIter i;</span><br><span class="line">						g_variant_iter_init(&amp;i, prop_val);</span><br><span class="line">						<span class="keyword">while</span> (g_variant_iter_next(&amp;i, <span class="string">&quot;s&quot;</span>, &amp;str))</span><br><span class="line">						&#123;</span><br><span class="line">							g_printf(<span class="string">&quot;%s &quot;</span>, str);</span><br><span class="line">							g_free(str);</span><br><span class="line">						&#125;</span><br><span class="line">						g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					g_free(prop_name);</span><br><span class="line">					g_variant_unref(prop_val);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			g_printf(<span class="string">&quot;Other\n&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wpa_signal_scan_done_cb</span><span class="params">(GDBusConnection *sig,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *sender_name,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *object_path,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *interface,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *signal_name,</span></span><br><span class="line"><span class="params">									GVariant *parameters,</span></span><br><span class="line"><span class="params">									gpointer user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// parameters data type: (b)</span></span><br><span class="line">	(<span class="type">void</span>)sig;</span><br><span class="line">	(<span class="type">void</span>)sender_name;</span><br><span class="line">	(<span class="type">void</span>)object_path;</span><br><span class="line">	(<span class="type">void</span>)interface;</span><br><span class="line">	(<span class="type">void</span>)signal_name;</span><br><span class="line">	(<span class="type">void</span>)user_data;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> gchar *type = g_variant_get_type_string(parameters);</span><br><span class="line">	g_printf(<span class="string">&quot;ScanDone signal data type: %s\n&quot;</span>, type);</span><br><span class="line">	g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_print(parameters, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">	gboolean val;</span><br><span class="line">	g_variant_get(parameters, <span class="string">&quot;(b)&quot;</span>, &amp;val);</span><br><span class="line">	g_printf(<span class="string">&quot;ScanDone: %s\n&quot;</span>, val ? <span class="string">&quot;true&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">	g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wpa_signal_bss_added_cb</span><span class="params">(GDBusConnection *sig,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *sender_name,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *object_path,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *interface,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *signal_name,</span></span><br><span class="line"><span class="params">									GVariant *parameters,</span></span><br><span class="line"><span class="params">									gpointer user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// parameters data type: (oa&#123;sv&#125;)</span></span><br><span class="line">	(<span class="type">void</span>)sig;</span><br><span class="line">	(<span class="type">void</span>)sender_name;</span><br><span class="line">	(<span class="type">void</span>)object_path;</span><br><span class="line">	(<span class="type">void</span>)interface;</span><br><span class="line">	(<span class="type">void</span>)signal_name;</span><br><span class="line">	(<span class="type">void</span>)user_data;</span><br><span class="line"></span><br><span class="line">	GVariantIter *iter;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *object;</span><br><span class="line">	gchar *interface_name;</span><br><span class="line">	GVariant *properties;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> gchar *type = g_variant_get_type_string(parameters);</span><br><span class="line">	g_printf(<span class="string">&quot;BssAdded data type: %s\n&quot;</span>, type);</span><br><span class="line">	g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_print(parameters, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">	g_variant_get(parameters, <span class="string">&quot;(oa&#123;sv&#125;)&quot;</span>, &amp;object, &amp;iter);</span><br><span class="line">	g_printf(<span class="string">&quot;object_path: %s\n&quot;</span>, object);</span><br><span class="line">	<span class="keyword">while</span> (g_variant_iter_next(iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;interface_name, &amp;properties))</span><br><span class="line">	&#123;</span><br><span class="line">		wpa_property_value(interface_name, properties);</span><br><span class="line">		g_free(interface_name);</span><br><span class="line">		g_variant_unref(properties);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	g_variant_iter_free(iter);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wpa_signal_bss_removed_cb</span><span class="params">(GDBusConnection *sig,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *sender_name,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *object_path,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *interface,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *signal_name,</span></span><br><span class="line"><span class="params">									GVariant *parameters,</span></span><br><span class="line"><span class="params">									gpointer user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// parameters data type: (o)</span></span><br><span class="line">	(<span class="type">void</span>)sig;</span><br><span class="line">	(<span class="type">void</span>)sender_name;</span><br><span class="line">	(<span class="type">void</span>)object_path;</span><br><span class="line">	(<span class="type">void</span>)interface;</span><br><span class="line">	(<span class="type">void</span>)signal_name;</span><br><span class="line">	(<span class="type">void</span>)user_data;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> gchar *type = g_variant_get_type_string(parameters);</span><br><span class="line">	g_printf(<span class="string">&quot;BssRemoved data type: %s\n&quot;</span>, type);</span><br><span class="line">	g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_print(parameters, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> gchar *val = <span class="literal">NULL</span>;</span><br><span class="line">	g_variant_get(parameters, <span class="string">&quot;(o)&quot;</span>, &amp;val);</span><br><span class="line">	g_printf(<span class="string">&quot;BssRemoved: %s\n&quot;</span>, val);</span><br><span class="line">	g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wpa_signal_properties_changed_cb</span><span class="params">(GDBusConnection *sig,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *sender_name,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *object_path,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *interface,</span></span><br><span class="line"><span class="params">									<span class="type">const</span> gchar *signal_name,</span></span><br><span class="line"><span class="params">									GVariant *parameters,</span></span><br><span class="line"><span class="params">									gpointer user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// parameters data type: (a&#123;sv&#125;)</span></span><br><span class="line">	(<span class="type">void</span>)sig;</span><br><span class="line">	(<span class="type">void</span>)sender_name;</span><br><span class="line">	(<span class="type">void</span>)object_path;</span><br><span class="line">	(<span class="type">void</span>)interface;</span><br><span class="line">	(<span class="type">void</span>)signal_name;</span><br><span class="line">	(<span class="type">void</span>)user_data;</span><br><span class="line"></span><br><span class="line">	GVariantIter *iter;</span><br><span class="line">	gchar *property_name;</span><br><span class="line">	GVariant *prop_val;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> gchar *type = g_variant_get_type_string(parameters);</span><br><span class="line">	g_printf(<span class="string">&quot;PropertiesChanged data type: %s\n&quot;</span>, type);</span><br><span class="line">	g_printf(<span class="string">&quot;%s\n&quot;</span>, g_variant_print(parameters, <span class="literal">true</span>));</span><br><span class="line">	</span><br><span class="line">	g_variant_get(parameters, <span class="string">&quot;(a&#123;sv&#125;)&quot;</span>, &amp;iter);</span><br><span class="line">	<span class="comment">// while (g_variant_iter_loop(iter, &quot;&#123;sv&#125;&quot;, &amp;property_name, &amp;prop_val))</span></span><br><span class="line">	<span class="keyword">while</span> (g_variant_iter_next(iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;property_name, &amp;prop_val))</span><br><span class="line">	&#123;</span><br><span class="line">		wpa_property_value(property_name, prop_val);</span><br><span class="line">		g_free(property_name);</span><br><span class="line">		g_variant_unref(prop_val);</span><br><span class="line">	&#125;</span><br><span class="line">	g_printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	g_variant_iter_free(iter);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">main_loop_stop</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sigact</span> =</span> &#123; .sa_handler = SIG_DFL &#125;;</span><br><span class="line">	sigaction(sig, &amp;sigact, <span class="literal">NULL</span>);</span><br><span class="line">	g_main_loop_quit(g_loop);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// æ³¨å†Œä¿¡å·å›è°ƒ</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sigact</span> =</span> &#123; .sa_handler = main_loop_stop &#125;;</span><br><span class="line">	sigaction(SIGTERM, &amp;sigact, <span class="literal">NULL</span>);</span><br><span class="line">	sigaction(SIGINT, &amp;sigact, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ›å»ºgdbusè¿æ¥</span></span><br><span class="line">	g_gdbus_con = g_bus_get_sync(G_BUS_TYPE_SYSTEM, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(g_gdbus_con == <span class="literal">NULL</span>) </span><br><span class="line">	&#123;</span><br><span class="line">		g_printf(<span class="string">&quot;Not able to get connection to system bus\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸»å¾ªç¯</span></span><br><span class="line">	g_loop = g_main_loop_new(<span class="literal">NULL</span>, FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ­¥è°ƒç”¨ï¼Œè·å–wlan0çš„å¯¹è±¡è·¯å¾„</span></span><br><span class="line">	GVariant *result;</span><br><span class="line">	GError *error = <span class="literal">NULL</span>;</span><br><span class="line">	result = g_dbus_connection_call_sync(</span><br><span class="line">				g_gdbus_con,</span><br><span class="line">				<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;/fi/w1/wpa_supplicant1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;GetInterface&quot;</span>,</span><br><span class="line">				g_variant_new(<span class="string">&quot;(s)&quot;</span>, <span class="string">&quot;wlan0&quot;</span>),</span><br><span class="line">				G_VARIANT_TYPE(<span class="string">&quot;(o)&quot;</span>),</span><br><span class="line">				G_DBUS_CALL_FLAGS_NONE,</span><br><span class="line">				<span class="number">-1</span>,</span><br><span class="line">				<span class="literal">NULL</span>,</span><br><span class="line">				&amp;error);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> != error)</span><br><span class="line">	&#123;</span><br><span class="line">		g_printf(<span class="string">&quot;Error GetInterface: %s\n&quot;</span>, error-&gt;message);</span><br><span class="line">		g_error_free(error);</span><br><span class="line">		<span class="keyword">goto</span> fail;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// g_printf(&quot;%s\n&quot;, g_variant_print(result, true));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æobject path</span></span><br><span class="line">    <span class="type">const</span> gchar *object_path = <span class="literal">NULL</span>;</span><br><span class="line">    g_variant_get(result, <span class="string">&quot;(o)&quot;</span>, &amp;object_path);</span><br><span class="line">    g_variant_unref(result);</span><br><span class="line">    <span class="keyword">if</span> (object_path == <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        g_print(<span class="string">&quot;Failed to parse object path from the result.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> fail;</span><br><span class="line">    &#125;</span><br><span class="line">    g_printf(<span class="string">&quot;Received object path from wlan0: %s\n\n&quot;</span>, object_path);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¢é˜… ScanDone ä¿¡å·</span></span><br><span class="line">	g_scan_done = g_dbus_connection_signal_subscribe(</span><br><span class="line">						g_gdbus_con, 						<span class="comment">// connection</span></span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>, 			<span class="comment">// sender</span></span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1.Interface&quot;</span>,  <span class="comment">// interface_name</span></span><br><span class="line">						<span class="string">&quot;ScanDone&quot;</span>,							<span class="comment">// memberï¼šmethod or signal</span></span><br><span class="line">						object_path, 								<span class="comment">// object path</span></span><br><span class="line">						<span class="literal">NULL</span>, 								<span class="comment">// arg0</span></span><br><span class="line">						G_DBUS_SIGNAL_FLAGS_NONE, 			<span class="comment">// flags</span></span><br><span class="line">						wpa_signal_scan_done_cb, 			<span class="comment">// callback</span></span><br><span class="line">						<span class="literal">NULL</span>, 								<span class="comment">// user_data</span></span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">// è®¢é˜… BSSAdded ä¿¡å·</span></span><br><span class="line">	g_bss_added = g_dbus_connection_signal_subscribe(</span><br><span class="line">						g_gdbus_con,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1.Interface&quot;</span>,</span><br><span class="line">						<span class="string">&quot;BSSAdded&quot;</span>,</span><br><span class="line">						object_path,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						G_DBUS_SIGNAL_FLAGS_NONE,</span><br><span class="line">						wpa_signal_bss_added_cb,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">// è®¢é˜… BSSRemoved ä¿¡å·</span></span><br><span class="line">	g_bss_removed = g_dbus_connection_signal_subscribe(</span><br><span class="line">						g_gdbus_con,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1.Interface&quot;</span>,</span><br><span class="line">						<span class="string">&quot;BSSRemoved&quot;</span>,</span><br><span class="line">						object_path,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						G_DBUS_SIGNAL_FLAGS_NONE,</span><br><span class="line">						wpa_signal_bss_removed_cb,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">// è®¢é˜… PropertiesChanged ä¿¡å·</span></span><br><span class="line">	g_prop_changed = g_dbus_connection_signal_subscribe(</span><br><span class="line">						g_gdbus_con,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">						<span class="string">&quot;fi.w1.wpa_supplicant1.Interface&quot;</span>,</span><br><span class="line">						<span class="string">&quot;PropertiesChanged&quot;</span>,</span><br><span class="line">						object_path,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						G_DBUS_SIGNAL_FLAGS_NONE,</span><br><span class="line">						wpa_signal_properties_changed_cb,</span><br><span class="line">						<span class="literal">NULL</span>,</span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* æ‰«æ */</span> </span><br><span class="line">	GVariantBuilder *builder = g_variant_builder_new(G_VARIANT_TYPE(<span class="string">&quot;a&#123;sv&#125;&quot;</span>));</span><br><span class="line">	g_variant_builder_add(builder, <span class="string">&quot;&#123;sv&#125;&quot;</span>, <span class="string">&quot;Type&quot;</span>, g_variant_new_string(<span class="string">&quot;active&quot;</span>));</span><br><span class="line">	GVariant *variant = g_variant_builder_end(builder);</span><br><span class="line">	g_variant_builder_unref(builder);</span><br><span class="line"></span><br><span class="line">	g_dbus_connection_call(g_gdbus_con,</span><br><span class="line">				<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>,</span><br><span class="line">				object_path,</span><br><span class="line">				<span class="string">&quot;fi.w1.wpa_supplicant1.Interface&quot;</span>,</span><br><span class="line">				<span class="string">&quot;Scan&quot;</span>,</span><br><span class="line">				g_variant_new_tuple(&amp;variant, <span class="number">1</span>),</span><br><span class="line">				<span class="literal">NULL</span>,</span><br><span class="line">				G_DBUS_CALL_FLAGS_NONE,</span><br><span class="line">				<span class="number">-1</span>,</span><br><span class="line">				<span class="literal">NULL</span>,</span><br><span class="line">				<span class="literal">NULL</span>,</span><br><span class="line">				<span class="literal">NULL</span>);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">    g_main_loop_run(g_loop);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// é‡Šæ”¾gdbusè¿æ¥</span></span><br><span class="line">	g_object_unref(g_gdbus_con);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;@@@@@@ App Stop @@@@@@&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h2><p><strong>éš¾ç‚¹1ï¼š</strong></p>
<p>è¿™é‡Œå®ç°è¿‡ç¨‹çš„é€»è¾‘å‚è€ƒäº†<a href="https://android.googlesource.com/platform/external/wpa_supplicant_8/+/master/wpa_supplicant/examples/wpas-dbus-new.py">wpa_supplicant dbus api example using python</a> ï¼Œé€šè¿‡pythonç¼–ç¨‹å®ç°ã€‚</p>
<p><strong>éš¾ç‚¹2ï¼š</strong></p>
<p>è®¢é˜…å„ç§ä¿¡å·çš„è¿”å›å€¼ç±»å‹ä»¥åŠå¦‚ä½•å¯¹å®ƒè¿›è¡Œè§£æä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚è¿™éœ€è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://w1.fi/wpa_supplicant/devel/dbus.html">wpa_supplicant å®˜æ–¹dbusæ¥å£æ–‡æ¡£</a> ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢ï¼Œæˆ‘æŠŠå®ƒè½¬æ¢æˆäº†è¡¨æ ¼å½¢å¼ï¼Œå…·ä½“æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  <code>&#123;% post_link wpa-supplicant application %&#125;</code></p>
<p>è¿™é‡Œå¯¹å„ç§ä¿¡å·åŸå§‹æ•°æ®è¿›è¡Œè®°å½•ï¼š</p>
<p>ä¸»è¦æ¶‰åŠå„ç§ä¿¡å·ï¼šScanDoneã€BSSAddedã€BssRemovedã€PropertiesChanged</p>
<h3 id="ScanDone"><a href="#ScanDone" class="headerlink" title="ScanDone"></a>ScanDone</h3><p>data type: <code>(b)</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">(<span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>)</span><br></pre></td></tr></table></figure>

<h3 id="BSSAdded"><a href="#BSSAdded" class="headerlink" title="BSSAdded"></a>BSSAdded</h3><p>data type: <code>(oa&#123;sv&#125;)</code> </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">    objectpath &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">257</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;SSID&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>byte <span class="number">0x43</span><span class="punctuation">,</span> <span class="number">0x6f</span><span class="punctuation">,</span> <span class="number">0x6f</span><span class="punctuation">,</span> <span class="number">0x6c</span><span class="punctuation">,</span> <span class="number">0x4b</span><span class="punctuation">,</span> <span class="number">0x69</span><span class="punctuation">,</span> <span class="number">0x74</span><span class="punctuation">,</span> <span class="number">0x5f</span><span class="punctuation">,</span> <span class="number">0x35</span><span class="punctuation">,</span> <span class="number">0x47</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;BSSID&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>byte <span class="number">0x60</span><span class="punctuation">,</span> <span class="number">0xdb</span><span class="punctuation">,</span> <span class="number">0x15</span><span class="punctuation">,</span> <span class="number">0xfa</span><span class="punctuation">,</span> <span class="number">0x8b</span><span class="punctuation">,</span> <span class="number">0x05</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;Privacy&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;Mode&#x27;<span class="punctuation">:</span> &lt;&#x27;infrastructure&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;Signal&#x27;<span class="punctuation">:</span> &lt;int16 <span class="number">-70</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;Frequency&#x27;<span class="punctuation">:</span> &lt;uint16 <span class="number">5805</span>&gt;<span class="punctuation">,</span></span><br><span class="line">        &#x27;Rates&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>uint32 <span class="number">54000000</span><span class="punctuation">,</span> <span class="number">48000000</span><span class="punctuation">,</span> <span class="number">36000000</span><span class="punctuation">,</span> <span class="number">24000000</span><span class="punctuation">,</span> <span class="number">18000000</span><span class="punctuation">,</span> <span class="number">12000000</span><span class="punctuation">,</span> <span class="number">9000000</span><span class="punctuation">,</span> <span class="number">6000000</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;WPA&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;KeyMgmt&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;wpa-psk&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Group&#x27;<span class="punctuation">:</span> &lt;&#x27;tkip&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Pairwise&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;tkip&#x27;<span class="punctuation">,</span> &#x27;ccmp&#x27;<span class="punctuation">]</span>&gt;</span><br><span class="line">         <span class="punctuation">&#125;</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;RSN&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;KeyMgmt&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;wpa-psk&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Group&#x27;<span class="punctuation">:</span> &lt;&#x27;tkip&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Pairwise&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;tkip&#x27;<span class="punctuation">,</span> &#x27;ccmp&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;MgmtGroup&#x27;<span class="punctuation">:</span> &lt;&#x27;aes128cmac&#x27;&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;WPS&#x27;<span class="punctuation">:</span> &lt;@a<span class="punctuation">&#123;</span>sv<span class="punctuation">&#125;</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;IEs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>byte <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0a</span><span class="punctuation">,</span> <span class="number">0x43</span><span class="punctuation">,</span> <span class="number">0x6f</span><span class="punctuation">,</span> <span class="number">0x6f</span><span class="punctuation">,</span> <span class="number">0x6c</span><span class="punctuation">,</span> <span class="number">0x4b</span><span class="punctuation">,</span> <span class="number">0x69</span><span class="punctuation">,</span> <span class="number">0x74</span><span class="punctuation">,</span> <span class="number">0x5f</span><span class="punctuation">,</span> <span class="number">0x35</span><span class="punctuation">,</span> <span class="number">0x47</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x8c</span><span class="punctuation">,</span> <span class="number">0x12</span><span class="punctuation">,</span> <span class="number">0x98</span><span class="punctuation">,</span> <span class="number">0x24</span><span class="punctuation">,</span> <span class="number">0xb0</span><span class="punctuation">,</span> <span class="number">0x48</span><span class="punctuation">,</span> <span class="number">0x60</span><span class="punctuation">,</span> <span class="number">0x6c</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0xa1</span><span class="punctuation">,</span> <span class="number">0xdd</span><span class="punctuation">,</span> <span class="number">0x1a</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x30</span><span class="punctuation">,</span> <span class="number">0x18</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0f</span><span class="punctuation">,</span> <span class="number">0xac</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0f</span><span class="punctuation">,</span> <span class="number">0xac</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0f</span><span class="punctuation">,</span> <span class="number">0xac</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0f</span><span class="punctuation">,</span> <span class="number">0xac</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x2d</span><span class="punctuation">,</span> <span class="number">0x1a</span><span class="punctuation">,</span> <span class="number">0xef</span><span class="punctuation">,</span> <span class="number">0x09</span><span class="punctuation">,</span> <span class="number">0x17</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x18</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x87</span><span class="punctuation">,</span> <span class="number">0x09</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x3d</span><span class="punctuation">,</span> <span class="number">0x16</span><span class="punctuation">,</span> <span class="number">0xa1</span><span class="punctuation">,</span> <span class="number">0x07</span><span class="punctuation">,</span> <span class="number">0x06</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x7f</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x80</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x40</span><span class="punctuation">,</span> <span class="number">0x0b</span><span class="punctuation">,</span> <span class="number">0x05</span><span class="punctuation">,</span> <span class="number">0x0f</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xca</span><span class="punctuation">,</span> <span class="number">0x12</span><span class="punctuation">,</span> <span class="number">0x7a</span><span class="punctuation">,</span> <span class="number">0xdd</span><span class="punctuation">,</span> <span class="number">0x18</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x50</span><span class="punctuation">,</span> <span class="number">0xf2</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0xa4</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x27</span><span class="punctuation">,</span> <span class="number">0xa4</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x42</span><span class="punctuation">,</span> <span class="number">0x43</span><span class="punctuation">,</span> <span class="number">0x5e</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x62</span><span class="punctuation">,</span> <span class="number">0x32</span><span class="punctuation">,</span> <span class="number">0x2f</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x20</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x23</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x3f</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xc3</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x2f</span><span class="punctuation">,</span> <span class="number">0x2f</span><span class="punctuation">,</span> <span class="number">0x2f</span><span class="punctuation">,</span> <span class="number">0x07</span><span class="punctuation">,</span> <span class="number">0x0a</span><span class="punctuation">,</span> <span class="number">0x43</span><span class="punctuation">,</span> <span class="number">0x4e</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x24</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x1e</span><span class="punctuation">,</span> <span class="number">0x95</span><span class="punctuation">,</span> <span class="number">0x05</span><span class="punctuation">,</span> <span class="number">0x1e</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xbf</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0xb1</span><span class="punctuation">,</span> <span class="number">0x79</span><span class="punctuation">,</span> <span class="number">0xc9</span><span class="punctuation">,</span> <span class="number">0x33</span><span class="punctuation">,</span> <span class="number">0xfa</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0xfa</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0xc0</span><span class="punctuation">,</span> <span class="number">0x05</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x9b</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xfc</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x1c</span><span class="punctuation">,</span> <span class="number">0x23</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x1a</span><span class="punctuation">,</span> <span class="number">0x44</span><span class="punctuation">,</span> <span class="number">0x10</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x20</span><span class="punctuation">,</span> <span class="number">0x0e</span><span class="punctuation">,</span> <span class="number">0x92</span><span class="punctuation">,</span> <span class="number">0x6f</span><span class="punctuation">,</span> <span class="number">0x09</span><span class="punctuation">,</span> <span class="number">0x8f</span><span class="punctuation">,</span> <span class="number">0x08</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xfa</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0xfa</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x39</span><span class="punctuation">,</span> <span class="number">0x1c</span><span class="punctuation">,</span> <span class="number">0xc7</span><span class="punctuation">,</span> <span class="number">0x71</span><span class="punctuation">,</span> <span class="number">0x1c</span><span class="punctuation">,</span> <span class="number">0x07</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x07</span><span class="punctuation">,</span> <span class="number">0x24</span><span class="punctuation">,</span> <span class="number">0xf4</span><span class="punctuation">,</span> <span class="number">0x3f</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x26</span><span class="punctuation">,</span> <span class="number">0xfc</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x27</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x0e</span><span class="punctuation">,</span> <span class="number">0x26</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x20</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x40</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x60</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xdd</span><span class="punctuation">,</span> <span class="number">0x07</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0x43</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xdd</span><span class="punctuation">,</span> <span class="number">0x21</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0xe7</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0xbf</span><span class="punctuation">,</span> <span class="number">0x0c</span><span class="punctuation">,</span> <span class="number">0xb1</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0xc0</span><span class="punctuation">,</span> <span class="number">0x33</span><span class="punctuation">,</span> <span class="number">0x2a</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x92</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0x2a</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x92</span><span class="punctuation">,</span> <span class="number">0x04</span><span class="punctuation">,</span> <span class="number">0xc0</span><span class="punctuation">,</span> <span class="number">0x05</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x2a</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0xc3</span><span class="punctuation">,</span> <span class="number">0x03</span><span class="punctuation">,</span> <span class="number">0x01</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0xf0</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">,</span> <span class="number">0x00</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;Age&#x27;<span class="punctuation">:</span> &lt;uint32 <span class="number">0</span>&gt;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="BSSRemoved"><a href="#BSSRemoved" class="headerlink" title="BSSRemoved"></a>BSSRemoved</h3><p>data type: <code>(o)</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">(objectpath &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">519</span>&#x27;<span class="punctuation">,</span>)</span><br></pre></td></tr></table></figure>

<h3 id="PropertiesChanged"><a href="#PropertiesChanged" class="headerlink" title="PropertiesChanged"></a>PropertiesChanged</h3><p>data type: <code>(a&#123;sv&#125;)</code></p>
<p>æ•°æ®1ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;Scanning&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">        &#x27;BSSs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>objectpath </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">2</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">423</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">424</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">425</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">426</span>&#x27;<span class="punctuation">]</span>&gt;</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>æ•°æ®2ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;BSSs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>objectpath </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">2</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1363</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1364</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1365</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1366</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1367</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1369</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1372</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1374</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1375</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1376</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1377</span>&#x27;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;/fi/w1/wpa_supplicant1/Interfaces/<span class="number">0</span>/BSSs/<span class="number">1378</span>&#x27;<span class="punctuation">]</span>&gt;</span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Wi-Fi</category>
      </categories>
      <tags>
        <tag>Wi-Fi</tag>
        <tag>wpa_supplicant</tag>
      </tags>
  </entry>
  <entry>
    <title>Embedded Linux System Generate Tool: Buildroot</title>
    <url>/2024/10/29/2024/Embedded-Linux-System-Generate-Tool-Buildroot/</url>
    <content><![CDATA[<h2 id="Buildroot"><a href="#Buildroot" class="headerlink" title="Buildroot"></a>Buildroot</h2><blockquote>
<p>Buildrootæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å®˜æ–¹æ‰‹å†Œï¼šBuildroot is a tool that simplifies and automates the process of building a complete Linux system for an embedded system, using cross-compilation</p>
</blockquote>
<p>Buildroot æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä½¿ç”¨äº¤å‰ç¼–è¯‘æ¥ç®€åŒ–å’Œè‡ªåŠ¨åŒ–åµŒå…¥å¼Linuxç³»ç»Ÿæ„å»ºè¿‡ç¨‹ã€‚ä¸ºäº†è¾¾åˆ°ä¸Šè¿°ç›®çš„ï¼ŒBuildroot èƒ½å¤Ÿç”Ÿæˆäº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼ˆa cross-compilation toolchainï¼‰ã€æ ¹æ–‡æ¡£ç³»ç»Ÿï¼ˆa root filesysystemï¼‰ã€Linux å†…æ ¸æ˜ åƒï¼ˆa Linux kernel imageï¼‰å’Œå¼•å¯¼åŠ è½½è¿›ç¨‹ï¼ˆa bootloaderï¼‰ã€‚</p>
<p>Buildrootæ¯3ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ï¼Œ2æœˆã€5æœˆã€8æœˆã€11æœˆï¼Œå‘å¸ƒå·çš„æ ¼å¼ä¸º YYYY.MMï¼Œä¾‹å¦‚ 2013.02ã€2014.08ã€‚</p>
<p><a href="https://github.com/buildroot/buildroot">Buildrootçš„Githubé“¾æ¥</a></p>
<p>Buildrootå¦‚ä½•ä½¿ç”¨ï¼Ÿ</p>
<p>é€šè¿‡ <code>make menuconfig</code> è¿›å…¥èœå•ï¼Œé…ç½®é€‰é¡¹ã€‚å…¨éƒ¨é…ç½®å®Œæˆåï¼Œé…ç½®å·¥å…·å°†ä¼šç”Ÿæˆä¸€ä¸ª<code>.config</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°†è¢«é¡¶å±‚Makefileè¯»å–ã€‚ç„¶åå°±å¯ä»¥è¿›è¡Œæ„å»ºï¼š<code>make</code>ï¼Œè¯¥å‘½ä»¤ä¸€èˆ¬ä¼šæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>ä¸‹è½½æºæ–‡ä»¶</li>
<li>é…ç½®ã€æ„å»ºã€å®‰è£…äº¤å‰ç¼–è¯‘é“¾ï¼Œæˆ–è€…ç®€å•åœ°å¯¼å…¥å¤–éƒ¨äº¤å‰ç¼–è¯‘é“¾</li>
<li>é…ç½®ã€æ„å»ºã€å®‰è£…å·²å‹¾é€‰çš„ç›®æ ‡åŒ…</li>
<li>æ„å»ºå†…æ ¸é•œåƒï¼ˆkernel imageï¼‰ï¼Œå¦‚æœå·²å‹¾é€‰</li>
<li>æ„å»ºå¼•å¯¼åŠ è½½ç¨‹åºé•œåƒï¼ˆbootloader imageï¼‰ï¼Œå¦‚æœå·²å‹¾é€‰</li>
<li>åˆ›å»ºé€‰å®šæ ¼å¼çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆroot filesystemï¼‰</li>
</ul>
<p>Buildrootè¾“å‡ºä¿å­˜åœ¨<code>output/.</code> ç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•åŒ…å«å¦‚ä¸‹å‡ ä¸ªå­ç›®å½•ï¼š</p>
<ul>
<li><strong>images</strong>ï¼šå­˜æ”¾æ‰€æœ‰çš„imagesï¼ˆkernel imageã€bootloaderã€root filesystem imageï¼‰ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦æ”¾åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</li>
<li><strong>build</strong>ï¼šå­˜æ”¾æ‰€æœ‰éœ€è¦ç¼–è¯‘çš„åº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨éƒ½ä»¥ä¸€ä¸ªæ–‡ä»¶å¤¹è¡¨ç¤ºã€‚</li>
<li><strong>host</strong>ï¼šåŒ…å«ä¸ºä¸»æœºæ„å»ºçš„å·¥å…·ï¼ˆä¸»è¦æ˜¯ä¸»æœºä¸ŠBuildrootéœ€è¦çš„å·¥å…·å’Œäº¤å‰ç¼–è¯‘å·¥å…·ï¼‰å’Œç›®æ ‡å·¥å…·é“¾çš„sysrootï¼ˆä¸»è¦æ˜¯ç”¨æˆ·äº¤å‰ç¼–è¯‘çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼‰ã€‚</li>
<li><strong>staging</strong>ï¼šhostç›®å½•å†…ç›®æ ‡å·¥å…·é“¾sysrootçš„ç¬¦å·é“¾æ¥ï¼Œå…¶å­˜åœ¨æ˜¯ä¸ºäº†å‘åå…¼å®¹</li>
<li><strong>target</strong>ï¼šåŒ…å«äº†ç›®æ ‡å‡ ä¹å®Œæ•´çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚æœ€åå¯¼å…¥ç›®æ ‡ä¸»æœºçš„æ ¹æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯è¿™ä¸ª</li>
</ul>
<p><code>make menuconfig</code> ä¸­ï¼Œå¯ä»¥è¾“å…¥<code>/</code> è¿›è¡Œç›®æ ‡æœç´¢ã€‚å½“æœç´¢åˆ°æ‰€æœ‰ç›®æ ‡ï¼Œå¯ä»¥é€šè¿‡æŒ‰ä¸‹<strong>ç›®æ ‡çš„æ•°å­—ç¼–å·</strong>è¿›è¡Œè·³è½¬ã€‚</p>
<p><code>buildroot/package</code> ç›®å½•ä¸‹ï¼Œå¯ä»¥ä¸ºè‡ªå·±çš„åº”ç”¨åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹è‡³å°‘æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>xxx.mk</code> å’Œ <code>Config.in</code> ã€‚</p>
<ul>
<li><code>xxx.mk</code>ï¼šè¿™æ˜¯ä¸€ä¸ªMakefileæ–‡ä»¶ï¼ŒåŒ…å«äº†å¯¹åº”ç”¨packageçš„ä¸‹è½½ã€é…ç½®ã€ç¼–è¯‘å’Œå®‰è£…</li>
<li><code>Config.in</code>ï¼šè¿™æ˜¯ä¸€ä¸ªé…ç½®å·¥å…·æè¿°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæè¿°äº†åº”ç”¨packageçš„é€‰é¡¹ã€‚</li>
</ul>
<p><a href="https://buildroot.org/downloads/manual/manual.html">Buildrootæ‰‹å†Œé“¾æ¥</a></p>
<h2 id="äº¤å‰ç¼–è¯‘å·¥å…·é“¾"><a href="#äº¤å‰ç¼–è¯‘å·¥å…·é“¾" class="headerlink" title="äº¤å‰ç¼–è¯‘å·¥å…·é“¾"></a>äº¤å‰ç¼–è¯‘å·¥å…·é“¾</h2><blockquote>
<p>äº¤å‰ç¼–è¯‘æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>å› ä¸ºä½ çš„ç›®æ ‡ä¸»æœºï¼ˆarmæ¶æ„ï¼‰çš„cpuã€ramã€roméƒ½æ˜¯æå…¶æœ‰é™çš„ï¼Œæ— æ³•åœ¨ç›®æ ‡ä¸»æœºç¼–è¯‘åº”ç”¨ç¨‹åºã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨æºä¸»æœºï¼ˆx86æ¶æ„ï¼‰ä¸Šä¸ºç›®æ ‡ä¸»æœºï¼ˆarmæ¶æ„ï¼‰ç¼–è¯‘åº”ç”¨ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©ç³»ç»Ÿé»˜è®¤çš„ç¼–è¯‘é“¾å·¥å…·ï¼Œç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶åªèƒ½åœ¨x86æ¶æ„ä¸»æœºè¿è¡Œã€‚è‹¥æƒ³åœ¨ç›®æ ‡ä¸»æœºï¼ˆarmæ¶æ„ï¼‰ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºï¼Œéœ€è¦åœ¨æºä¸»æœºï¼ˆx86æ¶æ„ï¼‰ä¸Šå®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚</p>
<p><strong>ç¼–è¯‘å·¥å…·é“¾æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸€ç»„å¯ç”¨äºç¼–è¯‘ç³»ç»Ÿä»£ç çš„å·¥å…·ã€‚å®ƒç”±<strong>ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨</strong>ç­‰äºŒè¿›åˆ¶å®ç”¨ç¨‹åºä»¥åŠ <strong>C æ ‡å‡†åº“</strong>ç»„æˆã€‚</p>
<p><strong>äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>ä¸€ä¸ªåœ¨ä¸»æœºç³»ç»Ÿä¸Šè¿è¡Œä½†ä¸º <em>ç›®æ ‡ç³»ç»Ÿ</em>ï¼ˆå’Œç›®æ ‡å¤„ç†å™¨ï¼‰ç”Ÿæˆä»£ç çš„ç¼–è¯‘å·¥å…·é“¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ä¸»æœºç³»ç»Ÿä½¿ç”¨ x86 è€Œç›®æ ‡ç³»ç»Ÿä½¿ç”¨ ARMï¼Œåˆ™ä¸»æœºä¸Šçš„å¸¸è§„ç¼–è¯‘å·¥å…·é“¾åœ¨ x86 ä¸Šè¿è¡Œå¹¶ä¸º x86 ç”Ÿæˆä»£ç ï¼Œè€Œäº¤å‰ç¼–è¯‘å·¥å…·é“¾åœ¨ x86 ä¸Šè¿è¡Œå¹¶ä¸º ARM ç”Ÿæˆä»£ç ã€‚</p>
<p><strong>Buildrootä¸æä¾›ç¼–è¯‘å·¥å…·é“¾ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å®‰è£…ã€‚</strong></p>
<p>Buildrootä¸ºäº¤å‰ç¼–è¯‘å·¥å…·é“¾æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å†…éƒ¨å·¥å…·é“¾åç«¯ï¼Œ<code>Buildroot toolchain</code>åœ¨é…ç½®ç•Œé¢è°ƒç”¨ã€‚</li>
<li>å¤–éƒ¨å·¥å…·é“¾åç«¯ï¼Œ<code>External toolchain</code>åœ¨é…ç½®ç•Œé¢è°ƒç”¨ã€‚</li>
</ul>
<h3 id="å†…éƒ¨å·¥å…·é“¾åç«¯"><a href="#å†…éƒ¨å·¥å…·é“¾åç«¯" class="headerlink" title="å†…éƒ¨å·¥å…·é“¾åç«¯"></a>å†…éƒ¨å·¥å…·é“¾åç«¯</h3><p><em>å†…éƒ¨å·¥å…·é“¾åç«¯</em>æ˜¯Buildroot åœ¨ä¸ºç›®æ ‡åµŒå…¥å¼ç³»ç»Ÿæ„å»ºç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºå’Œåº“ä¹‹å‰è‡ªè¡Œæ„å»ºäº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„åç«¯ã€‚</p>
<h3 id="å¤–éƒ¨å·¥å…·é“¾åç«¯"><a href="#å¤–éƒ¨å·¥å…·é“¾åç«¯" class="headerlink" title="å¤–éƒ¨å·¥å…·é“¾åç«¯"></a>å¤–éƒ¨å·¥å…·é“¾åç«¯</h3><p><em>å¤–éƒ¨å·¥å…·é“¾åç«¯</em>å…è®¸ä½¿ç”¨ç°æœ‰çš„é¢„æ„å»ºäº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚Buildroot äº†è§£è®¸å¤šè‘—åçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼ˆæ¥è‡ª <a href="http://www.linaro.org/">Linaro</a> for ARMã€ Sourcery CodeBench for ARMã€x86-64ã€PowerPC å’Œ MIPSï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨ä¸‹è½½å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥æŒ‡å‘è‡ªå®šä¹‰å·¥å…·é“¾ï¼Œå¯ä¸‹è½½æˆ–æœ¬åœ°å®‰è£…ã€‚</p>
<p>æœ‰ä¸‰ç§ä½¿ç”¨å¤–éƒ¨å·¥å…·é“¾çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä½¿ç”¨é¢„å®šä¹‰çš„å¤–éƒ¨å·¥å…·é“¾é…ç½®æ–‡ä»¶ï¼Œè®© Buildroot ä¸‹è½½ã€æå–å’Œå®‰è£…å·¥å…·é“¾ã€‚</li>
<li>ä½¿ç”¨é¢„å®šä¹‰çš„å¤–éƒ¨å·¥å…·é“¾é…ç½®æ–‡ä»¶ï¼Œä½†ä¸æ˜¯è®© Buildroot ä¸‹è½½å¹¶æå–å·¥å…·é“¾ï¼Œè€Œæ˜¯å¯ä»¥å‘Šè¯‰ Buildroot æ‚¨çš„å·¥å…·é“¾å·²å®‰è£…åœ¨ç³»ç»Ÿä¸Šçš„ä½ç½®ã€‚</li>
<li>ä½¿ç”¨å®Œå…¨è‡ªå®šä¹‰çš„å¤–éƒ¨å·¥å…·é“¾ã€‚</li>
</ul>
<h2 id="åˆå§‹åŒ–ç³»ç»Ÿ"><a href="#åˆå§‹åŒ–ç³»ç»Ÿ" class="headerlink" title="åˆå§‹åŒ–ç³»ç»Ÿ"></a>åˆå§‹åŒ–ç³»ç»Ÿ</h2><p><em>init</em>ç¨‹åºæ˜¯å†…æ ¸å¯åŠ¨çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´ç¨‹åºï¼ˆå®ƒçš„ PID ç¼–å·ä¸º 1ï¼‰ï¼Œè´Ÿè´£å¯åŠ¨ç”¨æˆ·ç©ºé—´æœåŠ¡å’Œç¨‹åºï¼ˆä¾‹å¦‚ï¼šWeb æœåŠ¡å™¨ã€å›¾å½¢åº”ç”¨ç¨‹åºã€å…¶ä»–ç½‘ç»œæœåŠ¡å™¨ç­‰ï¼‰ã€‚</p>
<p>Buildroot å…è®¸ä½¿ç”¨ä¸‰ç§ä¸åŒç±»å‹çš„ init ç³»ç»Ÿï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯<strong>BusyBox</strong>ï¼šåœ¨ä¼—å¤šç¨‹åºä¸­ï¼ŒBusyBox æœ‰ä¸€ä¸ªåŸºæœ¬<code>init</code>ç¨‹åºçš„å®ç°ï¼Œå¯¹äºå¤§å¤šæ•°åµŒå…¥å¼ç³»ç»Ÿæ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚</li>
<li>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ˜¯<strong>systemV</strong>ï¼šæ­¤è§£å†³æ–¹æ¡ˆä½¿ç”¨æ—§çš„ä¼ ç»Ÿ<em>sysvinit</em>ç¨‹åºï¼Œè¯¥ç¨‹åºåœ¨ Buildroot ä¸­æ‰“åŒ… <code>package/sysvinit</code>ã€‚è¿™æ˜¯å¤§å¤šæ•°æ¡Œé¢ Linux å‘è¡Œç‰ˆä¸­ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œç›´åˆ°ä»–ä»¬è½¬å‘ Upstart æˆ– Systemd ç­‰è¾ƒæ–°çš„æ›¿ä»£æ–¹æ¡ˆã€‚</li>
<li>ç¬¬ä¸‰ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯<strong>systemd</strong>ï¼š<code>systemd</code>å®ƒæ˜¯æ–°ä¸€ä»£çš„ Linux åˆå§‹åŒ–ç³»ç»Ÿã€‚</li>
</ul>
<p>Buildroot å¼€å‘äººå‘˜æ¨èçš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <strong>BusyBox init</strong>ï¼Œå› ä¸ºå®ƒå¯¹äºå¤§å¤šæ•°åµŒå…¥å¼ç³»ç»Ÿæ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚systemdå¯ç”¨äºæ›´å¤æ‚çš„æƒ…å†µã€‚</p>
<h2 id="Kconfig"><a href="#Kconfig" class="headerlink" title="Kconfig"></a>Kconfig</h2><blockquote>
<p>Kconfigæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>é…ç½®æ•°æ®åº“æ˜¯ä»¥æ ‘çŠ¶ç»“æ„ç»„ç»‡çš„é…ç½®é€‰é¡¹çš„é›†åˆã€‚</p>
<p><em>æ³¨æ„ï¼šlinux åœ¨2.6ç‰ˆæœ¬ä»¥åå°†é…ç½®æ–‡ä»¶ç”±åŸæ¥çš„ Config.in æ”¹ä¸º Kconfig</em></p>
<p>Kconfigçš„åŠŸèƒ½ï¼Ÿ</p>
<p>Kconfigç”¨æ¥é…ç½®å†…æ ¸ï¼Œå®ƒå°±æ˜¯å„ç§é…ç½®ç•Œé¢çš„æºæ–‡ä»¶ï¼Œå†…æ ¸çš„é…ç½®å·¥å…·è¯»å–å„ä¸ªKconfigæ–‡ä»¶ï¼Œç”Ÿæˆé…ç½®ç•Œé¢ä¾›å¼€å‘äººå‘˜é…ç½®å†…æ ¸ï¼Œæœ€åç”Ÿæˆé…ç½®æ–‡ä»¶<code>.config</code>ã€‚é€šè¿‡é…ç½®ç•Œé¢è¿›è¡Œå‹¾é€‰çš„é¡¹ç›®å°†ä¼šä»¥å›ºå®šæ ¼å¼å†™å…¥<code>.config</code> æ–‡ä»¶ã€‚</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š<code>make menuconfig</code> ï¼Œè‡ªåŠ¨è¯»å–å½“å‰ç›®å½•ä¸‹çš„ <code>Config.in</code>ï¼Œå½¢æˆé…ç½®ç•Œé¢</p>
<p><strong>Kconfig è¯­æ³•</strong></p>
<p>exampleï¼šConfig.in</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">menu &quot;Network device support&quot;</span><br><span class="line">config BR2_PACKAGE_NETDEVICES</span><br><span class="line">    bool &quot;Enable Net Devices&quot;</span><br><span class="line">    depends on NET</span><br><span class="line">    select BR2_PACKAGE_LIBDEVICES</span><br><span class="line">    default y</span><br><span class="line">    help</span><br><span class="line">        This is help desciptionã€‚</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">endmenu</span><br></pre></td></tr></table></figure>

<p><strong>Network device support</strong>ï¼šä¸»èœå•</p>
<p><strong>menu â€¦ endmenu</strong>ï¼šæ ‡ç­¾ä¸­é—´çš„æˆä¸ºå­èœå•ï¼Œå­èœå•ç”±å…³é”®å­—configå®šä¹‰ã€‚</p>
<p>å…¶ä¸­configä¸‹é¢å…¶ä»–å…³é”®å­—æ˜¯å±æ€§ï¼šboolã€depends onã€defaultã€helpï¼Œç”¨äºå®šä¹‰è¯¥èœå•é¡¹çš„ç±»å‹ã€ä¾èµ–é¡¹ã€é»˜è®¤å€¼ã€å¸®åŠ©ä¿¡æ¯ç­‰ã€‚</p>
<p>ç±»å‹å®šä¹‰ï¼š</p>
<ul>
<li>boolï¼šå¸ƒå°”ç±»å‹ã€‚æ˜¾ç¤º <code>[]</code></li>
<li>tristateï¼šä¸‰æ€ï¼ˆå†…å»ºYã€æ¨¡å—Mã€ç§»é™¤Nï¼‰ã€‚æ˜¾ç¤º <code>&lt;&gt;</code></li>
<li>stringï¼šå­—ç¬¦ä¸²</li>
<li>hexï¼š16è¿›åˆ¶ã€‚æ˜¾ç¤º <code>()</code></li>
<li>integerï¼šæ•´å‹</li>
</ul>
<p>ç›®å½•åµŒå¥—ï¼šå­ç›®å½•ä¸‹çš„Kconfigå¿…é¡»æ·»åŠ åˆ°çˆ¶ç›®å½•ä¸­çš„Kconfigä¸­ã€‚åœ¨çˆ¶ç›®å½•ä¸­çš„Kconfigç±»ä¼¼è¯­å¥ï¼š<code>source &quot;package/app/Kconfig&quot;</code></p>
<p>ç”¨æ¥åŒ…å«ï¼ˆæˆ–åµŒå¥—ï¼‰æ–°çš„Kconfigæ–‡ä»¶ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä½¿å„ä¸ªç›®å½•ç®¡ç†å„è‡ªçš„é…ç½®å†…å®¹ï¼Œä½¿ä¸å¿…æŠŠé‚£äº›é…ç½®éƒ½å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ–¹ä¾¿ä¿®æ”¹å’Œç®¡ç†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ¡ç›®</span><br><span class="line">configï¼šç”Ÿæˆå¯é€‰é¡¹</span><br><span class="line">menu/endmenuï¼šç”Ÿæˆèœå•</span><br><span class="line">choice/endchoiceï¼šå°†å¤šä¸ªç±»ä¼¼çš„é…ç½®é€‰é¡¹ç»„åˆåœ¨ä¸€èµ·ï¼Œä¾›ç”¨æˆ·å•é€‰æˆ–å¤šé€‰ã€‚</span><br><span class="line">commentï¼šåœ¨ç•Œé¢çš„ç¬¬ä¸€è¡Œæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br><span class="line">if/endif:</span><br><span class="line">sourceï¼šç”¨äºè¯»å–å¦å¤–ä¸€ä¸ªKconfigæ–‡ä»¶ï¼Œä¸€èˆ¬è¯»å–å­ç›®å½•çš„Kconfigæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h2 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h2><p>.mkæ˜¯ä¸€ç§androidç¼–è¯‘ç¯å¢ƒä¸‹çš„ä¸€ç§ç‰¹æ®Šçš„â€œmakefileâ€æ–‡ä»¶</p>
<ul>
<li>PKG_NAMEï¼šå®šä¹‰è½¯ä»¶åŒ…çš„åç§°ã€‚é€šå¸¸ä¸è½¯ä»¶åŒ…æºä»£ç çš„ç›®å½•åç›¸åŒã€‚</li>
<li>PKG_VERSIONï¼šå®šä¹‰è½¯ä»¶åŒ…çš„ç‰ˆæœ¬å·ã€‚</li>
<li>PKG_SOURCEï¼šå®šä¹‰è½¯ä»¶åŒ…æºä»£ç çš„ä¸‹è½½é“¾æ¥æˆ–è·¯å¾„ã€‚å¯ä»¥æ˜¯è¿œç¨‹ URL æˆ–æœ¬åœ°è·¯å¾„ã€‚</li>
<li>PKG_SITEï¼šå®šä¹‰è½¯ä»¶åŒ…ç›®å½•ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªurlæˆ–è€…æœ¬åœ°æ–‡ä»¶è·¯å¾„</li>
<li>PKG_HASHï¼šå®šä¹‰è½¯ä»¶åŒ…æºä»£ç çš„å“ˆå¸Œå€¼ï¼Œç”¨äºéªŒè¯ä¸‹è½½æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚é€šå¸¸ä½¿ç”¨ MD5 æˆ– SHA256 ç®—æ³•è®¡ç®—ã€‚</li>
<li>PKG_SITE_METHODï¼šå®šä¹‰æ‹‰å–æˆ–è€…å¤åˆ¶åŒ…æºæ–‡ä»¶çš„æ–¹å¼</li>
<li>PKG_LICENSEï¼šå®šä¹‰è½¯ä»¶åŒ…çš„è®¸å¯è¯ç±»å‹ã€‚å¯ä»¥æ˜¯å•ä¸ªè®¸å¯è¯æˆ–å¤šä¸ªè®¸å¯è¯çš„ç»„åˆã€‚</li>
<li>PKG_BUILD_DIRï¼šå®šä¹‰è½¯ä»¶åŒ…æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶ç›®å½•ã€‚é€šå¸¸æ˜¯ <code>$&#123;BUILD_DIR&#125;/$&#123;PKG_NAME&#125;-$&#123;PKG_VERSION&#125;</code>ã€‚</li>
<li>PKG_INSTALL_DIRï¼šå®šä¹‰è½¯ä»¶åŒ…å®‰è£…åˆ°ç›®æ ‡ç³»ç»Ÿçš„ç›®å½•ã€‚é€šå¸¸æ˜¯ <code>$&#123;TARGET_DIR&#125;</code>ã€‚</li>
<li>PKG_CONFIG_DEPENDSï¼šå®šä¹‰è½¯ä»¶åŒ…æ„å»ºè¿‡ç¨‹ä¸­ä¾èµ–çš„å…¶ä»–è½¯ä»¶åŒ…ã€‚è¿™äº›ä¾èµ–å°†è¢«è‡ªåŠ¨è§£æå’Œæ„å»ºã€‚</li>
<li>PKG_BUILD_CMDSç»“å°¾çš„å˜é‡ä¼šåœ¨ buildroot æ¡†æ¶ç¼–è¯‘çš„æ—¶å€™æ‰§è¡Œï¼Œç”¨äºç»™æºç çš„ Makefile ä¼ é€’ç¼–è¯‘é€‰é¡¹å’Œé“¾æ¥é€‰é¡¹ï¼Œè°ƒç”¨æºç çš„Makefileã€‚</li>
<li>PKG_INSTALL_TARGET_CMDSç»“å°¾çš„å˜é‡æ˜¯åœ¨ç¼–è¯‘å®Œä¹‹åï¼Œè‡ªåŠ¨å®‰è£…æ‰§è¡Œï¼Œä¸€èˆ¬æ˜¯è®© buildroot æŠŠç¼–è¯‘å‡ºæ¥çš„çš„ bin æˆ– lib æ‹·è´åˆ°æŒ‡å®šç›®å½•ã€‚</li>
<li>$(eval $(autotools-package))ï¼šä½¿ç”¨ Autotools æ„å»ºç³»ç»Ÿçš„è½¯ä»¶åŒ…è§„åˆ™ã€‚é€‚ç”¨äºä½¿ç”¨ configure è„šæœ¬çš„è½¯ä»¶åŒ…ã€‚</li>
<li>$(eval $(cmake-package))ï¼šä½¿ç”¨ CMake æ„å»ºç³»ç»Ÿçš„è½¯ä»¶åŒ…è§„åˆ™ã€‚é€‚ç”¨äºä½¿ç”¨ CMakeLists.txt çš„è½¯ä»¶åŒ…ã€‚</li>
<li>$(eval $(generic-package))ï¼šé€šç”¨çš„è½¯ä»¶åŒ…è§„åˆ™ï¼Œé€‚ç”¨äºæ²¡æœ‰ç‰¹å®šæ„å»ºç³»ç»Ÿçš„è½¯ä»¶åŒ…ã€‚éœ€è¦æ‰‹åŠ¨å®šä¹‰æ„å»ºå’Œå®‰è£…è¿‡ç¨‹ã€‚</li>
<li>$(eval $(host-generic-package))ï¼šé€‚ç”¨äºä¸»æœºï¼ˆå¼€å‘æœºï¼‰ä¸Šæ„å»ºçš„é€šç”¨è½¯ä»¶åŒ…è§„åˆ™ã€‚ä¸ç›®æ ‡ç³»ç»Ÿæ— å…³ã€‚</li>
<li>$(eval $(python-package))ï¼šé€‚ç”¨äº Python è½¯ä»¶åŒ…çš„è§„åˆ™ã€‚ç”¨äºæ„å»ºå’Œå®‰è£… Python æ¨¡å—ã€‚</li>
</ul>
<p><em>æ³¨æ„ï¼šPKGæ˜¯ä½ çš„åº”ç”¨åç§°</em></p>
<h2 id="å†…ç½®å˜é‡"><a href="#å†…ç½®å˜é‡" class="headerlink" title="å†…ç½®å˜é‡"></a>å†…ç½®å˜é‡</h2><ul>
<li>TOPDIRï¼š<code>buildroot</code> ç›®å½•</li>
<li>TARGET_MAKE_ENV</li>
<li>TARGET_CC</li>
<li>TARGET_CXX</li>
</ul>
<h2 id="å‚è€ƒå¼•ç”¨"><a href="#å‚è€ƒå¼•ç”¨" class="headerlink" title="å‚è€ƒå¼•ç”¨"></a>å‚è€ƒå¼•ç”¨</h2><p>[1ã€Kconfig Language](<a href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html">Kconfig Language â€” The Linux Kernel documentation</a>)</p>
<p><a href="https://www.cnblogs.com/jiangzhaowei/p/7528099.html">2ã€Kconfigè¯¦è§£-æ–‡ä»¶çš„åŸºæœ¬è¦ç´  - æ±Ÿå¬ä¼Ÿ - åšå®¢å›­ (cnblogs.com)</a></p>
]]></content>
      <categories>
        <category>Buildroot</category>
      </categories>
      <tags>
        <tag>embedded linux</tag>
        <tag>Buildroot</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux C: Program Name and Program ID</title>
    <url>/2024/10/28/2024/Linux-C-Program-Name-and-Program-ID/</url>
    <content><![CDATA[<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>åœ¨Linuxä¸ŠæŸ¥è¯¢ç¨‹åºçš„pidï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼š</p>
<ul>
<li><p>pså‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~/study$ ps -ef | grep bluealsa</span><br><span class="line">root        1017       1  0 19:01 ?        00:00:00 bluealsa --profile=a2dp-source</span><br><span class="line">pi          2852    2393 50 19:35 pts/0    00:00:00 grep --color=auto bluealsa</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>pidofå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~/study$ pidof bluealsa</span><br><span class="line">1017</span><br></pre></td></tr></table></figure></li>
</ul>
<p>é‚£ä¹ˆæ˜¯å¦å¯ä»¥é€šè¿‡Cä»£ç å°è£…æˆæ¥å£ï¼Œæ–¹ä¾¿ç›´æ¥åœ¨ä»£ç ä¸­è°ƒç”¨å‘¢ï¼Ÿå¯ä»¥</p>
<p>é¦–å…ˆï¼ŒLinuxæ‰€æœ‰è¿›ç¨‹çŠ¶æ€ä¿¡æ¯éƒ½å­˜å‚¨åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼š<code>/proc</code> ï¼Œæ¯ä¸€ä¸ªæ•°å­—æ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p><img src="/2024/10/28/2024/Linux-C-Program-Name-and-Program-ID/image-20241028195503492.png" alt="image-20241028195503492"></p>
<p>è¿›ç¨‹æ–‡ä»¶å¤¹ä¸‹æœ‰statusæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~/study$ <span class="built_in">cat</span> /proc/1017/status </span><br><span class="line">Name:	bluealsa</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Tgid:	1017</span><br><span class="line">Ngid:	0</span><br><span class="line">Pid:	1017</span><br><span class="line">PPid:	1</span><br><span class="line">TracerPid:	0</span><br><span class="line">Uid:	0	0	0	0</span><br><span class="line">Gid:	0	0	0	0</span><br><span class="line">FDSize:	128</span><br><span class="line">Groups:	 </span><br><span class="line">NStgid:	1017</span><br><span class="line">NSpid:	1017</span><br><span class="line">NSpgid:	1017</span><br><span class="line">NSsid:	1017</span><br><span class="line">Kthread:	0</span><br><span class="line">VmPeak:	  231224 kB</span><br><span class="line">VmSize:	  231224 kB</span><br><span class="line">VmLck:	       0 kB</span><br><span class="line">VmPin:	       0 kB</span><br><span class="line">VmHWM:	    5504 kB</span><br><span class="line">VmRSS:	    5504 kB</span><br><span class="line">RssAnon:	     384 kB</span><br><span class="line">RssFile:	    5120 kB</span><br><span class="line">RssShmem:	       0 kB</span><br><span class="line">VmData:	   25416 kB</span><br><span class="line">VmStk:	     132 kB</span><br><span class="line">VmExe:	     160 kB</span><br><span class="line">VmLib:	    7720 kB</span><br><span class="line">VmPTE:	      84 kB</span><br><span class="line">VmSwap:	       0 kB</span><br><span class="line">HugetlbPages:	       0 kB</span><br><span class="line">CoreDumping:	0</span><br><span class="line">THP_enabled:	1</span><br><span class="line">untag_mask:	0xffffffffffffff</span><br><span class="line">Threads:	4</span><br><span class="line">SigQ:	1/28918</span><br><span class="line">SigPnd:	0000000000000000</span><br><span class="line">ShdPnd:	0000000000000000</span><br><span class="line">SigBlk:	0000000000000000</span><br><span class="line">SigIgn:	0000000000001000</span><br><span class="line">SigCgt:	0000000100004002</span><br><span class="line">CapInh:	0000000000000000</span><br><span class="line">CapPrm:	000001ffffffffff</span><br><span class="line">CapEff:	000001ffffffffff</span><br><span class="line">CapBnd:	000001ffffffffff</span><br><span class="line">CapAmb:	0000000000000000</span><br><span class="line">NoNewPrivs:	0</span><br><span class="line">Seccomp:	0</span><br><span class="line">Seccomp_filters:	0</span><br><span class="line">Speculation_Store_Bypass:	vulnerable</span><br><span class="line">SpeculationIndirectBranch:	unknown</span><br><span class="line">Cpus_allowed:	f</span><br><span class="line">Cpus_allowed_list:	0-3</span><br><span class="line">Mems_allowed:	1</span><br><span class="line">Mems_allowed_list:	0</span><br><span class="line">voluntary_ctxt_switches:	26</span><br><span class="line">nonvoluntary_ctxt_switches:	8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>é€šè¿‡ <code>/proc/&lt;pid_dir&gt;/status</code> æ–‡ä»¶å†…çš„Nameå­—æ®µå¯ä»¥è·å–ç¨‹åºåï¼ŒPidå­—æ®µå¯ä»¥è·å–ç¨‹åºIDã€‚é€æ­¥éå†æ‰€æœ‰è¿™æ ·çš„ç›®æ ‡æ–‡ä»¶ï¼Œå°†è¾“å…¥çš„ç¨‹åºåå’ŒNameå­—æ®µçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°±å¯ä»¥å¾—å‡ºç¨‹åºçš„pidã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* gcc pid_get.c -Wall -o pid_get */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">get_pid_by_name</span><span class="params">(<span class="type">char</span> *task_name)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid = <span class="number">0</span>;</span><br><span class="line">    DIR *dir = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">ptr</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">    FILE *fp = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span> filepath[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> cur_task_name[<span class="number">50</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == task_name)</span><br><span class="line">        <span class="keyword">return</span> pid;</span><br><span class="line">    dir = opendir(<span class="string">&quot;/proc&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != dir)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> ((ptr = readdir(dir)) != <span class="literal">NULL</span>) <span class="comment">//å¾ªç¯è¯»å–/procä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœè¯»å–åˆ°çš„æ˜¯&quot;.&quot;æˆ–è€…&quot;..&quot;åˆ™è·³è¿‡ï¼Œè¯»å–åˆ°çš„ä¸æ˜¯æ–‡ä»¶å¤¹åå­—ä¹Ÿè·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">strcmp</span>(ptr-&gt;d_name, <span class="string">&quot;.&quot;</span>) == <span class="number">0</span>) || (<span class="built_in">strcmp</span>(ptr-&gt;d_name, <span class="string">&quot;..&quot;</span>) == <span class="number">0</span>))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// å¦‚æœç›®æ ‡ä¸æ˜¯ç›®å½•ï¼Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (DT_DIR != ptr-&gt;d_type)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">sprintf</span>(filepath, <span class="string">&quot;/proc/%s/status&quot;</span>, ptr-&gt;d_name);<span class="comment">//ç”Ÿæˆè¦è¯»å–çš„æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">            fp = fopen(filepath, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">            <span class="comment">// é€è¡Œè¯»å–ï¼Œå¹¶è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">NULL</span> != fp)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">NULL</span> == fgets(buf, <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>, fp))</span><br><span class="line">                &#123;</span><br><span class="line">                    fclose(fp);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">sscanf</span>(buf, <span class="string">&quot;%*s %s&quot;</span>, cur_task_name);</span><br><span class="line">                <span class="comment">//å¦‚æœæ–‡ä»¶å†…å®¹æ»¡è¶³è¦æ±‚åˆ™æ‰“å°è·¯å¾„çš„åå­—ï¼ˆå³è¿›ç¨‹çš„PIDï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(task_name, cur_task_name))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">sscanf</span>(ptr-&gt;d_name, <span class="string">&quot;%d&quot;</span>, &amp;pid);</span><br><span class="line">                    fclose(fp);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                fclose(fp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        closedir(dir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> != argc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;too small params\n&quot;</span></span><br><span class="line">               <span class="string">&quot;%s &lt;program_name&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> task_name[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">pid_t</span> pid = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sprintf</span>(task_name, <span class="string">&quot;%s&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">    pid = get_pid_by_name(task_name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Name: %s\n&quot;</span></span><br><span class="line">           <span class="string">&quot;Pid: %d\n&quot;</span>, task_name, pid);</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å¹¶è¿è¡Œç¨‹åºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@localhost:~/study$ gcc pid_get.c -Wall -o pid_get</span><br><span class="line">pi@localhost:~/study$ ./pid_get bluealsa</span><br><span class="line">Name: bluealsa</span><br><span class="line">Pid: 1017</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡pså‘½ä»¤ã€pidofå‘½ä»¤æŸ¥è¯¢å‡ºæ¥çš„bluealsaè¿›ç¨‹çš„pidæ˜¯1017ï¼Œè€Œé€šè¿‡ä¸Šè¿°ç¨‹åºå¾—å‡ºçš„bluealsaçš„pidä¹Ÿæ˜¯1017ï¼Œæ‰€ä»¥ä¸€åˆ‡æ­£å¸¸ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linuxç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux: Read-only file system</title>
    <url>/2024/10/25/2024/Linux-Read-only-file-system/</url>
    <content><![CDATA[<p>æ— è®ºæ˜¯é€šè¿‡touchåˆ›å»ºæ–‡ä»¶ï¼Œè¿˜æ˜¯é€šè¿‡viç¼–è¾‘æ–‡ä»¶éƒ½å¤±è´¥ï¼Œå‡ºç°æŠ¥é”™æç¤ºï¼šRead-only file system</p>
<p>å¯ä»¥é€šè¿‡lsblkå‘½ä»¤æŸ¥è¯¢å¯ç”¨å—è®¾å¤‡ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># touch aaa</span></span><br><span class="line"><span class="built_in">touch</span>: aaa: Read-only file system</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">mosquitto.acl       mosquitto.conf      mosquitto.password</span><br><span class="line"><span class="comment"># lsblk </span></span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">mmcblk0     179:0    0 29.2G  0 disk </span><br><span class="line">|-mmcblk0p1 179:1    0  256M  0 part /bootloader</span><br><span class="line">|-mmcblk0p2 179:2    0  256M  0 part </span><br><span class="line">|-mmcblk0p3 179:3    0    1G  0 part /</span><br><span class="line">|-mmcblk0p4 179:4    0    1G  0 part </span><br><span class="line">|-mmcblk0p5 179:5    0  128M  0 part /var/lib/bluetooth</span><br><span class="line">|                                    /overlay</span><br><span class="line">`-mmcblk0p6 179:6    0 26.5G  0 part /data</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡blkidå‘½ä»¤æŸ¥è¯¢å—è®¾å¤‡è¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># blkid </span></span><br><span class="line">/dev/mmcblk0p5: LABEL=<span class="string">&quot;overlay&quot;</span> UUID=<span class="string">&quot;539c8a51-988a-486c-a8b2-784fb3c01c68&quot;</span> BLOCK_SIZE=<span class="string">&quot;1024&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTLABEL=<span class="string">&quot;overlay&quot;</span> PARTUUID=<span class="string">&quot;87e24609-8c57-4272-bf30-a4d2f4ccf9a9&quot;</span></span><br><span class="line">/dev/mmcblk0p3: BLOCK_SIZE=<span class="string">&quot;131072&quot;</span> TYPE=<span class="string">&quot;squashfs&quot;</span> PARTLABEL=<span class="string">&quot;rootfs0&quot;</span> PARTUUID=<span class="string">&quot;a674b333-bab4-4478-b465-7e5d11caedc4&quot;</span></span><br><span class="line">/dev/mmcblk0p1: SEC_TYPE=<span class="string">&quot;msdos&quot;</span> LABEL_FATBOOT=<span class="string">&quot;bootloader&quot;</span> LABEL=<span class="string">&quot;bootloader&quot;</span> UUID=<span class="string">&quot;97B1-A458&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;vfat&quot;</span> PARTLABEL=<span class="string">&quot;boot0&quot;</span> PARTUUID=<span class="string">&quot;5d814d14-f6ed-435b-a41c-da4dd10befd8&quot;</span></span><br><span class="line">/dev/mmcblk0p6: LABEL=<span class="string">&quot;data&quot;</span> UUID=<span class="string">&quot;78f990db-9a78-4f44-95ea-9d04d36071d1&quot;</span> BLOCK_SIZE=<span class="string">&quot;1024&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTLABEL=<span class="string">&quot;data&quot;</span> PARTUUID=<span class="string">&quot;5e6f234c-fd9b-4a90-b75b-37fb26a39b27&quot;</span></span><br><span class="line">/dev/mmcblk0p4: BLOCK_SIZE=<span class="string">&quot;131072&quot;</span> TYPE=<span class="string">&quot;squashfs&quot;</span> PARTLABEL=<span class="string">&quot;rootfs1&quot;</span> PARTUUID=<span class="string">&quot;c538f7af-32d1-4ec0-9300-8df1da9fcabf&quot;</span></span><br><span class="line">/dev/mmcblk0p2: BLOCK_SIZE=<span class="string">&quot;131072&quot;</span> TYPE=<span class="string">&quot;squashfs&quot;</span> PARTLABEL=<span class="string">&quot;rescue&quot;</span> PARTUUID=<span class="string">&quot;3fe85d82-227d-454b-a3d6-bd589772098a&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”ä¸¤è€…ï¼Œå‘ç° <code>/</code> ç›®å½•å¯¹åº”çš„ mmcblk0p3 çš„ç±»å‹æ˜¯ squashfsï¼ˆå³åªè¯»ï¼‰ã€‚</p>
<p><strong>ä¸€èˆ¬è§£å†³æ–¹æ³•ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°† / ç›®å½•é‡æ–°æŒ‚è½½ï¼Œä¸”ç±»å‹ä¸ºå¯è¯»å†™</span></span><br><span class="line">mount -o remount,rw /</span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½ï¼Œä½¿ä¸Šé¢é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Git: branch and tag</title>
    <url>/2024/10/24/2024/Git-branch-and-tag/</url>
    <content><![CDATA[<p>branch å’Œ tag åœ¨Githubçš„ä½“ç°ï¼š</p>
<p><img src="/2024/10/24/2024/Git-branch-and-tag/image-20241024113806476.png" alt="image-20241024113806476"></p>
<p>æ ‡ç­¾ï¼ˆtagï¼‰ä»£è¡¨ç‰¹å®šåˆ†æ”¯åœ¨æŸä¸€æ—¶åˆ»çš„commitæäº¤çš„è®°å½•ï¼Œå³é€šè¿‡tagå¯ä»¥å¿«é€Ÿå®šä½åˆ°æŸä¸€ä¸ªcommitæäº¤çš„è®°å½•ã€‚Git å¯ä»¥ç»™ä»“åº“å†å²ä¸­çš„æŸä¸€ä¸ªæäº¤ï¼ˆcommitï¼‰æ‰“ä¸Šæ ‡ç­¾ï¼Œä»¥ç¤ºé‡è¦ã€‚ æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æ˜¯äººä»¬ä¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ ‡è®°å‘å¸ƒç»“ç‚¹ï¼ˆ <code>v1.0</code> ã€ <code>v2.0</code> ç­‰ç­‰ï¼‰ã€‚</p>
<p>åˆ†æ”¯ï¼ˆbranchï¼‰ä»£è¡¨ä¸€æ¡å•ç‹¬çš„æ—¶é—´çº¿ï¼Œä¸€ä¸ªä»“åº“å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å­˜åœ¨å¤šæ¡æ—¶é—´çº¿ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œã€‚åˆå§‹åŒ–ä¸€ä¸ªä»“åº“æ—¶ï¼Œç¬¬ä¸€æ¬¡commitæäº¤åï¼Œå°±ä¼šé»˜è®¤åˆ›å»ºmasteråˆ†æ”¯ï¼ˆæˆ–mainåˆ†æ”¯ï¼‰ï¼Œä¹‹åå¯ä»¥é’ˆå¯¹ä¸åŒçš„å¼€å‘ä»»åŠ¡ä»masteråˆ†æ”¯è¡ç”Ÿï¼ˆgit checkout -b new_branchï¼‰æ–°åˆ†æ”¯ï¼Œå½“æ–°åˆ†æ”¯ä»»åŠ¡å®Œæˆåï¼Œåˆ‡å›masteråˆ†æ”¯ï¼ˆgit checkout masterï¼‰ï¼Œç„¶åå¯ä»¥å°†æ–°åˆ†æ”¯åˆå¹¶ï¼ˆgit merge new_branchï¼‰åˆ°masteråˆ†æ”¯ä¸­ã€‚</p>
<p>å‚è€ƒæ¥æºï¼š</p>
<p><a href="https://www.cnblogs.com/chentiao/p/17082654.html">1ã€gitçš„åˆ†æ”¯ä¸ªæ ‡ç­¾çš„å¤§ç™½è¯è§£é‡Šï¼ˆbranch and tagï¼‰</a></p>
<p><a href="https://blog.csdn.net/qq_39505245/article/details/124705850">2ã€GitåŸºç¡€ - git tag ä¸€æ–‡çœŸæ­£çš„ææ‡‚gitæ ‡ç­¾çš„ä½¿ç”¨</a></p>
<p><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%AE%80%E4%BB%8B">3ã€Git åˆ†æ”¯ - åˆ†æ”¯ç®€ä»‹</a></p>
<p><a href="https://git-scm.com/book/zh/v2/Git-%e5%9f%ba%e7%a1%80-%e6%89%93%e6%a0%87%e7%ad%be">4ã€Git åŸºç¡€ - æ‰“æ ‡ç­¾</a></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>version control</tag>
      </tags>
  </entry>
  <entry>
    <title>embedded linux application development</title>
    <url>/2024/10/19/2024/embedded-linux-application-development/</url>
    <content><![CDATA[<h2 id="Developing-applications-on-embeded-Linux"><a href="#Developing-applications-on-embeded-Linux" class="headerlink" title="Developing applications on embeded Linux"></a>Developing applications on embeded Linux</h2><ul>
<li>åµŒå…¥å¼ Linux ç³»ç»Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ Linux ç³»ç»Ÿï¼Œé€šå¸¸ç»„ä»¶é€‰æ‹©è¾ƒå°‘</li>
<li>åœ¨åº”ç”¨ç¨‹åºå¼€å‘æ–¹é¢ï¼Œåœ¨åµŒå…¥å¼ Linux ä¸Šè¿›è¡Œå¼€å‘ä¸åœ¨æ¡Œé¢ Linux ç³»ç»Ÿä¸Šè¿›è¡Œå¼€å‘å®Œå…¨ç›¸åŒ</li>
<li>æ‰€æœ‰ç°æœ‰æŠ€èƒ½å‡å¯é‡å¤ä½¿ç”¨ï¼Œæ— éœ€è¿›è¡Œä»»ä½•ç‰¹æ®Šè°ƒæ•´</li>
<li>æ‰€æœ‰ç°æœ‰çš„åº“ï¼ˆæ— è®ºæ˜¯ç¬¬ä¸‰æ–¹çš„è¿˜æ˜¯å†…éƒ¨çš„ï¼‰éƒ½å¯ä»¥é›†æˆåˆ°åµŒå…¥å¼ Linux ç³»ç»Ÿä¸­<ul>
<li>å½“ç„¶ï¼Œè€ƒè™‘åˆ°åµŒå…¥å¼ç³»ç»Ÿåœ¨æ€§èƒ½ã€å­˜å‚¨å’Œå†…å­˜æ–¹é¢çš„é™åˆ¶</li>
</ul>
</li>
<li>ç”šè‡³åœ¨ç¡¬ä»¶å¯ç”¨ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºå¼€å‘å°±å¯ä»¥åœ¨ x86 ä¸Šå¼€å§‹</li>
</ul>
<h2 id="Leverage-existing-libraries-and-languages"><a href="#Leverage-existing-libraries-and-languages" class="headerlink" title="Leverage existing libraries and languages"></a>Leverage existing libraries and languages</h2><ul>
<li>è®¸å¤šåˆšå¼€å§‹ä½¿ç”¨åµŒå…¥å¼ Linux çš„å¼€å‘äººå‘˜ä»…é™äºä½¿ç”¨ Cã€æœ‰æ—¶æ˜¯ C++ å’Œ C&#x2F;C++ æ ‡å‡†åº“</li>
<li>ç„¶è€Œï¼Œæœ‰å¾ˆå¤šåº“å’Œè¯­è¨€å¯ä»¥å¸®åŠ©ä½ åŠ é€Ÿå’Œç®€åŒ–ä½ çš„åº”ç”¨ç¨‹åºå¼€å‘<ul>
<li>Rust å’Œ Go ç­‰ç¼–è¯‘è¯­è¨€è¶Šæ¥è¶Šå—æ¬¢è¿</li>
<li>è§£é‡Šå‹è¯­è¨€ï¼Œå°¤å…¶æ˜¯ Python</li>
<li>æ›´é«˜çº§åˆ«çš„åº“ï¼šQtã€Glibã€Boost ç­‰ç­‰</li>
</ul>
</li>
<li>ç¡®ä¿è¯„ä¼°ä»€ä¹ˆæ˜¯é€‚åˆæ‚¨é¡¹ç›®çš„æ­£ç¡®é€‰æ‹©ï¼Œä½†è¦æ³¨æ„å¦‚ä¸‹äº‹é¡¹ï¼š<ul>
<li>ä½ç«¯å¹³å°ä¸Šçš„å ç”¨ç©ºé—´å’Œæ€§èƒ½</li>
<li>ä½¿ç”¨ç»´æŠ¤è‰¯å¥½ä¸”çŸ¥åçš„æŠ€æœ¯</li>
</ul>
</li>
</ul>
<h2 id="Building-your-applications-libraries"><a href="#Building-your-applications-libraries" class="headerlink" title="Building your applications&#x2F;libraries"></a>Building your applications&#x2F;libraries</h2><ul>
<li>å³ä½¿å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæˆ–åº“ï¼Œä¹Ÿè¦ä½¿ç”¨æ„å»ºç³»ç»Ÿ<ul>
<li>CMake</li>
<li>Meson</li>
</ul>
</li>
<li>ç®€åŒ–äº‹é¡¹æœ‰å¦‚ä¸‹ï¼š<ul>
<li>åº”ç”¨ç¨‹åºçš„æ„å»ºè¿‡ç¨‹</li>
<li>åŠ å…¥é¡¹ç›®çš„å¼€å‘äººå‘˜çš„å¼€å‘å‘¨æœŸ</li>
<li>å°†æ‚¨çš„åº”ç”¨ç¨‹åºæ‰“åŒ…åˆ°åµŒå…¥å¼ Linux æ„å»ºç³»ç»Ÿä¸­</li>
</ul>
</li>
</ul>
<p><strong>CMake</strong></p>
<p><strong>Meson</strong></p>
<h2 id="GDB-GNU-Project-Dubugger"><a href="#GDB-GNU-Project-Dubugger" class="headerlink" title="GDB: GNU Project Dubugger"></a>GDB: GNU Project Dubugger</h2><ul>
<li><p>GNU&#x2F;Linux ä¸Šçš„è°ƒè¯•å™¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åµŒå…¥å¼æ¶æ„ã€‚</p>
</li>
<li><p>æ”¯æŒçš„è¯­è¨€ï¼šCã€C++ã€Pascalã€Objective-Cã€Fortranã€Adaâ€¦</p>
</li>
<li><p>å‘½ä»¤è¡Œç•Œé¢</p>
</li>
<li><p>è®¸å¤šå›¾å½¢é›†æˆå¼€å‘ç¯å¢ƒéƒ½é›†æˆäº†gdb</p>
</li>
<li><p>ä¹Ÿå¯ç”¨ä½œï¼š</p>
<ul>
<li>æ§åˆ¶æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„æ‰§è¡Œã€è®¾ç½®æ–­ç‚¹æˆ–æ›´æ”¹å†…éƒ¨å˜é‡</li>
<li>æŸ¥çœ‹ç¨‹åºå´©æºƒæ—¶æ­£åœ¨åšä»€ä¹ˆï¼šäº‹ååˆ†æ</li>
</ul>
</li>
<li><p>æ–°çš„æ›¿ä»£æ–¹æ¡ˆï¼šLLVM é¡¹ç›®çš„ lldb</p>
</li>
</ul>
<p><strong>gdb</strong></p>
<h2 id="Remote-debugging"><a href="#Remote-debugging" class="headerlink" title="Remote debugging"></a>Remote debugging</h2><ul>
<li>åœ¨éåµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ gdb æˆ–å…¶å‰ç«¯ä¹‹ä¸€è¿›è¡Œè°ƒè¯•ã€‚</li>
<li>gdb å¯ä»¥ç›´æ¥è®¿é—®ä½¿ç”¨è°ƒè¯•ç¬¦å·ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“</li>
<li>ç„¶è€Œï¼Œåœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œç›®æ ‡å¹³å°ç¯å¢ƒé€šå¸¸å¤ªæœ‰é™ï¼Œæ— æ³•ä½¿ç”¨ gdb ç›´æ¥è°ƒè¯•ï¼ˆx86 ä¸Šä¸º 2.4 MBï¼‰ã€‚</li>
<li>è¿œç¨‹è°ƒè¯•ä¼˜åŠ¿ï¼š<ul>
<li>ARCH-linux-gdb ç”¨äºå¼€å‘å·¥ä½œç«™ï¼Œæä¾›å…¶æ‰€æœ‰åŠŸèƒ½ã€‚</li>
<li>ç›®æ ‡ç³»ç»Ÿä¸Šä½¿ç”¨ gdbserverï¼ˆarm ä¸Šä»… 400 KBï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h2 id="Remote-debugging-architeture"><a href="#Remote-debugging-architeture" class="headerlink" title="Remote debugging: architeture"></a>Remote debugging: architeture</h2><p><img src="/2024/10/19/2024/embedded-linux-application-development/image-20241020183318748.png" alt="image-20241020183318748"></p>
<h2 id="Remote-debugging-target-setup"><a href="#Remote-debugging-target-setup" class="headerlink" title="Remote debugging: target setup"></a>Remote debugging: target setup</h2><ul>
<li><p>åœ¨ç›®æ ‡ä¸Šï¼Œé€šè¿‡ gdbserver è¿è¡Œç¨‹åºã€‚</p>
<p>ç¨‹åºä¸ä¼šç«‹å³æ‰§è¡Œ</p>
<p><code>gdbserver : &lt;port&gt; &lt;executable&gt; &lt;args&gt;</code></p>
<p><code>gdbserver /dev/ttyS0 &lt;executable&gt; &lt;args&gt;</code></p>
</li>
<li><p>å¦åˆ™ï¼Œå°† gdbserver é™„åŠ åˆ°å·²åœ¨è¿è¡Œçš„ç¨‹åº</p>
</li>
</ul>
<p>â€‹	<code>gdbserver --attach :&lt;port&gt; &lt;pid&gt;</code></p>
<ul>
<li><p>æ‚¨è¿˜å¯ä»¥å¯åŠ¨ gdbserverï¼Œè€Œæ— éœ€ä¼ é€’ä»»ä½•è¦å¯åŠ¨æˆ–é™„åŠ çš„ç¨‹åºï¼ˆå¹¶ç¨ååœ¨å®¢æˆ·ç«¯è®¾ç½®ç›®æ ‡ç¨‹åºï¼‰ï¼š</p>
<p><code>gdbserver --multi :&lt;port&gt;</code></p>
</li>
</ul>
<h2 id="Remote-debugging-host-setup"><a href="#Remote-debugging-host-setup" class="headerlink" title="Remote debugging: host setup"></a>Remote debugging: host setup</h2><ul>
<li>ç„¶åï¼Œåœ¨ä¸»æœºä¸Šå¯åŠ¨ <code>ARCH-linux-gdb &lt;executable&gt;</code>ï¼Œå¹¶ä½¿ç”¨ä¸‹é¢çš„gdbå‘½ä»¤<ul>
<li>å‘Šè¯‰gdbå…±äº«åº“çš„ä½ç½®ï¼š<code>gdb&gt; set sysroot &lt;library-path&gt;</code> ï¼Œï¼ˆé€šå¸¸æ˜¯æ²¡æœ‰ lib&#x2F; çš„æ„å»ºç©ºé—´çš„è·¯å¾„ï¼‰</li>
<li>è¿æ¥ç›®æ ‡ï¼Œ<code>gbd&gt; target remote &lt;ip-addr&gt;:&lt;port&gt;</code> ï¼Œ<code>gdb&gt; target remote /dev/ttyUSB0</code> ï¼ˆå¦‚æœå­˜åœ¨å¤šä¸ªè¿œç¨‹ç›®æ ‡ï¼Œæ³¨æ„æ›¿æ¢å‚æ•°ï¼‰</li>
<li>å¦‚æœæ‚¨æ²¡æœ‰åœ¨ gdbserver å‘½ä»¤è¡Œä¸Šå°†ç¨‹åºè®¾ç½®ä¸ºè°ƒè¯•ï¼Œ<code>gdb&gt; set remote exec-file &lt;path_to_program_on_target&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="Coredumps-for-post-mortem-analysis"><a href="#Coredumps-for-post-mortem-analysis" class="headerlink" title="Coredumps for post mortem analysis"></a>Coredumps for post mortem analysis</h2><ul>
<li>å½“åº”ç”¨ç¨‹åºå› åˆ†æ®µé”™è¯¯è€Œå´©æºƒï¼Œä¸”åº”ç”¨ç¨‹åºä¸åœ¨è°ƒè¯•å™¨çš„æ§åˆ¶ä¹‹ä¸‹æ—¶ï¼Œæˆ‘ä»¬æ— æ³•è·å¾—æœ‰å…³å´©æºƒçš„ä¿¡æ¯</li>
<li>å¹¸è¿çš„æ˜¯ï¼ŒLinux å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å´©æºƒæ—¶åº”ç”¨ç¨‹åºå†…å­˜çš„ ELF æ ¼å¼æ˜ åƒã€‚gdb å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ¸å¿ƒæ–‡ä»¶è®©æˆ‘ä»¬åˆ†æå´©æºƒåº”ç”¨ç¨‹åºçš„çŠ¶æ€</li>
<li>åœ¨ç›®æ ‡ä¸Šï¼š<ul>
<li>åœ¨shellä¸­æ‰§è¡Œï¼š<code>ulimit -c unlimited</code> ï¼Œå½“ç¨‹åºå´©æºƒå‘ç”Ÿæ—¶ï¼Œåˆ›å»ºcore æ–‡ä»¶</li>
<li>coredumpæ–‡ä»¶çš„åå­—å¯ä»¥åœ¨è¯¥è·¯å¾„ä¸‹ä¿®æ”¹ï¼š<code>/proc/sys/kernel/core_pattern</code></li>
<li>åœ¨ä½¿ç”¨systemdçš„ç³»ç»Ÿä¸Šï¼Œcore dumpä½œä¸ºé»˜è®¤å®‰å…¨åŠŸèƒ½è¢«å–æ¶ˆï¼Œä¸ºäº†é‡æ–°å­˜å‚¨coredumpç¼“å­˜ï¼Œè¿è¡Œï¼š<code>echo core &gt; /proc/sys/kernel/core_pattern</code></li>
</ul>
</li>
<li>åœ¨ä¸»æœºä¸Šï¼š<ul>
<li>ç¨‹åºå´©æºƒå‘ç”Ÿåï¼Œå°†coredumpæ–‡ä»¶ä»ç›®æ ‡ä¼ è¾“åˆ°ä¸»æœºä¸Šï¼Œç„¶åè¿è¡Œï¼š<code>ARCH-linux-gdb -c core-file application-binary</code></li>
</ul>
</li>
</ul>
<h2 id="minicoredumper"><a href="#minicoredumper" class="headerlink" title="minicoredumper"></a>minicoredumper</h2><ul>
<li>å¯¹äºå¤æ‚çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œcore dumpå¯èƒ½éå¸¸å¤§</li>
<li>minicoredumper æ˜¯ä¸€ä¸ªåŸºäºæ ‡å‡†core dumpåŠŸèƒ½çš„ç”¨æˆ·ç©ºé—´å·¥å…·ï¼ŒåŸºäºé€šè¿‡ç®¡é“å°†æ ¸å¿ƒè½¬å‚¨è¾“å‡ºé‡å®šå‘åˆ°ç”¨æˆ·ç©ºé—´ç¨‹åºçš„å¯èƒ½æ€§</li>
<li>åŸºäºJSONé…ç½®æ–‡ä»¶ï¼Œå®ƒèƒ½åšå¦‚ä¸‹ï¼š<ul>
<li>ä»…ä¿å­˜ç›¸å…³éƒ¨åˆ†ï¼ˆå †æ ˆã€å †ã€é€‰å®šçš„ ELF éƒ¨åˆ†ï¼‰</li>
<li>å‹ç¼©è¾“å‡ºæ–‡ä»¶</li>
<li>ä» &#x2F;proc ä¿å­˜é™„åŠ ä¿¡æ¯</li>
</ul>
</li>
<li>â€œé«˜æ•ˆã€å®ç”¨çš„åµŒå…¥å¼ç³»ç»Ÿç¢°æ’æ•°æ®é‡‡é›†â€œ</li>
</ul>
]]></content>
      <categories>
        <category>bootlin</category>
      </categories>
      <tags>
        <tag>embeded linux</tag>
      </tags>
  </entry>
  <entry>
    <title>DBUS: data type or container type</title>
    <url>/2024/10/18/2024/DBUS-data-type-or-container-type/</url>
    <content><![CDATA[<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>å…¶å®DBUSçš„æ•°æ®ç±»å‹åœ¨ <a href="/2024/08/16/2024/bluetoothctl-client-tool/" title="bluetoothctl client tool">bluetoothctl client tool</a>  ä¸­çš„dbusæ•°æ®æ¨¡å‹å°±æœ‰è®°å½•å’Œè¯´æ˜è¿‡ã€‚é€šè¿‡åŸºæœ¬ç±»å‹æ•°æ®è¿›è¡ŒåµŒå¥—å¯ä»¥ç»„åˆæˆå¤æ‚æ•°æ®ç±»å‹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨ç®€ç§°è¡¨ç¤ºï¼Œä¾‹å¦‚ <code>a&#123;sv&#125;</code> ã€‚å¦‚ä½•å°†æ•°æ®è¿›è¡Œæ„é€ å’Œè§£ææ‰æ˜¯éš¾ç‚¹å’Œé‡ç‚¹ã€‚</p>
<h3 id="Numeric"><a href="#Numeric" class="headerlink" title="Numeric"></a>Numeric</h3><p>æ•°å­—çš„æ•°æ®ç±»å‹æ¶‰åŠ: <code>b</code>, <code>y</code>, <code>n</code>, <code>q</code>, <code>i</code>, <code>u</code>, <code>x</code>, <code>t</code>, <code>h</code>, <code>d</code></p>
<table>
<thead>
<tr>
<th align="left">Character</th>
<th align="left">Equivalent C type</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>b</code></td>
<td align="left"><code>gboolean</code></td>
</tr>
<tr>
<td align="left"><code>y</code></td>
<td align="left"><code>guchar</code></td>
</tr>
<tr>
<td align="left"><code>n</code></td>
<td align="left"><code>gint16</code></td>
</tr>
<tr>
<td align="left"><code>q</code></td>
<td align="left"><code>guint16</code></td>
</tr>
<tr>
<td align="left"><code>i</code></td>
<td align="left"><code>gint32</code></td>
</tr>
<tr>
<td align="left"><code>u</code></td>
<td align="left"><code>guint32</code></td>
</tr>
<tr>
<td align="left"><code>x</code></td>
<td align="left"><code>gint64</code></td>
</tr>
<tr>
<td align="left"><code>t</code></td>
<td align="left"><code>guint64</code></td>
</tr>
<tr>
<td align="left"><code>h</code></td>
<td align="left"><code>gint32</code> (handle)</td>
</tr>
<tr>
<td align="left"><code>d</code></td>
<td align="left"><code>gdouble</code></td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ„é€ </span></span><br><span class="line">    GVariant *value1, *value2, *value3, *value4;</span><br><span class="line">    value1 = g_variant_new (<span class="string">&quot;y&quot;</span>, <span class="number">200</span>);</span><br><span class="line">    value2 = g_variant_new (<span class="string">&quot;b&quot;</span>, TRUE);</span><br><span class="line">    value3 = g_variant_new (<span class="string">&quot;d&quot;</span>, <span class="number">37.5</span>);</span><br><span class="line">    value4 = g_variant_new (<span class="string">&quot;x&quot;</span>, G_GINT64_CONSTANT (<span class="number">998877665544332211</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ</span></span><br><span class="line">    guchar byte;</span><br><span class="line">    gdouble floating;</span><br><span class="line">    gboolean truth;</span><br><span class="line">    gint64 bignum;</span><br><span class="line">    g_variant_get (value1, <span class="string">&quot;y&quot;</span>, &amp;byte);      <span class="comment">/* ignore the value. */</span></span><br><span class="line">    g_variant_get (value2, <span class="string">&quot;b&quot;</span>, &amp;truth);</span><br><span class="line">    g_variant_get (value3, <span class="string">&quot;d&quot;</span>, &amp;floating);</span><br><span class="line">    g_variant_get (value4, <span class="string">&quot;x&quot;</span>, &amp;bignum);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°</span></span><br><span class="line">    g_printf(<span class="string">&quot;value1(y): %u\n&quot;</span>, byte);</span><br><span class="line">    g_printf(<span class="string">&quot;value2(b): %s\n&quot;</span>, truth ? <span class="string">&quot;ture&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">    g_printf(<span class="string">&quot;value3(d): %.1f\n&quot;</span>, floating);</span><br><span class="line">    g_printf(<span class="string">&quot;value4(x): %ld\n&quot;</span>, bignum);</span><br><span class="line">    </span><br><span class="line">    g_variant_unref(value1);</span><br><span class="line">    g_variant_unref(value2);</span><br><span class="line">    g_variant_unref(value3);</span><br><span class="line">    g_variant_unref(value4);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>å­—ç¬¦ä¸²æ¶‰åŠï¼š<code>s</code>, <code>o</code>, <code>g</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    GVariant *value1, *value2, *value3;</span><br><span class="line"></span><br><span class="line">    value1 = g_variant_new (<span class="string">&quot;s&quot;</span>, <span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">    value2 = g_variant_new (<span class="string">&quot;o&quot;</span>, <span class="string">&quot;/must/be/a/valid/path&quot;</span>);</span><br><span class="line">    value3 = g_variant_new (<span class="string">&quot;g&quot;</span>, <span class="string">&quot;iias&quot;</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    gchar *str, *object_path, *signature;</span><br><span class="line"></span><br><span class="line">    g_variant_get (value1, <span class="string">&quot;s&quot;</span>, &amp;str);</span><br><span class="line">    g_variant_get (value2, <span class="string">&quot;o&quot;</span>, &amp;object_path);</span><br><span class="line">    g_variant_get (value3, <span class="string">&quot;g&quot;</span>, &amp;signature);</span><br><span class="line"></span><br><span class="line">    g_printf(<span class="string">&quot;value1(s): %s&#x27;\n&quot;</span>, str);</span><br><span class="line">    g_printf(<span class="string">&quot;value1(s): %s&#x27;\n&quot;</span>, object_path);</span><br><span class="line">    g_printf(<span class="string">&quot;value1(s): %s&#x27;\n&quot;</span>, signature);</span><br><span class="line">    g_free (str);</span><br><span class="line">    g_free (object_path);</span><br><span class="line">    g_free (signature);</span><br><span class="line">    </span><br><span class="line">    g_variant_unref(value1);</span><br><span class="line">    g_variant_unref(value2);</span><br><span class="line">    g_variant_unref(value3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šå½“g_variant_get() é‡åˆ° â€˜sâ€™ ,â€™oâ€™, â€˜gâ€™ æ—¶ï¼Œä¼šåˆ›å»ºä¸€å—æ–°çš„å†…å®¹ï¼Œç„¶åæŠŠè¦è¿”å›çš„å­—ç¬¦ä¸²æ‹·è´åˆ°è¿™ä¸ªå†…å®¹ä¸­ï¼Œè¿™å—å†…å­˜è¿”å›ç»™ç»™ä¸€ä¸ªæŒ‡å‘<code>gchar *</code> çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ä¼ å…¥å‡½æ•°å‚æ•°ç±»å‹æ˜¯ <code>gchar **</code> ï¼Œæœ€åä½¿ç”¨å®Œåï¼Œéœ€è¦ç”¨æˆ·ä½¿ç”¨g_free() è¿›è¡Œé‡Šæ”¾ã€‚</em> </p>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p>æ•°ç»„ï¼š<code>a</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ„é€ </span></span><br><span class="line">    GVariantBuilder *builder;</span><br><span class="line">    GVariant *value;</span><br><span class="line"></span><br><span class="line">    builder = g_variant_builder_new(G_VARIANT_TYPE(<span class="string">&quot;as&quot;</span>));</span><br><span class="line">    g_variant_builder_add(builder, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;when&quot;</span>);</span><br><span class="line">    g_variant_builder_add(builder, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;in&quot;</span>);</span><br><span class="line">    g_variant_builder_add(builder, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;the&quot;</span>);</span><br><span class="line">    g_variant_builder_add(builder, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;course&quot;</span>);</span><br><span class="line">    value = g_variant_new(<span class="string">&quot;as&quot;</span>, builder);</span><br><span class="line">    g_variant_builder_unref(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ</span></span><br><span class="line">    GVariantIter *iter;</span><br><span class="line">    gchar *str;</span><br><span class="line"></span><br><span class="line">    g_variant_get(value, <span class="string">&quot;as&quot;</span>, &amp;iter);</span><br><span class="line">    <span class="keyword">while</span> (g_variant_iter_loop(iter, <span class="string">&quot;s&quot;</span>, &amp;str))</span><br><span class="line">        g_print(<span class="string">&quot;%s\n&quot;</span>, str);</span><br><span class="line">    g_variant_iter_free(iter);</span><br><span class="line"></span><br><span class="line">    g_variant_unref(value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><p>å…ƒç»„ï¼š<code>()</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    GVariant *value1, *value2;</span><br><span class="line"></span><br><span class="line">    value1 = g_variant_new(<span class="string">&quot;(s(ii))&quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="number">55</span>, <span class="number">77</span>);</span><br><span class="line"></span><br><span class="line">    gchar *<span class="built_in">string</span>;</span><br><span class="line">    gint x, y;</span><br><span class="line"></span><br><span class="line">    g_variant_get(value1, <span class="string">&quot;(s(ii))&quot;</span>, &amp;<span class="built_in">string</span>, &amp;x, &amp;y);</span><br><span class="line">    g_printf(<span class="string">&quot;%s, %d, %d\n&quot;</span>, <span class="built_in">string</span>, x, y);</span><br><span class="line">    g_free(<span class="built_in">string</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h2><p>å­—å…¸ï¼š<code>&#123;&#125;</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ„é€ </span></span><br><span class="line">    GVariantBuilder *b;</span><br><span class="line">    GVariant *dict;</span><br><span class="line"></span><br><span class="line">    b = g_variant_builder_new(G_VARIANT_TYPE(<span class="string">&quot;a&#123;sv&#125;&quot;</span>));</span><br><span class="line">    g_variant_builder_add(b, <span class="string">&quot;&#123;sv&#125;&quot;</span>, <span class="string">&quot;name&quot;</span>, g_variant_new_string(<span class="string">&quot;foo&quot;</span>));</span><br><span class="line">    g_variant_builder_add(b, <span class="string">&quot;&#123;sv&#125;&quot;</span>, <span class="string">&quot;timeout&quot;</span>, g_variant_new_int32(<span class="number">10</span>));</span><br><span class="line">    dict = g_variant_builder_end(b);</span><br><span class="line">    g_variant_builder_unref(b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ</span></span><br><span class="line">    GVariantIter iter;</span><br><span class="line">    GVariant *value;</span><br><span class="line">    gchar *key;</span><br><span class="line">    g_variant_iter_init(&amp;iter, dict);</span><br><span class="line">    <span class="keyword">while</span> (g_variant_iter_next (&amp;iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;key, &amp;value))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> gchar *type = g_variant_get_type_string(value);</span><br><span class="line">        <span class="keyword">switch</span> (*type)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            g_printf(<span class="string">&quot;%s(%s): %s\n&quot;</span>, key, type, g_variant_get_string(value, <span class="literal">NULL</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">            g_printf(<span class="string">&quot;%s(%s): %d\n&quot;</span>, key, type, g_variant_get_int32(value));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// must free data for ourselves</span></span><br><span class="line">        g_variant_unref(value);</span><br><span class="line">        g_free(key);</span><br><span class="line">    &#125;</span><br><span class="line">    g_variant_unref(dict);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šé€šè¿‡g_variant_iter_next() è·å–çš„keyå’Œvalueï¼Œåœ¨whileå¾ªç¯å†…éƒ¨ä½¿ç”¨å®Œåï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œé‡Šæ”¾ã€‚é€šè¿‡g_variant_iter_init() è·å–çš„dictï¼Œåœ¨ä½¿ç”¨å®Œåï¼Œä¹Ÿéœ€è¦ç”¨æˆ·è¿›è¡Œé‡Šæ”¾ã€‚ä½†æ˜¯æœ‰ç‰¹æ®Šçš„åœ°æ–¹ï¼Œè‹¥ç¬¬äºŒä¸ªå‚æ•°æ˜¯{&amp;sv}ï¼Œé‚£ä¹ˆå¯¹åº”çš„keyå°±æ— éœ€ç”¨æˆ·é‡Šæ”¾ã€‚</em></p>
<h3 id="Multiple"><a href="#Multiple" class="headerlink" title="Multiple"></a>Multiple</h3><p>å¤åˆç±»å‹ï¼Œå³ä¸åŒç±»å‹çš„åµŒå¥—ï¼Œä¾‹å¦‚ï¼š<code>(a&#123;sv&#125;)</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    gcc main.c -o main `pkg-config --libs --cflags dbus-1` `pkg-config --libs --cflags glib-2.0` `pkg-config --libs --cflags gio-2.0`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gio/gio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glib/gprintf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ„é€ </span></span><br><span class="line">    GVariantBuilder *b;</span><br><span class="line">    GVariant *dict, *tuple;</span><br><span class="line"></span><br><span class="line">    b = g_variant_builder_new(G_VARIANT_TYPE(<span class="string">&quot;a&#123;sv&#125;&quot;</span>));</span><br><span class="line">    g_variant_builder_add(b, <span class="string">&quot;&#123;sv&#125;&quot;</span>, <span class="string">&quot;name&quot;</span>, g_variant_new_string(<span class="string">&quot;foo&quot;</span>));</span><br><span class="line">    g_variant_builder_add(b, <span class="string">&quot;&#123;sv&#125;&quot;</span>, <span class="string">&quot;timeout&quot;</span>, g_variant_new_int32(<span class="number">10</span>));</span><br><span class="line">    dict = g_variant_builder_end(b);</span><br><span class="line">    g_variant_builder_unref(b);</span><br><span class="line">    tuple = g_variant_new_tuple(&amp;dict, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ</span></span><br><span class="line">    GVariantIter *iter;</span><br><span class="line">    GVariant *value;</span><br><span class="line">    gchar *key;</span><br><span class="line">    </span><br><span class="line">    g_variant_get(tuple, <span class="string">&quot;(a&#123;sv&#125;)&quot;</span>, &amp;iter);</span><br><span class="line">    <span class="keyword">while</span> (g_variant_iter_next (iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;key, &amp;value))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> gchar *type = g_variant_get_type_string(value);</span><br><span class="line">        <span class="keyword">switch</span> (*type)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            g_printf(<span class="string">&quot;%s(%s): %s\n&quot;</span>, key, type, g_variant_get_string(value, <span class="literal">NULL</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">            g_printf(<span class="string">&quot;%s(%s): %d\n&quot;</span>, key, type, g_variant_get_int32(value));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// must free data for ourselves</span></span><br><span class="line">        g_variant_unref(value);</span><br><span class="line">        g_free(key);</span><br><span class="line">    &#125;</span><br><span class="line">    g_variant_unref(tuple);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å†…å­˜é‡Šæ”¾"><a href="#å†…å­˜é‡Šæ”¾" class="headerlink" title="å†…å­˜é‡Šæ”¾"></a>å†…å­˜é‡Šæ”¾</h2><p><strong>g_variant_iter_free()</strong></p>
<p><a href="https://docs.gtk.org/glib/method.VariantIter.free.html">g_variant_iter_free()</a> å¯ä»¥é‡Šæ”¾ç”±è¿™ä¸¤ä¸ªå‡½æ•°è¿”å›çš„å˜é‡çš„å†…å­˜ï¼š<code>g_variant_iter_new()</code> or <code>g_variant_iter_copy()</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_variant_iter_free</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariantIter* iter</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>







<h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><p><a href="https://blog.linumiz.com/archives/16468">1ã€BlueZ Part 3: Understanding DBUS â€“ Container type system â€“ (2)</a></p>
<p><a href="https://blog.linumiz.com/archives/16427">2ã€BlueZ Part 2: Understanding DBUS â€“ Basic type system â€“ (1)</a></p>
<p><a href="https://docs.gtk.org/glib/gvariant-format-strings.html">3ã€GVariant æ ¼å¼å­—ç¬¦ä¸²</a></p>
<p><a href="https://eightplus.github.io/2019/08/27/2019-08-27-dbus-glib/">4ã€Dbus-glib</a></p>
<p><a href="https://www.cnblogs.com/cxt-janson/p/11428362.html">5ã€dbusä»‹ç»ä¸ä¾‹å­</a></p>
]]></content>
      <categories>
        <category>IPC</category>
      </categories>
      <tags>
        <tag>IPC</tag>
        <tag>DBUS</tag>
      </tags>
  </entry>
  <entry>
    <title>callback and notify</title>
    <url>/2024/10/14/2024/callback-and-notify/</url>
    <content><![CDATA[<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">å›è°ƒå‡½æ•°</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p><strong>å›è°ƒå‡½æ•°</strong>æˆ–ç®€ç§°<strong>å›è°ƒ</strong>ï¼ˆcallbackï¼‰ï¼Œæ˜¯è®¡ç®—æœºç¼–ç¨‹ä¸­å¯¹æŸä¸€æ®µå¯æ‰§è¡Œä»£ç çš„å¼•ç”¨ï¼Œå®ƒè¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€æ®µä»£ç ï¼›é¢„æœŸè¿™æ®µä»£ç å°†å›è°ƒï¼ˆæ‰§è¡Œï¼‰è¿™ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºè‡ªå·±å·¥ä½œçš„ä¸€éƒ¨åˆ†ã€‚è¿™ç§æ‰§è¡Œå¯ä»¥æ˜¯å³æ—¶çš„ï¼Œå¦‚åœ¨åŒæ­¥å›è°ƒä¹‹ä¸­ï¼›ä¹Ÿå¯ä»¥åœ¨åæ¥çš„æ—¶é—´ç‚¹ä¸Šå‘ç”Ÿï¼Œå¦‚åœ¨å¼‚æ­¥å›è°ƒä¹‹ä¸­ã€‚</p>
<p>åœ¨Cè¯­è¨€ä¸­é€šè¿‡å‡½æ•°æŒ‡é’ˆå®ç°å›è°ƒå‡½æ•°ï¼Œå…¶ä¸­å›è°ƒå‡½æ•°çš„å…¸å‹ä¾‹å­å°±æ˜¯ä¿¡å·å¤„ç† :</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> (*signal(<span class="type">int</span> sig, <span class="type">void</span> (*func)(<span class="type">int</span>)))(<span class="type">int</span>);</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹1ï¼šåŸºäºå›è°ƒå‡½æ•°çš„ä¿¡å·æ•æ‰å®ç°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> g_main_loop = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">signal_handler</span><span class="params">(<span class="type">int</span> signum)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (signum)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> SIGINT: <span class="comment">// æ¥æ”¶åˆ°è¯¥ä¿¡å·åï¼Œé€€å‡ºç¨‹åº</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGINT: %d\n&quot;</span>, signum);</span><br><span class="line">        g_main_loop = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGUSR1:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGUER1: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGUSR2:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGUER2: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGTERM:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGTERM: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   signal(SIGINT, signal_handler);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(g_main_loop)</span><br><span class="line">   &#123;</span><br><span class="line">      sleep(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹2ï¼šå½“Aå‘å¸ƒäº†ä»»åŠ¡ç»™Bï¼ŒBæ‰§è¡Œä»»åŠ¡ï¼Œè‹¥ä»»åŠ¡æœ‰è¿›åº¦å˜åŒ–Bç«‹å³å‘ŠçŸ¥Aã€‚å½“ç„¶Aå¹¶ä¸ä¼šä¸€ç›´é¡¶ç€Açš„ä»»åŠ¡è¿›åº¦å˜åŒ–ï¼ŒAå‘å¸ƒä»»åŠ¡åï¼Œå°±å»å¹²å…¶ä»–æ´»äº†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å›è°ƒå‡½æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*CallbackFunction)</span><span class="params">(<span class="type">int</span> new_value)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®å¤„ç†å™¨ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    CallbackFunction callback;</span><br><span class="line">&#125; DataHandler;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> g_main_loop = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®å¤„ç†å™¨æ”¹å˜xå€¼çš„æ–¹æ³•</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">change_value</span><span class="params">(DataHandler *handler, <span class="type">int</span> new_value)</span> </span><br><span class="line">&#123;</span><br><span class="line">    handler-&gt;x = new_value;</span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨å›è°ƒå‡½æ•°ï¼Œåˆ™è°ƒç”¨å®ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (handler-&gt;callback != <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        handler-&gt;callback(new_value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">notify_callback</span><span class="params">(<span class="type">int</span> new_value)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Callback triggered: new value of x is %d\n&quot;</span>, new_value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹Açš„å·¥ä½œå‡½æ•°</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">thread_function</span><span class="params">(<span class="type">void</span> *arg)</span> </span><br><span class="line">&#123;</span><br><span class="line">    DataHandler *handler = (DataHandler *) arg;</span><br><span class="line">    <span class="type">int</span> value = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        change_value(handler, value++);  <span class="comment">// æ”¹å˜xçš„å€¼å¹¶è§¦å‘å›è°ƒ</span></span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®å¤„ç†å™¨çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">DataHandler handler;</span><br><span class="line"><span class="type">int</span> <span class="title function_">data_handler_register</span><span class="params">(CallbackFunction cb)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    handler.x = <span class="number">0</span>;</span><br><span class="line">    handler.callback = cb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pthread_create(&amp;tid, <span class="literal">NULL</span>, thread_function, &amp;handler) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to create thread.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_detach(tid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">signal_handler</span><span class="params">(<span class="type">int</span> signum)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (signum)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> SIGINT: <span class="comment">// æ¥æ”¶åˆ°è¯¥ä¿¡å·åï¼Œé€€å‡ºç¨‹åº</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGINT: %d\n&quot;</span>, signum);</span><br><span class="line">        g_main_loop = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGUSR1:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGUER1: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGUSR2:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGUER2: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGTERM:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SIGTERM: %d\n&quot;</span>, signum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    signal(SIGINT, signal_handler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ•°æ®å¤„ç†å™¨å¹¶è®¾ç½®å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != data_handler_register(notify_callback))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (g_main_loop)</span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;exit\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­mainçº¿ç¨‹ç§°ä¹‹ä¸ºAï¼Œè®¾ç½®å’Œå®šä¹‰äº†å›è°ƒå‡½æ•°notify_callback()ï¼Œå›è°ƒå‡½æ•°èµ‹å€¼ç»™äº†handlerçš„cbæˆå‘˜ã€‚åœ¨miançº¿ç¨‹ä¸­åˆ›å»ºäº†thread_functionçº¿ç¨‹ï¼Œç§°ä¹‹ä¸ºBï¼Œhandlerä½œä¸ºå‚æ•°ç»™åˆ°äº†Bï¼ˆå³Aå‘å¸ƒäº†ä»»åŠ¡åˆ°Bï¼‰ï¼ŒBæ¯éš”2ç§’è°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆå³é€šçŸ¥Aä»»åŠ¡è¿›åº¦å˜åŒ–ï¼‰ã€‚</p>
<h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><p><a href="https://eightplus.github.io/2019/09/05/2019-09-05-callback/">1ã€å›è°ƒå‡½æ•°</a></p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetooth: proper terms and concepts</title>
    <url>/2024/10/11/2024/bluetooth-proper-terms-and-concepts/</url>
    <content><![CDATA[<p>æ¥æºï¼š<a href="https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=587177">Core Specification (amended) 5.4</a></p>
<table>
<thead>
<tr>
<th>ä¸“æœ‰åè¯</th>
<th>æ³¨è§£</th>
</tr>
</thead>
<tbody><tr>
<td>Active Peripheral Broadcastï¼ˆä¸»åŠ¨å¤–è®¾å¹¿æ’­ï¼‰</td>
<td>ç”¨äºé€šè¿‡ BR&#x2F;EDR æ§åˆ¶å™¨å°† L2CAPç”¨æˆ·æµé‡å’ŒæŸäº›ç±»å‹çš„ LMP æµé‡ä¼ è¾“åˆ°å¾®å¾®ç½‘ï¼ˆpiconetï¼‰ä¸­çš„æ‰€æœ‰æ´»åŠ¨è®¾å¤‡çš„é€»è¾‘ä¼ è¾“ã€‚</td>
</tr>
<tr>
<td>Ad Hoc Networkï¼ˆè‡ªç»„ç»‡ç½‘ç»œï¼‰</td>
<td>é€šå¸¸ä»¥è‡ªå‘æ–¹å¼åˆ›å»ºçš„ç½‘ç»œã€‚ä¸´æ—¶ç½‘ç»œä¸éœ€è¦æ­£å¼çš„åŸºç¡€è®¾æ–½å¹¶ä¸”æ—¶é—´å’Œç©ºé—´èŒƒå›´æœ‰é™ã€‚</td>
</tr>
<tr>
<td><strong>Advertiserï¼ˆå¹¿æ’­è€…ï¼‰</strong></td>
<td>åœ¨å¹¿æ’­æ´»åŠ¨æœŸé—´é€šè¿‡å‘å¸ƒå¹¿æ’­æ•°æ®åŒ…çš„ä½åŠŸè€—è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td><strong>Advertising eventï¼ˆå¹¿æ’­äº‹ä»¶ï¼‰</strong></td>
<td>å¹¿æ’­è€…åœ¨ä¸åŒçš„å¹¿æ’­ç‰©ç†ä¿¡é“ä¸Šå‘é€çš„ä¸€ç³»åˆ—ä¸€åˆ°ä¸‰ä¸ªå¹¿æ’­æ•°æ®åŒ…ã€‚</td>
</tr>
<tr>
<td><strong>Advertising Packetï¼ˆå¹¿æ’­åŒ…ï¼‰</strong></td>
<td>åŒ…å«å¹¿æ’­PDUçš„æ•°æ®åŒ…</td>
</tr>
<tr>
<td>Angle of Arrivalï¼ˆåˆ°è¾¾è§’ï¼‰</td>
<td>åˆ°è¾¾è§’æ˜¯å•ä¸ªå¤©çº¿å‘å°„çš„å°„é¢‘æ³¢å…¥å°„åˆ°å¤©çº¿é˜µåˆ—çš„ç›¸å¯¹æ–¹å‘</td>
</tr>
<tr>
<td>Angle of Departureï¼ˆå‡ºå‘è§’ï¼‰</td>
<td>å‡ºå‘è§’æ˜¯ä½¿ç”¨å¤©çº¿é˜µåˆ—å‘å°„çš„å°„é¢‘æ³¢å…¥å°„åˆ°å¦ä¸€æ ¹å¤©çº¿çš„ç›¸å¯¹æ–¹å‘</td>
</tr>
<tr>
<td>BD_ADDR</td>
<td>è“ç‰™è®¾å¤‡çš„åœ°å€ï¼Œè¢«ç”¨æ¥è¯†åˆ«ä¸€ä¸ªè“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td><strong>Bluetoothï¼ˆè“ç‰™ï¼‰</strong></td>
<td>è“ç‰™æ˜¯ä¸€ç§æ— çº¿é€šä¿¡é“¾è·¯ï¼Œä½¿ç”¨è·³é¢‘æ”¶å‘å™¨åœ¨ 2.4 GHz çš„æœªæˆæƒ ISM é¢‘æ®µè¿è¡Œã€‚å®ƒå…è®¸è“ç‰™ä¸»æœºä¹‹é—´è¿›è¡Œå®æ—¶ AV å’Œæ•°æ®é€šä¿¡ã€‚é“¾è·¯åè®®åŸºäºæ—¶éš™ã€‚</td>
</tr>
<tr>
<td><strong>Bluetooth Basebandï¼ˆè“ç‰™åŸºå¸¦ï¼‰</strong></td>
<td>è“ç‰™ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼ŒæŒ‡å®šæˆ–å®ç°ä»‹è´¨è®¿é—®å’Œç‰©ç†å±‚ç¨‹åºï¼Œä»¥æ”¯æŒè“ç‰™è®¾å¤‡ä¹‹é—´å®æ—¶è¯­éŸ³ã€æ•°æ®ä¿¡æ¯æµå’Œä¸´æ—¶ç½‘ç»œçš„äº¤æ¢</td>
</tr>
<tr>
<td><strong>Bluetooth Clockï¼ˆè“ç‰™æ—¶é’Ÿï¼‰</strong></td>
<td>BR&#x2F;EDR æ§åˆ¶å™¨å­ç³»ç»Ÿå†…éƒ¨çš„ 28 ä½æ—¶é’Ÿï¼Œæ¯ 312.5 Âµs æ»´ç­”ä¸€æ¬¡ã€‚æ­¤æ—¶é’Ÿçš„å€¼å®šä¹‰äº†å„ä¸ªç‰©ç†é€šé“ä¸­çš„æ—¶éš™ç¼–å·å’Œæ—¶åºã€‚</td>
</tr>
<tr>
<td>Bluetooth Controllerï¼ˆè“ç‰™æ§åˆ¶å™¨ï¼‰</td>
<td>æŒ‡æ§åˆ¶å™¨çš„é€šç”¨æœ¯è¯­</td>
</tr>
<tr>
<td>Bluetooth Deviceï¼ˆè“ç‰™è®¾å¤‡ï¼‰</td>
<td>èƒ½å¤Ÿä½¿ç”¨è“ç‰™ç³»ç»Ÿè¿›è¡ŒçŸ­è·ç¦»æ— çº¿é€šä¿¡çš„è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td><strong>Bluetooth Device Addressï¼ˆè“ç‰™è®¾å¤‡åœ°å€ï¼‰</strong></td>
<td>ç”¨äºè¯†åˆ«æ¯ä¸ªè“ç‰™è®¾å¤‡çš„ 48 ä½åœ°å€</td>
</tr>
<tr>
<td><strong>BR&#x2F;EDR</strong></td>
<td>è“ç‰™åŸºæœ¬é€Ÿç‡ (BR) å’Œå¢å¼ºæ•°æ®é€Ÿç‡(EDR)ã€‚</td>
</tr>
<tr>
<td><strong>BR&#x2F;EDR Controllerï¼ˆBR&#x2F;EDRæ§åˆ¶å™¨ï¼‰</strong></td>
<td>æŒ‡è“ç‰™æ— çº¿ç”µã€åŸºå¸¦ã€é“¾è·¯ç®¡ç†å™¨å’Œ HCI å±‚çš„æœ¯è¯­ã€‚</td>
</tr>
<tr>
<td>BR&#x2F;EDR Piconet Physical Channelï¼ˆBR&#x2F;EDR å¾®å¾®ç½‘ç‰©ç†é€šé“ï¼‰</td>
<td>ä¿¡é“è¢«åˆ’åˆ†ä¸ºå¤šä¸ªæ—¶éš™ï¼Œæ¯ä¸ªæ—¶éš™ä¸ä¸€ä¸ª RF è·³é¢‘ç›¸å…³ã€‚è¿ç»­çš„è·³é¢‘é€šå¸¸å¯¹åº”äºä¸åŒçš„ RF è·³é¢‘ï¼Œæ ‡å‡†è·³é¢‘é€Ÿç‡ä¸ºæ¯ç§’ 1600 æ¬¡ã€‚è¿™äº›è¿ç»­çš„è·³é¢‘éµå¾ªä¼ªéšæœºè·³é¢‘åºåˆ—ï¼Œé€šè¿‡ 79 ä¸ª RF ä¿¡é“é›†è¿›è¡Œè·³é¢‘ï¼Œæˆ–è€…åœ¨ä½¿ç”¨è‡ªé€‚åº”è·³é¢‘ (AFH) æ—¶ï¼Œå¯é€‰æ‹©é€šè¿‡æ›´å°‘çš„ä¿¡é“è¿›è¡Œè·³é¢‘ã€‚</td>
</tr>
<tr>
<td>BR&#x2F;EDR&#x2F;LE</td>
<td>è“ç‰™åŸºæœ¬é€Ÿç‡ (BR) ï¼Œå¢å¼ºæ•°æ®é€Ÿç‡(EDR)ï¼Œä½åŠŸè€—ã€‚</td>
</tr>
<tr>
<td>C-plane</td>
<td>æ§åˆ¶å¹³é¢</td>
</tr>
<tr>
<td>Channelï¼ˆé€šé“ï¼‰</td>
<td>ç‰©ç†é€šé“æˆ– L2CAP é€šé“ï¼Œå…·ä½“å–å†³äºä¸Šä¸‹æ–‡ã€‚</td>
</tr>
<tr>
<td>Connectï¼ˆè¿æ¥ï¼‰</td>
<td>å»ºç«‹ä¸æœåŠ¡çš„è¿æ¥ã€‚å¦‚æœå°šæœªå®Œæˆï¼Œè¿™è¿˜åŒ…æ‹¬å»ºç«‹ç‰©ç†é“¾è·¯ã€é€»è¾‘ä¼ è¾“ã€é€»è¾‘é“¾è·¯å’Œ L2CAP é€šé“ã€‚</td>
</tr>
<tr>
<td>Connectable device</td>
<td>èŒƒå›´å†…çš„ BR&#x2F;EDR è®¾å¤‡ä¼šå®šæœŸä¾¦å¬å…¶å¯»å‘¼æ‰«æç‰©ç†é€šé“ï¼Œå¹¶å“åº”è¯¥é€šé“ä¸Šçš„å¯»å‘¼ã€‚ä½¿ç”¨å¯è¿æ¥å¹¿æ’­äº‹ä»¶è¿›è¡Œå¹¿æ’­çš„ LE è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td>Connected devices</td>
<td>ä¸¤ä¸ª BR&#x2F;EDR è®¾å¤‡ï¼Œå¹¶ä¸”å®ƒä»¬ä¹‹é—´æœ‰ç‰©ç†é“¾è·¯</td>
</tr>
<tr>
<td>Connecting</td>
<td>è®¾å¤‡ä¹‹é—´é€šä¿¡çš„ä¸€ä¸ªé˜¶æ®µï¼Œå³å»ºç«‹è®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚ï¼ˆé“¾æ¥å»ºç«‹é˜¶æ®µå®Œæˆåï¼Œè¿›å…¥è¿æ¥é˜¶æ®µã€‚ï¼‰</td>
</tr>
<tr>
<td>Connection</td>
<td>æ˜ å°„åˆ° L2CAP é€šé“ä¸Šçš„ä¸¤ä¸ªå¯¹ç­‰åº”ç”¨ç¨‹åºæˆ–æ›´é«˜å±‚åè®®ä¹‹é—´çš„è¿æ¥ã€‚</td>
</tr>
<tr>
<td>Connection establishment</td>
<td>åˆ›å»ºæ˜ å°„åˆ°é€šé“çš„è¿æ¥çš„è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td>Connection event</td>
<td>åœ¨åŒä¸€ç‰©ç†é€šé“ä¸Šï¼Œä¸­å¤®è®¾å¤‡å’Œå¤–å›´è®¾å¤‡ä¹‹é—´å‘é€çš„ä¸€ç³»åˆ—ä¸€å¯¹æˆ–å¤šå¯¹äº¤é”™æ•°æ®åŒ…ã€‚</td>
</tr>
<tr>
<td>Connectionless Peripheral Broadcast</td>
<td>å…è®¸ä¸­å¤®è®¾å¤‡å‘æ— é™æ•°é‡çš„å¤–å›´è®¾å¤‡å¹¿æ’­ä¿¡æ¯çš„åŠŸèƒ½</td>
</tr>
<tr>
<td>Connectionless Peripheral Broadcast Receiver</td>
<td>ä»æ— è¿æ¥å¤–å›´å¹¿æ’­å‘å°„å™¨æ¥æ”¶å¹¿æ’­ä¿¡æ¯çš„è“ç‰™è®¾å¤‡ã€‚è¯¥è®¾å¤‡æ˜¯å¾®å¾®ç½‘çš„å¤–å›´è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td>Connectionless Peripheral Broadcast Transmitter</td>
<td>å‘é€æ— è¿æ¥å¤–è®¾å¹¿æ’­æ¶ˆæ¯ä»¥ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæ— è¿æ¥å¤–è®¾å¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶çš„è“ç‰™è®¾å¤‡ã€‚è¯¥è®¾å¤‡æ˜¯å¾®å¾®ç½‘çš„ä¸­å¿ƒã€‚</td>
</tr>
<tr>
<td><strong>Controller</strong></td>
<td>æŒ‡ HCI ä»¥ä¸‹æ‰€æœ‰å±‚çš„ç»Ÿç§°ã€‚</td>
</tr>
<tr>
<td>Coverage areaï¼ˆè¦†ç›–èŒƒå›´ï¼‰</td>
<td>ä¸¤ä¸ªè“ç‰™è®¾å¤‡å¯ä»¥ä»¥å¯æ¥å—çš„è´¨é‡å’Œæ€§èƒ½äº¤æ¢ä¿¡æ¯çš„åŒºåŸŸ</td>
</tr>
<tr>
<td>Creation of a secure connection</td>
<td>å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯å’ŒåŠ å¯†</td>
</tr>
<tr>
<td>Creation of a trusted relationship</td>
<td>å°†è¿œç¨‹è®¾å¤‡æ ‡è®°ä¸ºå—ä¿¡ä»»è®¾å¤‡çš„è¿‡ç¨‹ã€‚è¿™åŒ…æ‹¬å­˜å‚¨é€šç”¨é“¾æ¥å¯†é’¥ï¼Œä»¥ä¾¿åœ¨é“¾æ¥å¯†é’¥ä¸å¯ç”¨æ—¶è¿›è¡Œå°†æ¥çš„èº«ä»½éªŒè¯æˆ–é…å¯¹ã€‚</td>
</tr>
<tr>
<td><strong>Device discovery</strong></td>
<td>ä»å¯å‘ç°çš„è®¾å¤‡ä¸­æ£€ç´¢è“ç‰™è®¾å¤‡åœ°å€ã€æ—¶é’Ÿå’Œè®¾å¤‡ç±»åˆ«çš„è¿‡ç¨‹</td>
</tr>
<tr>
<td>Discoverable device</td>
<td>èŒƒå›´å†…çš„ BR&#x2F;EDR è®¾å¤‡ä¼šå®šæœŸä¾¦å¬æŸ¥è¯¢æ‰«æç‰©ç†é€šé“ï¼Œå¹¶å“åº”è¯¥é€šé“ä¸Šçš„æŸ¥è¯¢ã€‚èŒƒå›´å†…çš„ LE è®¾å¤‡æ­£åœ¨é€šè¿‡å¯è¿æ¥æˆ–å¯æ‰«æçš„å¹¿å‘Šäº‹ä»¶è¿›è¡Œå¹¿å‘Šï¼Œå¹¶åœ¨å¹¿å‘Šæ•°æ®ä¸­è®¾ç½®äº†å¯å‘ç°æ ‡å¿—ã€‚æ­¤è®¾å¤‡å¤„äºå¯å‘ç°æ¨¡å¼</td>
</tr>
<tr>
<td><strong>Discoverable Mode</strong></td>
<td>åœ¨ BR&#x2F;EDR ä¸­æ‰§è¡ŒæŸ¥è¯¢æ‰«ææˆ–åœ¨ LE ä¸­è®¾ç½®å¯å‘ç°æ ‡å¿—å¹¶åˆ©ç”¨å¯å‘ç°æˆ–å¯è¿æ¥å¹¿å‘Šäº‹ä»¶è¿›è¡Œå¹¿å‘Šçš„è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td>Discovery procedure</td>
<td>æ­£åœ¨ BR&#x2F;EDR ä¸­æ‰§è¡ŒæŸ¥è¯¢ç¨‹åºæˆ–ä½¿ç”¨å¯å‘ç°æˆ–å¯è¿æ¥å¹¿å‘Šäº‹ä»¶ï¼ˆåœ¨ LE ä¸­è®¾ç½®äº†å¯å‘ç°æ ‡å¿—ï¼‰æ‰«æå¹¿å‘Šå•†çš„è“ç‰™è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td><strong>HCI</strong></td>
<td>ä¸»æœºæ§åˆ¶å™¨æ¥å£ (HCI) ä¸ºåŸºå¸¦æ§åˆ¶å™¨å’Œé“¾è·¯ç®¡ç†å™¨æä¾›å‘½ä»¤æ¥å£ï¼Œå¹¶å¯è®¿é—®ç¡¬ä»¶çŠ¶æ€å’Œæ§åˆ¶å¯„å­˜å™¨ã€‚æ­¤æ¥å£æä¾›è®¿é—®è“ç‰™åŸºå¸¦åŠŸèƒ½çš„<strong>ç»Ÿä¸€æ–¹æ³•</strong>ã€‚</td>
</tr>
<tr>
<td><strong>Host</strong></td>
<td>é€»è¾‘å®ä½“ï¼Œå®šä¹‰ä¸ºéæ ¸å¿ƒé…ç½®æ–‡ä»¶ä»¥ä¸‹å’Œä¸»æœºæ§åˆ¶å™¨æ¥å£ (HCI) ä»¥ä¸Šçš„æ‰€æœ‰å±‚ï¼›å³ç¬¬ 3 å·ä¸­æŒ‡å®šçš„å±‚ã€‚è¿æ¥åˆ°è“ç‰™æ§åˆ¶å™¨çš„è“ç‰™ä¸»æœºä¹Ÿå¯ä»¥ä¸è¿æ¥åˆ°å…¶æ§åˆ¶å™¨çš„å…¶ä»–è“ç‰™ä¸»æœºè¿›è¡Œé€šä¿¡</td>
</tr>
<tr>
<td>Initiatorï¼ˆå‘èµ·è€…ï¼‰</td>
<td>ä¸€ç§ä½åŠŸè€—è“ç‰™è®¾å¤‡ï¼Œç”¨äºç›‘å¬å¹¿å‘Šç‰©ç†ä¿¡é“ä¸Šçš„å¯è¿æ¥å¹¿å‘Šäº‹ä»¶ä»¥å»ºç«‹è¿æ¥</td>
</tr>
<tr>
<td><strong>Inquiring device</strong></td>
<td>æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢è¿‡ç¨‹çš„ BR&#x2F;EDR è®¾å¤‡ã€‚æ­¤è®¾å¤‡æ­£åœ¨æ‰§è¡Œå‘ç°è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td><strong>Inquiryï¼ˆæŸ¥è¯¢ï¼‰</strong></td>
<td>è“ç‰™è®¾å¤‡å‘é€æŸ¥è¯¢æ¶ˆæ¯å¹¶ç›‘å¬å“åº”ä»¥å‘ç°è¦†ç›–èŒƒå›´å†…çš„å…¶ä»–è“ç‰™è®¾å¤‡çš„è¿‡ç¨‹</td>
</tr>
<tr>
<td><strong>Inquiry scan</strong></td>
<td>è“ç‰™è®¾å¤‡ä¾¦å¬åœ¨å…¶æŸ¥è¯¢æ‰«æç‰©ç†ä¿¡é“ä¸Šæ”¶åˆ°çš„æŸ¥è¯¢æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td>Interoperabilityï¼ˆäº’æ“ä½œæ€§ï¼‰</td>
<td>ä¸¤ä¸ªæˆ–å¤šä¸ªè®¾å¤‡äº¤æ¢ä¿¡æ¯å¹¶ä½¿ç”¨å·²äº¤æ¢ä¿¡æ¯çš„èƒ½åŠ›</td>
</tr>
<tr>
<td>Isochronous dataï¼ˆç­‰æ—¶æ•°æ®ï¼‰</td>
<td>æµä¸­çš„ä¿¡æ¯ï¼Œå…¶ä¸­æµä¸­çš„æ¯ä¸ªä¿¡æ¯å®ä½“éƒ½ä¸å‰ä¸€ä¸ªå’Œåç»­å®ä½“å­˜åœ¨æ—¶é—´å…³ç³»</td>
</tr>
<tr>
<td>Known device</td>
<td>è‡³å°‘å­˜å‚¨äº† BD_ADDR çš„è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td><strong>L2CAP</strong></td>
<td>é€»è¾‘é“¾è·¯æ§åˆ¶å’Œé€‚é…åè®®</td>
</tr>
<tr>
<td>L2CAP Channel</td>
<td>ä½¿ç”¨å•ä¸ªåº”ç”¨ç¨‹åºæˆ–æ›´é«˜å±‚åè®®çš„ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„L2CAPçº§åˆ«çš„é€»è¾‘è¿æ¥ã€‚</td>
</tr>
<tr>
<td>L2CAP Channel establishment</td>
<td>åœ¨ L2CAP å±‚å»ºç«‹é€»è¾‘è¿æ¥çš„è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td><strong>LE</strong></td>
<td>è“ç‰™ä½åŠŸè€—</td>
</tr>
<tr>
<td>Link</td>
<td>é€»è¾‘é“¾æ¥çš„ç®€å†™ã€‚</td>
</tr>
<tr>
<td>Link establishment</td>
<td>å»ºç«‹è®¾å¤‡é—´é»˜è®¤ ACL é“¾æ¥å’Œé“¾æ¥åŠé€šé“å±‚æ¬¡ç»“æ„çš„ç¨‹åº</td>
</tr>
<tr>
<td>Link key</td>
<td>ä¸¤ä¸ªè®¾å¤‡éƒ½çŸ¥é“çš„å¯†é’¥ï¼Œç”¨äºéªŒè¯é“¾æ¥ã€‚</td>
</tr>
<tr>
<td>LMP authentication</td>
<td>ç”¨äºéªŒè¯è¿œç¨‹è®¾å¤‡èº«ä»½çš„ LMP çº§åˆ«ç¨‹åºã€‚</td>
</tr>
<tr>
<td>LMP pairing</td>
<td>å¯¹ä¸¤ä¸ªè®¾å¤‡è¿›è¡Œèº«ä»½éªŒè¯å¹¶åˆ›å»ºé€šç”¨é“¾æ¥å¯†é’¥çš„è¿‡ç¨‹ï¼Œè¯¥å¯†é’¥å¯ç”¨ä½œä¿¡ä»»å…³ç³»æˆ–ï¼ˆå•ä¸€ï¼‰å®‰å…¨è¿æ¥çš„åŸºç¡€</td>
</tr>
<tr>
<td>Logical link</td>
<td>ç”¨äºå‘è“ç‰™ç³»ç»Ÿå®¢æˆ·ç«¯æä¾›ç‹¬ç«‹æ•°æ®ä¼ è¾“æœåŠ¡çš„æœ€ä½æ¶æ„å±‚</td>
</tr>
<tr>
<td>Logical transport</td>
<td>ä¸åŒé€»è¾‘é“¾è·¯ä¹‹é—´å…±äº«ç¡®è®¤åè®®å’Œé“¾è·¯æ ‡è¯†ç¬¦</td>
</tr>
<tr>
<td>Name discovery</td>
<td>æ£€ç´¢å¯è¿æ¥è®¾å¤‡çš„ç”¨æˆ·å‹å¥½åç§°ï¼ˆè“ç‰™è®¾å¤‡åç§°ï¼‰çš„è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td>Packet</td>
<td>åœ¨ç‰©ç†é€šé“ä¸Šä¼ è¾“çš„èšåˆä½çš„æ ¼å¼ã€‚</td>
</tr>
<tr>
<td><strong>Page</strong></td>
<td>è¿æ¥è¿‡ç¨‹çš„åˆå§‹é˜¶æ®µï¼Œè®¾å¤‡ä¼ è¾“ä¸€ç³»åˆ—å¯»å‘¼æ¶ˆæ¯ï¼Œç›´åˆ°æ”¶åˆ°ç›®æ ‡è®¾å¤‡çš„å“åº”æˆ–å‘ç”Ÿè¶…æ—¶ã€‚</td>
</tr>
<tr>
<td><strong>Page scan</strong></td>
<td>è®¾å¤‡ä¾¦å¬åœ¨å…¶å¯»å‘¼æ‰«æç‰©ç†ä¿¡é“ä¸Šæ”¶åˆ°çš„å¯»å‘¼æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚</td>
</tr>
<tr>
<td>Paging device</td>
<td>æ­£åœ¨æ‰§è¡Œå¯»å‘¼è¿‡ç¨‹çš„è“ç‰™è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td>Paired device</td>
<td>å·²åˆ›å»ºé“¾æ¥å¯†é’¥çš„è“ç‰™è®¾å¤‡ï¼ˆåœ¨è¯·æ±‚å»ºç«‹è¿æ¥ä¹‹å‰æˆ–åœ¨è¿æ¥é˜¶æ®µï¼‰ã€‚</td>
</tr>
<tr>
<td>Passkey</td>
<td>ä½¿ç”¨å®‰å…¨ç®€å•é…å¯¹æ—¶ç”¨äºéªŒè¯è¿æ¥çš„ 6 ä½æ•°å­—ã€‚</td>
</tr>
<tr>
<td>Periodic advertising synchronization informationï¼ˆå®šæœŸå¹¿æ’­åŒæ—¶ä¿¡æ¯ï¼‰</td>
<td>æè¿°å®šæœŸå¹¿å‘Šçš„æ§åˆ¶ä¿¡æ¯ï¼Œä½åŠŸè€—è“ç‰™è®¾å¤‡ä½¿ç”¨è¯¥æ§åˆ¶ä¿¡æ¯åŒæ­¥å…¶æè¿°çš„å¹¿å‘Š</td>
</tr>
<tr>
<td>Physical Channelï¼ˆç‰©ç†é€šé“ï¼‰</td>
<td>å…¶ç‰¹ç‚¹æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè®¾å¤‡åŒæ­¥å ç”¨ä¸€ç³»åˆ—å°„é¢‘è½½æ³¢ã€‚å­˜åœ¨è®¸å¤šç‰©ç†ä¿¡é“ç±»å‹ï¼Œå…¶ç‰¹å¾é’ˆå¯¹ä¸åŒçš„ç”¨é€”è¿›è¡Œäº†å®šä¹‰</td>
</tr>
<tr>
<td>Physical linkï¼ˆç‰©ç†é“¾è·¯ï¼‰</td>
<td>ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„åŸºå¸¦æˆ–é“¾è·¯å±‚è¿æ¥ã€‚</td>
</tr>
<tr>
<td>Physical Transportï¼ˆç‰©ç†ä¼ è¾“ï¼‰</td>
<td>ä½¿ç”¨ä¸€ç§æˆ–å¤šç§è°ƒåˆ¶æ–¹æ¡ˆåœ¨ RF ä¿¡é“ä¸Šè¿›è¡Œ PHY æ•°æ®åŒ…ä¼ è¾“å’Œ&#x2F;æˆ–æ¥æ”¶ã€‚</td>
</tr>
<tr>
<td><strong>Piconetï¼ˆå¾®å¾®ç½‘ï¼‰</strong></td>
<td>ä¸€ç»„è®¾å¤‡ï¼ˆBR&#x2F;EDR ä¸­æœ€å¤š 8 ä¸ªè®¾å¤‡ï¼ŒLE ä¸­æ°å¥½ 2 ä¸ªè®¾å¤‡ï¼‰å ç”¨ä¸€ä¸ªå…±äº«ç‰©ç†é€šé“ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡æ˜¯ Piconet Centralï¼Œå…¶ä½™è®¾å¤‡éƒ½ä¸å…¶ç›¸è¿ã€‚</td>
</tr>
<tr>
<td>Piconet Central</td>
<td>å¾®å¾®ç½‘ä¸­çš„ BR&#x2F;EDR è®¾å¤‡ï¼Œå…¶è“ç‰™æ—¶é’Ÿå’Œè“ç‰™è®¾å¤‡åœ°å€ç”¨äºå®šä¹‰å¾®å¾®ç½‘ç‰©ç†ä¿¡é“ç‰¹æ€§ã€‚å¾®å¾®ç½‘ä¸­çš„ LE è®¾å¤‡å¯åŠ¨å¾®å¾®ç½‘çš„åˆ›å»ºï¼Œé€‰æ‹©æ ‡è¯†å¾®å¾®ç½‘çš„è®¿é—®åœ°å€ï¼Œå¹¶åœ¨æ¯ä¸ªè¿æ¥äº‹ä»¶ä¸­é¦–å…ˆè¿›è¡Œä¼ è¾“ã€‚</td>
</tr>
<tr>
<td>PIN</td>
<td>è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„å·ç ï¼Œå¯ç”¨äºåœ¨é…å¯¹ä¹‹å‰éªŒè¯ä¸è®¾å¤‡çš„è¿æ¥ã€‚</td>
</tr>
<tr>
<td>Profile Broadcast Data</td>
<td>å°†æ•°æ®ä»æ— è¿æ¥å¤–å›´å¹¿æ’­å‘é€å™¨ä¼ è¾“åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ— è¿æ¥å¤–å›´å¹¿æ’­æ¥æ”¶å™¨çš„é€»è¾‘é“¾è·¯ã€‚</td>
</tr>
<tr>
<td>Resolving List</td>
<td>ç”¨äºç”Ÿæˆå’Œè§£æå¯è§£æç§æœ‰åœ°å€çš„è®°å½•åˆ—è¡¨ã€‚æ¯æ¡è®°å½•åŒ…å«ä¸€ä¸ªæœ¬åœ°èº«ä»½è§£æå¯†é’¥ã€ä¸€ä¸ªå¯¹ç­‰èº«ä»½è§£æå¯†é’¥å’Œä¸€ä¸ªå¯¹ç­‰èº«ä»½åœ°å€ã€‚</td>
</tr>
<tr>
<td><strong>Scanner</strong></td>
<td>ç›‘å¬å¹¿å‘Šç‰©ç†ä¿¡é“ä¸Šçš„å¹¿å‘Šäº‹ä»¶çš„ä½åŠŸè€—è“ç‰™è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td>Scatternet</td>
<td>ä¸¤ä¸ªæˆ–å¤šä¸ªå¾®å¾®ç½‘ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…±åŒçš„è®¾å¤‡</td>
</tr>
<tr>
<td>Service discovery</td>
<td>æŸ¥è¯¢å’Œæµè§ˆç”±å…¶ä»–è“ç‰™è®¾å¤‡æä¾›æˆ–é€šè¿‡å…¶ä»–è“ç‰™è®¾å¤‡æä¾›çš„æœåŠ¡çš„ç¨‹åº</td>
</tr>
<tr>
<td>Service Layer Protocol</td>
<td>ä½¿ç”¨ L2CAP é€šé“ä¼ è¾“ PDU çš„åè®®ã€‚</td>
</tr>
<tr>
<td>Silent device</td>
<td>å¦‚æœè“ç‰™è®¾å¤‡ä¸å“åº”è¿œç¨‹è®¾å¤‡çš„è¯¢é—®ï¼Œåˆ™å¯¹äºè¿œç¨‹è®¾å¤‡è€Œè¨€ï¼Œå®ƒå°±æ˜¯é™é»˜çš„ã€‚</td>
</tr>
<tr>
<td>Synchronization Scan Physical Channelï¼ˆåŒæ­¥æ‰«æç‰©ç†é€šé“ï¼‰</td>
<td>ä½¿å¤–å›´è®¾å¤‡èƒ½å¤Ÿä»ä¸­å¤®è®¾å¤‡æ¥æ”¶åŒæ­¥ç³»åˆ—æ•°æ®åŒ…çš„ç‰©ç†é€šé“</td>
</tr>
<tr>
<td>Synchronization Train</td>
<td>åœ¨ä¸€ç»„å›ºå®šé¢‘ç‡ä¸Šä¼ è¾“çš„ä¸€ç³»åˆ—æ•°æ®åŒ…ï¼Œå®ƒä»¬ä¸ºæ¥æ”¶è®¾å¤‡æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä½¿æ¥æ”¶è®¾å¤‡å¼€å§‹æ¥æ”¶ç›¸åº”çš„æ— è¿æ¥å¤–å›´å¹¿æ’­æ•°æ®åŒ…ï¼Œæˆ–åœ¨ä¸¢å¤±ç²—ç•¥æ—¶é’Ÿè°ƒæ•´åæ¢å¤å½“å‰å¾®å¾®ç½‘æ—¶é’Ÿã€‚</td>
</tr>
<tr>
<td>Tick</td>
<td>ï¼ˆBR&#x2F;EDRï¼‰è“ç‰™æ—¶é’Ÿå€¼å˜åŒ–ä¹‹é—´çš„æ—¶é—´ï¼š312.5 Âµsã€‚</td>
</tr>
<tr>
<td>U-plane</td>
<td>ç”¨æˆ·å¹³é¢</td>
</tr>
<tr>
<td>Unknown device</td>
<td>æœªå­˜å‚¨ä»»ä½•ä¿¡æ¯ï¼ˆè“ç‰™è®¾å¤‡åœ°å€ã€é“¾æ¥å¯†é’¥æˆ–å…¶ä»–ï¼‰çš„è“ç‰™è®¾å¤‡</td>
</tr>
</tbody></table>
<p><em>æ³¨æ„ï¼šè¡¨æ ¼ä¸­çš„å¹¿å‘Šå’Œå¹¿æ’­æ˜¯åŒä¸€ä¸ªæ„æ€ Advertising</em></p>
<h2 id="BR-EDR"><a href="#BR-EDR" class="headerlink" title="BR&#x2F;EDR"></a>BR&#x2F;EDR</h2><blockquote>
<p>BR&#x2F;EDRæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>åŸºæœ¬é€Ÿç‡&#x2F;å¢å¼ºæ•°æ®é€Ÿç‡ (The Basic Rate &#x2F; Enhanced Data Rateï¼ŒBR&#x2F;EDR) æ— çº¿ç”µï¼ˆç‰©ç†å±‚æˆ– PHYï¼‰åœ¨ 2.4 GHz çš„æœªæˆæƒ ISM é¢‘æ®µè¿è¡Œã€‚</p>
<p>ç‰©ç†æ— çº¿ç”µä¿¡é“ç”±ä¸€ç»„ä¸å…¬å…±æ—¶é’Ÿå’Œè·³é¢‘æ¨¡å¼åŒæ­¥çš„è®¾å¤‡å…±äº«ã€‚ä¸€ä¸ªè®¾å¤‡æä¾›åŒæ­¥å‚è€ƒï¼Œç§°ä¸ºä¸­å¤®è®¾å¤‡ã€‚ä¸ä¸­å¤®è®¾å¤‡çš„æ—¶é’Ÿå’Œè·³é¢‘æ¨¡å¼åŒæ­¥çš„æ‰€æœ‰å…¶ä»–è®¾å¤‡ç§°ä¸ºå¤–å›´è®¾å¤‡ã€‚ä»¥è¿™ç§æ–¹å¼åŒæ­¥çš„ä¸€ç»„è®¾å¤‡å½¢æˆå¾®å¾®ç½‘ã€‚è¿™æ˜¯è“ç‰™ BR&#x2F;EDR æ— çº¿æŠ€æœ¯ä¸­çš„åŸºæœ¬é€šä¿¡å½¢å¼ã€‚å¾®å¾®ç½‘ä¸­çš„è®¾å¤‡ä½¿ç”¨ç‰¹å®šçš„è·³é¢‘æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ç”±ä¸­å¤®è®¾å¤‡çš„è“ç‰™åœ°å€å’Œæ—¶é’Ÿä¸­çš„æŸäº›å­—æ®µé€šè¿‡ç®—æ³•ç¡®å®šã€‚åŸºæœ¬è·³é¢‘æ¨¡å¼æ˜¯ ISM é¢‘æ®µä¸­ 79 ä¸ªé¢‘ç‡çš„ä¼ªéšæœºæ’åºï¼Œé—´éš” 1 MHzã€‚</p>
<p>ç‰©ç†é€šé“ä¸Šæ–¹æ˜¯é“¾è·¯å’Œé€šé“ä»¥åŠç›¸å…³æ§åˆ¶åè®®çš„åˆ†å±‚ã€‚ä»ç‰©ç†é€šé“å‘ä¸Šçš„é€šé“å’Œé“¾è·¯å±‚æ¬¡æ˜¯ç‰©ç†é€šé“ã€ç‰©ç†é“¾è·¯ã€é€»è¾‘ä¼ è¾“ã€é€»è¾‘é“¾è·¯å’Œ L2CAP é€šé“ã€‚</p>
<h2 id="LE"><a href="#LE" class="headerlink" title="LE"></a>LE</h2><blockquote>
<p>LEæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>ä¸ BR&#x2F;EDR æ— çº¿ç”µä¸€æ ·ï¼ŒLE æ— çº¿ç”µåœ¨æœªç»è®¸å¯çš„ 2.4 GHz ISM é¢‘æ®µè¿è¡Œã€‚</p>
<p>LE é‡‡ç”¨ä¸¤ç§å¤šå€æ–¹æ¡ˆï¼šé¢‘åˆ†å¤šå€ (FDMA) å’Œæ—¶åˆ†å¤šå€ (TDMA)ã€‚FDMA æ–¹æ¡ˆä¸­ä½¿ç”¨ 40 ä¸ª ä¸ªç‰©ç†ä¿¡é“ï¼Œé—´éš” 2 MHzã€‚å…¶ä¸­3 ä¸ªç”¨ä½œä¸»è¦å¹¿å‘Šä¿¡é“ï¼Œ37 ä¸ªç”¨ä½œé€šç”¨ä¿¡é“ï¼ˆåŒ…æ‹¬è¾…åŠ©å¹¿å‘Šä¿¡é“ï¼‰ã€‚ä½¿ç”¨åŸºäº TDMA çš„è½®è¯¢æ–¹æ¡ˆï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡åœ¨é¢„å®šæ—¶é—´ä¼ è¾“æ•°æ®åŒ…ï¼Œè€Œç›¸åº”çš„è®¾å¤‡åœ¨é¢„å®šé—´éš”åç”¨æ•°æ®åŒ…å“åº”ã€‚</p>
<p>åœ¨å¹¿å‘Š PHY é€šé“ä¸Šä¼ è¾“å¹¿æ’­æ•°æ®åŒ…çš„è®¾å¤‡ç§°ä¸ºå¹¿æ’­è€…ã€‚åœ¨å¹¿å‘Šç‰©ç†é€šé“ä¸Šæ¥æ”¶å¹¿æ’­æ•°æ®åŒ…è€Œæ— æ„è¿æ¥åˆ°å¹¿æ’­è®¾å¤‡çš„è®¾å¤‡ç§°ä¸ºæ‰«æè€…ã€‚</p>
<h2 id="Device-Mode"><a href="#Device-Mode" class="headerlink" title="Device Mode"></a>Device Mode</h2><p>åœ¨è“ç‰™æŠ€æœ¯ä¸­ï¼Œå•æ¨¡å’ŒåŒæ¨¡æ˜¯ä»£è¡¨è®¾å¤‡æ”¯æŒæ ¸å¿ƒèƒ½åŠ›ã€‚</p>
<p>è‹¥è®¾å¤‡ä»…æ”¯æŒBR&#x2F;EDR æˆ– LE ä¸­çš„ä¸€ç§èƒ½åŠ›ï¼Œç§°ä¹‹ä¸ºå•æ¨¡è“ç‰™è®¾å¤‡ã€‚è‹¥åŒæ—¶æ”¯æŒä»¥ä¸Šä¸¤ç§èƒ½åŠ›ï¼Œç§°ä¹‹ä¸ºåŒæ¨¡è®¾å¤‡ã€‚</p>
<h2 id="Role"><a href="#Role" class="headerlink" title="Role"></a>Role</h2><p>Central</p>
<p>Peripheral</p>
]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>Core Specification v5.4 with Amendment Notices</tag>
      </tags>
  </entry>
  <entry>
    <title>overview of major emabedded linux software stacks</title>
    <url>/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/</url>
    <content><![CDATA[<p><a href="https://bootlin.com/doc/training/embedded-linux/embedded-linux-slides.pdf">overview of major emabedded linux software stacks</a></p>
<h2 id="D-Bus"><a href="#D-Bus" class="headerlink" title="D-Bus"></a>D-Bus</h2><blockquote>
<p><a href="https://www.freedesktop.org/wiki/Software/dbus/">D-Bus</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>D-Busæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ¶ˆæ¯æ€»çº¿è¿›ç¨‹é—´é€šä¿¡ï¼ˆinterprocess communicationï¼Œå³IPCï¼‰ç³»ç»Ÿã€‚</p>
<p>D-Busæ¶æ„å›¾ï¼š</p>
<p><img src="/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/diagram.svg" alt="diagram"></p>
<ul>
<li>é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶æœºåˆ¶ï¼Œå…è®¸åœ¨åŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶è¿è¡Œçš„å¤šä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡</li>
<li>ä¾é å®ˆæŠ¤è¿›ç¨‹åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æ¶ˆæ¯</li>
<li>ä¸»è¦ç”±ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨ï¼Œä¸ºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›æœåŠ¡</li>
<li>ç¤ºä¾‹ï¼šä»¥ root èº«ä»½è¿è¡Œçš„ç½‘ç»œé…ç½®å®ˆæŠ¤ç¨‹åºæä¾› D-Bus APIï¼ŒCLI å’Œ GUI å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨å®ƒæ¥<br>é…ç½®ç½‘ç»œ</li>
<li>å¤šæ¡æ€»çº¿<ul>
<li>ä¸€æ¡ç³»ç»Ÿæ€»çº¿ï¼Œæ‰€æœ‰ç”¨æˆ·å‡å¯ä»¥è®¿é—®ï¼Œç”¨äºç³»ç»ŸæœåŠ¡</li>
<li>ä¸€æ¡ä¼šè¯æ€»çº¿ï¼Œä¾›æ¯ä¸ªç™»å½•ç”¨æˆ·ä½¿ç”¨</li>
</ul>
</li>
<li>å¯¹è±¡æ¨¡å‹ï¼šinterfaceã€objectã€methodã€signal</li>
</ul>
<p>ä¸€ä¸ªå¾ˆå…¸å‹çš„è“ç‰™åº”ç”¨ï¼šBlueZï¼Œå°±æ˜¯åŸºäºD-Buså®ç°å¤šä¸ªå®¢æˆ·ç«¯ä¸bluetoothdé€šä¿¡ã€‚</p>
<p>ä»¥BlueZé¡¹ç›®ï¼Œå¯¹D-Busçš„ä¸€äº›æ¦‚å¿µè¿›è¡Œç®€å•çš„è¯´æ˜ï¼š</p>
<p>BlueZé¡¹ç›®æä¾›å…³é”®çš„ä¸¤ä¸ªåº”ç”¨æ˜¯ï¼šbluetoothd å’Œ bluetoothctlã€‚</p>
<p>bluetoothdåº”ç”¨è¿æ¥dbus-daemonï¼Œåœ¨dbusä¸Šæ³¨å†Œbus nameä¸º <code>org.bluez</code> çš„æœåŠ¡ï¼Œ ç´§æ¥ç€æ³¨å†Œobject path name ä¸º <code>/org/bluez/hci0</code> çš„å¯¹è±¡è·¯å¾„ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡è·¯å¾„ä¸‹æ³¨å†Œinterface name ä¸º <code>org.bluez.Adapter1</code> çš„æ¥å£ï¼Œè¯¥æ¥å£ä¸‹ç»‘å®šäº†æ–¹æ³•å’Œå±æ€§ã€‚</p>
<p>bluetoothctlåº”ç”¨è¿æ¥dbus-daemonï¼Œæ¥ç€å°±å¯ä»¥å‘ <code>org.bluez</code> ä¸‹ <code>/org/bluez/hci0</code> ä¸‹ <code>org.bluez.Adapter1</code> ä¸‹çš„ <code>StartDiscovery</code> æ–¹æ³•å‘é€è¯·æ±‚ã€‚</p>
<p><img src="/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/image-20241009193405276.png" alt="image-20241009193405276"></p>
<p><a href="https://dbus.freedesktop.org/doc/api/html/group__DBusMessage.html#ga98ddc82450d818138ef326a284201ee0">D-Bus APIæ¥å£</a></p>
<h2 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h2><blockquote>
<p><a href="https://systemd.io/">systemd</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>åœ¨åŸºäºUNIXçš„è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œ<a href="https://zh.wikipedia.org/wiki/Init">init</a> æ˜¯æ“ä½œç³»ç»Ÿå¯åŠ¨æœŸé—´å¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚init æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šæŒç»­è¿è¡Œç›´åˆ°ç³»ç»Ÿå…³é—­ã€‚å®ƒæ˜¯æ‰€æœ‰å…¶ä»–è¿›ç¨‹çš„ç›´æ¥æˆ–é—´æ¥ç¥–å…ˆï¼Œå¹¶è‡ªåŠ¨æ¥æ”¶æ‰€æœ‰å­¤å„¿è¿›ç¨‹ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹çš„ç»“æ„ä¹Ÿæ˜¯å‘ˆç°æ ‘å½¢ï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ init ï¼ˆæ ¹ï¼‰ï¼Œå®ƒçš„è¿›ç¨‹IDå·æ˜¯ 1ã€‚</p>
<p>ä¸Šä¸€ä»£å…³äºåˆå§‹åŒ–ç¨‹åºæ˜¯SysV init æˆ– BSD initï¼Œè€Œç°åœ¨æ˜¯Systemdã€‚</p>
<ul>
<li><p>å‡ ä¹æ‰€æœ‰ Linux æ¡Œé¢&#x2F;æœåŠ¡å™¨å‘è¡Œç‰ˆéƒ½ä½¿ç”¨ç°ä»£ init ç³»ç»Ÿï¼Œå³systemd</p>
</li>
<li><p>systemdæ¯” Busybox init å¤æ‚å¾—å¤šï¼Œä½†ä¹ŸåŠŸèƒ½æ›´å¼ºå¤§</p>
</li>
<li><p>ä»…æ”¯æŒglibcï¼Œä¸æ”¯æŒ uClibc å’Œ Musl</p>
</li>
<li><p>æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>å¹¶è¡Œå¯åŠ¨æœåŠ¡ï¼ŒåŒæ—¶è€ƒè™‘ä¾èµ–å…³ç³»</li>
<li>æœåŠ¡ç›‘æ§</li>
<li>é€šè¿‡å¥—æ¥å­—æ¿€æ´»æŒ‰éœ€å¯åŠ¨æœåŠ¡</li>
<li>æœåŠ¡çš„èµ„æºç®¡ç†ï¼šCPUé™åˆ¶ã€å†…å­˜é™åˆ¶</li>
</ul>
</li>
<li><p>åŸºäºå•å…ƒçš„é…ç½®æ–‡ä»¶</p>
<ul>
<li>å£°æ˜æ€§è¯­è¨€ï¼Œè€Œä¸æ˜¯å…¶ä»– init ç³»ç»Ÿä¸­ä½¿ç”¨çš„ shell è„šæœ¬</li>
</ul>
</li>
<li><p>å…¶ä»–</p>
<ul>
<li><p>journaldï¼šæ—¥å¿—daemonï¼Œæ›¿æ¢äº†syslogd</p>
</li>
<li><p>networkdï¼šç”¨äºç½‘ç»œé…ç½®ç®¡ç†</p>
</li>
<li><p>udevdï¼šçƒ­æ’æ‹”å’Œ &#x2F;dev ç®¡ç†</p>
</li>
<li><p>logindï¼šç™»å½•ç®¡ç†</p>
</li>
<li><p>systemctlï¼šæ§åˆ¶å’Œç›‘æ§ systemd çš„å·¥å…·</p>
</li>
<li><p>other</p>
</li>
</ul>
</li>
</ul>
<h3 id="åŸºäºå•å…ƒçš„é…ç½®æ–‡ä»¶"><a href="#åŸºäºå•å…ƒçš„é…ç½®æ–‡ä»¶" class="headerlink" title="åŸºäºå•å…ƒçš„é…ç½®æ–‡ä»¶"></a>åŸºäºå•å…ƒçš„é…ç½®æ–‡ä»¶</h3><p>ç¤ºä¾‹1ï¼š&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;sshd.service</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=OpenBSD Secure Shell server</span><br><span class="line">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class="line">After=network.target auditd.service</span><br><span class="line">ConditionPathExists=!/etc/ssh/sshd_not_to_be_run</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/default/ssh</span><br><span class="line">ExecStartPre=/usr/sbin/sshd -t</span><br><span class="line">ExecStart=/usr/sbin/sshd -D <span class="variable">$SSHD_OPTS</span></span><br><span class="line">ExecReload=/usr/sbin/sshd -t</span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartPreventExitStatus=255</span><br><span class="line">Type=notify</span><br><span class="line">RuntimeDirectory=sshd</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">Alias=sshd.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹2ï¼š&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;wpa_supplicant.service</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=WPA supplicant</span><br><span class="line">Before=network.target</span><br><span class="line">After=dbus.service</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=dbus</span><br><span class="line">BusName=fi.w1.wpa_supplicant1</span><br><span class="line">ExecStart=/usr/sbin/wpa_supplicant -u</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">Alias=dbus-fi.w1.wpa_supplicant1.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><ul>
<li><code>systemctl status</code> æŸ¥è¯¢æ‰€æœ‰æœåŠ¡çš„çŠ¶æ€</li>
<li><code>systemctl status &lt;service&gt;</code> æŸ¥è¯¢æŒ‡å®šæœåŠ¡çš„çŠ¶æ€</li>
<li><code>systemctl [start|stop|restart] &lt;service&gt;</code> å¯åŠ¨æˆ–åœæ­¢æˆ–é‡å¯æŒ‡å®šæœåŠ¡</li>
<li><code>systemctl [enable|disable] &lt;service&gt;</code> å¯ç”¨æˆ–ç¦ç”¨æŒ‡å®šæœåŠ¡å¼€æœºè‡ªå¯åŠ¨</li>
<li><code>systemctl is-enabled &lt;service&gt;</code> æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</li>
<li><code>systemctl daemon-reload</code> åˆ·æ–°serviceé…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</li>
<li><code>systemctl list-units</code> ä»¥è¡¨æ ¼å½¢å¼æ‰“å°æ‰€æœ‰å¯ç”¨çš„æœåŠ¡å•å…ƒ</li>
</ul>
<h3 id="journalctl"><a href="#journalctl" class="headerlink" title="journalctl"></a>journalctl</h3><p>journalctl æ˜¯ç”¨æ¥æŸ¥è¯¢<strong>systemd-journald</strong> æœåŠ¡æ”¶é›†åˆ°çš„æ—¥å¿—çš„å·¥å…·ã€‚</p>
<ul>
<li><code>journalctl -a</code> æŸ¥è¯¢æ‰€æœ‰æ—¥å¿—</li>
<li><code>journalctl -f</code> æ˜¾ç¤ºæœ€åä¸€ä¸ªæ—¥å¿—ï¼Œå¹¶ä¸”å®æ—¶æ‰“å°æ–°å¢çš„æ—¥å¿—</li>
<li><code>journalctl -u &lt;unit_name&gt;</code> æ˜¾ç¤ºæŒ‡å®šæœåŠ¡å•å…ƒçš„æ—¥å¿—</li>
</ul>
<p>ç¤ºä¾‹1ï¼šæŸ¥è¯¢wpa_supplicant.serviceçš„æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ journalctl -f -u wpa_supplicant.service</span><br><span class="line">Oct 31 05:43:27 homeassistant systemd[1]: Starting WPA supplicant...</span><br><span class="line">Oct 31 05:43:27 homeassistant wpa_supplicant[6665]: Successfully initialized wpa_supplicant</span><br><span class="line">Oct 31 05:43:27 homeassistant systemd[1]: Started WPA supplicant.</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: p2p-dev-wlan0: CTRL-EVENT-DSCP-POLICY clear_all</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: p2p-dev-wlan0: CTRL-EVENT-DSCP-POLICY clear_all</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: nl80211: deinit ifname=p2p-dev-wlan0 disabled_11b_rates=0</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: wlan0: CTRL-EVENT-DSCP-POLICY clear_all</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: wlan0: CTRL-EVENT-DSCP-POLICY clear_all</span><br><span class="line">Oct 31 05:43:48 homeassistant wpa_supplicant[6665]: nl80211: deinit ifname=wlan0 disabled_11b_rates=0</span><br><span class="line">Oct 31 05:44:17 homeassistant systemd[1]: wpa_supplicant.service: Deactivated successfully.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="linux-graphics-stack-overview"><a href="#linux-graphics-stack-overview" class="headerlink" title="linux graphics stack overview"></a>linux graphics stack overview</h2><p><img src="/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/image-20241008192139617.png" alt="image-20241008192139617"></p>
<h2 id="display-controller-support"><a href="#display-controller-support" class="headerlink" title="display controller support"></a>display controller support</h2><p><strong>fddev</strong> æ˜¯ä¸€ä¸ª Linux å­ç³»ç»Ÿï¼Œç”¨äºåœ¨è®¡ç®—æœºæ˜¾ç¤ºå™¨ä¸Šï¼ˆé€šå¸¸åœ¨ç³»ç»Ÿæ§åˆ¶å°ä¸Šï¼‰æ˜¾ç¤ºå›¾å½¢ã€‚ä¸è¿‡å·²ç»è¢«å¼ƒç”¨äº†ï¼Œä½†ä»æœ‰ä¸€äº›æ—§çš„å›¾å½¢é©±åŠ¨ç¨‹åºä»…åœ¨æ­¤å­ç³»ç»Ÿä¸­å¯ç”¨ã€‚</p>
<p><strong>DRM</strong> æ˜¯Linux å†…æ ¸çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œè´Ÿè´£ä¸ç°ä»£æ˜¾å¡çš„GPUè¿›è¡Œäº¤äº’ã€‚</p>
<p>æ”¯æŒ SoC æˆ–æ˜¾å¡çš„æ˜¾ç¤ºæ§åˆ¶å™¨ï¼Œä»¥åŠæ‰€æœ‰ç±»å‹çš„æ˜¾ç¤ºé¢æ¿å’Œæ¡¥æ¥å™¨ï¼šå¹¶è¡Œã€LVDSã€DSIã€HDMIã€DisplayPort ç­‰ã€‚å½“ç„¶ï¼Œä¹Ÿæ”¯æŒé€šè¿‡I2Cæˆ–è€…SPIè¿æ¥çš„å°å‹æ˜¾ç¤ºé¢æ¿ã€‚è®¾å¤‡åœ¨linuxç³»ç»Ÿä¸­æš´éœ²å‡ºæ¥çš„è·¯å¾„ä¸ºï¼š<code>/dev/fri/cardX</code>ã€‚</p>
<p>DRMå¯¹åº”çš„åº“ï¼šlibdrmï¼Œæä¾›äº†ä¸€ä¸ªå¥½ç”¨çš„æµ‹è¯•å·¥å…·ï¼šmodetestã€‚</p>
<h2 id="GPU-support-OpenGL"><a href="#GPU-support-OpenGL" class="headerlink" title="GPU support: OpenGL"></a>GPU support: OpenGL</h2><blockquote>
<p>OpenGLæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li><p>å¼€æº</p>
<ul>
<li><p>OpenGLæ˜¯DRM å­ç³»ç»Ÿä¸­çš„å†…æ ¸é©±åŠ¨ç¨‹åºï¼Œç”¨äºå‘ GPU å‘é€å‘½ä»¤å¹¶ç®¡ç†å†…å­˜ã€‚</p>
</li>
<li><p><a href="https://www.mesa3d.org/">mesa3d</a> ç”¨æˆ·ç©ºé—´åº“å®ç°äº†å„ç§ OpenGL APIï¼ŒåŒ…å«å¤§é‡GPU ç‰¹å®šé€»è¾‘</p>
</li>
<li><p>æ”¯æŒè¶Šæ¥è¶Šå¤šçš„GPU</p>
</li>
</ul>
</li>
<li><p>æ‰€æœ‰æƒ</p>
<ul>
<li>è®¸å¤šåµŒå…¥å¼ GPU è¿‡å»ä»…é€šè¿‡ä¸“æœ‰ blob è·å¾—æ”¯æŒ â€“&gt; é•¿æœŸç»´æŠ¤é—®é¢˜</li>
<li>ä¾›åº”å•†æä¾›çš„å†…æ ¸é©±åŠ¨ç¨‹åº â€“&gt; å¦‚æœç”¨æˆ·ç©ºé—´æ˜¯é—­æºçš„ï¼Œåˆ™ä¸Šæ¸¸ä¸ä¼šæ¥å—å®ƒä»¬</li>
<li>ä¸€ä¸ªï¼ˆå·¨å¤§çš„ï¼‰é—­æºç”¨æˆ·ç©ºé—´äºŒè¿›åˆ¶ blobï¼Œå®ç°å„ç§ OpenGL API</li>
</ul>
</li>
</ul>
<h2 id="Concept-of-display-serviers"><a href="#Concept-of-display-serviers" class="headerlink" title="Concept of display serviers"></a>Concept of display serviers</h2><ul>
<li><p>Linux å†…æ ¸ä¸å¤„ç†åº”ç”¨ç¨‹åºä¹‹é—´çš„æ˜¾ç¤ºå’Œè¾“å…¥è®¾å¤‡çš„å¤šè·¯å¤ç”¨</p>
<ul>
<li>åªæœ‰ä¸€ä¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ˜¾ç¤ºå™¨å’Œä¸€ç»„ç»™å®šçš„è¾“å…¥è®¾å¤‡</li>
</ul>
</li>
<li><p>æ˜¾ç¤ºæœåŠ¡æ˜¯ç‰¹æ®Šçš„ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºï¼Œå®ƒç”±å¦‚ä¸‹æ˜¾ç¤º&#x2F;è¾“å…¥å¤ç”¨æ„æˆ</p>
<ul>
<li>å…è®¸å¤šä¸ªå®¢æˆ·ç«¯ GUI åº”ç”¨ç¨‹åºæäº¤å…¶çª—å£å†…å®¹</li>
<li>æ ¹æ®åº”ç”¨ç¨‹åºæäº¤çš„å†…å®¹ã€çª—å£å¯è§æ€§å’Œåˆ†å±‚ï¼Œç»„æˆå±å¹•ä¸Šå¯è§çš„æœ€ç»ˆå¸§</li>
<li>æ ¹æ®ç„¦ç‚¹å°†è¾“å…¥äº‹ä»¶ä¼ æ’­åˆ°é€‚å½“çš„å®¢æˆ·ç«¯</li>
</ul>
</li>
</ul>
<h2 id="X11-and-X-org"><a href="#X11-and-X-org" class="headerlink" title="X11 and X.org"></a>X11 and X.org</h2><blockquote>
<p><a href="https://www.x.org/wiki/">X.org</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li><p>X.orgæ˜¯UNIXç³»ç»Ÿçš„å†å²æ˜¾ç¤ºæœåŠ¡ï¼ŒåŒ…æ‹¬Linuxç³»ç»Ÿ</p>
</li>
<li><p>X11åè®®è¢«ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»“æ„</p>
<ul>
<li>æœ¬åœ°å®¢æˆ·ç«¯ä½¿ç”¨UNIXå¥—æ¥å­—ï¼Œè¿œç¨‹å®¢æˆ·ç«¯ä½¿ç”¨TCP</li>
</ul>
</li>
<li><p>åœ¨ç°ä»£ Linux ä¸Šï¼Œåœ¨ DRM æˆ– fbdev ä¹‹ä¸Šå¤„ç†å›¾å½¢ï¼Œè¾“å…¥å­ç³»ç»Ÿå¤„ç†è¾“å…¥äº‹ä»¶</p>
</li>
<li><p>ä»ä¿ç•™ï¼Œä½†å·²æ˜¯é—ç•™</p>
</li>
<li><p>X11è®¸å¯</p>
</li>
</ul>
<h2 id="Wayland"><a href="#Wayland" class="headerlink" title="Wayland"></a>Wayland</h2><blockquote>
<p><a href="https://wayland.freedesktop.org/">Wayland</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li>æŒ‡å®šæ˜¾ç¤ºæœåŠ¡å™¨ä¸å…¶å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„é€šä¿¡åè®®ï¼Œä»¥åŠè¯¥åè®®çš„ C åº“å®ç°</li>
<li>ä½¿ç”¨ Wayland åè®®çš„æ˜¾ç¤ºæœåŠ¡ç§°ä¸º Wayland åˆæˆå™¨</li>
<li>X11 åè®®çš„ç°ä»£æ›¿ä»£å“</li>
<li>æ›´å¤šåœ°åŸºäº OpenGL æŠ€æœ¯</li>
</ul>
<p><strong>Wayland compositors</strong></p>
<ul>
<li><a href="https://gitlab.freedesktop.org/wayland/weston">Weston</a></li>
<li><a href="https://gitlab.gnome.org/GNOME/mutter">Mutter</a>ï¼šè¢« GNOME æ¡Œé¢ç¯å¢ƒä½¿ç”¨</li>
<li>wlrootsï¼šä¸€ä¸ª Wayland åˆæˆå™¨åº“<ul>
<li>Cage</li>
<li>swayWM</li>
</ul>
</li>
</ul>
<h2 id="Concept-of-graphics-toolkits"><a href="#Concept-of-graphics-toolkits" class="headerlink" title="Concept of graphics toolkits"></a>Concept of graphics toolkits</h2><ul>
<li><p>X11 å’Œ Wayland åè®®æ˜¯éå¸¸ä½çº§çš„åè®®</p>
</li>
<li><p>è™½ç„¶å¯ä»¥ä½¿ç”¨X11å’Œwaylandï¼Œä½†ç›´æ¥ä½¿ç”¨è¿™äº›åè®®æˆ–ç›¸åº”çš„å®¢æˆ·ç«¯åº“å¼€å‘åº”ç”¨ç¨‹åºä¼šå¾ˆéº»çƒ¦</p>
</li>
<li><p>toolkitså·¥å…·</p>
<ul>
<li>å…¶ä¸­ä¸€äº›åªèƒ½åœ¨æ˜¾ç¤ºæœåŠ¡ä¸Šè¿è¡Œï¼šX11 æˆ– Wayland</li>
<li>å…¶ä¸­ä¸€äº›å¯ä»¥ç›´æ¥åœ¨ DRM + è¾“å…¥ ä¹‹ä¸Šå·¥ä½œï¼Œé€‚ç”¨äºå•ä¸ªå…¨å±åº”ç”¨ç¨‹åº</li>
</ul>
</li>
<li><p>é¢å‘å°éƒ¨ä»¶çš„å·¥å…·åŒ…ï¼Œå…·æœ‰ç”¨äºåˆ›å»ºçª—å£ã€æŒ‰é’®ã€æ–‡æœ¬å­—æ®µã€ä¸‹æ‹‰åˆ—è¡¨ç­‰çš„ API</p>
</li>
<li><p>é¢å‘æ¸¸æˆ&#x2F;å¤šåª’ä½“çš„å·¥å…·åŒ…ï¼Œæ²¡æœ‰é¢„å®šä¹‰çš„å°éƒ¨ä»¶ API</p>
</li>
</ul>
<h2 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h2><blockquote>
<p>Qtæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li>éå¸¸å—æ¬¢è¿ä¸”æ–‡æ¡£ä¸°å¯Œçš„å¼€å‘æ¡†æ¶ï¼Œæä¾›å¦‚ä¸‹ï¼š<ul>
<li>æ ¸å¿ƒåº“ï¼šæ•°æ®ç»“æ„ã€äº‹ä»¶å¤„ç†ã€XMLã€æ•°æ®åº“ã€ç½‘ç»œç­‰</li>
<li>å›¾å½¢åº“ï¼šå°ç»„ä»¶å’Œå…¶ä»–</li>
</ul>
</li>
<li>æ ‡å‡† API æ˜¯ C++ï¼Œä½†å¯ä»¥ç»‘å®šåˆ°å…¶ä»–è¯­è¨€</li>
<li>å¯ä»¥ä½œä¸ºï¼š<ul>
<li>å…·æœ‰ DRM å’Œ OpenGL çš„å•ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ–æ²¡æœ‰åŠ é€Ÿçš„ fbdev</li>
<li>X11 æˆ– Wayland ä¸Šçš„å¤šä¸ªåº”ç”¨ç¨‹åº</li>
</ul>
</li>
<li>å¤šå¹³å°ï¼šLinuxã€MacOSã€Windows</li>
<li>è®¸å¯æœ‰ç‚¹å¤æ‚ï¼Œæ··åˆäº† LGPLv3ã€GPLv2ã€GPLv3 å’Œï¼ˆæ˜‚è´µçš„ï¼‰å•†ä¸šè®¸å¯</li>
</ul>
<h2 id="Gtk"><a href="#Gtk" class="headerlink" title="Gtk"></a>Gtk</h2><blockquote>
<p><a href="https://www.gtk.org/">Gtk</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li><p>ä½œä¸º GNOME æ¡Œé¢ç¯å¢ƒåŸºç¡€çš„å·¥å…·åŒ…ï¼ŒGNOME æ¡Œé¢ç¯å¢ƒæ˜¯ Linux æ¡Œé¢å‘è¡Œç‰ˆä¸­æœ€æµè¡Œçš„æ¡Œé¢ç¯å¢ƒï¼Œä½†åœ¨åµŒå…¥å¼é¡¹ç›®ä¸­é€æ¸å¤±å»å¸å¼•åŠ›</p>
</li>
<li><p>ç”± glibï¼ˆæ ¸å¿ƒåº“ï¼‰ã€pangoï¼ˆæ–‡æœ¬å¤„ç†ï¼‰ã€cairoï¼ˆçŸ¢é‡å›¾å½¢ï¼‰ã€gtkï¼ˆå°ç»„ä»¶åº“ï¼‰ ç»„æˆ</p>
</li>
<li><p>C ä¸­çš„æ ‡å‡† APIï¼Œä½†è®¸å¤šè¯­è¨€éƒ½å­˜åœ¨ç»‘å®š</p>
</li>
<li><p>éœ€è¦æ˜¾ç¤ºæœåŠ¡æ”¯æŒï¼šX11 æˆ– Wayland</p>
</li>
<li><p>LGPLv2è®¸å¯</p>
</li>
<li><p>å½“å‰æœ€æµè¡Œçš„å¼€å‘ç‰ˆæœ¬æ˜¯v 3.xï¼Œæ¥ä¸‹æ¥çš„ç‰ˆæœ¬æ˜¯v 4.x</p>
</li>
<li><p>å¤šå¹³å°ï¼šLinuxã€MacOSã€Windows</p>
</li>
</ul>
<h2 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h2><blockquote>
<p><a href="https://flutter.dev/">Flutter</a>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li>è·¨å¹³å° UI åº”ç”¨ç¨‹åºå¼€å‘ï¼šLinuxã€Androidã€iOSã€Windowsã€MacOS</li>
<li>ç”±Googleè´Ÿè´£å¼€å‘å’Œç»´æŠ¤</li>
<li>åº”ç”¨å¼€å‘å¿…é¡»ä½¿ç”¨ Dart ç¼–ç¨‹è¯­è¨€</li>
<li>åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ Dart è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæœ¬åœ°ç¼–è¯‘ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½</li>
<li>BSD-3-Clauseè®¤è¯è®¸å¯</li>
</ul>
<h2 id="SDL"><a href="#SDL" class="headerlink" title="SDL"></a>SDL</h2><ul>
<li>è·¨å¹³å°å¼€å‘åº“ï¼Œæ—¨åœ¨æä¾›å¯¹éŸ³é¢‘ã€é”®ç›˜ã€é¼ æ ‡ã€æ“çºµæ†å’Œå›¾å½¢ç¡¬ä»¶çš„ä½çº§è®¿é—®</li>
<li>ä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œè½»é‡çº§</li>
<li>æ²¡æœ‰æä¾›å°ç»„ä»¶åº“</li>
<li>æ¸¸æˆã€åª’ä½“æ’­æ”¾å™¨ã€è‡ªå®šä¹‰ UI</li>
<li>zlibè®¤è¯è®¸å¯</li>
</ul>
<h2 id="Other-graphical-toolkits"><a href="#Other-graphical-toolkits" class="headerlink" title="Other graphical toolkits"></a>Other graphical toolkits</h2><ul>
<li>Enlightenment Foundation Libraries (EFL) &#x2F; Elementary<ul>
<li>è½»é‡ä¸”å¼ºå¤§ï¼Œä½†ä¸æ˜¯é‚£ä¹ˆæµè¡Œ</li>
<li>è¿è¡Œåœ¨X11 æˆ– Waylandä¹‹ä¸Š</li>
<li>LGPLv2.1è®¤è¯</li>
</ul>
</li>
<li>LVGL<ul>
<li>éå¸¸è½»é‡ï¼Œä¸»è¦ç”¨äºå¾®æ§åˆ¶å™¨ï¼Œä½†ä¹Ÿèƒ½è¿è¡Œåœ¨Linuxä¸Š</li>
<li>MITè®¤è¯è®¸å¯</li>
</ul>
</li>
</ul>
<h2 id="Linux-multimedia-stack-overview"><a href="#Linux-multimedia-stack-overview" class="headerlink" title="Linux multimedia stack overview"></a>Linux multimedia stack overview</h2><p><img src="/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/image-20241009151839214.png" alt="image-20241009151839214"></p>
<h2 id="Audio-stack"><a href="#Audio-stack" class="headerlink" title="Audio stack"></a>Audio stack</h2><ul>
<li>å†…æ ¸ä¾§ï¼šALSAå­ç³»ç»Ÿï¼ŒAdvanced Linux Sound Architecture<ul>
<li>åŒ…æ‹¬éŸ³é¢‘æ¥å£å’ŒéŸ³é¢‘ç¼–è§£ç å™¨çš„é©±åŠ¨ç¨‹åº</li>
<li>æš´éœ²çš„éŸ³é¢‘è®¾å¤‡æ¥å£ &#x2F;dev&#x2F;snd&#x2F;</li>
</ul>
</li>
<li>ç”¨æˆ·ç©ºé—´åº“ï¼šalsa-lib</li>
<li>éŸ³é¢‘æœåŠ¡<ul>
<li>å½“å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«éŸ³é¢‘è®¾å¤‡æ—¶éœ€è¦ï¼šæ··åˆéŸ³é¢‘æµï¼Œå°†éŸ³é¢‘æµä»ç‰¹å®šåº”ç”¨ç¨‹åºè·¯ç”±åˆ°ç‰¹å®šè®¾å¤‡</li>
<li>JACKï¼šä¸»è¦ç”¨äºä¸“ä¸šéŸ³å“</li>
<li>pulseaudioï¼šä¸»è¦ç”¨äºå¸¸è§„æ¡Œé¢ Linux éŸ³é¢‘</li>
<li>pipewireï¼špulseaudio å’Œ JACK çš„ç°ä»£æ›¿ä»£å“ï¼Œå·²è¢«ä¸€äº› Linux å‘è¡Œç‰ˆé‡‡ç”¨</li>
</ul>
</li>
</ul>
<h2 id="Video-stack"><a href="#Video-stack" class="headerlink" title="Video stack"></a>Video stack</h2><ul>
<li>å†…æ ¸ä¾§ï¼šVideo4Linux å­ç³»ç»Ÿï¼ˆç®€ç§°V4Lï¼‰<ul>
<li>æ”¯æŒæ‘„åƒå¤´è®¾å¤‡ï¼šç½‘ç»œæ‘„åƒå¤´ä»¥åŠ SoC å’Œæ‘„åƒå¤´ä¼ æ„Ÿå™¨çš„æ‘„åƒå¤´æ¥å£ï¼ˆå¹¶è¡Œã€CSI ç­‰ï¼‰</li>
<li>è¿˜ç”¨äºæ”¯æŒè§†é¢‘ç¼–ç &#x2F;è§£ç ç¡¬ä»¶åŠ é€Ÿå™¨ï¼šH264ã€H265ç­‰</li>
<li>æš´éœ²çš„è§†é¢‘è®¾å¤‡æ¥å£ &#x2F;dev&#x2F;videoX</li>
</ul>
</li>
<li>ä¼ ç»Ÿç”¨æˆ·ç©ºé—´åº“ï¼šlibv4l</li>
<li>æ–°çš„ç”¨æˆ·ç©ºé—´åº“ï¼Œæ›´ç°ä»£ï¼Œå…·æœ‰æ›´å¤šåŠŸèƒ½ï¼Œæ­£åœ¨é‡‡ç”¨ï¼šlibcamera</li>
<li>è®¸å¤šå¤šåª’ä½“å †æ ˆ&#x2F;è½¯ä»¶éƒ½æ”¯æŒï¼šGStreamerã€ffmpegã€VLC ç­‰</li>
</ul>
<h2 id="GStreamer"><a href="#GStreamer" class="headerlink" title="GStreamer"></a>GStreamer</h2><blockquote>
<p>Gstreameræ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<ul>
<li>ç”¨äºæ„å»ºåª’ä½“å¤„ç†ç»„ä»¶å›¾è¡¨çš„åº“</li>
<li>å…è®¸åˆ›å»ºç®¡é“æ¥è½¬æ¢ã€è½¬å˜ã€æµå¼ä¼ è¾“ã€æ˜¾ç¤ºã€æ•è·å¤šåª’ä½“æµï¼ˆåŒ…æ‹¬éŸ³é¢‘å’Œè§†é¢‘ï¼‰</li>
<li>ç”±å¤§é‡æ’ä»¶ç»„æˆï¼šè§†é¢‘æ•è·&#x2F;æ˜¾ç¤ºã€éŸ³é¢‘æ•è·&#x2F;æ’­æ”¾ã€ç¼–ç &#x2F;è§£ç ã€ç¼©æ”¾ã€è¿‡æ»¤ç­‰</li>
<li>ä¸€ä¸ªæœ‰è¶£çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ ffmpeg</li>
</ul>
<h2 id="Linux-networking-stack"><a href="#Linux-networking-stack" class="headerlink" title="Linux networking stack"></a>Linux networking stack</h2><p><img src="/2024/10/08/2024/overview-of-major-emabedded-linux-software-stacks/image-20241009153641765.png" alt="image-20241009153641765"></p>
<h2 id="Web-accessible-UI"><a href="#Web-accessible-UI" class="headerlink" title="Web accessible UI"></a>Web accessible UI</h2><ul>
<li>åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ Web ç•Œé¢è¿›è¡Œè®¾å¤‡é…ç½®&#x2F;ç›‘æ§éå¸¸å¸¸è§</li>
<li>éœ€è¦ web æœåŠ¡å™¨ï¼šBusybox httpdå¯ä»¥æ»¡è¶³ç®€å•çš„éœ€æ±‚ã€lighttpdã€nginxã€apacheå¯ä»¥æ»¡è¶³å¤æ‚çš„éœ€æ±‚</li>
<li>å¯ä»¥ä½¿ç”¨ PHPã€NodeJS æˆ–å…¶ä»–è§£é‡Šå‹è¯­è¨€ï¼Œæˆ–è€…ç®€å•çš„ CGI shell è„šæœ¬</li>
</ul>
<h2 id="Web-browsers-rendering-engines"><a href="#Web-browsers-rendering-engines" class="headerlink" title="Web browsers: rendering engines"></a>Web browsers: rendering engines</h2><p>å‘ä½ çš„è®¾å¤‡æ·»åŠ  HTML å‘ˆç°åŠŸèƒ½ï¼š</p>
<ul>
<li>WebKit<ul>
<li>ç”±Appleå‘èµ·ï¼Œåœ¨ iOS å’Œ Safari ä¸­è¢«ä½¿ç”¨</li>
<li>å¼€æºé¡¹ç›®è®¸å¯ï¼šLGPLv2.1 å’Œ BSD-2-Clause</li>
<li>åœ¨Gtkä¸­é›†æˆæ–¹å¼ï¼šWebKitGtk</li>
<li>åœ¨Qtä¸­çš„é›†æˆæ–¹å¼ï¼šQtWebKit</li>
<li>é’ˆå¯¹åµŒå…¥å¼è®¾å¤‡ä¼˜åŒ–çš„ç«¯å£ï¼šWPE WebKit</li>
</ul>
</li>
<li>Blink<ul>
<li>ä»WebKitä¸­åˆ†æ”¯å‡ºæ¥çš„</li>
<li>ç”±Googleå¼€å‘ï¼Œå¹¶è¢«ç”¨åœ¨Chromeä¸­</li>
<li>åœ¨Qtä¸­çš„é›†æˆæ–¹å¼ï¼šQtWebEngine</li>
<li>è¢« Electron ä½¿ç”¨</li>
</ul>
</li>
</ul>
<h2 id="Web-based-UIs"><a href="#Web-based-UIs" class="headerlink" title="Web-based UIs"></a>Web-based UIs</h2><ul>
<li><p>åŸç”Ÿ GUI åº”ç”¨ç¨‹åºçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯åˆ›å»ºåŸºäº Web æŠ€æœ¯çš„ GUI</p>
</li>
<li><p>å…¨å±è¿è¡Œ Web æµè§ˆå™¨ï¼Œå¹¶ä½¿ç”¨æµè¡Œçš„ Web æŠ€æœ¯å¼€å‘åº”ç”¨ç¨‹åº</p>
</li>
<li><p>ä¸€äº›å¯ç”¨é€‰é¡¹ï¼š</p>
<ul>
<li>Cogï¼šé€‚ç”¨äº WPE Webkit ç«¯å£çš„ç®€å•å¯åŠ¨å™¨</li>
<li>Electronï¼šå°† NodeJS åº”ç”¨ç¨‹åºä¸ Web æ¸²æŸ“å¼•æ“æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºçš„æ–¹æ³•</li>
</ul>
</li>
<li><p>æ³¨æ„å ç”¨ç©ºé—´å’Œæ€§èƒ½å½±å“ï¼šWeb æ¸²æŸ“å¼•æ“æ˜¯ä¸€ä¸ªåºå¤§ä¸”è€—è´¹èµ„æºçš„è½¯ä»¶</p>
</li>
</ul>
<h2 id="Programming-languages"><a href="#Programming-languages" class="headerlink" title="Programming languages"></a>Programming languages</h2><ul>
<li>å¯ç”¨çš„è¯­è¨€å’Œæ¡†æ¶ç§ç±»ç¹å¤šï¼Œä¸ä»…é™äº C&#x2F;C++</li>
<li>æ³¨æ„ç©ºé—´å’Œæ€§èƒ½çš„å½±å“</li>
<li>ç¼–è¯‘å‹è¯­è¨€<ul>
<li>C&#x2F;C++</li>
<li>Rust</li>
<li>Go</li>
<li>Ada</li>
<li>Fortran</li>
</ul>
</li>
<li>è§£é‡Šå‹è¯­è¨€<ul>
<li>Python</li>
<li>Javascriptsï¼ŒNodeJS</li>
<li>Lua</li>
<li>Shell scripts</li>
<li>Perlï¼ŒRubyï¼ŒPHP</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>bootlin</category>
      </categories>
      <tags>
        <tag>embeded linux</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetooth: le advertise scan</title>
    <url>/2024/09/29/2024/bluetooth-le-advertise-scan/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>le advertise scan</tag>
        <tag>hci</tag>
        <tag>le</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetoothd: source file reading</title>
    <url>/2024/09/25/2024/bluetoothd-source-file-reading/</url>
    <content><![CDATA[<p><a href="https://github.com/bluez/bluez">bluez</a></p>
<h2 id="ç¨‹åºå…¥å£"><a href="#ç¨‹åºå…¥å£" class="headerlink" title="ç¨‹åºå…¥å£"></a>ç¨‹åºå…¥å£</h2><p>é¦–å…ˆä» <code>/src/main.c</code> çš„ main() å‡½æ•°å¼€å§‹ï¼Œå¯¹äºæœ¬åœ°å®šä¹‰çš„å‡½æ•°åŠŸèƒ½ä½œå‡ºè§£è¯»ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€éƒ¨åˆ†</p>
<p><strong>init_defaults()</strong> é»˜è®¤å€¼çš„åˆå§‹åŒ–æ“ä½œï¼Œä¸»è¦æ˜¯ç»™å…¨å±€å˜é‡ <code>btd_opts</code> è®¾ç½®é»˜è®¤å€¼ã€‚å…¶ä¸­æœ‰æˆ‘ä»¬æ‰€å…³å¿ƒçš„ä¸€äº›ä¿¡æ¯ï¼šBlueZç‰ˆæœ¬ã€ä¸´æ—¶è®¾å¤‡ï¼ˆTemporaryï¼‰è¢«æ¸…ç†çš„å®šæ—¶æ—¶é•¿ã€é€‚é…å™¨é…å¯¹å±æ€§ï¼ˆPairableï¼‰å’Œå¯å‘ç°å±æ€§ï¼ˆDiscoverableï¼‰é»˜è®¤æœ‰æ•ˆæ—¶é•¿ ç­‰ç­‰ã€‚</p>
</li>
<li><p>ç¬¬äºŒéƒ¨åˆ†</p>
<p>è§£æbluetoothdæ”¯æŒçš„è¾“å…¥å‚æ•°ï¼Œ<code>options</code> ç»“æ„ä½“å˜é‡é¢„å®šä¹‰äº†ä¸€äº›å‚æ•°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„ä½“æŒ‡é’ˆå˜é‡context</span></span><br><span class="line">context = g_option_context_new(<span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">// å°†optionsçš„æ¡ç›®å¢åŠ åˆ°context</span></span><br><span class="line">g_option_context_add_main_entries(context, options, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ç”¨æˆ·è¾“å…¥çš„å‚æ•°argvä¸é¢„å®šä¹‰çš„å‘½ä»¤è¡Œå‚æ•°å¯¹æ¯”è§£æ</span></span><br><span class="line"><span class="keyword">if</span> (g_option_context_parse(context, &amp;argc, &amp;argv, &amp;err) == FALSE) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        g_printerr(<span class="string">&quot;%s\n&quot;</span>, err-&gt;message);</span><br><span class="line">        g_error_free(err);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        g_printerr(<span class="string">&quot;An unknown error occurred\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">g_option_context_free(context);</span><br><span class="line"><span class="comment">// çœç•¥...</span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šä¸Šè¿°å‡ ä¸ªå‡½æ•°éƒ½æ˜¯ <a href="https://docs.gtk.org/glib/struct.OptionContext.html">Glibåº“ä¸­çš„å‡½æ•°</a></em></p>
<p>1ã€g_option_context_new</p>
<p>2ã€g_option_context_add_main_entries</p>
<p>3ã€g_option_context_parse</p>
<p>4ã€g_option_context_free</p>
</li>
<li><p>ç¬¬ä¸‰éƒ¨åˆ†</p>
<p>debugå’Œlogéƒ¨åˆ†çš„åˆå§‹åŒ–å¤„ç†</p>
</li>
<li><p>ç¬¬å››éƒ¨åˆ†</p>
<p>ç”¨æˆ·é…ç½®æ–‡ä»¶å¯¼å…¥å’Œè§£æï¼Œå‰ææ¡ä»¶ï¼šç”¨æˆ·è¿è¡Œbluetoothdæ—¶é€šè¿‡å‚æ•°-fæŒ‡å®šäº†é…ç½®æ–‡ä»¶ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨main.confã€‚</p>
</li>
<li><p>ç¬¬äº”éƒ¨åˆ†</p>
<p>è¿æ¥dbus daemonï¼Œç„¶åå‘dbusä¸Šæ³¨å†Œ <code>org.bluez</code> æœåŠ¡ã€‚</p>
</li>
<li><p>ç¬¬å…­éƒ¨åˆ†</p>
<p>adapter_init() å‡½æ•°ç”¨äºé€‚é…å™¨åˆå§‹åŒ–æ“ä½œï¼ŒæŸ¥æ‰¾æœ¬åœ°è“ç‰™é€‚é…å™¨æ•°é‡ï¼Œåœ¨é€‚é…å™¨ä¸Šæ³¨å†Œæ‰€æœ‰çš„äº‹ä»¶ï¼ˆeventï¼‰é€šçŸ¥å›è°ƒå‡½æ•°ï¼Œè¿™é‡Œéœ€è¦é‡ç‚¹å…³æ³¨å‡ ä¸ªï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">device_found_callback()</span><br><span class="line">discovering_callback()</span><br></pre></td></tr></table></figure>

<p>å½“åº•å±‚çš„è“ç‰™é€‚é…å™¨controllerå‘ç°è“ç‰™è®¾å¤‡é€šè¿‡ device_found_callback() å›è°ƒå‡½æ•°é€šçŸ¥bluetoothdåº”ç”¨</p>
<p>å½“åº•å±‚çš„è“ç‰™é€‚é…å™¨controllerå¯åŠ¨&#x2F;åœæ­¢æ‰«æé€šè¿‡ discovering_callback() å›è°ƒå‡½æ•°é€šçŸ¥bluetoothdåº”ç”¨</p>
<p>Hostå’ŒControllerä¹‹é—´é€šè¿‡HCIé€šä¿¡ï¼ŒHoståˆ›å»ºsocketæ¥å£ï¼Œæ¥ç€æ³¨å†Œ can_read_data() å›è°ƒå‡½æ•°ï¼Œå¯ä»¥è¯»å–Controllerçš„Eventï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡send_request() å‘é€Commandç»™Controllerã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK, BTPROTO_HCI);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¬¬ä¸ƒéƒ¨åˆ†</p>
<p>deviceã€agentã€profileã€pluginçš„åˆå§‹åŒ–</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">btd_device_init();</span><br><span class="line">btd_agent_init();</span><br><span class="line">btd_profile_init();</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¬¬å…«éƒ¨åˆ†</p>
<p>æ³¨å†Œä¿¡å·ï¼Œç„¶åè¿›å…¥glibäº‹ä»¶å¾ªç¯</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">mainloop_run_with_signal(signal_callback, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>bluetoothdå°±å¯åŠ¨å®Œæ¯•äº†ã€‚</p>
<p>å¯¹äºbluetoothdæºç çš„è§£è¯»è¿˜æœ‰éå¸¸çš„å¤šçš„ç–‘é—®ï¼Œäº’è”ç½‘ä¸Šå¯¹äºbluezä¸­bluetoothdèµ„æ–™æ›´æ˜¯å‡¤æ¯›éºŸè§’ï¼Œåªèƒ½æ˜¯æš‚æ—¶è‡ªå·±å¯¹äºbluetoothdæºç çš„ä¸€ä¸ªç®€å•çš„è®¤è¯†ã€‚</p>
<h2 id="MGMT"><a href="#MGMT" class="headerlink" title="MGMT"></a>MGMT</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MGMT_OP_START_DISCOVERY		0x0023</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mgmt_cp_start_discovery</span> &#123;</span></span><br><span class="line">	<span class="type">uint8_t</span> type;</span><br><span class="line">&#125; __packed;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MGMT_OP_STOP_DISCOVERY		0x0024</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mgmt_cp_stop_discovery</span> &#123;</span></span><br><span class="line">	<span class="type">uint8_t</span> type;</span><br><span class="line">&#125; __packed;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MGMT_EV_DEVICE_FOUND		0x0012</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mgmt_ev_device_found</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mgmt_addr_info</span> <span class="title">addr</span>;</span></span><br><span class="line">	<span class="type">int8_t</span> rssi;</span><br><span class="line">	<span class="type">uint32_t</span> flags;</span><br><span class="line">	<span class="type">uint16_t</span> eir_len;</span><br><span class="line">	<span class="type">uint8_t</span> eir[<span class="number">0</span>];</span><br><span class="line">&#125; __packed;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MGMT_EV_DISCOVERING		0x0013</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mgmt_ev_discovering</span> &#123;</span></span><br><span class="line">	<span class="type">uint8_t</span> type;</span><br><span class="line">	<span class="type">uint8_t</span> discovering;</span><br><span class="line">&#125; __packed;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="è®¾å¤‡å‘ç°"><a href="#è®¾å¤‡å‘ç°" class="headerlink" title="è®¾å¤‡å‘ç°"></a>è®¾å¤‡å‘ç°</h2><blockquote>
<p>å½“é€‚é…å™¨å¼€å§‹æ‰«ææ—¶ï¼Œå‘ç°äº†é™„è¿‘çš„è“ç‰™è®¾å¤‡ï¼Œè“ç‰™è®¾å¤‡è¢«æ·»åŠ åˆ°é€‚é…å™¨çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p>
</blockquote>
<p>å½“é€‚é…å™¨æ‰§è¡Œæ‰«ææ—¶ï¼Œå‘ç°çš„è“ç‰™è®¾å¤‡é€šè¿‡å›è°ƒå‡½æ•°ä¼ é€’ï¼ˆbluetoothdåœ¨mainå‡½æ•°ä¸­æ‰§è¡Œadapter_initå‡½æ•°å°±æ³¨å†Œæ‰€æœ‰çš„äº‹ä»¶å›è°ƒå‡½æ•°ï¼‰ï¼Œä»¥ä¸‹å°±æ˜¯å…³äºè®¾å¤‡å‘ç°çš„å›è°ƒå‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">device_found_callback</span><span class="params">(<span class="type">uint16_t</span> index, <span class="type">uint16_t</span> length,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="type">void</span> *param, <span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">mgmt_ev_device_found</span> *<span class="title">ev</span> =</span> param;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_adapter</span> *<span class="title">adapter</span> =</span> user_data;</span><br><span class="line">	<span class="type">const</span> <span class="type">uint8_t</span> *eir;</span><br><span class="line">	<span class="type">uint16_t</span> eir_len;</span><br><span class="line">	<span class="type">uint32_t</span> flags;</span><br><span class="line">	<span class="type">char</span> addr[<span class="number">18</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (length &lt; <span class="keyword">sizeof</span>(*ev)) &#123;</span><br><span class="line">		btd_error(adapter-&gt;dev_id,</span><br><span class="line">			<span class="string">&quot;Too short device found event (%u bytes)&quot;</span>, length);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	eir_len = btohs(ev-&gt;eir_len);</span><br><span class="line">	<span class="keyword">if</span> (length != <span class="keyword">sizeof</span>(*ev) + eir_len) &#123;</span><br><span class="line">		btd_error(adapter-&gt;dev_id,</span><br><span class="line">				<span class="string">&quot;Device found event size mismatch (%u != %zu)&quot;</span>,</span><br><span class="line">					length, <span class="keyword">sizeof</span>(*ev) + eir_len);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (eir_len == <span class="number">0</span>)</span><br><span class="line">		eir = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		eir = ev-&gt;eir;</span><br><span class="line"></span><br><span class="line">	flags = le32_to_cpu(ev-&gt;flags);</span><br><span class="line"></span><br><span class="line">	ba2str(&amp;ev-&gt;addr.bdaddr, addr);</span><br><span class="line">	DBG(<span class="string">&quot;hci%u addr %s, rssi %d flags 0x%04x eir_len %u&quot;</span>,</span><br><span class="line">			index, addr, ev-&gt;rssi, flags, eir_len);</span><br><span class="line"></span><br><span class="line">	btd_adapter_device_found(adapter, &amp;ev-&gt;addr.bdaddr,</span><br><span class="line">					ev-&gt;addr.type, ev-&gt;rssi, flags,</span><br><span class="line">					eir, eir_len, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å…³æ³¨è¿™ä¸ªå‡½æ•° btd_adapter_device_foundï¼Œç”±äºè¿™ä¸ªå‡½æ•°å¤ªé•¿ï¼Œä»…æ”¾å‡ºéƒ¨åˆ†ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">btd_adapter_device_found</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="type">bdaddr_t</span> *bdaddr,</span></span><br><span class="line"><span class="params">					<span class="type">uint8_t</span> bdaddr_type, <span class="type">int8_t</span> rssi,</span></span><br><span class="line"><span class="params">					<span class="type">uint32_t</span> flags,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="type">uint8_t</span> *data, <span class="type">uint8_t</span> data_len,</span></span><br><span class="line"><span class="params">					<span class="type">bool</span> monitoring)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// çœç•¥...</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä»é€‚é…å™¨ä¸‹é¢æŸ¥æ‰¾ç›®æ ‡è®¾å¤‡ï¼Œè‹¥æ²¡æœ‰è¯¥è®¾å¤‡ï¼Œåˆ™æ‰§è¡ŒèŠ±æ‹¬å·çš„å†…å®¹</span></span><br><span class="line">	dev = btd_adapter_find_device(adapter, bdaddr, bdaddr_type);</span><br><span class="line">	<span class="keyword">if</span> (!dev) &#123;</span><br><span class="line">		<span class="comment">/* In case of being just a scan response don&#x27;t attempt to create</span></span><br><span class="line"><span class="comment">		 * the device.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (scan_rsp) &#123;</span><br><span class="line">			eir_data_free(&amp;eir_data);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Monitor Devices advertising Broadcast Announcements if the</span></span><br><span class="line"><span class="comment">		 * adapter is capable of synchronizing to it.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (eir_get_service_data(&amp;eir_data, BCAA_SERVICE_UUID) &amp;&amp;</span><br><span class="line">				btd_adapter_has_settings(adapter,</span><br><span class="line">				MGMT_SETTING_ISO_SYNC_RECEIVER))</span><br><span class="line">			monitoring = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!discoverable &amp;&amp; !monitoring &amp;&amp; not_connectable) &#123;</span><br><span class="line">			eir_data_free(&amp;eir_data);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		dev = adapter_create_device(adapter, bdaddr, bdaddr_type);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ›´æ–°å®šæ—¶å™¨</span></span><br><span class="line">	device_update_last_seen(dev, bdaddr_type, !not_connectable);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (bdaddr_type != BDADDR_BREDR &amp;&amp; eir_data.flags &amp;&amp;</span><br><span class="line">					!(eir_data.flags &amp; EIR_BREDR_UNSUP)) &#123;</span><br><span class="line">		device_set_bredr_support(dev);</span><br><span class="line">		<span class="comment">/* Update last seen for BR/EDR in case its flag is set */</span></span><br><span class="line">		device_update_last_seen(dev, BDADDR_BREDR, !not_connectable);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (eir_data.name != <span class="literal">NULL</span> &amp;&amp; eir_data.name_complete)</span><br><span class="line">		device_store_cached_name(dev, eir_data.name);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>device_store_cached_nameå‡½æ•°ç”¨äºåœ¨cacheç›®å½•ä¸‹åˆ›å»ºè®¾å¤‡çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œæ¥ä¸‹æ¥å…³æ³¨è¿™ä¸ªå‡½æ•° adapter_create_device</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">struct</span> btd_device *<span class="title function_">adapter_create_device</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">						<span class="type">const</span> <span class="type">bdaddr_t</span> *bdaddr,</span></span><br><span class="line"><span class="params">						<span class="type">uint8_t</span> bdaddr_type)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">device</span>;</span></span><br><span class="line"></span><br><span class="line">	device = device_create(adapter, bdaddr, bdaddr_type);</span><br><span class="line">	<span class="keyword">if</span> (!device)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	adapter_add_device(adapter, device);</span><br><span class="line">	<span class="keyword">return</span> device;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ¥äº†ï¼Œæ­¤æ—¶çœ‹åˆ°äº†å‡½æ•° <code>device_create</code> ç”¨äºåˆ›å»ºè®¾å¤‡ï¼Œå…·ä½“çœ‹å®ƒçš„å®ç°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> btd_device *<span class="title function_">device_create</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">bdaddr_t</span> *bdaddr, <span class="type">uint8_t</span> bdaddr_type)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">device</span>;</span></span><br><span class="line">	<span class="type">char</span> dst[<span class="number">18</span>];</span><br><span class="line">	<span class="type">char</span> *str;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *storage_dir;</span><br><span class="line"></span><br><span class="line">	ba2str(bdaddr, dst);</span><br><span class="line">	DBG(<span class="string">&quot;dst %s&quot;</span>, dst);</span><br><span class="line"></span><br><span class="line">	device = device_new(adapter, dst);</span><br><span class="line">	<span class="keyword">if</span> (device == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	device-&gt;bdaddr_type = bdaddr_type;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (bdaddr_type == BDADDR_BREDR)</span><br><span class="line">		device-&gt;bredr = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		device-&gt;le = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	storage_dir = btd_adapter_get_storage_dir(adapter);</span><br><span class="line">	str = load_cached_name(device, storage_dir, dst);</span><br><span class="line">	<span class="keyword">if</span> (str) &#123;</span><br><span class="line">		<span class="built_in">strcpy</span>(device-&gt;name, str);</span><br><span class="line">		g_free(str);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	load_cached_name_resolve(device, storage_dir, dst);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> device;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“è“ç‰™è®¾å¤‡è¢«é€‚é…å™¨æ·»åŠ åï¼Œä¼šæ³¨å†Œç±»ä¼¼è¿™ç§å¯¹è±¡è·¯å¾„ <code>/org/bluez/hci0/dev_50_64_2B_BF_46_36</code>ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±åœ¨è¿™ä¸ªå‡½æ•° device_new()</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> GDBusMethodTable device_methods[] = &#123;</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Disconnect&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, dev_disconnect) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Connect&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, dev_connect) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;ConnectProfile&quot;</span>, GDBUS_ARGS(&#123; <span class="string">&quot;UUID&quot;</span>, <span class="string">&quot;s&quot;</span> &#125;),</span><br><span class="line">						<span class="literal">NULL</span>, connect_profile) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;DisconnectProfile&quot;</span>, GDBUS_ARGS(&#123; <span class="string">&quot;UUID&quot;</span>, <span class="string">&quot;s&quot;</span> &#125;),</span><br><span class="line">						<span class="literal">NULL</span>, disconnect_profile) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Pair&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, pair_device) &#125;,</span><br><span class="line">	&#123; GDBUS_METHOD(<span class="string">&quot;CancelPairing&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, cancel_pairing) &#125;,</span><br><span class="line">	&#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> GDBusPropertyTable device_properties[] = &#123;</span><br><span class="line">	&#123; <span class="string">&quot;Address&quot;</span>, <span class="string">&quot;s&quot;</span>, dev_property_get_address &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;AddressType&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_address_type &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;s&quot;</span>, dev_property_get_name, <span class="literal">NULL</span>, dev_property_exists_name &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Alias&quot;</span>, <span class="string">&quot;s&quot;</span>, dev_property_get_alias, dev_property_set_alias &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Class&quot;</span>, <span class="string">&quot;u&quot;</span>, dev_property_get_class, <span class="literal">NULL</span>,</span><br><span class="line">					dev_property_exists_class &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Appearance&quot;</span>, <span class="string">&quot;q&quot;</span>, dev_property_get_appearance, <span class="literal">NULL</span>,</span><br><span class="line">					dev_property_exists_appearance &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Icon&quot;</span>, <span class="string">&quot;s&quot;</span>, dev_property_get_icon, <span class="literal">NULL</span>,</span><br><span class="line">					dev_property_exists_icon &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Paired&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_paired &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Bonded&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_bonded &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Trusted&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_trusted, dev_property_set_trusted &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Blocked&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_blocked, dev_property_set_blocked &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;LegacyPairing&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_legacy &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;RSSI&quot;</span>, <span class="string">&quot;n&quot;</span>, dev_property_get_rssi, <span class="literal">NULL</span>, dev_property_exists_rssi &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Connected&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_connected &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;UUIDs&quot;</span>, <span class="string">&quot;as&quot;</span>, dev_property_get_uuids &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Modalias&quot;</span>, <span class="string">&quot;s&quot;</span>, dev_property_get_modalias, <span class="literal">NULL</span>,</span><br><span class="line">						dev_property_exists_modalias &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Adapter&quot;</span>, <span class="string">&quot;o&quot;</span>, dev_property_get_adapter &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;ManufacturerData&quot;</span>, <span class="string">&quot;a&#123;qv&#125;&quot;</span>, dev_property_get_manufacturer_data,</span><br><span class="line">				<span class="literal">NULL</span>, dev_property_manufacturer_data_exist &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;ServiceData&quot;</span>, <span class="string">&quot;a&#123;sv&#125;&quot;</span>, dev_property_get_service_data,</span><br><span class="line">				<span class="literal">NULL</span>, dev_property_service_data_exist &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;TxPower&quot;</span>, <span class="string">&quot;n&quot;</span>, dev_property_get_tx_power, <span class="literal">NULL</span>,</span><br><span class="line">					dev_property_exists_tx_power &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;ServicesResolved&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_svc_resolved, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;AdvertisingFlags&quot;</span>, <span class="string">&quot;ay&quot;</span>, dev_property_get_flags, <span class="literal">NULL</span>,</span><br><span class="line">					dev_property_flags_exist &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;AdvertisingData&quot;</span>, <span class="string">&quot;a&#123;yv&#125;&quot;</span>, dev_property_get_advertising_data,</span><br><span class="line">				<span class="literal">NULL</span>, dev_property_advertising_data_exist &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;WakeAllowed&quot;</span>, <span class="string">&quot;b&quot;</span>, dev_property_get_wake_allowed,</span><br><span class="line">				dev_property_set_wake_allowed,</span><br><span class="line">				dev_property_wake_allowed_exist &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Sets&quot;</span>, <span class="string">&quot;a&#123;oa&#123;sv&#125;&#125;&quot;</span>, dev_property_get_set, <span class="literal">NULL</span>,</span><br><span class="line">				dev_property_set_exists &#125;,</span><br><span class="line">	&#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">struct</span> btd_device *<span class="title function_">device_new</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">char</span> *address)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> *address_up;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">device</span>;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *adapter_path = adapter_get_path(adapter);</span><br><span class="line"></span><br><span class="line">	DBG(<span class="string">&quot;address %s&quot;</span>, address);</span><br><span class="line"></span><br><span class="line">	device = g_try_malloc0(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> btd_device));</span><br><span class="line">	<span class="keyword">if</span> (device == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	device-&gt;tx_power = <span class="number">127</span>;</span><br><span class="line">	device-&gt;volume = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	device-&gt;db = gatt_db_new();</span><br><span class="line">	<span class="keyword">if</span> (!device-&gt;db) &#123;</span><br><span class="line">		g_free(device);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(device-&gt;ad_flags, INVALID_FLAGS, <span class="keyword">sizeof</span>(device-&gt;ad_flags));</span><br><span class="line"></span><br><span class="line">	device-&gt;ad = bt_ad_new();</span><br><span class="line">	<span class="keyword">if</span> (!device-&gt;ad) &#123;</span><br><span class="line">		device_free(device);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	address_up = g_ascii_strup(address, <span class="number">-1</span>);</span><br><span class="line">	device-&gt;path = g_strdup_printf(<span class="string">&quot;%s/dev_%s&quot;</span>, adapter_path, address_up);</span><br><span class="line">	g_strdelimit(device-&gt;path, <span class="string">&quot;:&quot;</span>, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">	g_free(address_up);</span><br><span class="line"></span><br><span class="line">	str2ba(address, &amp;device-&gt;bdaddr);</span><br><span class="line"></span><br><span class="line">	device-&gt;client_dbus = btd_gatt_client_new(device);</span><br><span class="line">	<span class="keyword">if</span> (!device-&gt;client_dbus) &#123;</span><br><span class="line">		error(<span class="string">&quot;Failed to create btd_gatt_client&quot;</span>);</span><br><span class="line">		device_free(device);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	DBG(<span class="string">&quot;Creating device %s&quot;</span>, device-&gt;path);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (g_dbus_register_interface(dbus_conn,</span><br><span class="line">					device-&gt;path, DEVICE_INTERFACE,</span><br><span class="line">					device_methods, <span class="literal">NULL</span>,</span><br><span class="line">					device_properties, device,</span><br><span class="line">					device_free) == FALSE) &#123;</span><br><span class="line">		error(<span class="string">&quot;Unable to register device interface for %s&quot;</span>, address);</span><br><span class="line">		device_free(device);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	device-&gt;adapter = adapter;</span><br><span class="line">	device-&gt;sirks = queue_new();</span><br><span class="line">	device-&gt;temporary = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	device-&gt;db_id = gatt_db_register(device-&gt;db, gatt_service_added,</span><br><span class="line">					gatt_service_removed, device, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	device-&gt;refresh_discovery = btd_opts.refresh_discovery;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> btd_device_ref(device);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•° <code>g_dbus_register_interface</code> ä¸ºè“ç‰™è®¾å¤‡æ³¨å†Œäº† <code>org.bluez.Device1</code> æœåŠ¡</p>
<p><strong>æ‰«ææ³¨æ„äº‹é¡¹ï¼š</strong></p>
<p>å‚è€ƒæ¥æºï¼š<a href="https://www.bluetooth.com/specifications/specs/core-specification-amended-5-4/">Core_amended_2024_06_11_v5.4.pdf</a></p>
<ul>
<li><p>æŸ¥è¯¢æ‰«æç±»å‹ï¼ˆinquiry scan typeï¼‰</p>
<p>Inquiry_Scan_Type é…ç½®å‚æ•°æŒ‡ç¤ºæŸ¥è¯¢æ‰«ææ˜¯å¦ä½¿ç”¨ééš”è¡Œæ‰«ææˆ–éš”è¡Œæ‰«æè¿›è¡Œã€‚ç›®å‰ï¼Œå®šä¹‰äº†ä¸€ç§å¼ºåˆ¶æŸ¥è¯¢æ‰«æç±»å‹å’Œä¸€ç§å¯é€‰æŸ¥è¯¢æ‰«æç±»å‹ã€‚</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/image-20241023191822349.png" alt="image-20241023191822349"></p>
</li>
<li><p>æŸ¥è¯¢æ‰«æçª—å£ï¼ˆinquiry scan windowï¼‰ï¼šæŒç»­æ‰«ææŸ¥è¯¢çš„æ—¶é—´ï¼Œå¿…é¡»å°äºæˆ–ç­‰äºæ‰«æé—´éš”ã€‚å–å€¼èŒƒå›´ï¼š0x0011 ~ 0x1000ï¼Œè½¬åŒ–ä¸ºæ—¶é—´å•ä½èŒƒå›´ï¼š10.625 ms ~ 2560 msï¼Œé»˜è®¤å€¼ï¼š0x0012ï¼ˆ11.25msï¼‰</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/image-20241008212348333.png" alt="image-20241008212348333"></p>
<p><em>æ³¨æ„ï¼šä¸€ä¸ªæ‰«æçª—å£å¹¶ä¸ä¼šæ‰«ææ‰€æœ‰çš„40ä¸ªå°„é¢‘é€šé“ï¼Œå®Œå…¨å–å†³äºç¡¬ä»¶åº•å±‚å®ç°ã€‚</em></p>
</li>
<li><p>æŸ¥è¯¢æ‰«æé—´éš”ï¼ˆinquiry scan intervalï¼‰ï¼šä»ä¸Šä¸€æ¬¡æ‰«ææŸ¥è¯¢å¼€å§‹æ‰«ä¸‹ä¸€æ¬¡æ‰«ææŸ¥è¯¢å¼€å§‹çš„æ—¶é—´é—´éš”ã€‚å–å€¼èŒƒå›´ï¼š0x0012 ~ 0x1000ï¼Œè½¬åŒ–ä¸ºæ—¶é—´å•ä½èŒƒå›´ï¼š11.25 ms ~ 2560 msï¼Œé»˜è®¤å€¼ï¼š0x1000ï¼ˆ2560msï¼‰ </p>
<p>Inquiry_Scan_Interval é…ç½®å‚æ•°å®šä¹‰è¿ç»­æŸ¥è¯¢æ‰«æä¹‹é—´çš„æ—¶é—´é‡ã€‚è¿™å®šä¹‰ä¸ºä» BR&#x2F;EDR æ§åˆ¶å™¨å¼€å§‹å…¶ä¸Šä¸€æ¬¡æŸ¥è¯¢æ‰«æåˆ°å¼€å§‹ä¸‹ä¸€æ¬¡æŸ¥è¯¢æ‰«æçš„æ—¶é—´é—´éš”</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/image-20241008212407775.png" alt="image-20241008212407775"></p>
</li>
<li><p>é¡µæ‰«æé—´éš”ï¼ˆpage scan intervalï¼‰ï¼šPage_Scan_Interval é…ç½®å‚æ•°å®šä¹‰è¿ç»­é¡µé¢æ‰«æä¹‹é—´çš„æ—¶é—´é‡ã€‚æ­¤æ—¶é—´é—´éš”å®šä¹‰ä¸ºä»æ§åˆ¶å™¨å¼€å§‹å…¶ä¸Šä¸€æ¬¡é¡µé¢æ‰«æåˆ°å¼€å§‹ä¸‹ä¸€æ¬¡é¡µé¢æ‰«æçš„æ—¶é—´ã€‚</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/image-20241023193938906.png" alt="image-20241023193938906"></p>
</li>
<li><p>é¡µæ‰«æçª—å£ï¼ˆpage scan windowï¼‰ï¼šPage_Scan_Window é…ç½®å‚æ•°å®šä¹‰é¡µé¢æ‰«æçš„æŒç»­æ—¶é—´ã€‚Page_Scan_Window åªèƒ½å°äºæˆ–ç­‰äº Page_Scan_Intervalã€‚</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/image-20241023194040460.png" alt="image-20241023194040460"></p>
</li>
</ul>
<p>æ‰«æçª—å£å’Œæ‰«æé—´éš”çš„å…³ç³»ï¼š</p>
<p><img src="/2024/09/25/2024/bluetoothd-source-file-reading/1bb9cc19d90e21a6df65dd230d9a0020.png"></p>
<p>å…¶ä»–å­¦ä¹ å‚è€ƒ<a href="https://www.ebyte.com/news/1369.html#:~:text=%E6%89%AB%E6%8F%8F%E5%8F%82%E6%95%B0%E6%98%AF%E8%93%9D%E7%89%99%E4%B8%BB%E6%9C%BA%E8%AE%BE">BLEè®¾å¤‡åŠŸè€—å¤ªé«˜ï¼Ÿå¼„æ‡‚è¿™å‡ ä¸ªå‚æ•°ï¼ŒåŠŸè€—æƒ³ä¸é™éƒ½éš¾</a></p>
<p><strong>æ‰«æå‚æ•°</strong></p>
<p>åœ¨ main.conf é…ç½®æ–‡ä»¶ä¸­æ¶‰åŠåˆ°bredr å’Œ le çš„æ‰«æå‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[BT]</span><br><span class="line"># BR/EDR Inquiry scan activity configuration</span><br><span class="line">#InquiryScanType=</span><br><span class="line">#InquiryScanInterval=</span><br><span class="line">#InquiryScanWindow=</span><br><span class="line"></span><br><span class="line">[LE]</span><br><span class="line"># LE scanning parameters used for active scanning supporting discovery</span><br><span class="line"># proceedure</span><br><span class="line">#ScanIntervalDiscovery=</span><br><span class="line">#ScanWindowDiscovery=</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨src&#x2F;main.c ä¸­è‹¥ç”¨æˆ·æ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚main.confï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šç»™å®šä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<p>é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼Œè¦†ç›–é»˜è®¤æ‰«æå‚æ•°ï¼š</p>
<ul>
<li>LEæ‰«æå‚æ•°èŒƒå›´</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ScanIntervalDiscovery&quot;</span>,</span><br><span class="line">		  &amp;btd_opts.defaults.le.scan_interval_discovery,</span><br><span class="line">		  <span class="keyword">sizeof</span>(btd_opts.defaults.le.scan_interval_discovery),</span><br><span class="line">		  <span class="number">0x0004</span>,</span><br><span class="line">		  <span class="number">0x4000</span>&#125;,</span><br><span class="line">&#123; <span class="string">&quot;ScanWindowDiscovery&quot;</span>,</span><br><span class="line">		  &amp;btd_opts.defaults.le.scan_win_discovery,</span><br><span class="line">		  <span class="keyword">sizeof</span>(btd_opts.defaults.le.scan_win_discovery),</span><br><span class="line">		  <span class="number">0x0004</span>,</span><br><span class="line">		  <span class="number">0x4000</span>&#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>BREDRæ‰«æå‚æ•°èŒƒå›´</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123; <span class="string">&quot;InquiryScanType&quot;</span>,</span><br><span class="line">		  &amp;btd_opts.defaults.br.scan_type,</span><br><span class="line">		  <span class="keyword">sizeof</span>(btd_opts.defaults.br.scan_type),</span><br><span class="line">		  <span class="number">0</span>,</span><br><span class="line">		  <span class="number">1</span>&#125;,</span><br><span class="line">&#123; <span class="string">&quot;InquiryScanInterval&quot;</span>,</span><br><span class="line">		  &amp;btd_opts.defaults.br.scan_interval,</span><br><span class="line">		  <span class="keyword">sizeof</span>(btd_opts.defaults.br.scan_interval),</span><br><span class="line">		  <span class="number">0x0012</span>,</span><br><span class="line">		  <span class="number">0x1000</span>&#125;,</span><br><span class="line">&#123; <span class="string">&quot;InquiryScanWindow&quot;</span>,</span><br><span class="line">		  &amp;btd_opts.defaults.br.scan_win,</span><br><span class="line">		  <span class="keyword">sizeof</span>(btd_opts.defaults.br.scan_win),</span><br><span class="line">		  <span class="number">0x0011</span>,</span><br><span class="line">		  <span class="number">0x1000</span>&#125;,</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>bluez</tag>
        <tag>bluetoothd</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetoothd: device cache</title>
    <url>/2024/09/23/2024/bluetoothd-device-cache/</url>
    <content><![CDATA[<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>å…³äºè“ç‰™æ•°æ®çš„å­˜å‚¨ï¼Œåœ¨bluezçš„docç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼ˆ<a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/settings-storage.txt">settings-storage.txt</a>ï¼‰ä½œå‡ºäº†è¯´æ˜ã€‚</p>
<blockquote>
<p>Adapter and remote device info are read form the storage during object initialization. Write to storage is performed immediately on every value<br>change.</p>
<p>Default storage directory is &#x2F;var&#x2F;lib&#x2F;bluetooth. This can be adjusted by the â€“localstatedir configure switch. Default is â€“localstatedir&#x3D;&#x2F;var.</p>
</blockquote>
<p>ç¿»è¯‘ï¼šåœ¨å¯¹è±¡åˆå§‹åŒ–æœŸé—´ï¼Œä»å­˜å‚¨ä¸­è¯»å–é€‚é…å™¨å’Œè¿œç¨‹è®¾å¤‡ä¿¡æ¯ã€‚æ¯æ¬¡å€¼æ›´æ”¹æ—¶éƒ½ä¼šç«‹å³å†™å…¥å­˜å‚¨ã€‚é»˜è®¤å­˜å‚¨ç›®å½•ä¸º <code>/var/lib/bluetooth</code>ã€‚å¯ä»¥é€šè¿‡ â€“localstatedir é…ç½®å¼€å…³è¿›è¡Œè°ƒæ•´ã€‚é»˜è®¤å€¼ä¸º <code>--localstatedir=/var</code>ã€‚</p>
<p><strong>é¦–æ¬¡è¿è¡Œbluetoothdçš„å­˜å‚¨ç›®å½•ç»“æ„ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tree bluetooth</span><br><span class="line">bluetooth/</span><br><span class="line">â””â”€â”€ 40:80:E1:50:1D:47</span><br><span class="line">    â”œâ”€â”€ attributes</span><br><span class="line">    â””â”€â”€ settings</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼š<code>40:80:E1:50:1D:47</code>æ˜¯æœ¬åœ°è“ç‰™é€‚é…å™¨çš„MACåœ°å€ä½œä¸ºç›®å½•åç§°ã€‚è‹¥æœ¬åœ°å­˜åœ¨å¤šä¸ªè“ç‰™é€‚é…å™¨ï¼Œé‚£ä¹ˆå°±æœ‰å¤šä¸ªè¿™æ ·çš„ç›®å½•ã€‚</em></p>
<p><strong>æ‰§è¡Œæ‰«æã€é…å¯¹ã€è¿æ¥åçš„å­˜å‚¨ç›®å½•ç»“æ„ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bluetooth/</span><br><span class="line">â””â”€â”€ 40:80:E1:50:1D:47</span><br><span class="line">    â”œâ”€â”€ attributes</span><br><span class="line">    â”œâ”€â”€ cache</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 08:F0:B6:58:2E:90</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 18:C2:3C:31:3C:3A</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 23:07:04:00:03:C0</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 3A:29:EC:03:27:D0</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 44:17:93:CD:E4:36</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 60:F4:3A:A6:4D:E1</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 64:68:76:FC:B5:E3</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 88:4A:18:88:9F:F5</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 8C:F6:81:FC:9D:F1</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 90:F0:52:BE:DC:6E</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ 98:8D:46:1A:60:20</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ AC:D8:29:09:18:B6</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ B4:8C:9D:06:D4:83</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ B8:14:4D:73:52:99</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ C8:94:02:E1:6D:C4</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ D0:62:2C:13:2E:8F</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ E4:19:C1:E4:35:21</span><br><span class="line">    â”‚Â Â  â””â”€â”€ F4:4E:FD:7A:71:09</span><br><span class="line">    â”œâ”€â”€ F4:4E:FD:7A:71:09</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ attributes</span><br><span class="line">    â”‚Â Â  â””â”€â”€ info</span><br><span class="line">    â””â”€â”€ settings</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šæ‰§è¡Œæ‰«ææ“ä½œåï¼Œ<code>cache</code> ç›®å½•å°±è¢«åˆ›å»ºï¼ŒåŒæ—¶æ‰«æåˆ°çš„è“ç‰™è®¾å¤‡ä¹Ÿä¼šä»¥å…¶MACåœ°å€åç§°ä½œä¸ºæ–‡ä»¶åã€‚è‹¥é…å¯¹ã€è¿æ¥æŒ‡å®šè“ç‰™è®¾å¤‡æˆåŠŸåï¼Œåˆ™ä¼šåˆ›å»ºä»¥å…¶MACåœ°å€åç§°ä½œä¸ºç›®å½•åï¼Œè€Œä¸”è¯¥ç›®å½•ä¸‹ä¹Ÿä¼šåˆ›å»º attribute å’Œ infoä¸¤ä¸ªæ–‡ä»¶ã€‚</em></p>
<p>cacheç›®å½•ä¸‹è“ç‰™è®¾å¤‡æ–‡ä»¶è¢«åˆ›å»ºçš„ä½ç½®ï¼Œé€šè¿‡device_store_cached_name()å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">device_store_cached_name</span><span class="params">(<span class="keyword">struct</span> btd_device *dev, <span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> filename[PATH_MAX];</span><br><span class="line">	<span class="type">char</span> d_addr[<span class="number">18</span>];</span><br><span class="line">	GKeyFile *key_file;</span><br><span class="line">	GError *gerr = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">char</span> *data;</span><br><span class="line">	<span class="type">char</span> *data_old;</span><br><span class="line">	gsize length = <span class="number">0</span>;</span><br><span class="line">	gsize length_old = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (device_address_is_private(dev)) &#123;</span><br><span class="line">		DBG(<span class="string">&quot;Can&#x27;t store name for private addressed device %s&quot;</span>,</span><br><span class="line">								dev-&gt;path);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ba2str(&amp;dev-&gt;bdaddr, d_addr);</span><br><span class="line">	create_filename(filename, PATH_MAX, <span class="string">&quot;/%s/cache/%s&quot;</span>,</span><br><span class="line">			btd_adapter_get_storage_dir(dev-&gt;adapter), d_addr);</span><br><span class="line">	create_file(filename, <span class="number">0600</span>);</span><br><span class="line"></span><br><span class="line">	key_file = g_key_file_new();</span><br><span class="line">	<span class="keyword">if</span> (!g_key_file_load_from_file(key_file, filename, <span class="number">0</span>, &amp;gerr)) &#123;</span><br><span class="line">		error(<span class="string">&quot;Unable to load key file from %s: (%s)&quot;</span>, filename,</span><br><span class="line">								gerr-&gt;message);</span><br><span class="line">		g_clear_error(&amp;gerr);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	data_old = g_key_file_to_data(key_file, &amp;length_old, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	g_key_file_set_string(key_file, <span class="string">&quot;General&quot;</span>, <span class="string">&quot;Name&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">	data = g_key_file_to_data(key_file, &amp;length, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((length != length_old) || (<span class="built_in">memcmp</span>(data, data_old, length))) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!g_file_set_contents(filename, data, length, &amp;gerr)) &#123;</span><br><span class="line">			error(<span class="string">&quot;Unable set contents for %s: (%s)&quot;</span>, filename,</span><br><span class="line">								gerr-&gt;message);</span><br><span class="line">			g_clear_error(&amp;gerr);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	g_free(data);</span><br><span class="line">	g_free(data_old);</span><br><span class="line"></span><br><span class="line">	g_key_file_free(key_file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="settingsæ–‡ä»¶"><a href="#settingsæ–‡ä»¶" class="headerlink" title="settingsæ–‡ä»¶"></a>settingsæ–‡ä»¶</h3><p>settingsæ–‡ä»¶åŒ…å«äº†é€‚é…å™¨çš„ä¸€ä¸ªç»„çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[General]</span><br><span class="line">Discoverable=<span class="literal">false</span></span><br><span class="line">Alias=SCO_AUDIO1</span><br></pre></td></tr></table></figure>

<ul>
<li>Aliasï¼šé€‚é…å™¨çš„åˆ«åï¼Œé»˜è®¤å€¼æ˜¯ä¸»æœºå</li>
<li>Discoverableï¼šé€‚é…å™¨çš„å¯è¢«å‘ç°çš„å±æ€§</li>
</ul>
<p>settingsæ–‡ä»¶ä»¥åŠå†…å®¹è¢«åˆ›å»ºä½ç½®ï¼Œé€šè¿‡ <code>src/adapter.c</code> ä¸­çš„store_adapter_info()å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">store_adapter_info</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter)</span></span><br><span class="line">&#123;</span><br><span class="line">	GKeyFile *key_file;</span><br><span class="line">	GError *gerr = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">char</span> filename[PATH_MAX];</span><br><span class="line">	<span class="type">char</span> *str;</span><br><span class="line">	gsize length = <span class="number">0</span>;</span><br><span class="line">	gboolean discoverable;</span><br><span class="line"></span><br><span class="line">	key_file = g_key_file_new();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (adapter-&gt;pairable_timeout != btd_opts.pairto)</span><br><span class="line">		g_key_file_set_integer(key_file, <span class="string">&quot;General&quot;</span>, <span class="string">&quot;PairableTimeout&quot;</span>,</span><br><span class="line">					adapter-&gt;pairable_timeout);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((adapter-&gt;current_settings &amp; MGMT_SETTING_DISCOVERABLE) &amp;&amp;</span><br><span class="line">						!adapter-&gt;discoverable_timeout)</span><br><span class="line">		discoverable = TRUE;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		discoverable = FALSE;</span><br><span class="line"></span><br><span class="line">	g_key_file_set_boolean(key_file, <span class="string">&quot;General&quot;</span>, <span class="string">&quot;Discoverable&quot;</span>,</span><br><span class="line">							discoverable);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (adapter-&gt;discoverable_timeout != btd_opts.discovto)</span><br><span class="line">		g_key_file_set_integer(key_file, <span class="string">&quot;General&quot;</span>,</span><br><span class="line">					<span class="string">&quot;DiscoverableTimeout&quot;</span>,</span><br><span class="line">					adapter-&gt;discoverable_timeout);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (adapter-&gt;stored_alias)</span><br><span class="line">		g_key_file_set_string(key_file, <span class="string">&quot;General&quot;</span>, <span class="string">&quot;Alias&quot;</span>,</span><br><span class="line">							adapter-&gt;stored_alias);</span><br><span class="line"></span><br><span class="line">	create_filename(filename, PATH_MAX, <span class="string">&quot;/%s/settings&quot;</span>,</span><br><span class="line">					btd_adapter_get_storage_dir(adapter));</span><br><span class="line">	create_file(filename, <span class="number">0600</span>);</span><br><span class="line"></span><br><span class="line">	str = g_key_file_to_data(key_file, &amp;length, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (!g_file_set_contents(filename, str, length, &amp;gerr)) &#123;</span><br><span class="line">		error(<span class="string">&quot;Unable set contents for %s: (%s)&quot;</span>, filename,</span><br><span class="line">								gerr-&gt;message);</span><br><span class="line">		g_error_free(gerr);</span><br><span class="line">	&#125;</span><br><span class="line">	g_free(str);</span><br><span class="line"></span><br><span class="line">	g_key_file_free(key_file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="infoæ–‡ä»¶"><a href="#infoæ–‡ä»¶" class="headerlink" title="infoæ–‡ä»¶"></a>infoæ–‡ä»¶</h3><p>infoæ–‡ä»¶åŒ…å«äº†ä¸è“ç‰™è®¾å¤‡å…³è”çš„å¤šç»„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[General]</span><br><span class="line">Name=JBL ROCK</span><br><span class="line">Class=0x240404</span><br><span class="line">SupportedTechnologies=BR/EDR;</span><br><span class="line">Trusted=<span class="literal">false</span></span><br><span class="line">Blocked=<span class="literal">false</span></span><br><span class="line">Services=0000110b-0000-1000-8000-00805f9b34fb;0000110c-0000-1000-8000-00805f9b34fb;0000110e-0000-1000-8000-00805f9b34fb;0000111e-0000-1000-8000-00805f9b34fb;</span><br><span class="line"></span><br><span class="line">[LinkKey]</span><br><span class="line">Key=2BB06C500CC2926271D2B31687931BFF</span><br><span class="line">Type=4</span><br><span class="line">PINLength=0</span><br></pre></td></tr></table></figure>

<p>infoæ–‡ä»¶çš„åˆ›å»ºä½ç½®ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">store_link_key</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">				<span class="keyword">struct</span> btd_device *device, <span class="type">const</span> <span class="type">uint8_t</span> *key,</span></span><br><span class="line"><span class="params">				<span class="type">uint8_t</span> type, <span class="type">uint8_t</span> pin_length)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> device_addr[<span class="number">18</span>];</span><br><span class="line">	<span class="type">char</span> filename[PATH_MAX];</span><br><span class="line">	GKeyFile *key_file;</span><br><span class="line">	GError *gerr = <span class="literal">NULL</span>;</span><br><span class="line">	gsize length = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> key_str[<span class="number">33</span>];</span><br><span class="line">	<span class="type">char</span> *str;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	ba2str(device_get_address(device), device_addr);</span><br><span class="line"></span><br><span class="line">	create_filename(filename, PATH_MAX, <span class="string">&quot;/%s/%s/info&quot;</span>,</span><br><span class="line">			btd_adapter_get_storage_dir(adapter), device_addr);</span><br><span class="line">	create_file(filename, <span class="number">0600</span>);</span><br><span class="line"></span><br><span class="line">	key_file = g_key_file_new();</span><br><span class="line">	<span class="keyword">if</span> (!g_key_file_load_from_file(key_file, filename, <span class="number">0</span>, &amp;gerr)) &#123;</span><br><span class="line">		error(<span class="string">&quot;Unable to load key file from %s: (%s)&quot;</span>, filename,</span><br><span class="line">								gerr-&gt;message);</span><br><span class="line">		g_error_free(gerr);</span><br><span class="line">		g_key_file_free(key_file);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">		<span class="built_in">sprintf</span>(key_str + (i * <span class="number">2</span>), <span class="string">&quot;%2.2X&quot;</span>, key[i]);</span><br><span class="line"></span><br><span class="line">	g_key_file_set_string(key_file, <span class="string">&quot;LinkKey&quot;</span>, <span class="string">&quot;Key&quot;</span>, key_str);</span><br><span class="line"></span><br><span class="line">	g_key_file_set_integer(key_file, <span class="string">&quot;LinkKey&quot;</span>, <span class="string">&quot;Type&quot;</span>, type);</span><br><span class="line">	g_key_file_set_integer(key_file, <span class="string">&quot;LinkKey&quot;</span>, <span class="string">&quot;PINLength&quot;</span>, pin_length);</span><br><span class="line"></span><br><span class="line">	str = g_key_file_to_data(key_file, &amp;length, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (!g_file_set_contents(filename, str, length, &amp;gerr)) &#123;</span><br><span class="line">		error(<span class="string">&quot;Unable set contents for %s: (%s)&quot;</span>, filename,</span><br><span class="line">								gerr-&gt;message);</span><br><span class="line">		g_error_free(gerr);</span><br><span class="line">	&#125;</span><br><span class="line">	g_free(str);</span><br><span class="line"></span><br><span class="line">	g_key_file_free(key_file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ–¹æ³•å®ç°"><a href="#æ–¹æ³•å®ç°" class="headerlink" title="æ–¹æ³•å®ç°"></a>æ–¹æ³•å®ç°</h2><p>åœ¨ <code>org.bluez.Adapter1</code> æ¥å£æ–‡æ¡£ä¸­æä¾›äº†ä¸‰ä¸ªæ¥å£å‡½æ•°ï¼š</p>
<ul>
<li>StartDiscovery()</li>
<li>StopDiscovery()</li>
<li>RemoveDevice()</li>
</ul>
<p>å½“ <code>StartDiscovery()</code> å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œcacheç›®å½•ä¸‹å°±ä¼šæœ‰æ–°çš„è“ç‰™è®¾å¤‡æ–‡ä»¶è¢«åˆ›å»ºï¼Œè€Œå½“ <code>StopDiscovery()</code> å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œcacheç›®å½•ä¸‹å°±ä¼šæœ‰è“ç‰™è®¾å¤‡æ–‡ä»¶è¢«åˆ é™¤ï¼Œ<code>RemoveDevice()</code> å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œ<code>&lt;controller address&gt;</code> ç›®å½•ä¸‹æœ‰å·²é…å¯¹æˆ–å·²è¿æ¥è¿‡çš„è“ç‰™è®¾å¤‡æ–‡ä»¶å¤¹ä¼šè¢«åˆ é™¤ã€‚</p>
<p><em>æ³¨æ„ï¼šå½“è“ç‰™è®¾å¤‡è¢«è‡ªåŠ¨ç§»é™¤æ—¶ï¼Œcacheç›®å½•çš„è“ç‰™è®¾å¤‡æ–‡ä»¶éƒ¨åˆ†è¿˜æ˜¯ä¿ç•™ï¼Œä¸ºä»€ä¹ˆä¼šä¿ç•™å‘¢ï¼Ÿ</em></p>
<p><code>src/adapter.c</code> å…³äºé€‚é…å™¨ç›¸å…³çš„æ–¹æ³•å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€‚é…å™¨æ³¨å†Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> GDBusMethodTable adapter_methods[] = &#123;</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;StartDiscovery&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, start_discovery) &#125;,</span><br><span class="line">	&#123; GDBUS_METHOD(<span class="string">&quot;SetDiscoveryFilter&quot;</span>,</span><br><span class="line">				GDBUS_ARGS(&#123; <span class="string">&quot;properties&quot;</span>, <span class="string">&quot;a&#123;sv&#125;&quot;</span> &#125;), <span class="literal">NULL</span>,</span><br><span class="line">				set_discovery_filter) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;StopDiscovery&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, stop_discovery) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;RemoveDevice&quot;</span>,</span><br><span class="line">			GDBUS_ARGS(&#123; <span class="string">&quot;device&quot;</span>, <span class="string">&quot;o&quot;</span> &#125;), <span class="literal">NULL</span>, remove_device) &#125;,</span><br><span class="line">	&#123; GDBUS_METHOD(<span class="string">&quot;GetDiscoveryFilters&quot;</span>, <span class="literal">NULL</span>,</span><br><span class="line">			GDBUS_ARGS(&#123; <span class="string">&quot;filters&quot;</span>, <span class="string">&quot;as&quot;</span> &#125;),</span><br><span class="line">			get_discovery_filters) &#125;,</span><br><span class="line">	&#123; GDBUS_EXPERIMENTAL_ASYNC_METHOD(<span class="string">&quot;ConnectDevice&quot;</span>,</span><br><span class="line">				GDBUS_ARGS(&#123; <span class="string">&quot;properties&quot;</span>, <span class="string">&quot;a&#123;sv&#125;&quot;</span> &#125;), <span class="literal">NULL</span>,</span><br><span class="line">				connect_device) &#125;,</span><br><span class="line">	&#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‚é…å™¨æ³¨å†Œçš„å±æ€§</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> GDBusPropertyTable adapter_properties[] = &#123;</span><br><span class="line">	&#123; <span class="string">&quot;Address&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_address &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;AddressType&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_address_type &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Name&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_name &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Alias&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_alias, property_set_alias &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Class&quot;</span>, <span class="string">&quot;u&quot;</span>, property_get_class &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Powered&quot;</span>, <span class="string">&quot;b&quot;</span>, property_get_powered, property_set_powered &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;PowerState&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_power_state &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Discoverable&quot;</span>, <span class="string">&quot;b&quot;</span>, property_get_discoverable,</span><br><span class="line">					property_set_discoverable &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;DiscoverableTimeout&quot;</span>, <span class="string">&quot;u&quot;</span>, property_get_discoverable_timeout,</span><br><span class="line">					property_set_discoverable_timeout &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Pairable&quot;</span>, <span class="string">&quot;b&quot;</span>, property_get_pairable, property_set_pairable &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;PairableTimeout&quot;</span>, <span class="string">&quot;u&quot;</span>, property_get_pairable_timeout,</span><br><span class="line">					property_set_pairable_timeout &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Discovering&quot;</span>, <span class="string">&quot;b&quot;</span>, property_get_discovering &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;UUIDs&quot;</span>, <span class="string">&quot;as&quot;</span>, property_get_uuids &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Modalias&quot;</span>, <span class="string">&quot;s&quot;</span>, property_get_modalias, <span class="literal">NULL</span>,</span><br><span class="line">					property_exists_modalias &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Roles&quot;</span>, <span class="string">&quot;as&quot;</span>, property_get_roles &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;ExperimentalFeatures&quot;</span>, <span class="string">&quot;as&quot;</span>, property_get_experimental, <span class="literal">NULL</span>,</span><br><span class="line">					property_experimental_exists &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Manufacturer&quot;</span>, <span class="string">&quot;q&quot;</span>, property_get_manufacturer &#125;,</span><br><span class="line">	&#123; <span class="string">&quot;Version&quot;</span>, <span class="string">&quot;y&quot;</span>, property_get_version &#125;,</span><br><span class="line">	&#123; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="StartDiscoveryæ–¹æ³•çš„å®ç°"><a href="#StartDiscoveryæ–¹æ³•çš„å®ç°" class="headerlink" title="StartDiscoveryæ–¹æ³•çš„å®ç°"></a>StartDiscoveryæ–¹æ³•çš„å®ç°</h3><p>åœ¨src&#x2F;adapter.cç»™å‡ºäº†StartDiscoveryæ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> DBusMessage *<span class="title function_">start_discovery</span><span class="params">(DBusConnection *conn,</span></span><br><span class="line"><span class="params">					DBusMessage *msg, <span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_adapter</span> *<span class="title">adapter</span> =</span> user_data;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *sender = dbus_message_get_sender(msg);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">discovery_client</span> *<span class="title">client</span>;</span></span><br><span class="line">	<span class="type">bool</span> is_discovering;</span><br><span class="line">	<span class="type">int</span> err;</span><br><span class="line"></span><br><span class="line">	DBG(<span class="string">&quot;sender %s&quot;</span>, sender);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!btd_adapter_get_powered(adapter))</span><br><span class="line">		<span class="keyword">return</span> btd_error_not_ready(msg);</span><br><span class="line"></span><br><span class="line">	is_discovering = get_discovery_client(adapter, sender, &amp;client);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Every client can only start one discovery, if the client</span></span><br><span class="line"><span class="comment">	 * already started a discovery then return an error.</span></span><br><span class="line"><span class="comment">	 * æ¯ä¸€ä¸ªå®¢æˆ·ç«¯ä»…èƒ½å¯åŠ¨ä¸€æ¬¡æ‰«æï¼Œå¦‚æœå®¢æˆ·ç«¯æ—©å·²å¯åŠ¨äº†æ‰«æï¼Œé‚£ä¹ˆæ­¤æ—¶è¿”å›ä¸€ä¸ªé”™è¯¯</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (is_discovering)</span><br><span class="line">		<span class="keyword">return</span> btd_error_busy(msg);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there was pre-set filter, just reconnect it to discovery_list,</span></span><br><span class="line"><span class="comment">	 * and trigger scan.</span></span><br><span class="line"><span class="comment">	 * å¦‚æœæœ‰é¢„è®¾ç½®çš„è¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆåªæ˜¯åˆ°æ‰«æåˆ—è¡¨å»é‡è¿å®ƒå¹¶è§¦å‘æ‰«æ</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (client) &#123;</span><br><span class="line">		<span class="keyword">if</span> (client-&gt;msg)</span><br><span class="line">			<span class="keyword">return</span> btd_error_busy(msg);</span><br><span class="line"></span><br><span class="line">		adapter-&gt;set_filter_list = g_slist_remove(</span><br><span class="line">					     adapter-&gt;set_filter_list, client);</span><br><span class="line">		adapter-&gt;discovery_list = g_slist_prepend(</span><br><span class="line">					      adapter-&gt;discovery_list, client);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">goto</span> done;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	client = g_new0(<span class="keyword">struct</span> discovery_client, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	client-&gt;adapter = adapter;</span><br><span class="line">	client-&gt;owner = g_strdup(sender);</span><br><span class="line">	client-&gt;discovery_filter = <span class="literal">NULL</span>;</span><br><span class="line">	client-&gt;watch = g_dbus_add_disconnect_watch(dbus_conn, sender,</span><br><span class="line">						discovery_disconnect, client,</span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line">	adapter-&gt;discovery_list = g_slist_prepend(adapter-&gt;discovery_list,</span><br><span class="line">								client);</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Just trigger the discovery here. In case an already running</span></span><br><span class="line"><span class="comment">	 * discovery in idle phase exists, it will be restarted right</span></span><br><span class="line"><span class="comment">	 * away.</span></span><br><span class="line"><span class="comment">	 * åªéœ€åœ¨æ­¤å¤„è§¦å‘æ‰«æã€‚å¦‚æœå­˜åœ¨åœ¨ç©ºé—²æ®µè¿è¡Œçš„å‘ç°ï¼Œå®ƒå°†ç«‹å³é‡æ–°å¯åŠ¨æ‰«æã€‚</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	err = update_discovery_filter(adapter);</span><br><span class="line">	<span class="keyword">if</span> (!err)</span><br><span class="line">		<span class="keyword">return</span> dbus_message_new_method_return(msg);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* If the discovery has to be started wait it complete to reply */</span></span><br><span class="line">	<span class="keyword">if</span> (err == -EINPROGRESS) &#123;</span><br><span class="line">		client-&gt;msg = dbus_message_ref(msg);</span><br><span class="line">		adapter-&gt;client = client;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> btd_error_failed(msg, strerror(-err));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="RemoveDeviceæ–¹æ³•çš„å®ç°"><a href="#RemoveDeviceæ–¹æ³•çš„å®ç°" class="headerlink" title="RemoveDeviceæ–¹æ³•çš„å®ç°"></a>RemoveDeviceæ–¹æ³•çš„å®ç°</h3><p>åœ¨src&#x2F;adapter.cç»™å‡ºäº†RemoveDeviceæ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RemoveDeviceæ–¹æ³•çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="type">static</span> DBusMessage *<span class="title function_">remove_device</span><span class="params">(DBusConnection *conn,</span></span><br><span class="line"><span class="params">					DBusMessage *msg, <span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_adapter</span> *<span class="title">adapter</span> =</span> user_data;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">device</span>;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *path;</span><br><span class="line">	GSList *<span class="built_in">list</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// RemoveDeviceæ–¹æ³•ä¼ é€’çš„å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªè·¯å¾„å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">if</span> (dbus_message_get_args(msg, <span class="literal">NULL</span>, DBUS_TYPE_OBJECT_PATH, &amp;path,</span><br><span class="line">						DBUS_TYPE_INVALID) == FALSE)</span><br><span class="line">		<span class="keyword">return</span> btd_error_invalid_args(msg);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›®æ ‡è“ç‰™è®¾å¤‡</span></span><br><span class="line">	<span class="built_in">list</span> = g_slist_find_custom(adapter-&gt;devices, path, device_path_cmp);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">list</span>)</span><br><span class="line">		<span class="keyword">return</span> btd_error_does_not_exist(msg);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// åˆ¤æ–­é€‚é…å™¨Poweredæ˜¯å¦ä¸ºTRUEï¼Œè‹¥ä¸ºFALSEï¼Œåˆ™æ‰§è¡ŒèŠ±æ‹¬å·é‡Œé¢çš„å†…å®¹ã€‚</span></span><br><span class="line">	<span class="keyword">if</span> (!btd_adapter_get_powered(adapter))</span><br><span class="line">		<span class="keyword">return</span> btd_error_not_ready(msg);</span><br><span class="line"></span><br><span class="line">	device = <span class="built_in">list</span>-&gt;data;</span><br><span class="line"></span><br><span class="line">	btd_device_set_temporary(device, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­Deviceæ˜¯å¦connectedä¸ºTRUEï¼Œè‹¥ä¸ºFALSEï¼Œåˆ™æ‰§è¡ŒèŠ±æ‹¬å·é‡Œé¢çš„å†…å®¹ã€‚</span></span><br><span class="line">	<span class="keyword">if</span> (!btd_device_is_connected(device)) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// é€‚é…å™¨ç§»é™¤è“ç‰™è®¾å¤‡ï¼Œç„¶åæ„é€ ä¸€æ¡æ¶ˆæ¯ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„åº”ç­”</span></span><br><span class="line">		btd_adapter_remove_device(adapter, device);</span><br><span class="line">		<span class="keyword">return</span> dbus_message_new_method_return(msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¯·æ±‚æ–­å¼€ç›®æ ‡è“ç‰™è®¾å¤‡çš„è¿æ¥</span></span><br><span class="line">	device_request_disconnect(device, msg);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="StopDiscoveryæ–¹æ³•çš„å®ç°"><a href="#StopDiscoveryæ–¹æ³•çš„å®ç°" class="headerlink" title="StopDiscoveryæ–¹æ³•çš„å®ç°"></a>StopDiscoveryæ–¹æ³•çš„å®ç°</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// StopDiscoveryæ–¹æ³•çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="type">static</span> DBusMessage *<span class="title function_">stop_discovery</span><span class="params">(DBusConnection *conn,</span></span><br><span class="line"><span class="params">					DBusMessage *msg, <span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_adapter</span> *<span class="title">adapter</span> =</span> user_data;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *sender = dbus_message_get_sender(msg);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">discovery_client</span> *<span class="title">client</span>;</span></span><br><span class="line">	GSList *<span class="built_in">list</span>;</span><br><span class="line">	<span class="type">int</span> err;</span><br><span class="line"></span><br><span class="line">	DBG(<span class="string">&quot;sender %s&quot;</span>, sender);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ£€æŸ¥é€‚é…å™¨çš„Poweredæ˜¯å¦ä¸ºTRUE</span></span><br><span class="line">	<span class="keyword">if</span> (!btd_adapter_get_powered(adapter))</span><br><span class="line">		<span class="keyword">return</span> btd_error_not_ready(msg);</span><br><span class="line">	<span class="comment">// æ£€æŸ¥å‘é€è€…æ˜¯å¦åœ¨å‘ç°åˆ—è¡¨ä¸­ï¼Œå³è¯¥å‘é€è€…ä¹‹å‰æ˜¯å¦å‘é€è¿‡StartDiscoveryæ–¹æ³•</span></span><br><span class="line">	<span class="built_in">list</span> = g_slist_find_custom(adapter-&gt;discovery_list, sender,</span><br><span class="line">						compare_sender);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">list</span>)</span><br><span class="line">		<span class="keyword">return</span> btd_error_failed(msg, <span class="string">&quot;No discovery started&quot;</span>);</span><br><span class="line"></span><br><span class="line">	client = <span class="built_in">list</span>-&gt;data;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æœ‰äº†å¾…å¤„ç†çš„æ¶ˆæ¯</span></span><br><span class="line">	<span class="keyword">if</span> (client-&gt;msg)</span><br><span class="line">		<span class="keyword">return</span> btd_error_busy(msg);</span><br><span class="line">	<span class="comment">// è°ƒç”¨æ‰«æåœæ­¢å‡½æ•°</span></span><br><span class="line">	err = discovery_stop(client);</span><br><span class="line">	<span class="keyword">switch</span> (err) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> dbus_message_new_method_return(msg);</span><br><span class="line">	<span class="keyword">case</span> -EINPROGRESS:</span><br><span class="line">		client-&gt;msg = dbus_message_ref(msg);</span><br><span class="line">		adapter-&gt;client = client;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> btd_error_failed(msg, strerror(-err));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸´æ—¶å®šæ—¶å™¨"><a href="#ä¸´æ—¶å®šæ—¶å™¨" class="headerlink" title="ä¸´æ—¶å®šæ—¶å™¨"></a>ä¸´æ—¶å®šæ—¶å™¨</h3><p>åœ¨&#x2F;src&#x2F;main.confæ–‡ä»¶ä¸­ï¼Œæœ‰å…³äºæ‰«æåˆ°çš„è®¾å¤‡ä¸´æ—¶ï¼ˆtemporaryï¼‰æ—¶é—´å®šä¹‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[General]</span><br><span class="line"></span><br><span class="line"># How long to keep temporary devices around</span><br><span class="line"># The value is in seconds. Default is 30.</span><br><span class="line"># 0 = disable timer, i.e. never keep temporary devices</span><br><span class="line">#TemporaryTimeout = 30</span><br></pre></td></tr></table></figure>

<p>åœ¨&#x2F;src&#x2F;main.cæ–‡ä»¶ä¸­ï¼Œå…³äºä¸´æ—¶ï¼ˆtemporaryï¼‰æ—¶é—´ä¹Ÿæœ‰å®å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_PAIRABLE_TIMEOUT           0 <span class="comment">/* disabled */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_DISCOVERABLE_TIMEOUT     180 <span class="comment">/* 3 minutes */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_TEMPORARY_TIMEOUT         30 <span class="comment">/* 30 seconds */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_NAME_REQUEST_RETRY_DELAY 300 <span class="comment">/* 5 minutes */</span></span></span><br></pre></td></tr></table></figure>



<p>&#x2F;src&#x2F;device.cæºæ–‡ä»¶å…³äºä¸´æ—¶ï¼ˆtemporaryï¼‰å®šæ—¶å™¨çš„è®°å½•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">bool</span> <span class="title function_">device_disappeared</span><span class="params">(gpointer user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">dev</span> =</span> user_data;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* If there are services connected restart the timer to give more time</span></span><br><span class="line"><span class="comment">	 * for the service to either complete the connection or disconnect.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (device_service_connected(dev))</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">	dev-&gt;temporary_timer = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// here adapter remove device</span></span><br><span class="line">	btd_adapter_remove_device(dev-&gt;adapter, dev);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">set_temporary_timer</span><span class="params">(<span class="keyword">struct</span> btd_device *dev, <span class="type">unsigned</span> <span class="type">int</span> timeout)</span></span><br><span class="line">&#123;</span><br><span class="line">	clear_temporary_timer(dev);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!timeout)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	dev-&gt;temporary_timer = timeout_add_seconds(timeout, device_disappeared,</span><br><span class="line">								dev, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">btd_device_set_temporary</span><span class="params">(<span class="keyword">struct</span> btd_device *device, <span class="type">bool</span> temporary)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!device)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (device-&gt;temporary == temporary)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (device_address_is_private(device))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	DBG(<span class="string">&quot;temporary %d&quot;</span>, temporary);</span><br><span class="line"></span><br><span class="line">	device-&gt;temporary = temporary;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (temporary) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (device-&gt;bredr)</span><br><span class="line">			adapter_accept_list_remove(device-&gt;adapter, device);</span><br><span class="line">		adapter_connect_list_remove(device-&gt;adapter, device);</span><br><span class="line">		<span class="keyword">if</span> (device-&gt;auto_connect) &#123;</span><br><span class="line">			device-&gt;disable_auto_connect = TRUE;</span><br><span class="line">			device_set_auto_connect(device, FALSE);</span><br><span class="line">		&#125;</span><br><span class="line">		set_temporary_timer(device, btd_opts.tmpto);<span class="comment">// here</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		clear_temporary_timer(device);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (device-&gt;bredr)</span><br><span class="line">		adapter_accept_list_add(device-&gt;adapter, device);</span><br><span class="line"></span><br><span class="line">	store_device_info(device);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* attributes were not stored when resolved if device was temporary */</span></span><br><span class="line">	<span class="keyword">if</span> (device-&gt;bdaddr_type != BDADDR_BREDR &amp;&amp;</span><br><span class="line">			device-&gt;le_state.svc_resolved &amp;&amp;</span><br><span class="line">			g_slist_length(device-&gt;primaries) != <span class="number">0</span>)</span><br><span class="line">		store_services(device);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>btd_device_set_temporary()å‡½æ•°çš„å‚æ•°temporaryçš„å€¼ä¸º trueæ—¶ï¼Œdeviceå°†è¢«æ ‡è®°ä¸ºä¸´æ—¶è®¾å¤‡ï¼Œå¹¶é€šè¿‡ <code>set_temporary_timer(device, btd_opts.tmpto)</code> å¯åŠ¨äº†ä¸€ä¸ªä¸´æ—¶çš„å®šæ—¶å™¨ã€‚</p>
<p>&#x2F;src&#x2F;adapter.cå…³äºä¸´æ—¶ï¼ˆtemporaryï¼‰å®šæ—¶å™¨çš„ä½¿ç”¨</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">btd_adapter_remove_device</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter,</span></span><br><span class="line"><span class="params">				<span class="keyword">struct</span> btd_device *dev)</span></span><br><span class="line">&#123;</span><br><span class="line">	GList *l;</span><br><span class="line"></span><br><span class="line">	adapter-&gt;connect_list = g_slist_remove(adapter-&gt;connect_list, dev);</span><br><span class="line"></span><br><span class="line">	adapter_remove_device(adapter, dev);</span><br><span class="line">	btd_adv_monitor_device_remove(adapter-&gt;adv_monitor_manager, dev);</span><br><span class="line"></span><br><span class="line">	adapter-&gt;discovery_found = g_slist_remove(adapter-&gt;discovery_found,</span><br><span class="line">									dev);</span><br><span class="line"></span><br><span class="line">	adapter-&gt;connections = g_slist_remove(adapter-&gt;connections, dev);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (adapter-&gt;connect_le == dev)</span><br><span class="line">		adapter-&gt;connect_le = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	l = adapter-&gt;auths-&gt;head;</span><br><span class="line">	<span class="keyword">while</span> (l != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">service_auth</span> *<span class="title">auth</span> =</span> l-&gt;data;</span><br><span class="line">		GList *next = g_list_next(l);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (auth-&gt;device != dev) &#123;</span><br><span class="line">			l = next;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		g_queue_delete_link(adapter-&gt;auths, l);</span><br><span class="line">		l = next;</span><br><span class="line"></span><br><span class="line">		service_auth_cancel(auth);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	device_remove(dev, TRUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">discovery_cleanup</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter, <span class="type">int</span> timeout)</span></span><br><span class="line">&#123;</span><br><span class="line">	GSList *l, *next;</span><br><span class="line"></span><br><span class="line">	adapter-&gt;discovery_type = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (adapter-&gt;discovery_idle_timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		timeout_remove(adapter-&gt;discovery_idle_timeout);</span><br><span class="line">		adapter-&gt;discovery_idle_timeout = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	g_slist_free_full(adapter-&gt;discovery_found,</span><br><span class="line">						invalidate_rssi_and_tx_power);</span><br><span class="line">	adapter-&gt;discovery_found = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!adapter-&gt;devices)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (l = adapter-&gt;devices; l != <span class="literal">NULL</span>; l = next) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">dev</span> =</span> l-&gt;data;</span><br><span class="line"></span><br><span class="line">		next = g_slist_next(l);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (device_is_temporary(dev) &amp;&amp; !device_is_connectable(dev)</span><br><span class="line">			&amp;&amp; !btd_device_is_connected(dev))</span><br><span class="line">			btd_adapter_remove_device(adapter, dev); <span class="comment">// here</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">remove_temporary_devices</span><span class="params">(<span class="keyword">struct</span> btd_adapter *adapter)</span></span><br><span class="line">&#123;</span><br><span class="line">	GSList *l, *next;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (l = adapter-&gt;devices; l; l = next) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">dev</span> =</span> l-&gt;data;</span><br><span class="line"></span><br><span class="line">		next = g_slist_next(l);</span><br><span class="line">		<span class="keyword">if</span> (device_is_temporary(dev))</span><br><span class="line">			btd_adapter_remove_device(adapter, dev); <span class="comment">// here</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> DBusMessage *<span class="title function_">remove_device</span><span class="params">(DBusConnection *conn,</span></span><br><span class="line"><span class="params">					DBusMessage *msg, <span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_adapter</span> *<span class="title">adapter</span> =</span> user_data;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">device</span>;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *path;</span><br><span class="line">	GSList *<span class="built_in">list</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dbus_message_get_args(msg, <span class="literal">NULL</span>, DBUS_TYPE_OBJECT_PATH, &amp;path,</span><br><span class="line">						DBUS_TYPE_INVALID) == FALSE)</span><br><span class="line">		<span class="keyword">return</span> btd_error_invalid_args(msg);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">list</span> = g_slist_find_custom(adapter-&gt;devices, path, device_path_cmp);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">list</span>)</span><br><span class="line">		<span class="keyword">return</span> btd_error_does_not_exist(msg);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!btd_adapter_get_powered(adapter))</span><br><span class="line">		<span class="keyword">return</span> btd_error_not_ready(msg);</span><br><span class="line"></span><br><span class="line">	device = <span class="built_in">list</span>-&gt;data;</span><br><span class="line"></span><br><span class="line">	btd_device_set_temporary(device, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!btd_device_is_connected(device)) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// here adapter remove device</span></span><br><span class="line">		btd_adapter_remove_device(adapter, device);</span><br><span class="line">		<span class="keyword">return</span> dbus_message_new_method_return(msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	device_request_disconnect(device, msg);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æœ€ç»ˆçš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°è§£å†³ï¼šbluetoothdç¨‹åºæ¥æ”¶åˆ°å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼šbluetoothctlï¼‰çš„è¯·æ±‚ï¼š <code>StartDiscovery</code> æ–¹æ³•æ—¶ï¼Œè“ç‰™è®¾å¤‡è¢«å‘ç°åï¼Œé€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼é€šçŸ¥äº†å®¢æˆ·ç«¯å‘¢ï¼ŸåŒæ ·çš„ï¼Œå®¢æˆ·ç«¯å‘é€ <code>RemoveDevice</code> æ–¹æ³•æ—¶ï¼Œbluetoothdåˆæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Ÿæœ€åä¸€ç‚¹ï¼Œå½“é™„è¿‘è®¾å¤‡è¢«æ‰«æåˆ°åï¼Œä¼šä½œä¸ºä¸€ä¸ªä¸´æ—¶è®¾å¤‡ï¼Œå½“ä¸´æ—¶æ—¶é—´æœ€å¤§æ—¶é—´åˆ°è¾¾åï¼Œåœ¨å“ªé‡Œæ‰§è¡Œåˆ é™¤ä¸´æ—¶è®¾å¤‡æ“ä½œï¼Œä»¥åŠåˆ é™¤ä¸´æ—¶è®¾å¤‡åï¼Œä»¥ä»€ä¹ˆæ–¹å¼é€šçŸ¥å®¢æˆ·ç«¯ï¼Ÿ</p>
<h2 id="ç–‘éš¾æ‚ç—‡"><a href="#ç–‘éš¾æ‚ç—‡" class="headerlink" title="ç–‘éš¾æ‚ç—‡"></a>ç–‘éš¾æ‚ç—‡</h2><p>é€šè¿‡ä½¿ç”¨bluezæä¾›çš„gdbusæ¥å£ç¼–å†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆä»è¿™è¾¹æ–‡ç« å¯ä»¥å¾—çŸ¥ï¼š<code>&#123;% post_link 'bluetoothctl-client-tool' %&#125;</code> ï¼‰ï¼Œå¹¶ä¸”ä¸ºäº†æµ‹è¯•è¿æ¥çš„ç¨³å®šæ€§ç¼–è¯‘äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•å‡½æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼š<code>bt_open()</code> æ‰“å¼€è“ç‰™å¹¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li>
<li>ç¬¬äºŒæ­¥ï¼š<code>bt_start_discovery()</code> å¼€å§‹æ‰§è¡Œæ‰«ææ“ä½œ</li>
<li>ç¬¬ä¸‰æ­¥ï¼šè¿›å…¥while() å¾ªç¯ä½“ï¼Œå®ŒæˆæŒ‡å®šçš„è¿æ¥æ¬¡æ•°<ul>
<li>ç­‰å¾…ç›®æ ‡è“ç‰™è®¾å¤‡è¢«æ‰«æåˆ°</li>
<li>è¿æ¥ç›®æ ‡è“ç‰™è®¾å¤‡</li>
<li>ç§»é™¤ç›®æ ‡è“ç‰™è®¾å¤‡ï¼Œå¹¶è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ä½“</li>
</ul>
</li>
<li>ç¬¬å››æ­¥ï¼šé€€å‡ºwhile() å¾ªç¯ä½“ï¼Œ<code>bt_cancel_discovery()</code> åœæ­¢æ‰«ææ“ä½œ</li>
<li>ç¬¬äº”æ­¥ï¼š<code>bt_close()</code> å…³é—­è“ç‰™å¹¶é‡Šæ”¾ç›¸å…³çš„èµ„æº</li>
</ul>
<p>æ‰§è¡Œæµ‹è¯•æ¬¡æ•°ä¸º100æ¬¡ï¼Œæ€»ä¼šå‡ºç°é‚£ä¹ˆå‡ æ¬¡ä»¥ä¸Šçš„è¿æ¥è¶…æ—¶å¤±è´¥ï¼š<code>Timeout was reached</code>ã€‚æŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°æ‰§è¡Œconnectæ“ä½œåï¼Œç«‹å³å‡ºç°äº†åˆ é™¤ä¸´æ—¶è®¾å¤‡çš„æ“ä½œï¼ˆåŒ…æ‹¬ç›®æ ‡è“ç‰™è®¾å¤‡ï¼‰ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿æ¥è¶…æ—¶æŠ¥é”™äº†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ‰«æåˆ°ç›®æ ‡è“ç‰™è®¾å¤‡ï¼Œç›´æ¥å»è¿æ¥ï¼Œåˆ™ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GDBus.Error:org.freedesktop.DBus.Error.UnknownObject: Method <span class="string">&quot;Connect&quot;</span> with signature <span class="string">&quot;&quot;</span> on interface <span class="string">&quot;org.bluez.Device1&quot;</span> doesn<span class="string">&#x27;t exist</span></span><br></pre></td></tr></table></figure>

<p><strong>æ‰€ä»¥å…³é”®çš„é—®é¢˜æ˜¯æ‰¾åˆ°æ‰§è¡Œconnectæ“ä½œä¼šä¸ä¼šå¯¼è‡´bluetoothdè¿›ç¨‹æ‰§è¡Œæ¸…ç†ä¸´æ—¶è®¾å¤‡æ“ä½œï¼</strong></p>
<p>æŸ¥è¯¢ <code>org.bluez.Device1</code> çš„ Connect æ–¹æ³•ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> GDBusMethodTable device_methods[] = &#123;</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Disconnect&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, dev_disconnect) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Connect&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, dev_connect) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;ConnectProfile&quot;</span>, GDBUS_ARGS(&#123; <span class="string">&quot;UUID&quot;</span>, <span class="string">&quot;s&quot;</span> &#125;),</span><br><span class="line">						<span class="literal">NULL</span>, connect_profile) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;DisconnectProfile&quot;</span>, GDBUS_ARGS(&#123; <span class="string">&quot;UUID&quot;</span>, <span class="string">&quot;s&quot;</span> &#125;),</span><br><span class="line">						<span class="literal">NULL</span>, disconnect_profile) &#125;,</span><br><span class="line">	&#123; GDBUS_ASYNC_METHOD(<span class="string">&quot;Pair&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, pair_device) &#125;,</span><br><span class="line">	&#123; GDBUS_METHOD(<span class="string">&quot;CancelPairing&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, cancel_pairing) &#125;,</span><br><span class="line">	&#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connectæ–¹æ³•çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="type">static</span> DBusMessage *<span class="title function_">dev_connect</span><span class="params">(DBusConnection *conn, DBusMessage *msg,</span></span><br><span class="line"><span class="params">							<span class="type">void</span> *user_data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">btd_device</span> *<span class="title">dev</span> =</span> user_data;</span><br><span class="line">	<span class="type">uint8_t</span> bdaddr_type;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dev-&gt;bredr_state.connected) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Check if services have been resolved and there is at least</span></span><br><span class="line"><span class="comment">		 * one connected before switching to connect LE.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (dev-&gt;bredr_state.svc_resolved &amp;&amp;</span><br><span class="line">			find_service_with_state(dev-&gt;services,</span><br><span class="line">						BTD_SERVICE_STATE_CONNECTED))</span><br><span class="line">			bdaddr_type = dev-&gt;bdaddr_type;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			bdaddr_type = BDADDR_BREDR;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (dev-&gt;le_state.connected &amp;&amp; dev-&gt;bredr)</span><br><span class="line">		bdaddr_type = BDADDR_BREDR;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		bdaddr_type = select_conn_bearer(dev);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (bdaddr_type != BDADDR_BREDR) &#123;</span><br><span class="line">		<span class="type">int</span> err;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dev-&gt;le_state.connected)</span><br><span class="line">			<span class="keyword">return</span> dbus_message_new_method_return(msg);</span><br><span class="line"></span><br><span class="line">		btd_device_set_temporary(dev, <span class="literal">false</span>);<span class="comment">// ä¸ä¸´æ—¶è®¾å¤‡ç›¸å…³çš„å‡½æ•°ï¼Œç§»é™¤ç¼“å­˜å®šæ—¶å™¨</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dev-&gt;disable_auto_connect) &#123;</span><br><span class="line">			dev-&gt;disable_auto_connect = FALSE;</span><br><span class="line">			device_set_auto_connect(dev, TRUE);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		err = device_connect_le(dev);</span><br><span class="line">		<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> btd_error_failed(msg, strerror(-err));</span><br><span class="line"></span><br><span class="line">		dev-&gt;connect = dbus_message_ref(msg);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> connect_profiles(dev, bdaddr_type, msg, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ä¸èƒ½100%ç¡®è®¤è®¾å¤‡åˆ é™¤çš„æ—¶é—´ç‚¹ï¼Œä½†æ˜¯æˆ‘æŸ¥åˆ°äº†ç›¸å…³è°ƒç”¨å…³ç³»ï¼Œæœ€ç»ˆè®¾å¤‡è¢«ç§»é™¤æ—¶ä¸€å®šä¼šè°ƒç”¨å‡½æ•° <code>g_dbus_unregister_interface()</code> ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦å‘ä¸Šæ‰¾å‡ºå…³äºè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨çš„ä½ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># src/adapter.c</span><br><span class="line"># ç¬¬ä¸€ä¸ªè°ƒç”¨æ–¹å‘</span><br><span class="line">g_dbus_unregister_interface() --&gt; btd_device_unref() --&gt; device_remove()  </span><br><span class="line">--&gt; btd_adapter_remove_device() --&gt; remove_temporary_devices()</span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒä¸ªè°ƒç”¨æ–¹å‘ </span><br><span class="line">g_dbus_unregister_interface() --&gt; btd_device_unref() --&gt; device_remove()  </span><br><span class="line">--&gt; btd_adapter_remove_device() --&gt;  discovery_cleanup() --&gt; discovery_remove() </span><br><span class="line">--&gt; start_discovery_complete() --&gt; start_discovery_timeout() </span><br><span class="line">--&gt; trigger_start_discovery() --&gt; discovering_callback()</span><br><span class="line"></span><br><span class="line"># ç¬¬ä¸‰ä¸ªè°ƒç”¨æ–¹å‘</span><br><span class="line">g_dbus_unregister_interface() --&gt; btd_device_unref() --&gt; device_remove() </span><br><span class="line">--&gt; btd_adapter_remove_device() --&gt; remove_device()</span><br><span class="line"></span><br><span class="line"># src/device.cä¸­btd_adapter_remove_device()çš„è°ƒç”¨å…³ç³»</span><br><span class="line">btd_adapter_remove_device() --&gt; device_disappeared() --&gt; set_temporary_timer() </span><br><span class="line">--&gt; btd_device_set_temporary() --&gt; dev_connect()</span><br></pre></td></tr></table></figure>



<p>å½“ç„¶ï¼Œæœ€å¥½å°†bluetoothdçš„æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªçƒ¦æ¼çš„é—®é¢˜ï¼Œå°±æ˜¯æ—¥å¿—æ–‡ä»¶å¤ªå¤§äº†ï¼ŒåŠ¨ä¸åŠ¨å°±æ˜¯10Mä»¥ä¸Šçš„å¤§å°ï¼Œæ’æŸ¥å¾ˆå›°éš¾ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/libexec/bluetooth/bluetoothd -d -n &gt; bluetoothd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>bluez</tag>
        <tag>bluetoothd</tag>
      </tags>
  </entry>
  <entry>
    <title>Matter: Level Control Cluster</title>
    <url>/2024/09/10/2024/Matter-Level-Control-Cluster/</url>
    <content><![CDATA[<blockquote>
<p>LevelControl Clusterçš„ä½œç”¨ï¼Ÿ</p>
</blockquote>
<p>è¯¥é›†ç¾¤æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨äºæ§åˆ¶å¯è®¾ç½®ä¸ºæŸä¸ªçº§åˆ«çš„è®¾å¤‡ç‰¹æ€§ï¼Œä¾‹å¦‚ç¯å…‰çš„äº®åº¦ã€é—¨çš„å…³é—­ç¨‹åº¦æˆ–åŠ çƒ­å™¨çš„åŠŸç‡è¾“å‡ºã€‚</p>
<h2 id="Cluster-ID"><a href="#Cluster-ID" class="headerlink" title="Cluster ID"></a>Cluster ID</h2><table>
<thead>
<tr>
<th>Hierarchy</th>
<th>Role</th>
<th>Scope</th>
<th>PICS Code</th>
</tr>
</thead>
<tbody><tr>
<td>Base</td>
<td>Application</td>
<td>Endpoint</td>
<td>LVL</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ID</th>
<th>Hierachy</th>
<th>Name</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0008</td>
<td>Base</td>
<td>Level Control</td>
<td></td>
</tr>
<tr>
<td>0x001c</td>
<td>Derived</td>
<td>Pulse Width Modulation</td>
<td>P</td>
</tr>
</tbody></table>
<p><em>æ³¨æ„ï¼šPulse Width Modulation clusteræ˜¯ä¸´æ—¶æ€§çš„</em></p>
<h2 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h2><table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Type</th>
<th>Contraint</th>
<th>Quality</th>
<th>Default</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0000</td>
<td>CurrentLevel</td>
<td>uint8</td>
<td>MinLevel to MaxLevel</td>
<td>SNX</td>
<td>null</td>
<td>R V</td>
<td>M</td>
</tr>
<tr>
<td>0x0001</td>
<td>RemainingTime</td>
<td>uint16</td>
<td>all</td>
<td></td>
<td>0</td>
<td>R V</td>
<td>LT</td>
</tr>
<tr>
<td>0x0002</td>
<td>MinLevel</td>
<td>uint8</td>
<td>1 to MaxLevel</td>
<td></td>
<td>1</td>
<td>R V</td>
<td>[LT]</td>
</tr>
<tr>
<td>0x0002</td>
<td>MinLevel</td>
<td>uint8</td>
<td>0 to MaxLevel</td>
<td></td>
<td>0</td>
<td>R V</td>
<td>[!LT]</td>
</tr>
<tr>
<td>0x0003</td>
<td>MaxLevel</td>
<td>uint8</td>
<td>MinLevel to 254</td>
<td></td>
<td>254</td>
<td>R V</td>
<td>O</td>
</tr>
<tr>
<td>0x0004</td>
<td>CurrentFrequency</td>
<td>uint16</td>
<td>MinFrequency to MaxFrequency</td>
<td>PS</td>
<td>0</td>
<td>R V</td>
<td>FQ</td>
</tr>
<tr>
<td>0x0005</td>
<td>MinFrequency</td>
<td>uint16</td>
<td>0 to MaxFrequency</td>
<td></td>
<td>0</td>
<td>R V</td>
<td>FQ</td>
</tr>
<tr>
<td>0x0006</td>
<td>MaxFrequency</td>
<td>uint16</td>
<td>min Minfrequency</td>
<td></td>
<td>0</td>
<td>R V</td>
<td>FQ</td>
</tr>
<tr>
<td>0x0010</td>
<td>OnOffTransitionTime</td>
<td>uint16</td>
<td>all</td>
<td></td>
<td>0</td>
<td>RW VO</td>
<td>O</td>
</tr>
<tr>
<td>0x0011</td>
<td>OnLevel</td>
<td>uint8</td>
<td>MinLevel to MaxLevel</td>
<td>X</td>
<td>null</td>
<td>RW VO</td>
<td>M</td>
</tr>
<tr>
<td>0x0012</td>
<td>OnTransitionTime</td>
<td>uint16</td>
<td>all</td>
<td>X</td>
<td>null</td>
<td>RW VO</td>
<td>O</td>
</tr>
<tr>
<td>0x0013</td>
<td>OffTransitionTime</td>
<td>uint16</td>
<td>all</td>
<td>X</td>
<td>null</td>
<td>RW VO</td>
<td>O</td>
</tr>
<tr>
<td>0x0014</td>
<td>DefaultMoveRate</td>
<td>uint8</td>
<td>all</td>
<td>X</td>
<td>MS</td>
<td>RW VO</td>
<td>O</td>
</tr>
<tr>
<td>0x000f</td>
<td>Options</td>
<td>OptionsBitmap</td>
<td>desc</td>
<td></td>
<td>0</td>
<td>RW VO</td>
<td>M</td>
</tr>
<tr>
<td>0x4000</td>
<td>StartUpCurrentLevel</td>
<td>uint8</td>
<td>desc</td>
<td>XN</td>
<td>MS</td>
<td>RW VM</td>
<td>LT</td>
</tr>
</tbody></table>
<p><strong>CurrentLevel Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€è®¾å¤‡å½“å‰çº§åˆ«ã€‚çº§åˆ«çš„å«ä¹‰å–å†³äºè®¾å¤‡ã€‚</p>
<p><strong>RemainingTime Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€æŒç»­æ—¶é—´ç›´åˆ°currentå‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒä»¥ååˆ†ä¹‹ç§’ä¸ºå•ä½ã€‚</p>
<p><strong>MinLevel Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€å½“å‰çº§åˆ«å¯ä»¥è®¾ç½®çš„æœ€å°å€¼</p>
<p><strong>MaxLevel Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€å½“å‰çº§åˆ«å¯ä»¥è®¾ç½®çš„æœ€å¤§å€¼</p>
<p><strong>CurrentFrequency Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€è®¾å¤‡å¤„äºå½“å‰çº§åˆ«æ—¶çš„é¢‘ç‡ã€‚å½“å‰é¢‘ç‡çš„å€¼ä¸º0ï¼Œè¡¨ç¤ºæ˜¯æœªçŸ¥çš„ã€‚</p>
<p><strong>MinFrequency Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€å½“å‰é¢‘ç‡å¯ä»¥è®¾ç½®çš„æœ€å°å€¼ã€‚æœ€å°é¢‘ç‡å±æ€§çš„å€¼åº”è¯¥å°äºæˆ–ç­‰äºæœ€å¤§é¢‘ç‡å±æ€§çš„å€¼ã€‚</p>
<p><strong>MaxFrequency Attribute</strong></p>
<p>è¯¥å±æ€§æš—ç¤ºç€å½“å‰é¢‘ç‡å¯ä»¥è®¾ç½®çš„æœ€å°å€¼ã€‚æœ€å¤§é¢‘ç‡å±æ€§çš„å€¼åº”è¯¥å¤§äºæˆ–ç­‰äºæœ€å°å±æ€§çš„å€¼ã€‚</p>
<p><strong>Options Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºè®¾å¤‡çš„é€‰å®šé€‰é¡¹ã€‚<br>é€‰é¡¹å±æ€§æ˜¯ä¸€ä¸ªä½å›¾ï¼Œå®ƒå†³å®šäº†æŸäº›é›†ç¾¤å‘½ä»¤çš„é»˜è®¤è¡Œä¸ºã€‚æ¯ä¸ªä¾èµ–äºé€‰é¡¹å±æ€§çš„å‘½ä»¤éƒ½åº”é¦–å…ˆæ„é€ ä¸€ä¸ªä¸´æ—¶çš„é€‰é¡¹ä½å›¾ï¼Œè¯¥ä½å›¾åœ¨å‘½ä»¤å¤„ç†æœŸé—´æœ‰æ•ˆã€‚ä¸´æ—¶é€‰é¡¹ä½å›¾å…·æœ‰ä¸é€‰é¡¹å±æ€§ç›¸åŒçš„æ ¼å¼å’Œå«ä¹‰ï¼Œä½†åŒ…æ‹¬å¯èƒ½è¢«å‘½ä»¤å­—æ®µè¦†ç›–çš„ä»»ä½•ä½ã€‚</p>
<p><strong>OnOffTransitionTime Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºå½“åŒä¸€ä¸ªEndpointä¸Šçš„ OnOff é›†ç¾¤æ”¶åˆ°Onæˆ– Offå‘½ä»¤æ—¶ï¼Œç§»åŠ¨åˆ°ç›®æ ‡çº§åˆ«æˆ–ä»ç›®æ ‡çº§åˆ«ç§»å‡ºæ‰€éœ€çš„æ—¶é—´ã€‚ä»¥ååˆ†ä¹‹ä¸€ç§’ä¸ºå•ä½ã€‚</p>
<p><strong>OnLevel Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºå½“åŒä¸€Endpointä¸Šçš„ OnOff é›†ç¾¤çš„ OnOff å±æ€§è®¾ç½®ä¸º TRUE æ—¶ï¼Œ CurrentLevel å±æ€§è¢«è®¾ç½®çš„å€¼ï¼Œè¿™æ˜¯å¤„ç† OnOff é›†ç¾¤å‘½ä»¤çš„ç»“æœã€‚å¦‚æœæœªå®ç° OnLevel å±æ€§ï¼Œæˆ–å°†å…¶è®¾ç½®ä¸ºç©ºå€¼ï¼Œåˆ™å®ƒä¸èµ·ä½œç”¨ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¼€&#x2F;å…³å‘½ä»¤å¯¹ CurrentLevel å±æ€§çš„å½±å“ã€‚</p>
<p><strong>OnTrasitionTime Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºå½“åŒä¸€ Endpoint ä¸Šçš„ OnOff é›†ç¾¤æ”¶åˆ° On å‘½ä»¤æ—¶ï¼Œå°†å½“å‰çº§åˆ«ä»æœ€ä½çº§åˆ«ç§»è‡³æœ€é«˜çº§åˆ«æ‰€éœ€çš„æ—¶é—´ã€‚å®ƒä»¥ 1&#x2F;10 ç§’ä¸ºå•ä½æŒ‡å®šã€‚å¦‚æœæœªå®ç°æ­¤å±æ€§ï¼Œæˆ–åŒ…å«ç©ºå€¼ï¼Œåˆ™åº”ä½¿ç”¨ OnOffTransitionTimeã€‚</p>
<p><strong>OffTransitionTime Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºå½“åŒä¸€ Endpointä¸Š çš„ OnOff é›†ç¾¤æ”¶åˆ° Off å‘½ä»¤æ—¶ï¼Œå°†å½“å‰çº§åˆ«ä»æœ€é«˜çº§åˆ«ç§»è‡³æœ€ä½çº§åˆ«æ‰€éœ€çš„æ—¶é—´ã€‚å®ƒä»¥ 1&#x2F;10 ç§’ä¸ºå•ä½æŒ‡å®šã€‚å¦‚æœæœªå®ç°æ­¤å±æ€§ï¼Œæˆ–åŒ…å«ç©ºå€¼ï¼Œåˆ™åº”ä½¿ç”¨ OnOffTransitionTimeã€‚</p>
<p><strong>DefaultMoveRate Attribute</strong></p>
<p>å½“æ”¶åˆ°å¸¦æœ‰ç©ºå€¼é€Ÿç‡å‚æ•°çš„ç§»åŠ¨å‘½ä»¤æ—¶ï¼Œæ­¤å±æ€§åº”æŒ‡ç¤ºç§»åŠ¨é€Ÿç‡ï¼ˆä»¥å•ä½&#x2F;ç§’ä¸ºå•ä½ï¼‰ã€‚</p>
<p><strong>StartUpCurrentLevel Attribute</strong></p>
<p>æ­¤å±æ€§åº”æŒ‡ç¤ºè®¾å¤‡é€šç”µæ—¶æ‰€éœ€çš„å¯åŠ¨çº§åˆ«ï¼Œå¹¶ä¸”æ­¤çº§åˆ«åº”åæ˜ åœ¨ CurrentLevel å±æ€§ä¸­ã€‚StartUpCurrentLevel å±æ€§çš„å€¼å¦‚ä¸‹æ‰€åˆ—ï¼š</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Action on power up</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>å°† CurrentLevel å±æ€§è®¾ç½®ä¸ºè®¾å¤‡å…è®¸çš„æœ€å°å€¼</td>
</tr>
<tr>
<td>null</td>
<td>å°† CurrentLevel å±æ€§è®¾ç½®ä¸ºå®ƒä¹‹å‰çš„å€¼</td>
</tr>
<tr>
<td>other values</td>
<td>å°†CurrentLevel å±æ€§è®¾ç½®ä¸ºè¾“å…¥çš„å€¼</td>
</tr>
</tbody></table>
<p>æ­¤è¡Œä¸ºä¸é€‚ç”¨äºä¸ OTA ç›¸å…³çš„é‡å¯ã€‚OTA é‡å¯åï¼ŒCurrentLevel å±æ€§åº”è¿”å›åˆ°é‡å¯å‰çš„å€¼ã€‚</p>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Direction</th>
<th>Respone</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>MoveToLevel</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x01</td>
<td>Move</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x02</td>
<td>Step</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x03</td>
<td>Stop</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x04</td>
<td>MoveToLevelWithOnOff</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x05</td>
<td>MoveWithOnOff</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x06</td>
<td>StepWithOnOff</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x07</td>
<td>StopWithOnOff</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x08</td>
<td>MoveToClosestFrequecny</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
</tbody></table>
<p><strong>MoveToLevel Command</strong></p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”ä»å…¶å½“å‰çº§åˆ«ç§»è‡³çº§åˆ«å­—æ®µä¸­æŒ‡å®šçš„å€¼ã€‚â€œçº§åˆ«â€çš„å«ä¹‰å–å†³äºè®¾å¤‡ - ä¾‹å¦‚ï¼Œå¯¹äºç¯æ¥è¯´ï¼Œå®ƒå¯èƒ½è¡¨ç¤ºäº®åº¦çº§åˆ«ã€‚</p>
<p>ç§»åŠ¨åº”å°½å¯èƒ½åœ¨æŠ€æœ¯ä¸Šå¯è¡Œï¼Œå³ä¸æ˜¯é˜¶è·ƒå‡½æ•°ï¼Œå¹¶ä¸”ç§»åŠ¨åˆ°æ–°çº§åˆ«æ‰€éœ€çš„æ—¶é—´åº”ç­‰äº TransitionTime å­—æ®µçš„å€¼ï¼ˆä»¥ååˆ†ä¹‹ä¸€ç§’ä¸ºå•ä½ï¼‰ï¼Œæˆ–å°½å¯èƒ½æ¥è¿‘è¯¥å€¼ã€‚</p>
<p>å¦‚æœ TransitionTime å­—æ®µçš„å€¼ä¸º nullï¼Œåˆ™ç§»åŠ¨åˆ°æ–°çº§åˆ«æ‰€éœ€çš„æ—¶é—´åº”ç”± OnOffTransitionTime å±æ€§å†³å®šã€‚å¦‚æœä¸å­˜åœ¨ OnOffTransitionTimeï¼ˆå¯é€‰å±æ€§ï¼‰ï¼Œåˆ™è®¾å¤‡åº”å°½å¿«ç§»åŠ¨åˆ°æ–°çº§åˆ«ã€‚</p>
<p><strong>Move Command</strong></p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”é¦–å…ˆåˆ›å»ºå¹¶å¤„ç†ä¸´æ—¶é€‰é¡¹ä½å›¾ï¼Œå¦‚ MoveToLevel å‘½ä»¤ä¸­æ‰€è¿°ã€‚</p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”ä»å…¶å½“å‰çº§åˆ«å¼€å§‹ä»¥è¿ç»­çš„æ–¹å¼å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š</p>
<table>
<thead>
<tr>
<th>MoveMode</th>
<th>Action on Receipt</th>
</tr>
</thead>
<tbody><tr>
<td>Up</td>
<td>æŒ‰ç…§é€Ÿç‡å­—æ®µä¸­ç»™å‡ºçš„é€Ÿç‡å¢åŠ è®¾å¤‡çš„çº§åˆ«ã€‚å¦‚æœçº§åˆ«è¾¾åˆ°è®¾å¤‡å…è®¸çš„æœ€å¤§å€¼ï¼Œåˆ™åœæ­¢ã€‚</td>
</tr>
<tr>
<td>Down</td>
<td>æŒ‰ç…§â€œé€Ÿç‡â€å­—æ®µä¸­æŒ‡å®šçš„é€Ÿç‡é™ä½è®¾å¤‡çš„çº§åˆ«ã€‚å¦‚æœçº§åˆ«è¾¾åˆ°è®¾å¤‡å…è®¸çš„æœ€ä½æ°´å¹³ï¼Œåˆ™åœæ­¢ã€‚</td>
</tr>
</tbody></table>
<p><strong>Step Command</strong></p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”é¦–å…ˆåˆ›å»ºå¹¶å¤„ç†ä¸´æ—¶é€‰é¡¹ä½å›¾ï¼Œå¦‚ MoveToLevel å‘½ä»¤ä¸­æ‰€è¿°ã€‚</p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”ä»å…¶å½“å‰çº§åˆ«å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š</p>
<table>
<thead>
<tr>
<th>StepMode</th>
<th>Action on Receipt</th>
</tr>
</thead>
<tbody><tr>
<td>Up</td>
<td>æŒ‰ StepSize å•ä½å¢åŠ  CurrentLevelï¼Œæˆ–ç›´åˆ°è¾¾åˆ°è®¾å¤‡å…è®¸çš„æœ€å¤§çº§åˆ«ï¼ˆå¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­å·²è¾¾åˆ°ï¼‰ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¿‡æ¸¡æ—¶é—´åº”æŒ‰æ¯”ä¾‹å‡å°‘ã€‚</td>
</tr>
<tr>
<td>Down</td>
<td>å°† CurrentLevel é™ä½ StepSize å•ä½ï¼Œæˆ–ç›´åˆ°è¾¾åˆ°è®¾å¤‡å…è®¸çš„æœ€ä½çº§åˆ«ï¼ˆå¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­å·²è¾¾åˆ°ï¼‰ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¿‡æ¸¡æ—¶é—´åº”æŒ‰æ¯”ä¾‹å‡å°‘ã€‚</td>
</tr>
</tbody></table>
<p><strong>Stop Command</strong></p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”é¦–å…ˆåˆ›å»ºå¹¶å¤„ç†ä¸´æ—¶é€‰é¡¹ä½å›¾ï¼Œå¦‚ MoveToLevel å‘½ä»¤ä¸­æ‰€è¿°ã€‚</p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œå½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»ä½• MoveToLevelã€Move æˆ– Step å‘½ä»¤ï¼ˆåŠå…¶â€œå¸¦å¼€&#x2F;å…³â€å˜ä½“ï¼‰éƒ½åº”ç»ˆæ­¢ã€‚æ”¶åˆ° Stop å‘½ä»¤åï¼ŒCurrentLevel çš„å€¼åº”ä¿ç•™ä¸ºåŸå€¼ï¼ŒRemainingTime åº”è®¾ç½®ä¸ºé›¶ã€‚</p>
<p>æ­¤å‘½ä»¤åœ¨å‘½ä»¤åˆ—è¡¨ä¸­æœ‰ä¸¤ä¸ªæ¡ç›®ï¼Œä¸€ä¸ªç”¨äº MoveToLevelã€Move å’Œ Step å‘½ä»¤ï¼Œå¦ä¸€ä¸ªç”¨äºå®ƒä»¬çš„â€œå¸¦ On&#x2F;Offâ€å¯¹åº”é¡¹ã€‚è¿™åªæ˜¯ä¸ºäº†å¯¹ç§°ï¼Œä»¥ä¾¿è½»æ¾é€‰æ‹©ä¸€ç»„æˆ–å¦ä¸€ç»„å‘½ä»¤ - Stop å‘½ä»¤æ˜¯ç›¸åŒçš„ï¼Œå› ä¸º On&#x2F;Off çš„ä¾èµ–æ€§ç”±è¦åœæ­¢çš„åŸå§‹å‘½ä»¤å†³å®šã€‚</p>
<p><strong>MoveToClosestFrequecny Command</strong></p>
<p>æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œè®¾å¤‡åº”å°†å…¶å½“å‰é¢‘ç‡æ›´æ”¹ä¸ºè¯·æ±‚çš„é¢‘ç‡ï¼Œæˆ–æ›´æ”¹ä¸ºå…¶å¯ä»¥ç”Ÿæˆçš„æœ€æ¥è¿‘çš„é¢‘ç‡ã€‚å¦‚æœè®¾å¤‡æ— æ³•æ¥è¿‘è¯¥é¢‘ç‡ï¼Œåˆ™åº”è¿”å›é»˜è®¤å“åº”ï¼Œé”™è¯¯ä»£ç ä¸º CONSTRAINT_ERRORã€‚ç¡®å®šè¯·æ±‚çš„é¢‘ç‡æ˜¯å¦å¯ä»¥è¿‘ä¼¼ä¸ºæ”¯æŒçš„é¢‘ç‡æ˜¯åˆ¶é€ å•†ç‰¹å®šçš„å†³å®šã€‚</p>
<p><strong>With On&#x2F;Off Commands</strong></p>
<p>MoveToLevelWithOnOffã€MoveWithOnOff å’Œ StepWithOnOff å‘½ä»¤åˆ†åˆ«ä¸ MoveToLevelã€Move å’Œ Step å‘½ä»¤å…·æœ‰ç›¸åŒçš„æ•°æ®å­—æ®µã€‚</p>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>LevelControl Cluster</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-asset-image problem</title>
    <url>/2024/09/07/2024/hexo-assert-image-problem/</url>
    <content><![CDATA[<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p>åœ¨ä¹‹å‰ä½¿ç”¨hexoæ­å»ºåšå®¢åï¼Œè®¤ä¸ºåœ¨å†…å®¹ä¸­æ’å…¥å›¾ç‰‡è¿˜æ˜¯ä¸å¯ç¼ºå°‘äº†ã€‚æ‰€ä»¥æ‰¾åˆ°äº†ä¸€ä¸ªåšä¸»å‘å¸ƒçš„ä¸€éæ–‡ç« ï¼š<a href="https://blog.csdn.net/m0_43401436/article/details/107191688">hexoåšå®¢ä¸­æ’å…¥å›¾ç‰‡å¤±è´¥â€”â€”è§£å†³æ€è·¯åŠä¸ªäººæœ€ç»ˆè§£å†³åŠæ³•</a>ï¼Œä¸“é—¨è§£å†³æˆ‘è¿™ä¸ªéœ€æ±‚çš„ã€‚</p>
<p>å…ˆä»‹ç»ä¸€ä¸‹æˆ‘çš„hexoç¯å¢ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo --version</span><br><span class="line">INFO  Validating config</span><br><span class="line">hexo: 7.3.0</span><br><span class="line">hexo-cli: 4.3.2</span><br><span class="line">os: linux 6.8.0-40-generic Ubuntu 22.04.4 LTS 22.04.4 LTS (Jammy Jellyfish)</span><br><span class="line">node: 12.22.9</span><br><span class="line">v8: 7.8.279.23-node.56</span><br><span class="line">uv: 1.43.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.9</span><br><span class="line">ares: 1.18.1</span><br><span class="line">modules: 72</span><br><span class="line">nghttp2: 1.43.0</span><br><span class="line">napi: 8</span><br><span class="line">llhttp: 2.1.6</span><br><span class="line">http_parser: 2.9.4</span><br><span class="line">openssl: 1.1.1m</span><br><span class="line">cldr: 40.0</span><br><span class="line">icu: 70.1</span><br><span class="line">tz: 2021a3</span><br><span class="line">unicode: 14.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>hexo-next-themeï¼š8.20.0</em></p>
<p>ä¸‹é¢å°±æ˜¯æˆ‘æŒ‰ç…§åˆ†äº«çš„æ–‡ç« çš„æ“ä½œè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>ä¸‹è½½hexo-asset-imageæ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ npm install hexo-asset-image --save</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹hexoçš„é…ç½®æ–‡ä»¶_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»…ä¿®æ”¹ä¸€å¤„ï¼šå°†falseä¿®æ”¹ä¸ºtrue</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Typoraä¿®æ”¹å›¾ç‰‡åå¥½è®¾ç½®</p>
<p><img src="/2024/09/07/2024/hexo-assert-image-problem/image-20240907142349989.png" alt="image-20240907142349989"></p>
</li>
<li><p>åœ¨Typoraç¼–è¯‘mdæ–‡ä»¶ï¼Œå¹¶å¤åˆ¶å›¾ç‰‡åˆ°å†…å®¹ä¸­</p>
</li>
<li><p>hexoæ¸…ç†ç¼“å­˜å¹¶é‡æ–°æ„å»ºï¼šhexo clean &amp;&amp; hexo g</p>
</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯æŒ‰ç…§åˆ†äº«æ–‡ç« çš„æ­¥éª¤ï¼Œä½†æ˜¯å›¾ç‰‡è¿˜æ˜¯æ— æ³•æ˜¾ç¤ºï¼ˆgo dieï¼‰ã€‚</p>
<p>ä½†æ˜¯æˆ‘åœ¨hexoæ„å»ºæ—¶ï¼Œå‘ç°äº†ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  ==================================</span><br><span class="line">  â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—</span><br><span class="line">  â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•</span><br><span class="line">  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘</span><br><span class="line">  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘</span><br><span class="line">  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘</span><br><span class="line">  â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•</span><br><span class="line">========================================</span><br><span class="line">NexT version 8.20.0</span><br><span class="line">Documentation: https://theme-next.js.org</span><br><span class="line">========================================</span><br><span class="line">INFO  Start processing</span><br><span class="line">update <span class="built_in">link</span> as:--&gt;/.io//Snipaste_esp32c3_2024-09-07_11-47-30.png</span><br><span class="line">update <span class="built_in">link</span> as:--&gt;/.io//Snipaste_esp32c3_2024-09-07_12-01-02.png</span><br><span class="line">update <span class="built_in">link</span> as:--&gt;/.io//Snipaste_esp32c3_2024-09-07_11-47-30.png</span><br><span class="line">update <span class="built_in">link</span> as:--&gt;/.io//Snipaste_esp32c3_2024-09-07_12-01-02.png</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å›¾ç‰‡è·¯å¾„å¾ˆä¸æ­£å¸¸ï¼Œæˆ‘çŒœæµ‹è¿™æ˜¯å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„åŸå› ã€‚</p>
<h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>é€šè¿‡æŠŠæ–‡ä»¶çš„å¼‚å¸¸è·¯å¾„æ”¾åœ¨æµè§ˆå™¨æœç´¢ï¼Œå‘ç°äº†ä¸€ä¸ªåšä¸»å‘å¸ƒäº†è§£å†³æ–¹æ³•ï¼š<a href="https://blog.iz4.cc/tutorial/2022/08/%E8%A7%A3%E5%86%B3hexo-asset-image%E5%9B%BE%E7%89%87%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E6%9B%BF%E6%8D%A2%E9%97%AE%E9%A2%98/">è§£å†³hexo-asset-imageå›¾ç‰‡ç›¸å¯¹è·¯å¾„æ›¿æ¢é—®é¢˜</a> ï¼ŒåŸæ¥æ˜¯hexo-assert-imageæ’ä»¶è½¬æ¢å›¾ç‰‡è·¯å¾„å‡ºé—®é¢˜äº†ã€‚</p>
<p>æŒ‰ç…§åˆ†äº«çš„æ–‡ç« ä¿®æ”¹æ­¥éª¤ï¼š</p>
<ul>
<li><p>ç¼–è¾‘ blog&#x2F;node_modules&#x2F;hexo-asset-image&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…æ–°å¢ else if ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class="line"><span class="comment">// if not with index.html endpos = link.lastIndexOf(&#x27;.&#x27;) + 1 support hexo-abbrlink</span></span><br><span class="line"><span class="keyword">if</span>(<span class="regexp">/.*\/index\.html$/</span>.<span class="title function_">test</span>(link)) &#123;</span><br><span class="line">  <span class="comment">// when permalink is end with index.html, for example 2019/02/20/xxtitle/index.html</span></span><br><span class="line">  <span class="comment">// image in xxtitle/ will go to xxtitle/index/</span></span><br><span class="line">  appendLink = <span class="string">&#x27;index/&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> endPos = link.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/.*\/$/</span>.<span class="title function_">test</span>(link))&#123;</span><br><span class="line">  <span class="keyword">var</span> endPos = link.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> endPos = link.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>hexoæ¸…ç†ç¼“å­˜å¹¶é‡æ–°æ„å»ºï¼šhexo clean &amp;&amp; hexo g</p>
<p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼šæ¯æ¬¡æ’å…¥å›¾ç‰‡ï¼Œéƒ½è¦é‡æ–°æ„å»ºï¼Œå¦åˆ™å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚</p>
</li>
</ul>
<p>æœ€ç»ˆæœ¬åœ°è®¿é—®å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸ï¼Œéƒ¨ç½²åˆ°github.ioä¹Ÿæ˜¾ç¤ºæ­£å¸¸ã€‚</p>
<p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p>
<p>ç¬¬ä¸€ç¯‡åˆ†äº«æ–‡ç« çš„åšä¸»è¡¨ç¤ºï¼šTyporaå¼•å…¥å›¾ç‰‡æ—¶ï¼Œä¸èƒ½åŠ å…¥å›¾ç‰‡çš„æ–‡ä»¶å¤¹å‰ç¼€ï¼Œåªèƒ½ç›´æ¥ç»™å‡ºå›¾ç‰‡çš„æ–‡ä»¶åç§°ï¼Œå¦åˆ™å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚å¹¶ä¸”è¯¥åšä¸»ä¹Ÿé€šè¿‡hexo-asset-imageæ’ä»¶çš„README.mdè¯´æ˜ç”¨æ¥è®ºè¯ã€‚</p>
<p>æˆ‘ä¹ŸæŸ¥çœ‹äº†è¯¥æ’ä»¶çš„README.mdï¼Œç¡®å®å¦‚åŒè¯¥åšä¸»è¯´çš„ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå³åŠ ä¸Šäº†å›¾ç‰‡æ‰€åœ¨çš„æ–‡ä»¶å¤¹ä½œä¸ºå‰ç¼€ï¼‰ï¼Œå¹¶æ²¡æœ‰å‡ºç°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºçš„æƒ…å†µã€‚</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo-asset-imageå›¾ç‰‡æ˜¾ç¤ºå¼‚å¸¸</tag>
      </tags>
  </entry>
  <entry>
    <title>ESP32-C3-DevKitM-1 Schematic</title>
    <url>/2024/09/07/2024/ESP32-C3-DevKitM-1-Schematic/</url>
    <content><![CDATA[<p><a href="https://docs.espressif.com/projects/esp-dev-kits/zh_CN/latest/esp32c3/esp32-c3-devkitm-1/user_guide.html">ESP32-C3-DevKit-M1 å®˜ç½‘æ–‡æ¡£ä»‹ç»</a></p>
<h2 id="åŸç†å›¾"><a href="#åŸç†å›¾" class="headerlink" title="åŸç†å›¾"></a>åŸç†å›¾</h2><p>å…ˆçœ‹ä¸€ä¸‹å¼€å‘æ¿çš„ç¼©ç•¥å›¾ï¼š</p>
<p><img src="/2024/09/07/2024/ESP32-C3-DevKitM-1-Schematic/Snipaste_esp32c3_2024-09-07_11-47-30.png" alt="å¼€å‘æ¿çš„ç¼©ç•¥å›¾"></p>
<p>ç¼©ç•¥å›¾åªåˆ—ä¸¾äº†åŠŸèƒ½æ¨¡å—éƒ¨åˆ†ï¼Œå¹¶æ²¡æœ‰ä½“ç°ç”µè·¯éƒ¨åˆ†ã€‚ä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡ä¸Šå›¾çŸ¥é“è¯¥å¼€å‘æ¿æä¾›çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>Micro MiNi-USBï¼šæ”¯æŒä¾›ç”µï¼ˆ3.3Vï¼‰å’Œä¼ è¾“æ•°æ®ï¼ˆé€šè¿‡USB-UART Bridgeå®ç°ï¼‰</li>
<li>Bootï¼šæŒ‰é”®</li>
<li>RSTï¼šæŒ‰é”®</li>
<li>Pin Header Connectorï¼šæä¾›ä¸¤åˆ—æ’é’ˆï¼Œå°†èŠ¯ç‰‡çš„GPIOå£å¤–æ¥å‡ºæ¥</li>
<li>RGB LEDï¼šæä¾›ä¸€ä¸ªLEDç¯</li>
<li>WiFiï¼šæ”¯æŒWiFiåŠŸèƒ½</li>
<li>BTï¼šæ”¯æŒè“ç‰™åŠŸèƒ½</li>
</ul>
<h2 id="æŒ‰é”®ç”µè·¯å›¾"><a href="#æŒ‰é”®ç”µè·¯å›¾" class="headerlink" title="æŒ‰é”®ç”µè·¯å›¾"></a>æŒ‰é”®ç”µè·¯å›¾</h2><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹Bootå’ŒRSTæŒ‰é”®çš„ç”µè·¯å›¾ï¼š</p>
<p><img src="/2024/09/07/2024/ESP32-C3-DevKitM-1-Schematic/Snipaste_esp32c3_2024-09-07_12-01-02.png"></p>
<p>SW1æŒ‰é”®ï¼ˆå³BootæŒ‰é”®ï¼‰ï¼Œå½“SW1è¢«æŒ‰ä¸‹æ—¶ï¼Œç”µè·¯è¢«å¯¼é€šï¼ŒGPIO9ä»é«˜ç”µå¹³åˆ°ä½ç”µå¹³å˜åŒ–ï¼›åä¹‹ï¼Œå½“SW1è¢«æ¾å¼€æ—¶ï¼Œç”µè·¯è¢«æ–­å¼€ï¼ŒGPIO9ä»ä½ç”µå¹³åˆ°é«˜ç”µå¹³å˜åŒ–ï¼›</p>
<p>SW2æŒ‰é”®ï¼ˆå³RSTæŒ‰é”®ï¼‰ï¼Œå½“SW2è¢«æŒ‰ä¸‹æ—¶ï¼Œç”µè·¯è¢«å¯¼é€šï¼ŒCHIP_PUï¼ˆå³èŠ¯ç‰‡çš„ENæ¥å£ï¼‰ä»é«˜ç”µå¹³åˆ°ä½ç”µå¹³å˜åŒ–ï¼Œç›´æ¥å°†å¼€å‘æ¿å¤ä½ã€‚æ¥ç€æŸ¥çœ‹ä¸€ä¸‹CHIP_PUè¿æ¥çš„å¤ä½ç”µè·¯ï¼š</p>
<p><img src="/2024/09/07/2024/ESP32-C3-DevKitM-1-Schematic/image-20240907140310317.png" alt="image-20240907140310317"></p>
<h2 id="LEDç”µè·¯å›¾"><a href="#LEDç”µè·¯å›¾" class="headerlink" title="LEDç”µè·¯å›¾"></a>LEDç”µè·¯å›¾</h2><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹LEDçš„ç”µè·¯å›¾ï¼š</p>
<p><img src="/2024/09/07/2024/ESP32-C3-DevKitM-1-Schematic/image-20240907152038685.png" alt="image-20240907152038685"></p>
<p>é€šè¿‡GPIO8æ¥æ§åˆ¶LEDç¯ï¼Œå¼€å‘æ¿æä¾›çš„LEDæ”¯æŒçš„åŠŸèƒ½åŒ…æ‹¬ï¼šå¼€&#x2F;å…³ã€è°ƒèŠ‚äº®åº¦ã€è°ƒèŠ‚RGB</p>
<h2 id="GPIOæ±‡æ€»"><a href="#GPIOæ±‡æ€»" class="headerlink" title="GPIOæ±‡æ€»"></a>GPIOæ±‡æ€»</h2><p>ESP32-C3 èŠ¯ç‰‡å…·æœ‰ 22 ä¸ªç‰©ç† GPIO ç®¡è„šï¼ˆGPIO0 ~ GPIO21ï¼‰ã€‚æ¯ä¸ªç®¡è„šéƒ½å¯ç”¨ä½œä¸€ä¸ªé€šç”¨ IOï¼Œæˆ–è¿æ¥ä¸€ä¸ªå†…éƒ¨çš„å¤–è®¾ä¿¡å·ã€‚é€šè¿‡ GPIO äº¤æ¢çŸ©é˜µå’Œ IO MUXï¼Œå¯é…ç½®å¤–è®¾æ¨¡å—çš„è¾“å…¥ä¿¡å·æ¥æºäºä»»ä½•çš„ IO ç®¡è„šï¼Œå¹¶ä¸”å¤–è®¾æ¨¡å—çš„è¾“å‡ºä¿¡å·ä¹Ÿå¯è¿æ¥åˆ°ä»»æ„ IO ç®¡è„šã€‚è¿™äº›æ¨¡å—å…±åŒç»„æˆäº†èŠ¯ç‰‡çš„ IO æ§åˆ¶ã€‚</p>
<p>å‚è€ƒæ¥æºï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v5.2.2/esp32c3/api-reference/peripherals/gpio.html">ESP32-C3 GPIOæè¿°</a></p>
<table>
<thead>
<tr>
<th>GPIO</th>
<th>æ¨¡æ‹ŸåŠŸèƒ½</th>
<th>æ³¨é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>GPIO0</td>
<td>ADC1_CH0</td>
<td>RTC</td>
</tr>
<tr>
<td>GPIO1</td>
<td>ADC1_CH1</td>
<td>RTC</td>
</tr>
<tr>
<td>GPIO2</td>
<td>ADC1_CH2</td>
<td>Strappingç®¡æ•™ï¼›RTC</td>
</tr>
<tr>
<td>GPIO3</td>
<td>ADC1_CH3</td>
<td>RTC</td>
</tr>
<tr>
<td>GPIO4</td>
<td>ADC1_CH4</td>
<td>RTC</td>
</tr>
<tr>
<td>GPIO5</td>
<td>ADC2_CH0</td>
<td>RTC</td>
</tr>
<tr>
<td>GPIO6</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GPIO7</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GPIO8</td>
<td></td>
<td>Strappingç®¡è„š</td>
</tr>
<tr>
<td>GPIO9</td>
<td></td>
<td>Strappingç®¡è„š</td>
</tr>
<tr>
<td>GPIO10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GPIO11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GPIO12</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO13</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO14</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO15</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO16</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO17</td>
<td></td>
<td>SPI0&#x2F;1</td>
</tr>
<tr>
<td>GPIO18</td>
<td></td>
<td>USB-JTAG</td>
</tr>
<tr>
<td>GPIO19</td>
<td></td>
<td>USB-JTAG</td>
</tr>
<tr>
<td>GPIO20</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GPIO21</td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>ESP32-C3-DevKit-M1 åŸç†å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title>esp: blink project</title>
    <url>/2024/09/06/2024/esp-blink-project/</url>
    <content><![CDATA[<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>blinkç¤ºä¾‹çš„ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">--blink</span><br><span class="line">  |--mainï¼ˆå¿…æœ‰çš„mainç›®å½•ï¼‰</span><br><span class="line">     |--blink_example.c</span><br><span class="line">     |--CMakeLists.txtï¼ˆåº•å±‚ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼‰</span><br><span class="line">     |--idf_componect.yml</span><br><span class="line">     |--Kconfig.projbuildï¼ˆKconfigé…ç½®æ–‡ä»¶ï¼‰</span><br><span class="line">  |--CMakeLists.txtï¼ˆé¡¶å±‚ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼‰</span><br><span class="line">  |--pytest_blink.py</span><br><span class="line">  |--README.md</span><br><span class="line">  |--sdkconfig.ci.led_strip_spi</span><br></pre></td></tr></table></figure>

<h2 id="æºæ–‡ä»¶ä»£ç "><a href="#æºæ–‡ä»¶ä»£ç " class="headerlink" title="æºæ–‡ä»¶ä»£ç "></a>æºæ–‡ä»¶ä»£ç </h2><p>è¯¥é¡¹ç›®å°±åªæœ‰ä¸€ä¸ªæºæ–‡ä»¶ï¼šblink_example_main.c</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;driver/gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;led_strip.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sdkconfig.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;example&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Use project configuration menu (idf.py menuconfig) to choose the GPIO to blink,</span></span><br><span class="line"><span class="comment">   or you can edit the following line and set a number here.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// CONFIG_BLINK_GPIOçš„é»˜è®¤å€¼æ˜¯8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLINK_GPIO CONFIG_BLINK_GPIO</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> s_led_state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_BLINK_LED_STRIP</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">led_strip_handle_t</span> led_strip;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">blink_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* If the addressable LED is enabled */</span></span><br><span class="line">    <span class="keyword">if</span> (s_led_state) &#123;</span><br><span class="line">        <span class="comment">/* Set the LED pixel using RGB from 0 (0%) to 255 (100%) for each color */</span></span><br><span class="line">        led_strip_set_pixel(led_strip, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">/* Refresh the strip to send data */</span></span><br><span class="line">        led_strip_refresh(led_strip);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* Set all LED off to clear all pixels */</span></span><br><span class="line">        led_strip_clear(led_strip);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">configure_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Example configured to blink addressable LED!&quot;</span>);</span><br><span class="line">    <span class="comment">/* LED strip initialization with the GPIO and pixels number*/</span></span><br><span class="line">    <span class="type">led_strip_config_t</span> strip_config = &#123;</span><br><span class="line">        .strip_gpio_num = BLINK_GPIO,</span><br><span class="line">        .max_leds = <span class="number">1</span>, <span class="comment">// at least one LED on board</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> CONFIG_BLINK_LED_STRIP_BACKEND_RMT</span></span><br><span class="line">    <span class="type">led_strip_rmt_config_t</span> rmt_config = &#123;</span><br><span class="line">        .resolution_hz = <span class="number">10</span> * <span class="number">1000</span> * <span class="number">1000</span>, <span class="comment">// 10MHz</span></span><br><span class="line">        .flags.with_dma = <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    ESP_ERROR_CHECK(led_strip_new_rmt_device(&amp;strip_config, &amp;rmt_config, &amp;led_strip));</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> CONFIG_BLINK_LED_STRIP_BACKEND_SPI</span></span><br><span class="line">    <span class="type">led_strip_spi_config_t</span> spi_config = &#123;</span><br><span class="line">        .spi_bus = SPI2_HOST,</span><br><span class="line">        .flags.with_dma = <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    ESP_ERROR_CHECK(led_strip_new_spi_device(&amp;strip_config, &amp;spi_config, &amp;led_strip));</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> <span class="string">&quot;unsupported LED strip backend&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">/* Set all LED off to clear all pixels */</span></span><br><span class="line">    led_strip_clear(led_strip);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> CONFIG_BLINK_LED_GPIO</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">blink_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Set the GPIO level according to the state (LOW or HIGH)*/</span></span><br><span class="line">    gpio_set_level(BLINK_GPIO, s_led_state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">configure_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Example configured to blink GPIO LED!&quot;</span>);</span><br><span class="line">    gpio_reset_pin(BLINK_GPIO);</span><br><span class="line">    <span class="comment">/* Set the GPIO as a push/pull output */</span></span><br><span class="line">    gpio_set_direction(BLINK_GPIO, GPIO_MODE_OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> <span class="string">&quot;unsupported LED type&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Configure the peripheral according to the LED type */</span></span><br><span class="line">    configure_led();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Turning the LED %s!&quot;</span>, s_led_state == <span class="literal">true</span> ? <span class="string">&quot;ON&quot;</span> : <span class="string">&quot;OFF&quot;</span>);</span><br><span class="line">        blink_led();</span><br><span class="line">        <span class="comment">/* Toggle the LED state */</span></span><br><span class="line">        s_led_state = !s_led_state;</span><br><span class="line">        vTaskDelay(CONFIG_BLINK_PERIOD / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»æºæ–‡ä»¶ä¸­éœ€è¦ä¸»è¦çš„å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li><code>CONFIG_BLINK_GPIO</code>ï¼šè¿™ä¸ªå®æ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„ï¼Œå®šä¹‰çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><code>CONFIG_BLINK_LED_STRIP</code>ã€<code>CONFIG_BLINK_LED_GPIO</code>ï¼šè¿™ä¸¤ä¸ªå®åœ¨å“ªé‡Œå®šä¹‰çš„ï¼Œä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><code>CONFIG_BLINK_LED_STRIP_BACKEND_RMT</code>ã€<code>CONFIG_BLINK_LED_STRIP_BACKEND_SPI</code>ï¼šè¿™ä¸¤ä¸ªå®æ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><code>CONFIG_BLINK_PERIOD</code>ï¼šè¿™ä¸ªå®åœ¨å“ªé‡Œå®šä¹‰ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><code>portTICK_PERIOD_MS</code>ï¼šè¿™ä¸ªå®åœ¨å“ªé‡Œå®šä¹‰ï¼Ÿ</li>
</ul>
<p>blinkå·¥ç¨‹ç›®å½•ä¸‹æœ‰è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼šKconfig.projbuild</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">menu &quot;Example Configuration&quot;</span><br><span class="line"></span><br><span class="line">    orsource &quot;$IDF_PATH/examples/common_components/env_caps/$IDF_TARGET/Kconfig.env_caps&quot;</span><br><span class="line"></span><br><span class="line">    choice BLINK_LED</span><br><span class="line">        prompt &quot;Blink LED type&quot;</span><br><span class="line">        default BLINK_LED_GPIO if IDF_TARGET_ESP32 || IDF_TARGET_ESP32C2</span><br><span class="line">        default BLINK_LED_STRIP</span><br><span class="line">        help</span><br><span class="line">            Select the LED type. A normal level controlled LED or an addressable LED strip.</span><br><span class="line">            The default selection is based on the Espressif DevKit boards.</span><br><span class="line">            You can change the default selection according to your board.</span><br><span class="line"></span><br><span class="line">        config BLINK_LED_GPIO</span><br><span class="line">            bool &quot;GPIO&quot;</span><br><span class="line">        config BLINK_LED_STRIP</span><br><span class="line">            bool &quot;LED strip&quot;</span><br><span class="line">    endchoice</span><br><span class="line"></span><br><span class="line">    choice BLINK_LED_STRIP_BACKEND</span><br><span class="line">        depends on BLINK_LED_STRIP</span><br><span class="line">        prompt &quot;LED strip backend peripheral&quot;</span><br><span class="line">        default BLINK_LED_STRIP_BACKEND_RMT if SOC_RMT_SUPPORTED</span><br><span class="line">        default BLINK_LED_STRIP_BACKEND_SPI</span><br><span class="line">        help</span><br><span class="line">            Select the backend peripheral to drive the LED strip.</span><br><span class="line"></span><br><span class="line">        config BLINK_LED_STRIP_BACKEND_RMT</span><br><span class="line">            depends on SOC_RMT_SUPPORTED</span><br><span class="line">            bool &quot;RMT&quot;</span><br><span class="line">        config BLINK_LED_STRIP_BACKEND_SPI</span><br><span class="line">            bool &quot;SPI&quot;</span><br><span class="line">    endchoice</span><br><span class="line"></span><br><span class="line">    config BLINK_GPIO</span><br><span class="line">        int &quot;Blink GPIO number&quot;</span><br><span class="line">        range ENV_GPIO_RANGE_MIN ENV_GPIO_OUT_RANGE_MAX</span><br><span class="line">        default 5 if IDF_TARGET_ESP32</span><br><span class="line">        default 18 if IDF_TARGET_ESP32S2</span><br><span class="line">        default 48 if IDF_TARGET_ESP32S3</span><br><span class="line">        default 8</span><br><span class="line">        help</span><br><span class="line">            GPIO number (IOxx) to blink on and off the LED.</span><br><span class="line">            Some GPIOs are used for other purposes (flash connections, etc.) and cannot be used to blink.</span><br><span class="line"></span><br><span class="line">    config BLINK_PERIOD</span><br><span class="line">        int &quot;Blink period in ms&quot;</span><br><span class="line">        range 10 3600000</span><br><span class="line">        default 1000</span><br><span class="line">        help</span><br><span class="line">            Define the blinking period in milliseconds.</span><br><span class="line"></span><br><span class="line">endmenu</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†<code>CONFIG_BLINK_GPIO</code> ï¼Œåœ¨é…ç½®èœå•ä¸­æä¾›ä¸€ä¸ªèŒƒå›´ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œä¸åŒçš„ç›®æ ‡èŠ¯ç‰‡ç»™å®šäº†ä¸€ä¸ªé»˜è®¤å€¼ã€‚ç”±äºæµ‹è¯•çš„å¼€å‘æ¿çš„èŠ¯ç‰‡çš„ESP32-C3ï¼Œæ‰€ä»¥ç»™äº†é»˜è®¤å€¼8ã€‚</p>
<p>è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†<code>CONFIG_BLINK_LED_STRIP</code>ã€<code>CONFIG_BLINK_LED_GPIO</code>ï¼Œåœ¨é…ç½®èœå•ä¸­æä¾›æ”¯æŒçš„LEDç±»å‹è®©ç”¨æˆ·é€‰æ‹©ï¼Œå¯é€‰é¡¹ï¼šLED GPIOï¼ˆæ™®é€šçš„LEDï¼‰ or LED STRIPï¼ˆå¯å¯»å€çš„LEDï¼‰ã€‚ç”±äºæµ‹è¯•çš„å¼€å‘æ¿çš„èŠ¯ç‰‡çš„ESP32-C3ï¼Œæ‰€ä»¥ç»™äº†é»˜è®¤å€¼ï¼š<code>CONFIG_BLINK_LED_STRIP</code>ã€‚</p>
<p>è‹¥é€‰æ‹©LEDç±»å‹æ˜¯LED STRIPï¼Œè¿˜è¦ä¸ºå…¶é€‰æ‹©é©±åŠ¨ç±»å‹ï¼Œå¯é€‰é¡¹ï¼šSPI å’Œ RMTï¼Œå³<code>CONFIG_BLINK_LED_STRIP_BACKEND_RMT</code>ã€<code>CONFIG_BLINK_LED_STRIP_BACKEND_SPI</code>ï¼Œç”±äºæµ‹è¯•çš„å¼€å‘æ¿çš„èŠ¯ç‰‡çš„ESP32-C3ï¼Œæ‰€ä»¥ç»™äº†é»˜è®¤å€¼ï¼šSPIã€‚</p>
<p>è¿™ä¸ªæ–‡ä»¶è¿˜å®šä¹‰äº†<code>CONFIG_BLINK_PERIOD</code> ï¼Œæä¾›ä¸€ä¸ªèŒƒå›´ç»™ç”¨æˆ·é€‰æ‹©ï¼Œæ­¤å¤„çš„é»˜è®¤å€¼æ˜¯1000msï¼Œç”¨äºé—ªçƒå‘¨æœŸã€‚</p>
<p>æœ€åä¸€ä¸ªå®<code>portTICK_PERIOD_MS</code> ï¼Œè¿™ä¸ªæ˜¯çœŸçš„éš¾æ‰¾ï¼Œè¿˜ä¸èƒ½æŒ‰å›¾ç´¢éª¥ã€‚è¿˜æ˜¯é€šè¿‡æµè§ˆå™¨æœç´¢æ‰¾åˆ°äº†ä¸€éæ–‡ç« æ‰æ‰¾åˆ°ï¼š<a href="https://blog.csdn.net/sunnysunice/article/details/129817691">ç»†è¯´åŸºäºIDF-IDEçš„ESP32 å…¥é—¨ä¾‹ç¨‹blinkå·¥ç¨‹</a>ã€‚æŒ‰ç…§åˆ†äº«çš„æ–‡ç« ï¼Œå¦‚ä½•æ‰¾åˆ°è¿™ä¸ªå­—æ®µçš„å®šä¹‰ï¼š</p>
<ul>
<li><p>æœç´¢è¿™ä¸ªæ–‡ä»¶ï¼š<code>portmacro.h</code>ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°äº†å®šä¹‰</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> portTICK_PERIOD_MS          ( ( TickType_t ) 1000 / configTICK_RATE_HZ )</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¥ä¸‹æ¥æ‰¾è¿™ä¸ªï¼šconfigTICK_RATE_HZï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼š<code>FreeRTOSConfig.h</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> configTICK_RATE_HZ                           CONFIG_FREERTOS_HZ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€åæŸ¥æ‰¾ï¼š<code>CONFIG_FREERTOS_HZ</code> å°±å®¹æ˜“äº†ï¼Œç›´æ¥åœ¨<code>sdkconfig</code>æ–‡ä»¶ä¸­æ‰¾å°±å¥½äº†</p>
</li>
</ul>
<p>å°±è¿™ç§ææ³•ï¼Œæƒ³è®©åˆå­¦è€…å…¥é—¨çœŸçš„éš¾åº¦å¤ªå¤§äº†ï¼Œéƒ½ä¸ç”¨å»çœ‹ä»£ç é€»è¾‘ï¼Œå…‰æ‰¾è¿™äº›å®å’Œå˜é‡çš„å®šä¹‰å°±å¯ä»¥åŠé€€å¾ˆå¤šäººäº†ã€‚</p>
<h2 id="ç®€åŒ–ä»£ç "><a href="#ç®€åŒ–ä»£ç " class="headerlink" title="ç®€åŒ–ä»£ç "></a>ç®€åŒ–ä»£ç </h2><p>ESP32-C3-DevKit-M-1å¼€å‘æ¿GPIO8å¤–æ¥LED_STRIPç±»å‹ws2812è®¾å¤‡ï¼Œæ‰€ä»¥ä»£ç å¯ä»¥è¿™æ ·ç®€åŒ–ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;driver/gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;led_strip.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sdkconfig.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;example&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLINK_GPIO 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLINK_PERIOD 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒå®šä¹‰ä¸¤ç§STRIPæ¨¡å¼ï¼šSPI å’Œ RMT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLINK_LED_STRIP_BACKEND_TYPE <span class="string">&quot;SPI&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> s_led_state = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">led_strip_handle_t</span> led_strip;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">blink_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* If the addressable LED is enabled */</span></span><br><span class="line">    <span class="keyword">if</span> (s_led_state) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Set the LED pixel using RGB from 0 (0%) to 255 (100%) for each color */</span></span><br><span class="line">        led_strip_set_pixel(led_strip, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">/* Refresh the strip to send data */</span></span><br><span class="line">        led_strip_refresh(led_strip);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Set all LED off to clear all pixels */</span></span><br><span class="line">        led_strip_clear(led_strip);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">configure_led</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Example configured to blink addressable LED!&quot;</span>);</span><br><span class="line">    <span class="comment">/* LED strip initialization with the GPIO and pixels number*/</span></span><br><span class="line">    <span class="type">led_strip_config_t</span> strip_config = &#123;</span><br><span class="line">        .strip_gpio_num = BLINK_GPIO,</span><br><span class="line">        .max_leds = <span class="number">1</span>, <span class="comment">// at least one LED on board</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(BLINK_LED_STRIP_BACKEND_TYPE, <span class="string">&quot;RMT&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">led_strip_rmt_config_t</span> rmt_config = &#123;</span><br><span class="line">            .resolution_hz = <span class="number">10</span> * <span class="number">1000</span> * <span class="number">1000</span>, <span class="comment">// 10MHz</span></span><br><span class="line">            .flags.with_dma = <span class="literal">false</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        ESP_ERROR_CHECK(led_strip_new_rmt_device(&amp;strip_config, &amp;rmt_config, &amp;led_strip));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(BLINK_LED_STRIP_BACKEND_TYPE, <span class="string">&quot;SPI&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">led_strip_spi_config_t</span> spi_config = &#123;</span><br><span class="line">            .spi_bus = SPI2_HOST,</span><br><span class="line">            .flags.with_dma = <span class="literal">true</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        ESP_ERROR_CHECK(led_strip_new_spi_device(&amp;strip_config, &amp;spi_config, &amp;led_strip));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Set all LED off to clear all pixels */</span></span><br><span class="line">    led_strip_clear(led_strip);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Configure the peripheral according to the LED type */</span></span><br><span class="line">    configure_led();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Turning the LED %s!&quot;</span>, s_led_state == <span class="literal">true</span> ? <span class="string">&quot;ON&quot;</span> : <span class="string">&quot;OFF&quot;</span>);</span><br><span class="line">        blink_led();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Toggle the LED state */</span></span><br><span class="line">        s_led_state = !s_led_state;</span><br><span class="line">        vTaskDelay(BLINK_PERIOD / <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·é€šè¿‡<code>BLINK_LED_STRIP_BACKEND_TYPE</code> å®æ¥å®šä¹‰æ§åˆ¶ç±»å‹ã€‚</p>
]]></content>
      <categories>
        <category>esp</category>
      </categories>
      <tags>
        <tag>ç‚¹ç¯</tag>
        <tag>ESP32-C3-DevKit-M-1</tag>
      </tags>
  </entry>
  <entry>
    <title>Matter: On/Off Cluster</title>
    <url>/2024/09/06/2024/Matter-On-Off-Cluster/</url>
    <content><![CDATA[<blockquote>
<p>On&#x2F;Off Clusterçš„ä½œç”¨ï¼Ÿ</p>
</blockquote>
<p>ç”¨äºæ‰“å¼€å’Œå…³é—­è®¾å¤‡çš„å±æ€§å’Œå‘½ä»¤ã€‚</p>
<h2 id="Cluster-ID"><a href="#Cluster-ID" class="headerlink" title="Cluster ID"></a>Cluster ID</h2><p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>Hierarchy</th>
<th>Role</th>
<th>Scope</th>
<th>PICS Code</th>
</tr>
</thead>
<tbody><tr>
<td>Base</td>
<td>Application</td>
<td>Endpoint</td>
<td>OO</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
</tr>
</tbody></table>
<h2 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h2><table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Type</th>
<th>Constraint</th>
<th>Quality</th>
<th>Default</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0000</td>
<td>OnOff</td>
<td>bool</td>
<td>all</td>
<td>SN</td>
<td>FALSE</td>
<td>R V</td>
<td>M</td>
</tr>
<tr>
<td>0x4000</td>
<td>GlobalSceneControl</td>
<td>bool</td>
<td>all</td>
<td></td>
<td>TRUE</td>
<td>R V</td>
<td>LT</td>
</tr>
<tr>
<td>0x4001</td>
<td>OnTime</td>
<td>uint16</td>
<td>all</td>
<td></td>
<td>0</td>
<td>RW VO</td>
<td>LT</td>
</tr>
<tr>
<td>0x4002</td>
<td>OffWaitTime</td>
<td>uint16</td>
<td>all</td>
<td></td>
<td>0</td>
<td>RW VO</td>
<td>LT</td>
</tr>
<tr>
<td>0x4003</td>
<td>StartUpOnOff</td>
<td>StartUpOnOffEnum</td>
<td>desc</td>
<td>XN</td>
<td>MS</td>
<td>RW VM</td>
<td>LT</td>
</tr>
</tbody></table>
<p><strong>OnOff Attribute</strong></p>
<p>è¿™ä¸ªå±æ€§æš—ç¤ºç€åœ¨Endpointä¸Šè®¾å¤‡çŠ¶æ€æ˜¯å…³é—­æˆ–æ‰“å¼€ï¼Œè¯¥å±æ€§çš„å€¼ä¹Ÿå¯¹åº”ç€FALSEæˆ–TRUEã€‚</p>
<p><strong>GlobalSceneControl Attribute</strong></p>
<p>ä¸ºäº†æ”¯æŒç”¨æˆ·æ¢å¤ä¸€ç»„è®¾å¤‡çš„æœ€åè®¾ç½®ï¼ˆä¾‹å¦‚ç¯å…‰çš„çº§åˆ«è®¾ç½®ï¼‰çš„ç”¨ä¾‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨å±€åœºæ™¯ï¼Œè¯¥åœºæ™¯åœ¨è®¾å¤‡å…³é—­æ—¶å­˜å‚¨å¹¶åœ¨è®¾å¤‡æ‰“å¼€æ—¶è°ƒç”¨ã€‚å…¨å±€åœºæ™¯å®šä¹‰ä¸ºä½¿ç”¨ç»„æ ‡è¯†ç¬¦ 0 å’Œåœºæ™¯æ ‡è¯†ç¬¦ 0 å­˜å‚¨çš„åœºæ™¯ã€‚</p>
<p>å®šä¹‰æ­¤å±æ€§æ˜¯ä¸ºäº†é˜²æ­¢ç¬¬äºŒä¸ª Off å‘½ä»¤å°†æ‰€æœ‰è®¾å¤‡å…³é—­çš„æƒ…å†µå­˜å‚¨ä¸ºå…¨å±€åœºæ™¯ï¼Œå¹¶é˜²æ­¢ç¬¬äºŒä¸ª On å‘½ä»¤é€šè¿‡è¿”å›å…¨å±€åœºæ™¯æ¥ç ´åå½“å‰è®¾ç½®ã€‚</p>
<p>åœ¨æ”¶åˆ°å¯¼è‡´ OnOff å±æ€§è®¾ç½®ä¸º TRUE çš„å‘½ä»¤åï¼Œæ­¤å±æ€§åº”è®¾ç½®ä¸º TRUEï¼Œä¾‹å¦‚æ ‡å‡†Onå‘½ä»¤ã€MoveToLevel(WithOnOff) å‘½ä»¤ã€RecallScene å‘½ä»¤æˆ– OnWithRecallGlobalScene å‘½ä»¤ã€‚</p>
<p>åœ¨æ”¶åˆ° OffWithEffect å‘½ä»¤åï¼Œæ­¤å±æ€§çš„å€¼åº”è¯¥è®¾ç½®ä¸ºFALSEã€‚</p>
<p><strong>OnTime Attribute</strong></p>
<p>æ­¤å±æ€§æŒ‡å®šä½¿ç”¨ OnWithTimedOff å‘½ä»¤æ—¶ï¼Œåœ¨è‡ªåŠ¨è½¬æ¢ä¸º Off çŠ¶æ€ä¹‹å‰åº”ä¿æŒ On çŠ¶æ€çš„æ—¶é—´é•¿åº¦ï¼ˆä»¥ 1&#x2F;10 ç§’ä¸ºå•ä½ï¼‰ã€‚æ­¤å±æ€§å¯ä»¥éšæ—¶å†™å…¥ï¼Œä½†å†™å…¥å€¼ä»…åœ¨ Timed On çŠ¶æ€ä¸‹æ‰æœ‰æ•ˆã€‚</p>
<p><strong>OffWaitTime Attribute</strong></p>
<p>æ­¤å±æ€§æŒ‡å®šåº”ä¿æŠ¤å…³é—­çŠ¶æ€çš„æ—¶é—´é•¿åº¦ï¼ˆä»¥ 1&#x2F;10 ç§’ä¸ºå•ä½ï¼‰ï¼Œä»¥é˜²æ­¢å¦ä¸€ä¸ª OnWithTimedOff å‘½ä»¤å°†æœåŠ¡å™¨é‡æ–°åˆ‡æ¢å›å¼€å¯çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œç¦»å¼€æˆ¿é—´æ—¶ï¼Œç¯ä¼šå…³é—­ï¼Œä½†å ç”¨ä¼ æ„Ÿå™¨ä¼šæ£€æµ‹åˆ°ç¦»å¼€çš„äººå¹¶å°è¯•å°†ç¯é‡æ–°æ‰“å¼€ï¼‰ã€‚æ­¤å±æ€§å¯ä»¥éšæ—¶å†™å…¥ï¼Œä½†å†™å…¥å€¼ä»…åœ¨å¤„äºå®šæ—¶å¼€å¯çŠ¶æ€åè½¬æ¢åˆ°å»¶è¿Ÿå…³é—­çŠ¶æ€æˆ–å¤„äºå»¶è¿Ÿå…³é—­çŠ¶æ€æ—¶æ‰æœ‰æ•ˆã€‚</p>
<p><strong>StartUpOnOff Attribute</strong></p>
<p>æ­¤å±æ€§å®šä¹‰è®¾å¤‡é€šç”µæ—¶æ‰€éœ€çš„å¯åŠ¨è¡Œä¸ºå¹¶ä¸”æ­¤çŠ¶æ€åº”åæ˜ åœ¨ OnOff å±æ€§ä¸­ã€‚å¦‚æœå€¼ä¸ºç©ºï¼Œåˆ™å°† OnOff å±æ€§è®¾ç½®ä¸ºå…¶å…ˆå‰çš„å€¼ã€‚å¦åˆ™ï¼Œè¡Œä¸ºåœ¨å®šä¹‰ StartUpOnOffEnum çš„è¡¨ä¸­å®šä¹‰ã€‚</p>
<p>æ­¤å±æ€§ä¸é€‚ç”¨äºä¸ OTA ç›¸å…³çš„é‡å¯ã€‚OTA é‡å¯åï¼ŒOnOff å±æ€§åº”æ¢å¤ä¸ºé‡å¯å‰çš„å€¼ã€‚</p>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Direction</th>
<th>Response</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>Off</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>M</td>
</tr>
<tr>
<td>0x01</td>
<td>On</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>!OFFONLY</td>
</tr>
<tr>
<td>0x02</td>
<td>Toggle</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>!OFFONLY</td>
</tr>
<tr>
<td>0x40</td>
<td>OffWithEffect</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>LT</td>
</tr>
<tr>
<td>0x41</td>
<td>OnWithRecallGlobalSence</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>LT</td>
</tr>
<tr>
<td>0x42</td>
<td>OnWithTimedOff</td>
<td>client â€“&gt; server</td>
<td>Y</td>
<td>O</td>
<td>LT</td>
</tr>
</tbody></table>
<p><strong>Off Command</strong></p>
<p>æ”¶åˆ°Offå‘½ä»¤åï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OnOffå±æ€§çš„å€¼è®¾ç½®ä¸ºFALSEã€‚æ­¤å¤–ï¼Œå½“æ”¯æŒOnTimeå±æ€§æ—¶ï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OnTimeå±æ€§çš„å€¼è®¾ç½®ä¸º0ã€‚</p>
<p><strong>On Command</strong></p>
<p>å¦‚æœæ”¯æŒOffOnlyåŠŸèƒ½ï¼ˆæˆ–ç‰¹å¾ï¼‰æ—¶ï¼Œæ”¶åˆ°Onå‘½ä»¤åï¼ŒæœåŠ¡å™¨åº”è¯¥å‘é€UNSUPPORTED_COMMANDå¤±è´¥çŠ¶æ€å“åº”ã€‚å¦åˆ™ï¼Œæ”¶åˆ°Onå‘½ä»¤åï¼ŒæœåŠ¡å™¨åº”è¯¥è®¾ç½®OnOffå±æ€§çš„å€¼ä¸ºTRUEã€‚</p>
<p>æ­¤å¤–ï¼Œå½“åŒæ—¶æ”¯æŒOnTimeå’ŒOffWaitTimeä¸¤ä¸ªå±æ€§æ—¶ï¼Œå¦‚æœOnTimeå±æ€§çš„å€¼ç­‰äº0ï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OffWaitTimeå±æ€§çš„å€¼è®¾ç½®ä¸º0ã€‚</p>
<p><strong>Toggle Command</strong></p>
<p>å¦‚æœæ”¯æŒOffOnlyåŠŸèƒ½ï¼ˆæˆ–ç‰¹å¾ï¼‰ï¼Œæ”¶åˆ°Toggleå‘½ä»¤åï¼ŒæœåŠ¡å™¨åº”è¯¥å‘é€UNSUPPORTED_COMMANDå¤±è´¥çŠ¶æ€å“åº”ã€‚å¦åˆ™ï¼Œæ”¶åˆ°Toggleå‘½ä»¤åï¼Œå¦‚æœOnOffå±æ€§çš„å€¼ç­‰äºFALSEï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OnOffå±æ€§çš„å€¼è®¾ç½®ä¸ºTRUEï¼›å¦‚æœOnOffå±æ€§çš„å€¼ç­‰äºTRUEï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OnOffå±æ€§çš„å€¼è®¾ç½®ä¸ºFALSEã€‚</p>
<p>æ­¤å¤–ï¼Œå½“åŒæ—¶æ”¯æŒOnTimeå’ŒOffWaitTimeä¸¤ä¸ªå±æ€§æ—¶ï¼Œå¦‚æœOnOffå±æ€§çš„å€¼ç­‰äºFALSEï¼Œä¸”å¦‚æœOnTimeå±æ€§çš„å€¼ç­‰äº0ï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OffWaitTimeå±æ€§çš„å€¼è®¾ç½®ä¸º0ã€‚å¦‚æœOnOffå±æ€§çš„å€¼ç­‰äºTRUEï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OnTimeå±æ€§çš„å€¼è®¾ç½®ä¸º0ã€‚</p>
<p><strong>OffWithRecallGlobalSence Command</strong></p>
<p>è¿™ä¸ªå‘½ä»¤å…è®¸åœ¨è®¾å¤‡å…³é—­æ—¶è°ƒç”¨è®¾ç½®ã€‚</p>
<p>æ”¶åˆ°OffWithRecallGlobalSenceå‘½ä»¤åï¼Œå¦‚æœGlobalSceneControlå±æ€§çš„å€¼ç­‰äºTRUEï¼ŒæœåŠ¡å™¨åº”è¯¥ä¸¢å¼ƒè¿™ä¸ªå‘½ä»¤ã€‚</p>
<p>å¦‚æœGlobalSceneControlå±æ€§çš„å€¼ç­‰äºFALSEï¼Œé‚£ä¹ˆåŒä¸€ä¸ªEndpointä¸ŠScene ClusteræœåŠ¡å™¨åº”è¯¥è°ƒç”¨å®ƒçš„global sceneï¼Œå¹¶æ›´æ–°OnOffå±æ€§çš„å€¼ã€‚OnOffæœåŠ¡å™¨åº”è¯¥å°†GlobalSceneControlå±æ€§çš„å€¼è®¾ç½®ä¸ºTRUEã€‚</p>
<p>æ­¤å¤–ï¼Œå½“åŒæ—¶æ”¯æŒOnTimeå’ŒOffWaitTimeä¸¤ä¸ªå±æ€§æ—¶ï¼Œå¦‚æœOnTimeå±æ€§çš„å€¼ç­‰äº0ï¼ŒæœåŠ¡å™¨åº”è¯¥å°†OffWaitTimeå±æ€§çš„å€¼è®¾ç½®ä¸º0ã€‚</p>
<p><strong>OnWithTimedOff Command</strong></p>
<p>æ­¤å‘½ä»¤å…è®¸è®¾å¤‡åœ¨ç‰¹å®šæŒç»­æ—¶é—´å†…æ‰“å¼€ï¼Œå¹¶å…·æœ‰å—ä¿æŠ¤çš„æŒç»­æ—¶é—´ï¼Œå› æ­¤å¦‚æœè®¾å¤‡éšåå…³é—­ï¼Œåœ¨æ­¤æœŸé—´å†æ¬¡æ”¶åˆ° OnWithTimedOff å‘½ä»¤ï¼Œæ— æ³•é‡æ–°æ‰“å¼€è®¾å¤‡ã€‚åœ¨æœåŠ¡å™¨æ‰“å¼€æ—¶ï¼Œæ”¶åˆ°çš„æ›´å¤š OnWithTimedOff å‘½ä»¤å°†æ›´æ–°è®¾å¤‡æ‰“å¼€çš„æ—¶é—´æ®µã€‚</p>
<p><em>OnWithTimedOff å‘½ä»¤çš„æ•°æ®åŸŸ</em></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Type</th>
<th>Constraint</th>
<th>Quality</th>
<th>Default</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>OnOffControl</td>
<td>OnOffControlBitamp</td>
<td>0 to 1</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>1</td>
<td>OnTime</td>
<td>uint16</td>
<td>max 0xfffe</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>2</td>
<td>OffWaitTime</td>
<td>uint16</td>
<td>max 0xfffe</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
  </entry>
  <entry>
    <title>Matter: Sensor</title>
    <url>/2024/09/06/2024/Matter-Sensor/</url>
    <content><![CDATA[<p>å¯¹äºä¼ æ„Ÿå™¨å™¨ç±»å‹è®¾å¤‡æœ‰å¾ˆå¤šç§ï¼Œåˆ†åˆ«æœ‰ï¼š</p>
<ul>
<li>Contact Sensorï¼ˆæ¥è§¦å¼ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Light Sensorï¼ˆå…‰ä¼ æ„Ÿå™¨ or å…‰æ•ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Occupancy Sensorï¼ˆå ç”¨ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Temperature Sensorï¼ˆæ¸©åº¦ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Pressure Sensorï¼ˆå‹åŠ›ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Flow Sensorï¼ˆæµé‡ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Humidity Sensorï¼ˆæ¹¿åº¦ä¼ æ„Ÿå™¨ï¼‰</li>
<li>On&#x2F;Off Sensorï¼ˆå¼€&#x2F;å…³ ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Smoke CO Alarmï¼ˆçƒŸé›¾ä¸€æ°§åŒ–ç¢³æŠ¥è­¦å™¨ï¼‰</li>
<li>Air Quality Sensorï¼ˆç©ºæ°”è´¨é‡ä¼ æ„Ÿå™¨ï¼‰</li>
<li>Water Freeze Detectorï¼ˆæ°´å†»æ¢æµ‹å™¨ï¼‰</li>
<li>Water Leak Detectorï¼ˆæ¼æ°´æ¢æµ‹å™¨ï¼‰</li>
<li>Rain Sensorï¼ˆé›¨é‡ä¼ æ„Ÿå™¨ï¼‰</li>
</ul>
<p>æ‰€æœ‰ä¼ æ„Ÿå™¨å¯¹åº”çš„ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
</tr>
</thead>
<tbody><tr>
<td>0x0015</td>
<td>Contact Sensor</td>
</tr>
<tr>
<td>0x0106</td>
<td>Light Sensor</td>
</tr>
<tr>
<td>0x0107</td>
<td>Occupancy Sensor</td>
</tr>
<tr>
<td>0x0302</td>
<td>Temperature Sensor</td>
</tr>
<tr>
<td>0x0305</td>
<td>Pressure Sensor</td>
</tr>
<tr>
<td>0x0306</td>
<td>Flow Sensor</td>
</tr>
<tr>
<td>0x0307</td>
<td>Humidity Sensor</td>
</tr>
<tr>
<td>0x0850</td>
<td>On&#x2F;Off Sensor</td>
</tr>
<tr>
<td>0x0076</td>
<td>Smoke CO Alarm</td>
</tr>
<tr>
<td>0x002c</td>
<td>Air Quality Sensor</td>
</tr>
<tr>
<td>0x0041</td>
<td>Water Freeze Detector</td>
</tr>
<tr>
<td>0x0043</td>
<td>Water Leak Detector</td>
</tr>
<tr>
<td>0x0044</td>
<td>Rain Sensor</td>
</tr>
</tbody></table>
<h2 id="Contact-Sensor"><a href="#Contact-Sensor" class="headerlink" title="Contact Sensor"></a>Contact Sensor</h2><p>æ¥è§¦å¼ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹é—¨çª—ç­‰å¼€å£å¤„æ˜¯å¦å…³é—­çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0015</td>
<td>Contact Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0045</td>
<td><strong>Boolean State</strong></td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0080</td>
<td>Boolean State Configuration</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Light-Sensor"><a href="#Light-Sensor" class="headerlink" title="Light Sensor"></a>Light Sensor</h2><p>å…‰ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§èƒ½å¤Ÿæ£€æµ‹ç¯å¢ƒå…‰å¼ºåº¦çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0106</td>
<td>Light Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>[Zigbee]</td>
</tr>
<tr>
<td>0x0400</td>
<td>Illuminance Measurement</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<p><em>Illuminance Measurementï¼šå…‰å¼ºåº¦æ£€æµ‹å€¼</em></p>
<h2 id="Occupancy-Sendor"><a href="#Occupancy-Sendor" class="headerlink" title="Occupancy Sendor"></a>Occupancy Sendor</h2><p>å ç”¨ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹ä¸€ä¸ªåŒºåŸŸæ˜¯å¦æœ‰äººæˆ–å…¶ä»–ç”Ÿç‰©ä½“å­˜åœ¨çš„è®¾å¤‡ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ£€æµ‹ç”Ÿç‰©ä½“ï¼šçº¢å¤–çº¿ã€è¶…å£°æ³¢ã€å¾®æ³¢ã€å›¾åƒè®¾å¤‡ã€é›·è¾¾ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0107</td>
<td>Occupancy Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sesing</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Temperature-Sensor"><a href="#Temperature-Sensor" class="headerlink" title="Temperature Sensor"></a>Temperature Sensor</h2><p>æ¸©åº¦ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹ç¯å¢ƒæˆ–ç‰©ä½“æ¸©åº¦çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0302</td>
<td>Temperature Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>[zigbee]</td>
</tr>
</tbody></table>
<h2 id="Pressure-Sensor"><a href="#Pressure-Sensor" class="headerlink" title="Pressure Sensor"></a>Pressure Sensor</h2><p>å‹åŠ›ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§èƒ½å¤Ÿæµ‹é‡æµä½“å’Œæ°”ä½“å‹åŠ›å˜åŒ–è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0305</td>
<td>Pressure Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0403</td>
<td>Pressure Measurement</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>[zigbee]</td>
</tr>
</tbody></table>
<h2 id="Flow-Sensor"><a href="#Flow-Sensor" class="headerlink" title="Flow Sensor"></a>Flow Sensor</h2><p>æµé‡ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæµ‹é‡æµä½“ï¼ˆæ¶²ä½“æˆ–æ°”ä½“ï¼‰æµåŠ¨é€Ÿç‡çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0306</td>
<td>Flow Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>[zigbee]</td>
</tr>
</tbody></table>
<h2 id="Humidity-Sensor"><a href="#Humidity-Sensor" class="headerlink" title="Humidity Sensor"></a>Humidity Sensor</h2><p>æ¹¿åº¦ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæµ‹é‡ç©ºæ°”ä¸­æ°´åˆ†å«é‡çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0307</td>
<td>Humidity Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0405</td>
<td>Relative Humidity Measurement</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>[zigbee]</td>
</tr>
</tbody></table>
<h2 id="On-Off-Sensor"><a href="#On-Off-Sensor" class="headerlink" title="On&#x2F;Off Sensor"></a>On&#x2F;Off Sensor</h2><p>å¼€&#x2F;å…³ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹è®¾å¤‡æˆ–ç³»ç»Ÿæ˜¯å¦å¤„äºå¼€å¯æˆ–å…³é—­çŠ¶æ€çš„ä¼ æ„Ÿå™¨ã€‚ä¾‹å¦‚ï¼Œå½“ç»‘å®šåˆ°ä¸€ä¸ªå¯è°ƒå…‰ç¯è®¾å¤‡ï¼Œèƒ½å¤ŸåŒ¹é…åˆ°ç¯æ˜¯å¼€å¯æˆ–å…³é—­çŠ¶æ€ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0850</td>
<td>On&#x2F;Off Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Smoke-CO-Alarm"><a href="#Smoke-CO-Alarm" class="headerlink" title="Smoke CO Alarm"></a>Smoke CO Alarm</h2><p>çƒŸé›¾ä¸€æ°§åŒ–ç¢³æŠ¥è­¦å™¨æ˜¯ä¸€ç§æ£€æµ‹çƒŸé›¾å’Œä¸€æ°§åŒ–ç¢³çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0076</td>
<td>Smoke CO Alarm</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x005c</td>
<td>Smoke CO Alarm</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0405</td>
<td>Realative Humidity Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x040c</td>
<td>Carbon Monixide Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Air-Quality-Sensor"><a href="#Air-Quality-Sensor" class="headerlink" title="Air Quality Sensor"></a>Air Quality Sensor</h2><p>ç©ºæ°”è´¨é‡ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹ç¯å¢ƒä¸­ç©ºæ°”è´¨é‡çš„è®¾å¤‡ã€‚å¯ä»¥æ£€æµ‹å¤šç§ç©ºæ°”æ±¡æŸ“ç‰©ï¼Œä¾‹å¦‚ï¼šé¢—ç²’ç‰©ï¼ˆPM2.5ï¼‰ã€æŒ¥å‘æ€§æœ‰æœºåŒ–åˆç‰©ã€ä¸€æ°§åŒ–ç¢³ã€äºŒæ°§åŒ–ç¡«ç­‰ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x002c</td>
<td>Air Quality Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x005b</td>
<td>Air Quality</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0405</td>
<td>Realative Humidity Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x040c</td>
<td>Carbon Monixide Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x040d</td>
<td>Carbon Dioxide Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0413</td>
<td>Nitrogen Dioxide Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0415</td>
<td>Ozone Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042b</td>
<td>Formaldehyde Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042c</td>
<td>PM1 Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042a</td>
<td>PM2.5 Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042d</td>
<td>PM10 Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042f</td>
<td>Radon Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x042e</td>
<td>Total Volatile Organic Compounds Concentration Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><em>åè¯è§£é‡Šï¼š</em></p>
<p><em>1ã€Carbon Monixide Concentration Measurementï¼šä¸€æ°§åŒ–ç¢³æµ“åº¦æµ‹é‡</em></p>
<p><em>2ã€Carbon Dioxide Concentration Measurementï¼šäºŒæ°§åŒ–ç¢³æµ“åº¦æµ‹é‡</em></p>
<p><em>3ã€Nitrogen Dioxide Concentration Measurementï¼šäºŒæ°§åŒ–æ°®æµ“åº¦æµ‹é‡</em></p>
<p><em>4ã€Ozone Concentration Measurementï¼šè‡­æ°§æµ“åº¦æµ‹é‡</em></p>
<p><em>5ã€Formaldehyde Concentration Measurementï¼šç”²é†›æµ“åº¦æµ‹é‡</em></p>
<p><em>6ã€Radon Concentration Measurementï¼šæ°¡æµ“åº¦æµ‹é‡</em></p>
<p><em>7ã€Total Volatile Organic Compounds Concentration Measurementï¼šå‘æŒ¥æ€§æœ‰æœºç‰©æµ“åº¦æ€»é‡æµ‹é‡</em></p>
<h2 id="Water-Freeze-Detector"><a href="#Water-Freeze-Detector" class="headerlink" title="Water Freeze Detector"></a>Water Freeze Detector</h2><p>æ°´å†»æ¢æµ‹å™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹æ°´æ¸©æ˜¯å¦åˆ°è¾¾å†°ç‚¹çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0041</td>
<td>Water Freeze Detector</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0080</td>
<td>Boolean State Configuration</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Event</td>
<td>StateChange</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Water-Leak-Detector"><a href="#Water-Leak-Detector" class="headerlink" title="Water Leak Detector"></a>Water Leak Detector</h2><p>æ¼æ°´æ£€æµ‹å™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹æ˜¯å¦æ¼æ°´çš„ä¼ æ„Ÿå™¨ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0043</td>
<td>Water Leak Detector</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0080</td>
<td>Boolean State Configuration</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Event</td>
<td>StateChange</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Rain-Sensor"><a href="#Rain-Sensor" class="headerlink" title="Rain Sensor"></a>Rain Sensor</h2><p>é›¨é‡ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹é™é›¨å¼ºåº¦çš„è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0044</td>
<td>Rain Sensor</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0080</td>
<td>Boolean State Configuration</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0045</td>
<td>Boolean State</td>
<td>Event</td>
<td>StateChange</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>Sensor Device</tag>
      </tags>
  </entry>
  <entry>
    <title>Matter: Smart Plugs/Outlets and Other Actuators</title>
    <url>/2024/09/05/2024/Matter-Smart-Plugs-Outlets-and-Other-Actuators/</url>
    <content><![CDATA[<p>æ™ºèƒ½æ’å¤´&#x2F;æ’åº§å’Œå…¶ä»–æ‰§è¡Œå™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œåˆ†åˆ«æœ‰ï¼šOn&#x2F;Off Plug-in Unitã€Dimmable Plug-In Unitã€Pumpã€Water Value</p>
<p>Smart Plugs&#x2F;Outlets and Other Actuatorsç±»å‹æ‰€æœ‰è®¾å¤‡ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
</tr>
</thead>
<tbody><tr>
<td>0x010a</td>
<td>On&#x2F;Off Plug-in Unit</td>
</tr>
<tr>
<td>0x010b</td>
<td>Dimmable Plug-In Unit</td>
</tr>
<tr>
<td>0x0303</td>
<td>Pump</td>
</tr>
<tr>
<td>0x0042</td>
<td>Water Value</td>
</tr>
</tbody></table>
<h2 id="On-Off-Plug-in-Unit"><a href="#On-Off-Plug-in-Unit" class="headerlink" title="On&#x2F;Off Plug-in Unit"></a>On&#x2F;Off Plug-in Unit</h2><p>å¼€&#x2F;å…³ æ’å¤´å•å…ƒæ˜¯ä¸€ç§ä¸ºæ’å…¥å…¶ä¸­çš„å¦ä¸€ä¸ªè®¾å¤‡æä¾›ç”µæºçš„è®¾å¤‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰“å¼€æˆ–å…³é—­æ‰€æä¾›çš„ç”µæºã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x010a</td>
<td>On&#x2F;Off Plug-in Unit</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td><strong>On&#x2F;Off</strong></td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sesing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLebel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Dimmable-Plug-In-Unit"><a href="#Dimmable-Plug-In-Unit" class="headerlink" title="Dimmable Plug-In Unit"></a>Dimmable Plug-In Unit</h2><p>å¯è°ƒå…‰æ’å¤´æ˜¯ä¸€ç§ä¸ºæ’å…¥å…¶ä¸­çš„å¦ä¸€å°è®¾å¤‡æä¾›ç”µæºçš„è®¾å¤‡ï¼Œå¯ä»¥æ‰“å¼€æˆ–å…³é—­ï¼Œå¹¶è°ƒæ•´å…¶äº®åº¦ã€‚å¯è°ƒå…‰æ’å¤´é€šå¸¸ç”¨äºé€šè¿‡å…¶ä¸»ç”µæºè¿æ¥ä½¿ç”¨ç›¸ä½åˆ‡å‰²æ¥æ§åˆ¶ä¼ ç»Ÿçš„éé€šä¿¡ç¯ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x010b</td>
<td>Dimmable Plug-In Unit</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sesing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLebel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Pump"><a href="#Pump" class="headerlink" title="Pump"></a>Pump</h2><p>æ³µè®¾å¤‡æ˜¯ä¸€ç§å¯ä»¥å˜é€Ÿçš„æ³µã€‚å®ƒå¯ä»¥æœ‰å¯é€‰çš„å†…ç½®ä¼ æ„Ÿå™¨å’Œè°ƒèŠ‚æœºåˆ¶ã€‚å®ƒé€šå¸¸ç”¨äºæ³µé€æ°´ç­‰æµä½“ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0303</td>
<td>Pump</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0200</td>
<td>Pump Configuration and Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0403</td>
<td>Pressure Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0403</td>
<td>Pressure Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancu Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Water-Value"><a href="#Water-Value" class="headerlink" title="Water Value"></a>Water Value</h2><p>Water Valueçš„å®šä¹‰ä¸æ°´é˜€è®¾å¤‡ç±»å‹å®šä¹‰ä¸€è‡´ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0042</td>
<td>Water Value</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0081</td>
<td>Value Configuration and Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>Smart Plug/Outlet</tag>
        <tag>Actuator</tag>
        <tag>Matter</tag>
      </tags>
  </entry>
  <entry>
    <title>core dump and gdb</title>
    <url>/2024/09/03/2024/core-dump-and-gdb/</url>
    <content><![CDATA[<h2 id="core-dumpåŠŸèƒ½"><a href="#core-dumpåŠŸèƒ½" class="headerlink" title="core dumpåŠŸèƒ½"></a>core dumpåŠŸèƒ½</h2><p><code>core dump</code> æ–‡ä»¶æ˜¯åœ¨ç¨‹åºå› ä¸¥é‡é”™è¯¯ï¼ˆå¦‚æ®µé”™è¯¯ï¼‰è€Œå´©æºƒæ—¶ç”±æ“ä½œç³»ç»Ÿç”Ÿæˆçš„ä¸€ä¸ªå†…å­˜æ˜ åƒæ–‡ä»¶ï¼ˆæ”¯æŒè‡ªå®šä¹‰è®¾ç½®è®¾å¤‡æ–‡ä»¶åæ ¼å¼ï¼‰ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ç¨‹åºå´©æºƒæ—¶åˆ»çš„å†…å­˜çŠ¶æ€ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨çš„çŠ¶æ€ã€æ ˆã€å…¨å±€å˜é‡ç­‰æ•°æ®ã€‚è¿™å¯¹äºè°ƒè¯•ç¨‹åºï¼ˆgdbï¼‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…ç†è§£ç¨‹åºåœ¨å´©æºƒå‰çš„çŠ¶æ€ï¼Œä»è€Œå®šä½å’Œè§£å†³é—®é¢˜ã€‚</p>
<p>linuxç³»ç»Ÿé»˜è®¤å…³é—­core dumpæ–‡ä»¶çš„ç”Ÿæˆï¼ŒåŸå› æ˜¯ï¼šéœ€è¦å ç”¨ä¸€éƒ¨åˆ†ç³»ç»Ÿå¼€é”€ã€‚</p>
<ul>
<li>æŸ¥çœ‹core dumpæ˜¯å¦å¼€å¯</li>
</ul>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¯åŠ¨core dumpåŠŸèƒ½ï¼š<code>ulimit -c</code>ï¼Œè‹¥æ‰“å°ç»“æœä¸ºï¼š0ï¼Œè¯´æ˜æ²¡æœ‰å¯åŠ¨core dumpåŠŸèƒ½ã€‚</p>
<p><em>å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š<code>ulimit -a</code></em></p>
<ul>
<li>å¼€å¯core dumpåŠŸèƒ½</li>
</ul>
<p>åœ¨å½“å‰çš„shellçª—å£å¯ç”¨core dumpåŠŸèƒ½ï¼Œæ‰§è¡Œï¼š<code>ulimit -c unlimited</code> ï¼Œå³ç”Ÿæˆçš„coreæ–‡ä»¶å¤§å°ä¸å—é™åˆ¶ã€‚å¦‚æœæƒ³é™åˆ¶coreæ–‡ä»¶çš„å¤§å°ï¼Œå¯ä»¥æ‰§è¡Œï¼š<code>ulimit -c 1024</code>ï¼Œå³ç”Ÿæˆçš„coreæ–‡ä»¶æœ€å¤§é™åˆ¶ä¸º1024KBã€‚å¦‚æœæƒ³å…³é—­core dumpåŠŸèƒ½ï¼Œæ‰§è¡Œï¼š<code>ulimit -c 0</code> å³å¯ã€‚</p>
<p><em>æ³¨æ„ï¼šshellçª—å£å…³é—­åï¼Œcore dumpåŠŸèƒ½å¤±æ•ˆ</em></p>
<ul>
<li>core dumpæ–‡ä»¶åæ ¼å¼</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹core dumpæ–‡ä»¶åæ ¼å¼ã€‚%pè¡¨ç¤ºç¨‹åºIDï¼Œ%eè¡¨ç¤ºç¨‹åºæ–‡ä»¶å</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">/data/core-%p-%e</span><br></pre></td></tr></table></figure>

<ul>
<li>core dumpæ–‡ä»¶çš„ç”Ÿæˆ</li>
</ul>
<p>åœ¨ä½¿ç”¨gccç¼–è¯‘ç›®æ ‡ç¨‹åºæ—¶ï¼Œæ·»åŠ å‚æ•° <code>-g</code> ï¼Œæ‰§è¡Œç›®æ ‡ç¨‹åºï¼Œå¤ç°Segment Faulté”™è¯¯ï¼Œæ­¤æ—¶åœ¨ç”Ÿæˆäº†core dumpæ–‡ä»¶ <code>core-2585-g_main_loop_run</code></p>
<h2 id="gdbè°ƒè¯•åŠŸèƒ½"><a href="#gdbè°ƒè¯•åŠŸèƒ½" class="headerlink" title="gdbè°ƒè¯•åŠŸèƒ½"></a>gdbè°ƒè¯•åŠŸèƒ½</h2><p>å°†core dumpæ–‡ä»¶æ‹·è´è‡³å®¿ä¸»æœºï¼Œç”¨äº¤å‰ç¼–è¯‘é“¾gdbå»åˆ†æcore dumpæ–‡ä»¶ã€‚ä½†æ˜¯æ‰§è¡Œï¼š<code>./arm-linux-gnueabihf-gdb --help</code> ï¼ŒæŠ¥é”™å¹¶æç¤ºç¼ºå°‘åŠ¨æ€åº“æ–‡ä»¶ã€‚</p>
<p>æŸ¥çœ‹ä¸€ä¸‹gdbä¾èµ–çš„åŠ¨æ€åº“æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@5aee87bd72ed:/workspace/xxx/prebuilts/gcc/linux-x86/arm/gcc-arm-8.3-2019.03-x86_64-arm-linux-gnueabihf/bin$ ldd ./arm-linux-gnueabihf-gdb</span><br><span class="line">        linux-vdso.so.1 (0x00007ffea9745000)</span><br><span class="line">        libtinfo.so.5 =&gt; not found</span><br><span class="line">        libncursesw.so.5 =&gt; not found</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x0000719329bca000)</span><br><span class="line">        libpython2.7.so.1.0 =&gt; not found</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x0000719329837000)</span><br><span class="line">        libutil.so.1 =&gt; /lib/x86_64-linux-gnu/libutil.so.1 (0x0000719329832000)</span><br><span class="line">        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007193296e1000)</span><br><span class="line">        libexpat.so.1 =&gt; /lib/x86_64-linux-gnu/libexpat.so.1 (0x00007193296b3000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007193294c1000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x0000719329c41000)</span><br><span class="line">        libtinfo.so.6 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.6 (0x0000719329491000)</span><br><span class="line">        libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x0000719329475000)</span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«æœ‰ä¸‰ä¸ªåŠ¨æ€åº“æ–‡ä»¶æ‰¾ä¸åˆ°ï¼šlibtinfo.so.5ã€libncursesw.so.5ã€libpython2.7.so.1.0</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…libncurses5 å¯ä»¥è§£å†³libtinfo.so.5ç¼ºå¤±çš„é—®é¢˜</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libncurses5</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libpython2.7 å¯ä»¥è§£å†³libpython2.7.so.1.0ç¼ºå¤±é—®é¢˜</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libpython2.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…libncursesw5-devåï¼Œå¹¶åˆ›å»ºåŠ¨æ€åº“çš„è½¯é“¾æ¥</span></span><br><span class="line"><span class="comment"># å®‰è£…æ—¶ï¼Œå¯ä»¥æ˜¾ç¤ºå·²ç»å®‰è£…äº†ï¼Œæ²¡æœ‰æœ€æ–°å®‰è£…ã€‚è€Œä¸”å®‰è£…çš„åŠ¨æ€åº“æ˜¯libncursesw.so.6.2</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libncursesw5-dev</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /usr/lib/x86_64-linux-gnu/libncursesw.so.6.2 /usr/lib/x86_64-linux-gnu/libncursesw.so.5</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œgdbå¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
<p>è°ƒè¯•ç›®æ ‡ç¨‹åºå’Œå…¶å¯¹åº”çš„core dumpæ–‡ä»¶ï¼Œæ‰§è¡Œï¼š&#96;.&#x2F;arm-linux-gnueabihf-gdb .&#x2F;target_program .&#x2F;core-2585-g_main_loop_run</p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œå°†ç›®æ ‡ç¨‹åºå’Œå¯¹åº”çš„core dumpæ–‡ä»¶æ‹·è´åˆ°äº†å’ŒgdbåŒä¸€æ–‡ä»¶å¤¹</em></p>
<p>ä»¥ä¸‹æ˜¯æ‰§è¡Œçš„ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Use the <span class="string">&quot;info sharedlibrary&quot;</span> <span class="built_in">command</span> to see the complete listing.</span><br><span class="line">Do you need <span class="string">&quot;set solib-search-path&quot;</span> or <span class="string">&quot;set sysroot&quot;</span>?</span><br><span class="line">Core was generated by `./bt-ctl/bt-ctl<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">Program terminated with signal SIGSEGV, Segmentation fault.</span></span><br><span class="line"><span class="string">#0  0x00000000 in ?? ()</span></span><br><span class="line"><span class="string">[Current thread is 1 (LWP 2588)]</span></span><br><span class="line"><span class="string">(gdb) bt</span></span><br><span class="line"><span class="string">#0  0x00000000 in ?? ()</span></span><br><span class="line"><span class="string">#1  0xa6def8b0 in ?? ()</span></span><br><span class="line"><span class="string">Backtrace stopped: previous frame identical to this frame (corrupt stack?)</span></span><br><span class="line"><span class="string">(gdb) </span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¨‹åºæ˜¯ç”±äºSIGSEGVå¯¼è‡´å¼‚å¸¸ç»ˆæ­¢ï¼Œé€šè¿‡ <code>bt</code> æ‰“å°å †æ ˆï¼Œå´çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ã€‚ç”±äºæˆ‘çš„ç›®æ ‡ç¨‹åºæ— æ³•ç§»æ¤åˆ°å®¿ä¸»æœºè¿è¡Œï¼Œæ•…æ— æ³•æŸ¥çœ‹å…·ä½“æ˜¯ç”±äºå“ªä¸€è¡Œä»£ç å¯¼è‡´çš„æŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯å¯ä»¥ä¿®æ”¹ä»£ç ï¼Œåœ¨ç¨‹åºä¸­æ•æ‰SIGSEGVä¿¡å·ï¼Œå¹¶æ‰“å°å‡ºå †æ ˆä¿¡æ¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦çš„å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;execinfo.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printStackTrace</span><span class="params">(<span class="type">void</span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *callStack[<span class="number">1280</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> **messages = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> numFrames = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è°ƒç”¨æ ˆä¿¡æ¯</span></span><br><span class="line">    numFrames = backtrace(callStack, <span class="number">1280</span>);</span><br><span class="line">    messages = backtrace_symbols(callStack, numFrames);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Obtained %zd frames.\n&quot;</span>, numFrames);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numFrames; ++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;  %2d %s\n&quot;</span>, i, messages[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(messages); <span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://jardaliao.github.io/2024/08/07/%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%8C%E6%9D%BF%E5%AD%90%E9%87%8C%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%B4%A9%E4%BA%86/">1ã€æ€ä¹ˆåŠï¼Œæ¿å­é‡Œçš„ç¨‹åºå´©äº†</a></p>
<p><a href="https://blog.csdn.net/lsqtzj/article/details/108553576#:~:text=%E8%BF%99%E4%B8%AA%E9%94%99%E8%AF%AF%E9%80%9A%E5%B8%B8%E6%98%AF%E7%94%B1">2ã€ubuntu ç¼ºå°‘ libtinfo.so.5 é—®é¢˜</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>gdb</tag>
        <tag>core dump</tag>
      </tags>
  </entry>
  <entry>
    <title>Matter: Switches and Controls Device Types</title>
    <url>/2024/08/31/2024/Matter-Switches-and-Controls-DeviceTypes/</url>
    <content><![CDATA[<p>å¼€å…³ç±»è®¾å¤‡çš„ç±»åˆ«ä¹Ÿä¸ºå¤šç§ï¼ŒåŒ…æ‹¬ï¼šOn&#x2F;Off Light Switchã€Dimmer Switchã€Color Dimmer Switchã€Control Bridgeã€Pump Controllerã€Generic Switch</p>
<p>switches and controlsç±»å‹æ‰€æœ‰ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
</tr>
</thead>
<tbody><tr>
<td>0x0103</td>
<td>On&#x2F;Off Light Switch</td>
</tr>
<tr>
<td>0x0104</td>
<td>Dimmer Switch</td>
</tr>
<tr>
<td>0x0105</td>
<td>Color Dimmer Switch</td>
</tr>
<tr>
<td>0x0840</td>
<td>Control Bridge</td>
</tr>
<tr>
<td>0x0304</td>
<td>Pump Controller</td>
</tr>
<tr>
<td>0x000f</td>
<td>Generic Switch</td>
</tr>
</tbody></table>
<h2 id="On-Off-Light-Switch"><a href="#On-Off-Light-Switch" class="headerlink" title="On&#x2F;Off Light Switch"></a>On&#x2F;Off Light Switch</h2><p>å¼€&#x2F;å…³ç¯ å¼€å…³æ˜¯ä¸€ç§æ§åˆ¶è®¾å¤‡ï¼Œå½“å®ƒä¸ç…§æ˜è®¾å¤‡ï¼ˆå¦‚å¼€&#x2F;å…³ç¯ï¼‰ç»‘å®šæ—¶ï¼Œå¯ç”¨äºæ‰“å¼€æˆ–å…³é—­è¯¥è®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0103</td>
<td>On&#x2F;Off Light Switch</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
</tbody></table>
<h2 id="Dimmer-Switch"><a href="#Dimmer-Switch" class="headerlink" title="Dimmer Switch"></a>Dimmer Switch</h2><p>è°ƒå…‰å¼€å…³æ˜¯ä¸€ç§æ§åˆ¶è®¾å¤‡ï¼Œå½“å®ƒä¸å¯è°ƒå…‰ç¯ç­‰ç…§æ˜è®¾å¤‡ç»‘å®šæ—¶ï¼Œå¯ä»¥ç”¨äºæ‰“å¼€æˆ–å…³é—­è¯¥è®¾å¤‡ï¼Œå¹¶è°ƒèŠ‚å‘å°„å…‰çš„å¼ºåº¦ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0104</td>
<td>Dimmer Switch</td>
<td>On&#x2F;Off Light Switch</td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Color-Dimmer-Switch"><a href="#Color-Dimmer-Switch" class="headerlink" title="Color Dimmer Switch"></a>Color Dimmer Switch</h2><p>è°ƒè‰²å¼€å…³æ˜¯ä¸€ç§æ§åˆ¶å™¨è®¾å¤‡ï¼Œå½“å®ƒä¸ç…§æ˜è®¾å¤‡ï¼ˆå¦‚æ‰©å±•è‰²å…‰ç¯ï¼‰ç»‘å®šæ—¶ï¼Œå¯ä»¥ç”¨æ¥è°ƒèŠ‚æ‰€å‘å°„å…‰çš„é¢œè‰²ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0105</td>
<td>Color Dimmer Switch</td>
<td>Dimmer Switch</td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Control-Bridge"><a href="#Control-Bridge" class="headerlink" title="Control Bridge"></a>Control Bridge</h2><p>æ§åˆ¶æ¡¥æ˜¯ä¸€ç§æ§åˆ¶å™¨è®¾å¤‡ï¼Œå½“å®ƒä¸ç…§æ˜è®¾å¤‡ï¼ˆä¾‹å¦‚æ‰©å±•è‰²å…‰ï¼‰ç»‘å®šæ—¶ï¼Œå¯ç”¨äºæ‰“å¼€æˆ–å…³é—­è®¾å¤‡ã€è°ƒæ•´å‘å°„å…‰çš„å¼ºåº¦å’Œè°ƒæ•´å‘å°„å…‰çš„é¢œè‰²ã€‚æ­¤å¤–ï¼Œæ§åˆ¶æ¡¥è®¾å¤‡è¿˜å¯ç”¨äºè®¾ç½®åœºæ™¯ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0840</td>
<td>Control Bridge</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0400</td>
<td>Illuminance Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Pump-Controller"><a href="#Pump-Controller" class="headerlink" title="Pump Controller"></a>Pump Controller</h2><p>æ³µæ§åˆ¶å™¨è®¾å¤‡èƒ½å¤Ÿé…ç½®å’Œæ§åˆ¶æ³µè®¾å¤‡ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0304</td>
<td>Pump Controller</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0003</td>
<td>Identify</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Client</td>
<td></td>
<td>P,O</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x001e</td>
<td>Binding</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0200</td>
<td>Pump Configuration and Control</td>
<td>Client</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0402</td>
<td>Temperature Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0403</td>
<td>Presessure Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0404</td>
<td>Flow Measurement</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<h2 id="Generic-Switch"><a href="#Generic-Switch" class="headerlink" title="Generic Switch"></a>Generic Switch</h2><p>é€šç”¨å¼€å…³</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x000f</td>
<td>Generic Switch</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x003b</td>
<td>Switch</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>matter-1-3-device-library-specification</tag>
        <tag>Switches and Controls of Matter Device</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetoothï¼šraspberry4b play audio</title>
    <url>/2024/08/28/2024/raspberry4b-play-audio/</url>
    <content><![CDATA[<p>ç¯å¢ƒä»‹ç»ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¡¬ä»¶ä¿¡æ¯</span></span><br><span class="line">æ ‘è“æ´¾4B 8GB</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç³»ç»Ÿä¿¡æ¯</span></span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line">Linux caojun-desktop 6.8.0-1010-raspi <span class="comment">#11-Ubuntu SMP PREEMPT_DYNAMIC Thu Aug  8 23:22:41 UTC 2024 aarch64 aarch64 aarch64 GNU/Linux</span></span><br></pre></td></tr></table></figure>



<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p><code>&#123;% post_link 'bluetoothctl client tool' %&#125;</code> ä»‹ç»äº†ä¸ºä»€ä¹ˆè¦å†™ä¸€ä¸ªè“ç‰™åº”ç”¨åº“ï¼Œæ—¢ç„¶é€‰æ‹©äº†åœ¨æ ‘è“æ´¾ä¸Šå¼€å‘ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ ‘è“æ´¾ä¸ŠéªŒè¯è“ç‰™åº”ç”¨åº“çš„å¯ç”¨æ€§ã€‚é€šè¿‡æ ‘è“æ´¾è¿è¡Œè“ç‰™åº”ç”¨åº“è¿æ¥è“ç‰™éŸ³å“è®¾å¤‡æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ï¼Œæˆ‘å°±å¯ä»¥è¯æ˜è“ç‰™åº”ç”¨åº“çš„å¯ç”¨æ€§ã€‚</p>
<p>åœ¨è´­å…¥æ ‘è“æ´¾ä¹‹å‰ï¼Œæˆ‘æœ‰æŸ¥è¯¢è¿‡æ ‘è“æ´¾å¯ä»¥å®ç°å¤šåª’ä½“åº”ç”¨ï¼šè§†é¢‘å’ŒéŸ³é¢‘ã€‚æ ‘è“æ´¾ç¡¬ä»¶è‡ªå¸¦äº†ä¸€ä¸ª3.5mmçš„éŸ³é¢‘è¾“å‡ºå£ï¼Œä»¥åŠä¸¤ä¸ªmicro hdmiæ¥å£ã€‚</p>
<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æŸ¥çœ‹æ ‘è“æ´¾4Bæœ‰å“ªäº›éŸ³é¢‘æ’­æ”¾æ¥å£ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><p>æ–¹å¼1ï¼šæ‰§è¡Œå‘½ä»¤ <code>cat /proc/asound/cards</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 [Headphones     ]: bcm2835_headpho - bcm2835 Headphones</span><br><span class="line">                     bcm2835 Headphones</span><br><span class="line">1 [vc4hdmi0       ]: vc4-hdmi - vc4-hdmi-0</span><br><span class="line">                     vc4-hdmi-0</span><br><span class="line">2 [vc4hdmi1       ]: vc4-hdmi - vc4-hdmi-1</span><br><span class="line">                     vc4-hdmi-1</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹å¼2ï¼šæ‰§è¡Œå‘½ä»¤ <code>sudo apaly -l</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">**** List of PLAYBACK Hardware Devices ****</span><br><span class="line">card 0: Headphones [bcm2835 Headphones], device 0: bcm2835 Headphones [bcm2835 Headphones]</span><br><span class="line">  Subdevices: 8/8</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br><span class="line">  Subdevice <span class="comment">#1: subdevice #1</span></span><br><span class="line">  Subdevice <span class="comment">#2: subdevice #2</span></span><br><span class="line">  Subdevice <span class="comment">#3: subdevice #3</span></span><br><span class="line">  Subdevice <span class="comment">#4: subdevice #4</span></span><br><span class="line">  Subdevice <span class="comment">#5: subdevice #5</span></span><br><span class="line">  Subdevice <span class="comment">#6: subdevice #6</span></span><br><span class="line">  Subdevice <span class="comment">#7: subdevice #7</span></span><br><span class="line">card 1: vc4hdmi0 [vc4-hdmi-0], device 0: MAI PCM i2s-hifi-0 [MAI PCM i2s-hifi-0]</span><br><span class="line">  Subdevices: 1/1</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br><span class="line">card 2: vc4hdmi1 [vc4-hdmi-1], device 0: MAI PCM i2s-hifi-0 [MAI PCM i2s-hifi-0]</span><br><span class="line">  Subdevices: 1/1</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>é€šè¿‡ä¸Šè¿°æŸ¥è¯¢æ¥å£ï¼Œæ ‘è“æ´¾4Bæä¾›äº†3ä¸ªéŸ³é¢‘æ¥å£ï¼šbcm2835 Headphonesï¼ˆå³3.5mmè€³æœºå£ï¼‰ã€vc4-hdmi-0ã€vc4-hdmi-1</p>
<h3 id="è€³æœºå£æ’­æ”¾éŸ³é¢‘"><a href="#è€³æœºå£æ’­æ”¾éŸ³é¢‘" class="headerlink" title="è€³æœºå£æ’­æ”¾éŸ³é¢‘"></a>è€³æœºå£æ’­æ”¾éŸ³é¢‘</h3><p>å‡†å¤‡å·¥ä½œï¼š</p>
<ul>
<li>3.5mmè€³æœºçº¿æ’å…¥æ ‘è“æ´¾</li>
<li>æ ‘è“æ´¾ä¸­ä¸‹è½½alsa-utilså·¥å…·</li>
</ul>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥è¯¢alsa-utilsæ˜¯å¦å®‰è£…ï¼š<code>dpkg -l | grep alsa-utils</code>ï¼Œè‹¥æ²¡æœ‰å®‰è£…ï¼Œåˆ™é€šè¿‡å‘½ä»¤å®‰è£…ï¼š<code>sudo apt install alsa-utils</code></p>
<p>alsa-utilså·¥å…·åŒ…å«äº†ï¼šaplayï¼ˆæ’­æ”¾éŸ³é¢‘ï¼‰ ã€ arecordï¼ˆå½•åˆ¶éŸ³é¢‘ï¼‰ ã€ alsamixerï¼ˆåŸºäºæ–‡æœ¬ç•Œé¢çš„éŸ³é¢‘è®¾å¤‡ç®¡ç†ï¼‰ ã€ amixerï¼ˆè°ƒæ•´è®¾å¤‡éŸ³é‡ï¼‰ï¼Œè€Œä¸”åœ¨ <code>/usr/share/soudns/alsa</code> ç›®å½•ä¸‹ä¼šæä¾›å¤šä¸ªwavéŸ³é¢‘æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ll /usr/share/sounds/alsa/</span><br><span class="line">-rw-r--r--  1 root root 137134  4æœˆ  7 15:09 Front_Center.wav</span><br><span class="line">-rw-r--r--  1 root root 142128  4æœˆ  7 15:09 Front_Left.wav</span><br><span class="line">-rw-r--r--  1 root root 146990  4æœˆ  7 15:09 Front_Right.wav</span><br><span class="line">-rw-r--r--  1 root root 135202  4æœˆ  7 15:09 Noise.wav</span><br><span class="line">-rw-r--r--  1 root root 130096  4æœˆ  7 15:09 Rear_Center.wav</span><br><span class="line">-rw-r--r--  1 root root 126064  4æœˆ  7 15:09 Rear_Left.wav</span><br><span class="line">-rw-r--r--  1 root root 146480  4æœˆ  7 15:09 Rear_Right.wav</span><br><span class="line">-rw-r--r--  1 root root 134868  4æœˆ  7 15:09 Side_Left.wav</span><br><span class="line">-rw-r--r--  1 root root 129966  4æœˆ  7 15:09 Side_Right.wav</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å…ˆé€šè¿‡alsamixeré€‰æ‹©é»˜è®¤éŸ³é¢‘è®¾å¤‡ï¼Œå¹¶è°ƒèŠ‚éŸ³é‡ã€‚æ¥ç€é€šè¿‡aplayæ’­æ”¾wavéŸ³é¢‘æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ’­æ”¾æ–¹å¼1</span></span><br><span class="line"><span class="built_in">sudo</span> aplay /usr/share/sounds/alsa/Front_Center.wav</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’­æ”¾æ–¹å¼2, æŒ‡å®šCARDå’ŒDEV</span></span><br><span class="line"><span class="built_in">sudo</span> aplay /usr/share/sounds/alsa/Front_Center.wav -D plughw:CARD=0,DEV=0</span><br></pre></td></tr></table></figure>

<p>è‹¥ä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™ä¼šä»è€³æœºä¸­å¬åˆ°è‹±æ–‡å£°éŸ³ï¼šFrong Center</p>
<p>è°ƒèŠ‚è®¾å¤‡éŸ³é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éŸ³é‡è°ƒèŠ‚è‡³90%</span></span><br><span class="line">amixer sset Master 90%</span><br><span class="line"></span><br><span class="line"><span class="comment"># éŸ³é‡è°ƒèŠ‚è‡³20%</span></span><br><span class="line">amixer sset Master 20%</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æ’­æ”¾wavéŸ³é¢‘æ–‡ä»¶ï¼ŒéªŒè¯éŸ³é‡è®¾å¤‡æ˜¯å¦æˆåŠŸã€‚</p>
<p><em>æ³¨æ„ï¼šè¿™é‡Œå‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼šå¯¹äºalsa-utilså·¥å…·åŒ…çš„è½¯ä»¶éƒ½éœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼Œå³sudoï¼Œå¦åˆ™å°±ä¼šæœ‰é—®é¢˜ã€‚</em></p>
<h2 id="è“ç‰™éŸ³å“æ’­æ”¾éŸ³é¢‘"><a href="#è“ç‰™éŸ³å“æ’­æ”¾éŸ³é¢‘" class="headerlink" title="è“ç‰™éŸ³å“æ’­æ”¾éŸ³é¢‘"></a>è“ç‰™éŸ³å“æ’­æ”¾éŸ³é¢‘</h2><p>æ ‘è“æ´¾é€šè¿‡è“ç‰™é€‚é…å™¨è¿æ¥è“ç‰™éŸ³å“ï¼Œç„¶åæ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚å…¶ä¸­ä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šè“ç‰™è¿æ¥æˆåŠŸåï¼Œå¦‚ä½•å°†å°†éŸ³é¢‘æ–‡ä»¶ä¼ è¾“åˆ°è“ç‰™éŸ³å“ï¼Œå¹¶è¾“å‡ºéŸ³é¢‘ï¼Ÿ</p>
<p>é€šè¿‡äº’è”ç½‘ä¸Šçš„èµ„æ–™ï¼Œæˆ‘å¯ä»¥ç¡®è®¤æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>bluez+bluealsa</p>
<p><code>bluealsa</code> æ˜¯ä¸€ä¸ªç”¨äºå°† ALSAï¼ˆAdvanced Linux Sound Architectureï¼Œé«˜çº§LinuxéŸ³é¢‘æ¶æ„ï¼‰ä¸ Bluetooth ä½åŠŸè€—ï¼ˆå³ BLEï¼‰éŸ³é¢‘åè®®ç›¸ç»“åˆçš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä½¿å¾— Linux ç³»ç»Ÿèƒ½å¤Ÿé€šè¿‡ BLE è¿æ¥è“ç‰™éŸ³é¢‘è®¾å¤‡ï¼Œå¹¶è®©è“ç‰™éŸ³é¢‘è®¾å¤‡æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚</p>
<p>bluealsa çš„æ ¸å¿ƒæ˜¯<code>bluealsa</code>ä¸ BlueZ è“ç‰™å®ˆæŠ¤è¿›ç¨‹<code>bluetoothd</code>å’Œæœ¬åœ°è“ç‰™é€‚é…å™¨äº¤äº’çš„å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒå¤„ç† A2DPã€HFP å’Œ HSP çš„é…ç½®æ–‡ä»¶ï¼ˆå³Profileï¼‰è¿æ¥å’Œé…ç½®é€»è¾‘ï¼Œå¹¶é€šè¿‡ D-Bus å°†ç”Ÿæˆçš„éŸ³é¢‘æµå‘ˆç°ç»™åº”ç”¨ç¨‹åºã€‚</p>
</li>
<li><p>bluez+pulseaudio</p>
</li>
</ul>
<h3 id="ç¼–è¯‘å®‰è£…bluealsa"><a href="#ç¼–è¯‘å®‰è£…bluealsa" class="headerlink" title="ç¼–è¯‘å®‰è£…bluealsa"></a>ç¼–è¯‘å®‰è£…bluealsa</h3><p><a href="https://github.com/Arkq/bluez-alsa">Github å¼€æºé¡¹ç›®ï¼šbluez-alsa</a></p>
<p>è¯¥å¼€æºé¡¹ç›®README.mdæ–‡ä»¶ç»™å‡ºäº†ä¸€ä¸ªæç¤ºï¼š</p>
<blockquote>
<p>è­¦å‘Šï¼š</p>
<p>ä»tag 4.3.1ç‰ˆæœ¬æœ€æ–°çš„æºæ–‡ä»¶ä¸ºæ ¸å¿ƒç»„ä»¶ä½¿ç”¨äº†æ–°çš„åå­—ï¼š</p>
<ul>
<li><code>bluealsa</code> daemonç°åœ¨æ”¹ä¸ºäº† <code>bluealsad</code> daemon</li>
<li><code>bluealsa-cli</code> utilityç°åœ¨æ”¹ä¸ºäº† <code>bluealsactl</code> utility</li>
</ul>
</blockquote>
<p>ç”±äºå®‰è£…Ubuntu 24.04çš„æ ‘è“æ´¾ç›®å‰ä¸æ”¯æŒé€šè¿‡aptå®‰è£…bluealsaï¼Œæ•…è¿™é‡Œé€šè¿‡ç¼–è¯‘å®‰è£…ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è¿‡ç¨‹ã€‚</p>
<ul>
<li><p>å¯¹äºå¦‚ä½•é€šè¿‡æºç ç¼–è¯‘æ„å»ºï¼Œè¯¥é¡¹ç›®ä¹Ÿå¾ˆè´´å¿ƒçš„ç»™å‡ºäº†æŒ‡å¼•æ–‡ä»¶<a href="https://github.com/arkq/bluez-alsa/blob/master/INSTALL.md">INSTALL.md</a>ã€‚æ›´åŠ è¯¦ç»†çš„ç¼–è¯‘å®‰è£…æ•™ç¨‹å¯ä»¥æŸ¥çœ‹<a href="https://github.com/arkq/bluez-alsa/wiki/Installation-from-source">Installation from source</a>ï¼Œç”šè‡³ä¸åŒçš„æ“ä½œç³»ç»Ÿä¹Ÿéƒ½ç»™å‡ºäº†ï¼Œä¾‹å¦‚ï¼šDebain&#x2F;Raspberry Pi OS&#x2F;Ubuntuã€Fedoraã€Archã€‚è¿™é‡Œé€‰æ‹©Ubuntuçš„å®‰è£…è¿‡ç¨‹å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ç¼–è¯‘ç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install git automake build-essential libtool pkg-config python3-docutils</span><br><span class="line"><span class="built_in">sudo</span> apt-get install libasound2-dev libbluetooth-dev libdbus-1-dev libglib2.0-dev libsbc-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡gitå…‹éš†blue-alsaä»“åº“åˆ°æœ¬åœ°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…‹éš†ä»“åº“</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/arkq/bluez-alsa.git</span><br><span class="line"><span class="built_in">cd</span> blue-alsa</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡†å¤‡ç¼–è¯‘æ„å»º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨è‡ªåŠ¨é…ç½®å·¥å…·é€‚é…å½“å‰å¼€å‘ç¯å¢ƒï¼Œæœ€åç”Ÿæˆconfigureé…ç½®æ–‡ä»¶</span></span><br><span class="line">autoreconf --install --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºbuildç›®å½•ï¼Œå­˜æ”¾ç¼–è¯‘è¿‡ç¨‹æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨buildç›®å½•ä¸‹ï¼Œè¿è¡Œé…ç½®æ–‡ä»¶ï¼ˆè¿™é‡Œæ²¡æœ‰å¢åŠ é¢å¤–çš„å‚æ•°ï¼‰</span></span><br><span class="line">../configure</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å’Œå®‰è£…</span></span><br><span class="line">make</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="è¿è¡Œbluealsa"><a href="#è¿è¡Œbluealsa" class="headerlink" title="è¿è¡Œbluealsa"></a>è¿è¡Œbluealsa</h3><p>åœ¨è¿æ¥è“ç‰™éŸ³é¢‘è®¾å¤‡ä¹‹å‰ï¼Œç¡®ä¿ <code>hciconfig -a</code> å¯ä»¥æŸ¥è¯¢åˆ°hciæ¥å£ï¼Œç¡®ä¿ <code>bluetoothd</code> å·²ç»è¿è¡Œã€‚ç„¶åè¿è¡Œ <code>bluealsa</code> ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œæ–¹å¼1ï¼Œä»¥rootæƒé™è¿è¡Œï¼Œæ³¨æ„ï¼šè¿™é‡Œæœ‰bluealsaåå°æ‰“å°ä¿¡æ¯è¾“å‡º </span></span><br><span class="line"><span class="built_in">sudo</span> bluealsa --profile=a2dp-source &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ–¹å¼2ï¼Œä»¥rootæƒé™è¿è¡Œï¼Œç¦æ­¢bluealsaåå°æ‰“å°ä¿¡æ¯è¾“å‡º</span></span><br><span class="line"><span class="built_in">sudo</span> bluealsa --profile=a2dp-source &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ–¹å¼3ï¼Œé€šè¿‡systemdè¿è¡Œbluealsa</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start bluealsa.service</span><br></pre></td></tr></table></figure>



<p>ä½¿ç”¨ <code>bluetoothctl</code> æœç´¢ã€é…å¯¹ã€è¿æ¥è“ç‰™éŸ³é¢‘è®¾å¤‡ï¼ˆæ­¤éƒ¨åˆ†ä¸åšè¯´æ˜ï¼‰ï¼Œä¿®æ”¹asoundrc.confï¼Œæœ€åä½¿ç”¨ <code>aplay</code> æ’­æ”¾wavéŸ³é¢‘æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹asoundrc.conf</span></span><br><span class="line">pcm.!default <span class="string">&quot;bluealsa&quot;</span></span><br><span class="line">ctl.!default <span class="string">&quot;bluealsa&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># aplayæ’­æ”¾wavæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> aplay /usr/share/sounds/alsa/Front_Center.wav</span><br></pre></td></tr></table></figure>



<p><strong>asoundrc.conf</strong></p>
<p>ALSA æ­£å¸¸å·¥ä½œä¸éœ€è¦ç”¨æˆ·ç«¯æ–‡ä»¶<code>.asoundrc</code> æˆ– <code>asound.conf</code>é…ç½®æ–‡ä»¶ã€‚<code>asoundrc.conf</code> æ–‡ä»¶ç”¨äºé€šè¿‡ alsa-lib å±‚å®ç°é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·¯ç”±å’Œé‡‡æ ·ç‡è½¬æ¢ã€‚</p>
<p>alsa-lib è½¯ä»¶åŒ…æä¾›äº† <code>/usr/share/alsa/alsa.conf</code> æ–‡ä»¶ä½œä¸º<em>ä¸»å…¥å£ç‚¹</em>ã€‚è¯¥æ–‡ä»¶è´Ÿè´£åŒ…å«ç³»ç»Ÿä¸Šæ‰€æœ‰å¯èƒ½çš„ .asoundrc æ ¼å¼æ–‡ä»¶ã€‚alsa.conf ä¼šåŠ è½½ç³»ç»Ÿå…¨å±€è‡ªå®šä¹‰è®¾ç½®æ–‡ä»¶ &#x2F;etc&#x2F;asound.conf å’Œæ¯ä¸ªç”¨æˆ·çš„è‡ªå®šä¹‰è®¾ç½®æ–‡ä»¶ ~&#x2F;.asoundrcã€‚</p>
<p>ç”¨æˆ·è‡ªå®šä¹‰çš„ <code>~/.asoundrd.conf </code> æ–‡ä»¶éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºï¼Œå¹¶ä¸”æ–‡ä»¶è¯¥ä½œç”¨åŸŸå¤§äºå…¨å±€è‡ªå®šä¹‰çš„ <code>/etc/asoundrc.conf</code> ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://cursorhu.github.io/2021/09/09/%E6%A0%91%E8%8E%93%E6%B4%BE%E7%AC%94%E8%AE%B0%EF%BC%9A%E4%BD%BF%E7%94%A8ALSA-A2DP-PulseAudio%E8%87%AA%E5%88%B6%E8%93%9D%E7%89%99%E9%9F%B3%E7%AE%B1/">1ã€æ ‘è“æ´¾ç¬”è®°ï¼šä½¿ç”¨ALSA+A2DP+PulseAudioè‡ªåˆ¶è“ç‰™éŸ³ç®±</a></p>
<p><a href="https://www.alsa-project.org/main/index.php/Asoundrc">2ã€Asoundrc</a></p>
]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>raspberry4b</tag>
      </tags>
  </entry>
  <entry>
    <title>ssh remote login</title>
    <url>/2024/08/21/2024/ssh-remote-login/</url>
    <content><![CDATA[<h2 id="å®‰è£…ssh"><a href="#å®‰è£…ssh" class="headerlink" title="å®‰è£…ssh"></a>å®‰è£…ssh</h2><p>ä¸€èˆ¬éƒ½æ˜¯åœ¨æœ¬åœ°PCé€šè¿‡sshè¿œç¨‹è¿æ¥æœåŠ¡å™¨ï¼Œåœ¨æœ¬åœ°PCåŸºæœ¬éƒ½æœ‰ssh clientç¨‹åºï¼Œè€ŒæœåŠ¡å™¨ä¸ä¸€å®šä¼šæœ‰ssh serverç¨‹åºã€‚æ‰€ä»¥é¦–å…ˆç¬¬ä¸€æ­¥è¦ç¡®è®¤<strong>æœåŠ¡å™¨</strong>æ˜¯å¦å·²ç»å®‰è£…äº†ssh serverç¨‹åºï¼ˆå³openssh-serverï¼‰ï¼Œè‹¥å·²ç»å®‰è£…ï¼Œåˆ™è·³è¿‡ï¼›è‹¥æ²¡æœ‰å®‰è£…ï¼Œåˆ™æ¥ä¸‹æ¥å®‰è£…æ­¥éª¤ã€‚</p>
<ul>
<li><p>æœåŠ¡å™¨ä¸Šæ£€æŸ¥æ˜¯å¦å®‰è£… openssh-server</p>
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š<code>dpkg -l | grep openssh-server</code></p>
</li>
<li><p>æœåŠ¡å™¨ä¸Šå®‰è£…openssh-server</p>
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š<code>sudo apt update &amp;&amp; sudo apt install openssh-server</code></p>
</li>
<li><p>æœåŠ¡å™¨ä¸Šæ£€æŸ¥sshdæœåŠ¡æ˜¯å¦å¯åŠ¨</p>
<p>å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼å»æŸ¥è¯¢ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">ps -ef | grep sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line">systemctl status ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼3</span></span><br><span class="line">service ssh status</span><br></pre></td></tr></table></figure>

<p>è‹¥æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼å»å¯åŠ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">systtemctl start ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line">service ssh start</span><br></pre></td></tr></table></figure></li>
</ul>
<p>è‡³æ­¤ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…sshï¼ˆå³openssh-serverï¼‰å®Œæˆã€‚</p>
<h2 id="ç™»å½•ssh"><a href="#ç™»å½•ssh" class="headerlink" title="ç™»å½•ssh"></a>ç™»å½•ssh</h2><p>åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…sshåï¼Œå¯ä»¥åœ¨æœ¬åœ°PCé€šè¿‡ssh clientè¿æ¥åˆ°æœåŠ¡å™¨ssh serverï¼Œç™»å½•çš„æ–¹å¼æœ‰ï¼š<strong>ç§˜é’¥ç™»å½•</strong> å’Œ <strong>å…¬é’¥ç™»å½•</strong>ã€‚</p>
<h3 id="ç§˜é’¥ç™»å½•"><a href="#ç§˜é’¥ç™»å½•" class="headerlink" title="ç§˜é’¥ç™»å½•"></a>ç§˜é’¥ç™»å½•</h3><p>ç§˜é’¥ç™»å½•å°±æ˜¯é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼Œä¾‹å¦‚é€šè¿‡ç§˜é’¥ç™»å½•åˆ°æ ‘è“æ´¾ï¼ˆä½œä¸ºæœåŠ¡å™¨è§’è‰²ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># raspberryæ˜¯æ ‘è“æ´¾çš„ä¸»æœºåï¼Œä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºæ ‘è“æ´¾çš„IPåœ°å€ã€‚æ‰§è¡Œå‘½ä»¤åï¼Œä¼šè¦æ±‚è¾“å…¥piç”¨æˆ·çš„å¯†ç ã€‚</span></span><br><span class="line">ssh pi@raspberrypi</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ä½¿ç”¨æ ‘è“æ´¾çš„IPï¼Œè€Œæ˜¯ä½¿ç”¨æ ‘è“æ´¾çš„ä¸»æœºåã€‚å› ä¸ºæ ‘è“æ´¾å¯åŠ¨äº†avahi-daemonæœåŠ¡ï¼Œå°†æ ‘è“æ´¾ä¸»æœºåé€šè¿‡mDNSç»„æ’­ï¼Œè¿™æ ·æ ‘è“æ´¾ä¸»æœºåå°±å¯ä»¥æ›¿æ¢å®ƒçš„IPåœ°å€ã€‚</em></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@raspberrypi:~$ ps -ef | grep avahi</span><br><span class="line">avahi       1014       1  0 15:29 ?        00:00:00 avahi-daemon: running [raspberrypi.local]</span><br><span class="line">avahi       1051    1014  0 15:30 ?        00:00:00 avahi-daemon: <span class="built_in">chroot</span> helper</span><br><span class="line">pi          3046    3029 50 15:50 pts/1    00:00:00 grep --color=auto avahi</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="å…¬é’¥ç™»å½•"><a href="#å…¬é’¥ç™»å½•" class="headerlink" title="å…¬é’¥ç™»å½•"></a>å…¬é’¥ç™»å½•</h3><p>å…¬é’¥ç™»å½•æ˜¯æŒ‡å°†æœ¬åœ°PCçš„å…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œæœ¬åœ°PCå°†ç™»å½•ä¿¡æ¯ç”¨ç§é’¥ç­¾åç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç”¨æœ¬åœ°PCçš„å…¬é’¥é‰´åˆ«ã€‚</p>
<ul>
<li><p><strong>æœ¬åœ°PCåˆ›å»ºå…¬é’¥</strong></p>
<p>é€šè¿‡å‘½ä»¤åˆ›å»ºå…¬é’¥ï¼š<code>ssh-keygen</code>ï¼Œæ¥ä¸‹æ¥æŒ‰ä¸‹ä¸¤æ¬¡æ¬¡å›è½¦é”®å³å¯åˆ›å»ºå®Œæˆã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pi@raspberrypi:~$ ssh-keygen -t rsa -C <span class="string">&quot;caoj97141@gmail.com&quot;</span> -f ~/.ssh/id_rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/pi/.ssh/id_rsa</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/pi/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:*****ro74Dm9Zn****sfk91dbb****CLjnEOzJD**** caoj97141@gmail.com</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 3072]----+</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|          E      |</span></span><br><span class="line"><span class="string">|         = o    o|</span></span><br><span class="line"><span class="string">|        S o    .+|</span></span><br><span class="line"><span class="string">|        .*     .B|</span></span><br><span class="line"><span class="string">|       . +* o .*=|</span></span><br><span class="line"><span class="string">|        +.=Xo=oo*|</span></span><br><span class="line"><span class="string">|         =%@*o+=B|</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‘½ä»¤åä¼šæç¤ºè¾“å…¥ä¸¤æ¬¡å¯†ç ï¼ˆè¯¥å¯†ç æ˜¯ä½ pushæ–‡ä»¶çš„æ—¶å€™è¦è¾“å…¥çš„å¯†ç ï¼Œè€Œä¸æ˜¯githubç®¡ç†è€…çš„å¯†ç ï¼‰ï¼Œå½“ç„¶ä¹Ÿä¸å¯ä»¥ä¸è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦è·³è¿‡ã€‚è¿™æ ·è®¾ç½®ä¹‹åï¼Œgit pushæ—¶å°±ä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œç›´æ¥æäº¤åˆ°gitä»“åº“ã€‚</p>
<p>å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œç”Ÿæˆç§˜é’¥æ–‡ä»¶ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼š<code>~/.ssh/id_rsa.pub</code> å’Œ <code>~/.ssh/id_rsa</code></p>
</li>
<li><p><strong>ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨</strong></p>
<p>é€šè¿‡å‘½ä»¤å°†å…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š<code>cd ~/.ssh &amp;&amp; scp id_rsa.pub pi@raspberrypi:/home/pi</code></p>
</li>
<li><p><strong>æœåŠ¡å™¨ä¿®æ”¹sshé…ç½®</strong></p>
<p>å…ˆåœ¨æœåŠ¡å™¨åˆ›å»º <code>~/.ssh/authorized_keys</code>ï¼Œç„¶åå°†æœ¬åœ°PCçš„å…¬é’¥å†™è¿›å…¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> /home/pi/.ssh </span><br><span class="line"><span class="built_in">touch</span> /home/pi/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¬é’¥å†™å…¥</span></span><br><span class="line"><span class="built_in">cd</span> /home/pi/.ssh</span><br><span class="line"><span class="built_in">cat</span> /home/pi/id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> 600 authorized_keys</span><br></pre></td></tr></table></figure>

<p>æœ€åä¿®æ”¹sshçš„é…ç½®æ–‡ä»¶ï¼š<code>/etc/ssh/sshd_config</code>ï¼Œæ¶‰åŠåˆ°çš„é€‰é¡¹æœ‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¬é’¥ç™»å½•è®¸å¯</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>å…¬é’¥ç™»å½•</p>
<p>ä¿®æ”¹å®ŒsshæœåŠ¡çš„é…ç½®æ–‡ä»¶åï¼Œé‡å¯sshæœåŠ¡ï¼Œæ¥ç€æœ¬åœ°PCé€šè¿‡å…¬é’¥ç™»å½•æœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é‡å¯sshæœåŠ¡ æ–¹å¼1</span></span><br><span class="line">systemctl restart ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># # é‡å¯sshæœåŠ¡ æ–¹å¼2</span></span><br><span class="line">service ssh restart</span><br></pre></td></tr></table></figure></li>
</ul>
<p>æœ¬åœ°PCé€šè¿‡ssh clientå…¬é’¥è®¤è¯ç™»å½•ï¼š<code>ssh pi@raspberrypi</code>ï¼Œæ­¤æ—¶ä¼šç›´æ¥ç™»å½•ï¼Œæ— éœ€å¯†ç ã€‚</p>
<p>ç™»å½•æˆåŠŸæç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eiSouthBoy@eiSouthBoy-NMH-WCX9:~$ ssh  pi@raspberrypi</span><br><span class="line">Welcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-1009-raspi aarch64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/pro</span><br><span class="line"></span><br><span class="line">Expanded Security Maintenance <span class="keyword">for</span> Applications is not enabled.</span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line">Enable ESM Apps to receive additional future security updates.</span><br><span class="line">See https://ubuntu.com/esm or run: <span class="built_in">sudo</span> pro status</span><br><span class="line"></span><br><span class="line">*** System restart required ***</span><br><span class="line">Last login: Thu Aug 22 11:10:19 2024 from fdfc:869c:9ebb:0:2803:5d58:2f66:5d78</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ç®¡ç†å¤šä¸ªGitä»“åº“"><a href="#ç®¡ç†å¤šä¸ªGitä»“åº“" class="headerlink" title="ç®¡ç†å¤šä¸ªGitä»“åº“"></a>ç®¡ç†å¤šä¸ªGitä»“åº“</h2><p>åŒæ—¶æ‹¥æœ‰Githubå’ŒGiteeä¸¤ä¸ªè´¦æˆ·ä¸‹çš„ä»“åº“éœ€è¦ç®¡ç†ï¼Œå¦‚ä½•é€šè¿‡sshç®¡ç†ï¼Ÿ</p>
<p>åœ¨PCä¸Šåˆ†åˆ«ä¸ºGihubå’ŒGiteeåˆ›å»ºssh keyï¼Œç„¶åç¼–å†™ssh configæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºGithubåˆ›å»ºssh key</span></span><br><span class="line">pi@raspberrypi:~$ ssh-keygen -t rsa -C <span class="string">&quot;caoj97141@gmail.com&quot;</span> -f ~/.ssh/id_rsa-github</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºGiteeåˆ›å»ºssh key</span></span><br><span class="line">pi@raspberrypi:~$ ssh-keygen -t rsa -C <span class="string">&quot;caoj97141@gmail.com&quot;</span> -f ~/.ssh/id_rsa-gitee</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ssh configæ–‡ä»¶ï¼ˆvim ~&#x2F;.ssh&#x2F;configï¼‰ï¼Œè‹¥æ²¡æœ‰è¯¥æ–‡ä»¶å°±åˆ›å»ºå®ƒï¼ˆtouch ~&#x2F;.ssh&#x2F;configï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">    HostName github.com</span><br><span class="line">    User yourname@gmail.com</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa-github</span><br><span class="line">    StrictHostKeyChecking no</span><br><span class="line">    UserKnownHostsFile=/dev/null</span><br><span class="line">Host gitee.com</span><br><span class="line">    HostName gitee.com</span><br><span class="line">    User yourname@163.com</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa-gitee</span><br><span class="line">    StrictHostKeyChecking no</span><br><span class="line">    UserKnownHostsFile=/dev/null</span><br></pre></td></tr></table></figure>















]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>Shell and Shell Scripts</title>
    <url>/2024/08/18/2024/Shell-and-Shell-Scripts/</url>
    <content><![CDATA[<h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><p>åœ¨Linuxä¸­æœ‰å¾ˆå¤šShellå¯ä»¥ä½¿ç”¨ï¼Œå¸¸ç”¨çš„æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>shï¼šå³Bourne shellï¼Œç”±Steven Bourneå¼€å‘ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªæµè¡Œçš„shell</li>
<li>bashï¼šå³Bourne Again Shellï¼Œç”±GNUç»„ç»‡å¼€å‘ï¼Œå±äºBourne shellçš„å¢å¼ºç‰ˆæœ¬ï¼Œè¿™æ˜¯Linuxé»˜è®¤ä½¿ç”¨çš„shell</li>
<li>cshï¼šå³C shellï¼Œç”±Bill Joyå¼€å‘ï¼Œè¿™æ˜¯æµè¡Œäºå­¦æœ¯ç•ŒSunä¸»æœºçš„shell</li>
</ul>
<p>è™½ç„¶shellæœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯å­¦ä¹ å’Œå·¥ä½œéƒ½æ˜¯åŸºäºLinuxï¼Œæ‰€ä»¥æŒæ¡bashå³å¯ã€‚</p>
<h3 id="bashçš„åŠŸèƒ½"><a href="#bashçš„åŠŸèƒ½" class="headerlink" title="bashçš„åŠŸèƒ½"></a>bashçš„åŠŸèƒ½</h3><ul>
<li>å†å²å‘½ä»¤è®°å½•ï¼ˆhistoryï¼‰</li>
<li>å‘½ä»¤è¡¥å…¨åŠŸèƒ½ï¼ˆbash-completionï¼‰</li>
<li>å‘½ä»¤åˆ«åè®¾ç½®ï¼ˆaliasï¼‰</li>
<li>shellè„šæœ¬æ‰§è¡Œï¼ˆshell scriptsï¼‰</li>
</ul>
<h3 id="bashçš„å‘½ä»¤åˆ†ç±»"><a href="#bashçš„å‘½ä»¤åˆ†ç±»" class="headerlink" title="bashçš„å‘½ä»¤åˆ†ç±»"></a>bashçš„å‘½ä»¤åˆ†ç±»</h3><p>åœ¨bashä¸­æ‰§è¡Œçš„å‘½ä»¤åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li><p>å†…ç½®å‘½ä»¤ï¼šå†…ç½®å‘½ä»¤æ˜¯æŒ‡é›†æˆåœ¨bashé‡Œé¢çš„å¯ä»¥æ‰§è¡Œçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šcdã€pwd</p>
</li>
<li><p>å¤–éƒ¨å‘½ä»¤ï¼šå¤–éƒ¨å‘½ä»¤æ˜¯æ–‡ä»¶ç³»ç»Ÿé‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ·ä¸‹è½½çš„è½¯ä»¶å’Œç¼–å†™çš„è„šæœ¬æ–‡ä»¶</p>
</li>
</ul>
<blockquote>
<p>å¦‚ä½•åœ¨bashä¸­åˆ¤æ–­å‘½ä»¤çš„ç±»å‹ï¼Ÿtype target-command</p>
</blockquote>
<p>å¦‚æœtarget-commandæ˜¯ä¸€ä¸ªå†…ç½®å‘½ä»¤ï¼Œåˆ™ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">target-command is a shell <span class="built_in">builtin</span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šä½¿ç”¨æ—¶ï¼Œå°†target-commandæ›¿æ¢å…·ä½“çš„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼šcdã€ls</em></p>
<p>é‚£ä¹ˆå¦‚æœçŸ¥é“å½“å‰ä½¿ç”¨çš„shellç±»å‹å’Œæ”¯æŒå“ªäº›shellç±»å‹å‘¢ï¼Ÿ</p>
<ul>
<li><p>å½“å‰æ”¯æŒçš„shellç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">/bin/sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“å‰ä½¿ç”¨çš„shellç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /etc/shells </span><br><span class="line"><span class="comment"># /etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/usr/bin/rbash</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/dash</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>å…¶å®åœ¨åˆ›å»ºç”¨æˆ·æ—¶å°±ä¼šæŒ‡å®šä¸€ç§è¦ä½¿ç”¨çš„shellç±»å‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">user:x:1000:1000:user,,,:/home/caojun:/bin/bash</span><br><span class="line">ubuntu:x:1000:1000:ubuntu,,,:/home/caojun:/bin/sh</span><br></pre></td></tr></table></figure>

<p>rootç”¨æˆ·å°±æ˜¯ä½¿ç”¨shellç±»å‹å°±æ˜¯ï¼š<code>bash</code>ï¼Œè€Œubuntuç”¨æˆ·ä½¿ç”¨çš„shellç±»å‹æ˜¯ï¼š<code>sh</code></p>
<h3 id="bashçš„æŠ€å·§"><a href="#bashçš„æŠ€å·§" class="headerlink" title="bashçš„æŠ€å·§"></a>bashçš„æŠ€å·§</h3><p>åœ¨ä½¿ç”¨bashä¸­æœ‰å¾ˆå¤šå¸¸ç”¨çš„å°æŠ€å·§æˆ–è€…å°åŠŸèƒ½ï¼Œæœ‰å¿…è¦å­¦ä¹ å’Œè®°å½•ä¸€ä¸‹ã€‚</p>
<ul>
<li>å‘½ä»¤æ¢è¡Œï¼šè¾“å…¥ä¸€è¡Œå‘½ä»¤å¤ªé•¿ï¼Œé˜…è¯»æ•ˆæœå¹¶ä¸å¥½ï¼Œéœ€è¦æ‹†åˆ†æˆå¤šè¡Œæ˜¾ç¤ºã€‚åœ¨éœ€è¦æ¢è¡Œä½ç½®è¾“å…¥ <code>\</code> ï¼Œç´§æ¥ç€æŒ‰ä¸‹å›è½¦é”®ï¼ˆEnterï¼‰ï¼Œç„¶åæ¥ç€è¾“å…¥æœªå®Œæˆçš„å‘½ä»¤ã€‚</li>
<li>å…‰æ ‡è·³è½¬ï¼šè¾“å…¥ä¸€è¡Œå‘½ä»¤åï¼Œå‘ç°è¡Œå¤´é™„è¿‘æœ‰é”™è¯¯æˆ–è€…è¡Œå°¾å¤„æœ‰é”™è¯¯ï¼Œéœ€è¦å¿«é€Ÿè·³è½¬åˆ°è¡Œå¤´æˆ–è¡Œå°¾ã€‚é€šè¿‡ç»„åˆé”®è¿›è¡Œå…‰æ ‡å¿«é€Ÿè·³è½¬ï¼Œ<code>Ctrl+A</code> è°ƒåˆ°è¡Œå¤´ï¼Œ<code>Ctrl+E</code> è·³åˆ°è¡Œå°¾</li>
<li>ç¯å¢ƒå˜é‡ï¼šbashä¸­æœ‰å¾ˆå¤šé»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å¾ˆå¤šéƒ¨å‘½ä»¤ä¸éœ€è¦è¾“å…¥ç»å¯¹è·¯å¾„å°±å¯ä»¥æ‰§è¡Œã€‚é€šè¿‡ <code>env</code> å¯ä»¥æŸ¥è¯¢æ‰€æœ‰çš„é»˜è®¤ç¯å¢ƒå˜é‡ã€‚</li>
</ul>
<h2 id="Shell-Scripts"><a href="#Shell-Scripts" class="headerlink" title="Shell Scripts"></a>Shell Scripts</h2><blockquote>
<p>shell scriptsæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>shell scriptæ˜¯åˆ©ç”¨shellçš„åŠŸèƒ½æ‰€å†™çš„ä¸€ä¸ªâ€œç¨‹åºï¼ˆprogramï¼‰â€ï¼Œè¿™ä¸ªç¨‹åºæ˜¯ä½¿ç”¨çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå°†ä¸€äº›shellçš„è¯­æ³•ä¸æŒ‡ä»¤ï¼ˆåŒ…å«å¤–éƒ¨æŒ‡ä»¤ï¼‰å†™åœ¨é‡Œé¢ï¼Œæ­é…æ­£åˆ™è¡¨è¾¾å¼ã€ç®¡é“å‘½ä»¤ä¸æ•°æ®é‡å®šå‘ç­‰åŠŸèƒ½ï¼Œä»¥è¾¾åˆ°æˆ‘ä»¬æ‰€æƒ³è¦çš„å¤„ç†ç›®çš„ã€‚</p>
<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>å˜é‡ä¸€èˆ¬ç”¨äºå­˜æ”¾æ•°æ®ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒä¿®æ”¹ï¼Œæ–¹ä¾¿åœ¨ä¸åŒç¯å¢ƒæ‰§è¡Œæ—¶ï¼Œä»…ä»…ä¿®æ”¹å˜é‡å³å¯ä½¿ç”¨ã€‚</p>
<p>å˜é‡åçš„é™åˆ¶ï¼š</p>
<ul>
<li><p>å˜é‡åå’Œç­‰å·ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼ˆè¯­æ³•è§„å®šï¼‰</p>
</li>
<li><p>å˜é‡ååªèƒ½ç”±å­—æ¯ï¼ˆ<code>a~z</code>ï¼Œ<code>A~Z</code>ï¼‰ã€æ•°å­—ï¼ˆ0~9ï¼‰ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ç»„æˆï¼Œä¸”ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</p>
</li>
<li><p>å˜é‡åä¸èƒ½ä½¿ç”¨shellä¸­çš„å…³é”®å­—</p>
</li>
</ul>
<p>ç®€å•ç¤ºä¾‹1ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a simple example, print string &quot;hello world&quot;</span></span><br><span class="line">str1=<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">str2=<span class="string">&quot;world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str1</span> <span class="variable">$&#123;str2&#125;</span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šå®šä¹‰å˜é‡æ—¶ï¼Œç›´æ¥ç»™å˜é‡èµ‹å€¼ã€‚ä½¿ç”¨å˜é‡æ—¶ï¼Œå¿…é¡»é€šè¿‡<code>$</code>ç¬¦å·å¼•ç”¨ï¼Œè€Œä¸”å»ºè®®ç”¨<code>&#123;&#125;</code>å°†å˜é‡åŒ…å«èµ·æ¥ã€‚</em></p>
<h3 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h3><p>åˆ¤æ–­è¯­å¥ä¸€èˆ¬ç”¨äºæ£€æŸ¥æ¡ä»¶ç¬¦åˆä»€ä¹ˆæ¡ä»¶ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å†…å®¹ã€‚</p>
<h3 id="ifåˆ¤æ–­è¯­å¥"><a href="#ifåˆ¤æ–­è¯­å¥" class="headerlink" title="ifåˆ¤æ–­è¯­å¥"></a>ifåˆ¤æ–­è¯­å¥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># condition check, if [...];then</span></span><br><span class="line"></span><br><span class="line">target_file=condition.sh</span><br><span class="line">target_str=hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># example 1</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="variable">$&#123;target_file&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$&#123;target_file&#125;</span> exist</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># example 2</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;target_str&#125;</span> == <span class="string">&quot;hello&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span>  <span class="variable">$&#123;target_str&#125;</span> is exist</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$&#123;target_str&#125;</span> is not <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span>	</span><br><span class="line"></span><br><span class="line"><span class="comment"># example 3</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span>==<span class="string">&#x27;1&#x27;</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$1</span>==<span class="string">&#x27;2&#x27;</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;other&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼š</em></p>
<p><em>1ã€ç¬¬ä¸€è¡Œ <code>#!/bin/bash</code> è¡¨ç¤ºè¯¥è„šæœ¬æ–‡ä»¶ä½¿ç”¨shellç±»å‹æ˜¯ï¼šbashï¼Œè„šæœ¬æ–‡ä»¶å†…éƒ¨çš„å‘½ä»¤ä½¿ç”¨bashè¯­å¥è¿›è¡Œè§£é‡Šã€‚</em></p>
<p>2<em>ã€<code>$1</code> è¡¨ç¤ºä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</em></p>
<p>æ–‡ä»¶æµ‹è¯•æ ‡å¿—ï¼š</p>
<ul>
<li>-eï¼šæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li>
<li>-fï¼šæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åˆ™ä¸”ä¸ºæ™®é€šæ–‡ä»¶</li>
<li>-dï¼šæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ–‡ä»¶ç±»å‹æ˜¯ç›®å½•</li>
</ul>
<p>æ•´æ•°ä¹‹é—´çš„æ¯”è¾ƒï¼š</p>
<ul>
<li>-eqï¼šç›¸ç­‰</li>
<li>-neï¼šä¸ç›¸ç­‰</li>
<li>-gtï¼šå¤§äº</li>
<li>-ltï¼šå°äº</li>
<li>-geï¼šå¤§äºç­‰äº</li>
<li>-leï¼šå°äºç­‰äº</li>
</ul>
<p>å­—ç¬¦ä¸²ä¹‹é—´çš„æ¯”è¾ƒï¼š</p>
<ul>
<li>&#x3D;&#x3D;ï¼šå­—ç¬¦ä¸²ç›¸åŒ</li>
<li>!&#x3D;ï¼šå­—ç¬¦ä¸²ä¸åŒ</li>
<li>-zï¼šå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0</li>
<li>-nï¼šå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸ºé0</li>
</ul>
<h3 id="caseåˆ¤æ–­è¯­å¥"><a href="#caseåˆ¤æ–­è¯­å¥" class="headerlink" title="caseåˆ¤æ–­è¯­å¥"></a>caseåˆ¤æ–­è¯­å¥</h3><p>é€šè¿‡ä¼ å…¥çš„æ•°å­—å­—ç¬¦ä¸²æ¥åˆ¤æ–­æ˜ŸæœŸå‡ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print weekday by a number</span></span><br><span class="line">option=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;option&#125;</span> <span class="keyword">in</span></span><br><span class="line">	1)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Mon&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	2)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Tue&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	3)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Wed&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	4)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Thu&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	5)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Fri&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	6)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Sat&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	7)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Sun&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;unkonwn&quot;</span></span><br><span class="line">		;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><p>æ‰§è¡Œå¾ªç¯ä½“ï¼Œæ‰“å°ä»1åˆ°10</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 10)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å°†å›ºå®šçš„åŠŸèƒ½æ¨¡å—åŒ–â€“å‡½æ•°ï¼Œä¹‹åå¯ä»¥å¤ç”¨è¯¥å‡½æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">printit</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> -n <span class="string">&quot;Your choice is &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This program will print your selection!&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;1&#125;</span> <span class="keyword">in</span></span><br><span class="line">	<span class="string">&quot;one&quot;</span>)</span><br><span class="line">		printit; <span class="built_in">echo</span> <span class="variable">$&#123;1&#125;</span> | <span class="built_in">tr</span> <span class="string">&#x27;a-z&#x27;</span> <span class="string">&#x27;A-Z&#x27;</span></span><br><span class="line">		;;</span><br><span class="line">	<span class="string">&quot;two&quot;</span>)</span><br><span class="line">		printit; <span class="built_in">echo</span> <span class="variable">$&#123;1&#125;</span> | <span class="built_in">tr</span> <span class="string">&#x27;a-z&#x27;</span> <span class="string">&#x27;A-Z&#x27;</span></span><br><span class="line">		;;</span><br><span class="line">	<span class="string">&quot;three&quot;</span>)</span><br><span class="line">		printit; <span class="built_in">echo</span> <span class="variable">$&#123;1&#125;</span> | <span class="built_in">tr</span> <span class="string">&#x27;a-z&#x27;</span> <span class="string">&#x27;A-Z&#x27;</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Usage <span class="variable">$&#123;0&#125;</span> &#123;one;two;three&#125;&quot;</span></span><br><span class="line">		;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



















]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
        <tag>Shell Scripts</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/08/17/2024/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Clean-Statuc-files"><a href="#Clean-Statuc-files" class="headerlink" title="Clean Statuc files"></a>Clean Statuc files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo clean</span><br></pre></td></tr></table></figure>

<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo command</tag>
      </tags>
  </entry>
  <entry>
    <title>bluetoothctl client tool</title>
    <url>/2024/08/16/2024/bluetoothctl-client-tool/</url>
    <content><![CDATA[<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p>åœ¨ä½¿ç”¨æŸä¸€å®¶SoCçš„è“ç‰™åº“çš„æ—¶å€™ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½æ— æ³•ä¿®æ”¹ã€‚ä½†æ˜¯åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°è¿™å®¶SoCçš„è“ç‰™åº“ä¹Ÿæ˜¯åŸºäºbluezçš„dbuså®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä¹Ÿå¯ä»¥å°è£…ä¸€ä¸ªè“ç‰™åº“ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘æ‰‹é‡Œæœ‰æ ‘è“æ´¾4Bä¸€å°ï¼Œè¯¥è®¾å¤‡å…·å¤‡äº†è“ç‰™å’ŒWi-FiåŠŸèƒ½ã€‚é‚£ä¹ˆåªéœ€è¦é€šè¿‡ç ”ç©¶bluezé¡¹ç›®ä¸­çš„bluetoothctlå·¥å…·çš„æºç ï¼Œç„¶åè¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹ï¼Œæœ€åå°è£…æˆè‡ªå·±çš„è“ç‰™åº“ã€‚</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="ç¡¬ä»¶å¹³å°"><a href="#ç¡¬ä»¶å¹³å°" class="headerlink" title="ç¡¬ä»¶å¹³å°"></a>ç¡¬ä»¶å¹³å°</h3><p>æ ‘è“æ´¾ç¯å¢ƒä»‹ç»ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿï¼šUbuntu 24.04 LTS</p>
<p>å†…æ ¸ï¼š6.8.0-1009-raspi</p>
<p>æ¶æ„ï¼šaarch64</p>
<p>å†…å­˜ï¼š8GB</p>
</blockquote>
<p>é˜…è¯»è“ç‰™å®˜æ–¹æ–‡æ¡£ï¼Œé€šè¿‡åŸºäºbluezçš„dbusæ¥å£ç¼–ç¨‹éœ€è¦ç›¸å…³ä¾èµ–åº“ï¼šglib-2.0 ã€gio-2.0ã€ dbus-1ï¼Œå¦‚æœæ ‘è“æ´¾ç¯å¢ƒæ²¡æœ‰ä»¥ä¸Šä¾èµ–åº“ï¼Œåˆ™é€šè¿‡aptå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install libglib2.0-dev libdbus-1-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡pkg-configå¯ä»¥æŸ¥æ‰¾å¯¹åº”çš„å¤´æ–‡ä»¶ç›®å½•å’Œåº“æ–‡ä»¶</span></span><br><span class="line">pkg-config --cflags glib-2.0 gio-2.0 dbus-1</span><br><span class="line">pkg-config --libs glib-2.0 gio-2.0 dbus-1</span><br></pre></td></tr></table></figure>

<p>æ¶‰åŠçš„å¤´æ–‡ä»¶ç›®å½•å’Œåº“æ–‡ä»¶æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>-I&#x2F;usr&#x2F;include&#x2F;glib-2.0 </p>
</li>
<li><p>-I&#x2F;usr&#x2F;lib&#x2F;aarch64-linux-gnu&#x2F;glib-2.0&#x2F;include </p>
</li>
<li><p>-pthread -I&#x2F;usr&#x2F;include&#x2F;libmount</p>
</li>
<li><p>-I&#x2F;usr&#x2F;include&#x2F;blkid </p>
</li>
<li><p>-lgio-2.0 </p>
</li>
<li><p>-lgobject-2.0 </p>
</li>
<li><p>-lglib-2.0 </p>
</li>
<li><p>-ldbus-1</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡dpkgæŸ¥çœ‹ç›¸å…³ä¾èµ–åº“æ˜¯å¦å·²ç»å®‰è£…</span></span><br><span class="line">dpkg -l | grep libglib2.0-dev</span><br><span class="line">dpkg -l | grep libdbus-1-dev</span><br></pre></td></tr></table></figure>

<p>æ¶‰åŠçš„ä¾èµ–åŒ…æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>libglib2.0-dev-bin</p>
</li>
<li><p>libglib2.0-dev-bin</p>
</li>
<li><p>libdbus-1-dev:arm64</p>
</li>
</ul>
<h3 id="åè®®æ–‡æ¡£"><a href="#åè®®æ–‡æ¡£" class="headerlink" title="åè®®æ–‡æ¡£"></a>åè®®æ–‡æ¡£</h3><h4 id="dbusæ•°æ®æ¨¡å‹"><a href="#dbusæ•°æ®æ¨¡å‹" class="headerlink" title="dbusæ•°æ®æ¨¡å‹"></a>dbusæ•°æ®æ¨¡å‹</h4><p><a href="https://dbus.freedesktop.org/doc/dbus-specification.html">dbusè§„èŒƒ</a></p>
<p>dbusä½¿ç”¨ä¸€å¥—ç±»å‹äºJSONç±»å‹çš„æ•°æ®æ¨¡å‹ï¼Œä½†è¿˜æ˜¯æœ‰æ‰€å·®åˆ«ï¼Œdbusæ•°æ®æ¨¡å‹ï¼š</p>
<table>
<thead>
<tr>
<th>å¸¸è§„åå­—</th>
<th>ASCIIç¬¦å·</th>
<th>æ•°æ®å®šä¹‰</th>
<th>ç¼–ç å­˜å‚¨</th>
</tr>
</thead>
<tbody><tr>
<td>BYTE</td>
<td>y</td>
<td>guchar</td>
<td>unsigned 8-bit integer</td>
</tr>
<tr>
<td>BOOlEAN</td>
<td>b</td>
<td>gboolean</td>
<td>boolean value: 0 is false, 1 is true</td>
</tr>
<tr>
<td>INT16</td>
<td>n</td>
<td>gint16</td>
<td>signed 16-bit integer</td>
</tr>
<tr>
<td>UINT16</td>
<td>q</td>
<td>guint16</td>
<td>unsigned 16-bit integer</td>
</tr>
<tr>
<td>INT32</td>
<td>i</td>
<td>gint32</td>
<td>signed 32-bit integer</td>
</tr>
<tr>
<td>UINT32</td>
<td>u</td>
<td>guint32</td>
<td>unsigned 32-bit integer</td>
</tr>
<tr>
<td>INT64</td>
<td>x</td>
<td>gint64</td>
<td>signed 64-bit integer</td>
</tr>
<tr>
<td>UINT64</td>
<td>t</td>
<td>guint64</td>
<td>unsigned 64-bit integer</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>d</td>
<td>gdouble</td>
<td>double-precision floating point</td>
</tr>
<tr>
<td>UNIX_FD</td>
<td>h</td>
<td></td>
<td>unsigned 32-bit representing an index into an out-of-band array of file descriptors</td>
</tr>
<tr>
<td>STRING</td>
<td>s</td>
<td></td>
<td>string, å¿…é¡»æ˜¯æœ‰æ•ˆçš„UTF-8å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>OBJECT_PATH</td>
<td>o</td>
<td></td>
<td>object_pathï¼Œä¾‹å¦‚ï¼š&#x2F;org&#x2F;bluez&#x2F;hci0&#x2F;dev_50_64_2B_BF_46_36</td>
</tr>
<tr>
<td>SIGNATURE</td>
<td>g</td>
<td></td>
<td>signatureç±»å‹ï¼Œå³ç­¾åç±»å‹</td>
</tr>
<tr>
<td>ARRAY</td>
<td>a</td>
<td></td>
<td>array, like []</td>
</tr>
<tr>
<td>VARIANT</td>
<td>v</td>
<td></td>
<td>variantï¼Œå˜ä½“ç±»å‹</td>
</tr>
<tr>
<td>STRUCT</td>
<td>r ã€(  ã€ )</td>
<td></td>
<td>ç»“æ„ç±»å‹</td>
</tr>
<tr>
<td>DICT_ENTRY</td>
<td>e ã€{ ã€ }</td>
<td></td>
<td>å­—å…¸æˆ–æ˜ å°„ï¼ˆé”®å€¼å¯¹æ•°ç»„ï¼‰çš„æ¡ç›®</td>
</tr>
</tbody></table>
<p>å…³äºç»“æ„ç±»å‹ï¼Œå…¶ç»„æˆæ˜¯ç”±å…¶ä»–ç±»å‹ç»„åˆè€Œæˆã€‚ä¾‹å¦‚ï¼š<code>(a&#123;oa&#123;sa&#123;sv&#125;&#125;&#125;)</code></p>
<p>é€šè¿‡ä¸Šè¿°è¡¨æ ¼çš„æ•°æ®ç±»å‹æ¥è§£æç»“æ„ç±»å‹æ•°æ®ã€‚</p>
<p>1ã€æ‹¬å· <code>()</code> è¡¨ç¤ºä¸€ä¸ªç»“æ„ä½“</p>
<p>2ã€<code>a&#123;oa&#123;sa&#123;sv&#125;&#125;&#125;</code> è¡¨ç¤ºä¸€ä¸ªå­—å…¸æ•°ç»„ï¼Œå…¶ä¸­çš„é”®ä¸ºå¯¹è±¡è·¯å¾„ï¼ˆå³ oï¼‰ï¼Œå€¼ä¸ºå¦å¤–ä¸€ä¸ªå­—å…¸æ•°ç»„ï¼ˆå³ a{sa{sv}}ï¼‰</p>
<p>3ã€<code>a&#123;sa&#123;sv&#125;&#125;</code> è¡¨ç¤ºä¸€ä¸ªå­—å…¸æ•°ç»„ï¼Œå…¶ä¸­çš„é”®ä¸ºå­—ç¬¦ä¸²ï¼ˆå³ sï¼‰ï¼Œå€¼ä¸ºå¦å¤–ä¸€ä¸ªå­—å…¸æ•°ç»„ï¼ˆå³ a{sv}ï¼‰</p>
<p>4ã€<code>a&#123;sv&#125;</code> è¡¨ç¤ºä¸€ä¸ªå­—å…¸æ•°ç»„ï¼Œå…¶ä¸­çš„é”®ä¸ºå­—ç¬¦ä¸²ï¼ˆå³ sï¼‰ï¼Œå€¼ä¸ºå˜ä½“ï¼ˆå³vï¼‰</p>
<p><em>æ³¨æ„ï¼šå­—å…¸æ•°ç»„è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šå­—å…¸ + æ•°ç»„ï¼Œç±»å‹æ˜¯å­—å…¸ï¼Œä½†æ˜¯å­—å…¸é‡Œé¢å¤šä¸ªå­—å…¸å…ƒç´ </em></p>
<p><code>a&#123;oa&#123;sa&#123;sv&#125;&#125;&#125;</code> çš„å…·ä½“æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    &#x27;/org/bluez&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.AgentManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.ProfileManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.HealthManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    &#x27;/org/bluez/hci0&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.Adapter1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;Address&#x27;<span class="punctuation">:</span> &lt;&#x27;D8<span class="punctuation">:</span><span class="number">3</span>A<span class="punctuation">:</span>DD<span class="punctuation">:</span><span class="number">9</span>B<span class="punctuation">:</span><span class="number">13</span><span class="punctuation">:</span><span class="number">9</span>C&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;AddressType&#x27;<span class="punctuation">:</span> &lt;&#x27;public&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Name&#x27;<span class="punctuation">:</span> &lt;&#x27;caojun-desktop&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Alias&#x27;<span class="punctuation">:</span> &lt;&#x27;caojun-desktop&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Class&#x27;<span class="punctuation">:</span> &lt;uint32 <span class="number">7077888</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Powered&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Discoverable&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;DiscoverableTimeout&#x27;<span class="punctuation">:</span> &lt;uint32 <span class="number">180</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Pairable&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;PairableTimeout&#x27;<span class="punctuation">:</span> &lt;uint32 <span class="number">0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Discovering&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;UUIDs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span></span><br><span class="line">                &#x27;<span class="number">0000110e-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000111</span>f<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001200</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110</span>b<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110</span>a<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110</span>c<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001800</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001801</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000180</span>a<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000111e-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Modalias&#x27;<span class="punctuation">:</span> &lt;&#x27;usb<span class="punctuation">:</span>v1D6Bp0246d0548&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Roles&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;central&#x27;<span class="punctuation">,</span> &#x27;peripheral&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Manufacturer&#x27;<span class="punctuation">:</span> &lt;uint16 <span class="number">305</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Version&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x09</span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.freedesktop.DBus.Properties&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.BatteryProviderManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.GattManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.Media1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;SupportedUUIDs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span></span><br><span class="line">                &#x27;<span class="number">0000110</span>a<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110</span>b<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">]</span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.NetworkServer1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.LEAdvertisingManager1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;ActiveInstances&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x00</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;SupportedInstances&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x05</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;SupportedIncludes&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>&#x27;tx-power&#x27;<span class="punctuation">,</span> &#x27;appearance&#x27;<span class="punctuation">,</span> &#x27;local-name&#x27;<span class="punctuation">]</span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.Device1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;Address&#x27;<span class="punctuation">:</span> &lt;&#x27;<span class="number">50</span><span class="punctuation">:</span><span class="number">64</span><span class="punctuation">:</span><span class="number">2</span>B<span class="punctuation">:</span>BF<span class="punctuation">:</span><span class="number">46</span><span class="punctuation">:</span><span class="number">36</span>&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;AddressType&#x27;<span class="punctuation">:</span> &lt;&#x27;public&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Name&#x27;<span class="punctuation">:</span> &lt;&#x27;å°çˆ±è§¦å±éŸ³ç®±<span class="number">-8523</span>&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Alias&#x27;<span class="punctuation">:</span> &lt;&#x27;å°çˆ±è§¦å±éŸ³ç®±<span class="number">-8523</span>&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Class&#x27;<span class="punctuation">:</span> &lt;uint32 <span class="number">2360348</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Icon&#x27;<span class="punctuation">:</span> &lt;&#x27;audio-card&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Paired&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Bonded&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Trusted&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Blocked&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;LegacyPairing&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Connected&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;UUIDs&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span></span><br><span class="line">                &#x27;<span class="number">0000110</span>b<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110</span>c<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">0000110e-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001200</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001800</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001801</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">,</span> </span><br><span class="line">                &#x27;<span class="number">00001828</span><span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;<span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Modalias&#x27;<span class="punctuation">:</span> &lt;&#x27;bluetooth<span class="punctuation">:</span>v0046p1200d1436&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Adapter&#x27;<span class="punctuation">:</span> &lt;objectpath &#x27;/org/bluez/hci0&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;ServicesResolved&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.freedesktop.DBus.Properties&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.MediaControl1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span>&#x27;Connected&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">true</span></span>&gt;<span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36/sep2&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.MediaEndpoint1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;UUID&#x27;<span class="punctuation">:</span> &lt;&#x27;<span class="number">0000110</span>b<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Codec&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x02</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Capabilities&#x27;<span class="punctuation">:</span> &lt;b&#x27;\<span class="number">200</span>\<span class="number">001</span>\<span class="number">214</span>\<span class="number">004</span>\<span class="number">342</span>&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Device&#x27;<span class="punctuation">:</span> &lt;objectpath &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;DelayReporting&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.freedesktop.DBus.Properties&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36/sep1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.MediaEndpoint1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;UUID&#x27;<span class="punctuation">:</span> &lt;&#x27;<span class="number">0000110</span>b<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Codec&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x00</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Capabilities&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>byte <span class="number">0x3f</span><span class="punctuation">,</span> <span class="number">0xff</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x35</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Device&#x27;<span class="punctuation">:</span> &lt;objectpath &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;DelayReporting&#x27;<span class="punctuation">:</span> &lt;<span class="literal"><span class="keyword">false</span></span>&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.freedesktop.DBus.Properties&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36/sep1/fd12&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        &#x27;org.freedesktop.DBus.Introspectable&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.bluez.MediaTransport1&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            &#x27;Device&#x27;<span class="punctuation">:</span> &lt;objectpath &#x27;/org/bluez/hci0/dev_50_64_2B_BF_46_36&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;UUID&#x27;<span class="punctuation">:</span> &lt;&#x27;<span class="number">0000110</span>a<span class="number">-0000</span><span class="number">-1000</span><span class="number">-8000</span><span class="number">-00805</span>f9b34fb&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Codec&#x27;<span class="punctuation">:</span> &lt;byte <span class="number">0x00</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">            &#x27;Configuration&#x27;<span class="punctuation">:</span> &lt;<span class="punctuation">[</span>byte <span class="number">0x11</span><span class="punctuation">,</span> <span class="number">0x15</span><span class="punctuation">,</span> <span class="number">0x02</span><span class="punctuation">,</span> <span class="number">0x35</span><span class="punctuation">]</span>&gt;<span class="punctuation">,</span> &#x27;State&#x27;<span class="punctuation">:</span> &lt;&#x27;idle&#x27;&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        &#x27;org.freedesktop.DBus.Properties&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="dbusæ¥å£æ¨¡å‹"><a href="#dbusæ¥å£æ¨¡å‹" class="headerlink" title="dbusæ¥å£æ¨¡å‹"></a>dbusæ¥å£æ¨¡å‹</h4><ul>
<li><p><strong>æœåŠ¡åç§°ï¼ˆdbus nameï¼‰</strong>ï¼š<br>æœåŠ¡ç«¯ç¨‹åºåœ¨D-Busä¸Šæ³¨å†Œçš„æœåŠ¡åç§°ï¼ˆå³ dbus nameï¼‰ï¼Œåœ¨D-Busä¸Šçš„æ³¨å†Œçš„æœåŠ¡åä¼šäº§ç”Ÿä¸€ä¸ªåœ°å€ï¼ˆä¾‹å¦‚ï¼š<code>/org/bluez</code>ï¼‰å’Œå”¯ä¸€åç§°ï¼ˆä¾‹å¦‚ï¼š<code>1.466</code>ï¼‰ï¼Œåœ°å€å’Œå”¯ä¸€åç§°éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œå®¢æˆ·ç«¯é€šè¿‡dbus nameæ¥çŸ¥é“æœåŠ¡åç§°ã€‚dbus nameçš„æ ¼å¼ï¼Œä¾‹å¦‚ï¼š<code>org.bluez</code>ï¼Œè¿™æ˜¯D-Busçš„è§„å®šï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆã€‚</p>
</li>
<li><p><strong>å¯¹è±¡ï¼ˆObjectï¼‰</strong>ï¼š<br>å¯¹è±¡ä»¥è·¯å¾„çš„å½¢å¼è¡¨ç¤ºï¼Œå¯¹è±¡è·¯å¾„ä»£è¡¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚å¯¹è±¡è·¯å¾„çš„å‰ç¼€ä»¥dbus nameä¸ºå‚è€ƒï¼Œæ¥ä¸Šå…¶ä»–çš„ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°dbus nameï¼š<code>org.bluez</code>ï¼Œé‚£ä¹ˆå¯¹è±¡è·¯å¾„å‰ç¼€æ˜¯ï¼š<code>/org/bluez</code>ï¼Œæ¥ä¸Šå…¶ä»–çš„ï¼Œå½¢æˆå®Œæˆçš„å¯¹è±¡è·¯å¾„ï¼Œä¾‹å¦‚ï¼š<code>/org/bluez/hci0</code></p>
</li>
<li><p><strong>æ¥å£ï¼ˆInterfaceï¼‰</strong>ï¼š<br>æ¥å£ï¼Œé¡¾åæ€ä¹‰ã€‚æ¥å£åç§°çš„æ ¼å¼è§„å®šä¸dbus nameä¸€æ ·ï¼Œä¾‹å¦‚ï¼š<code>org.bluez.Adapter1</code></p>
</li>
<li><p><strong>æˆå‘˜åç§°ï¼ˆMember nameï¼‰</strong>ï¼š<br>æˆå‘˜åŒ…æ‹¬ï¼šæ–¹æ³•ï¼ˆMethodï¼‰å’Œä¿¡å·ï¼ˆSignalï¼‰ï¼Œåœ¨å¤§å¤šæ•°æ–¹é¢ï¼Œä»–ä»¬å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œé™¤äº†ä¸¤ç‚¹ï¼š</p>
<p>1ã€Signalæ˜¯åœ¨æ€»çº¿ä¸­è¿›è¡Œå¹¿æ’­çš„ï¼Œè€ŒMethodæ˜¯æŒ‡å®šå‘ç»™æŸä¸ªè¿›ç¨‹çš„ã€‚</p>
<p>2ã€Signal ä¸ä¼šæœ‰è¿”å›ï¼Œè€Œ Method ä¸€å®šä¼šæœ‰è¿”å›ï¼ˆMethodè°ƒç”¨å¯ä»¥åŒæ­¥çš„æˆ–æ˜¯å¼‚æ­¥çš„ï¼‰ã€‚</p>
<p>ä» C API çš„å±‚é¢æ¥çœ‹ï¼ŒMember name æœ€å¤§çš„ä½œç”¨å°±æ˜¯åœ¨ä¸¤ä¸ªè¿›ç¨‹é—´å…±äº« â€œå‘å‡ºçš„æ¶ˆæ¯çš„ç±»å‹ä¿¡æ¯â€ï¼ŒDBus åªèƒ½ä»¥ Signal or Method æ¥è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚</p>
</li>
</ul>
<h4 id="dbusé€šç”¨æ¥å£"><a href="#dbusé€šç”¨æ¥å£" class="headerlink" title="dbusé€šç”¨æ¥å£"></a>dbusé€šç”¨æ¥å£</h4><p>dbusæ ‡å‡†æ¥å£å…±æœ‰4ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>org.freedesktop.DBus.Peer</li>
<li>org.freedesktop.DBus.Introspectable</li>
<li><strong>org.freedesktop.DBus.Properties</strong>ï¼šç”¨äºè·å–å’Œè®¾ç½®å¯¹è±¡å±æ€§ï¼Œå¹¶ç›‘å¬å±æ€§å˜åŒ–ã€‚</li>
<li><strong>org.freedesktop.DBus.ObjectManager</strong>ï¼šç”¨äºç®¡ç†å’Œç›‘æ§ D-Bus å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºè·å–æ‰€æœ‰å¯¹è±¡åŠå…¶æ¥å£å’Œå±æ€§ã€‚</li>
</ul>
<h5 id="org-freedesktop-DBus-Properties"><a href="#org-freedesktop-DBus-Properties" class="headerlink" title="org.freedesktop.DBus.Properties"></a>org.freedesktop.DBus.Properties</h5><p>å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>Getï¼šè·å–å¯¹è±¡çš„ç‰¹å®šå±æ€§å€¼</li>
<li>Setï¼šè®¾ç½®å¯¹è±¡çš„ç‰¹å®šå±æ€§å€¼</li>
<li>GetAllï¼šè·å–å¯¹è±¡çš„æ‰€æœ‰å±æ€§å€¼</li>
</ul>
<p>å¸¸ç”¨çš„ä¿¡å·æœ‰ï¼š</p>
<ul>
<li>PropertiesChangedï¼šå½“å¯¹è±¡çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶å‘å‡ºä¿¡å·</li>
</ul>
<h5 id="org-freedesktop-DBus-ObjectManager"><a href="#org-freedesktop-DBus-ObjectManager" class="headerlink" title="org.freedesktop.DBus.ObjectManager"></a>org.freedesktop.DBus.ObjectManager</h5><p>å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>GetManagedObjectsï¼šè·å–æ‰€æœ‰å—ç®¡ç†çš„å¯¹è±¡åŠå…¶æ¥å£å’Œå±æ€§</li>
</ul>
<p>å¸¸ç”¨çš„ä¿¡å·æœ‰ï¼š</p>
<ul>
<li><p>InterfacesAddedï¼šå½“æ–°å¯¹è±¡æ·»åŠ æ—¶å‘å‡ºä¿¡å·</p>
</li>
<li><p>InterfacesRemovedï¼šå½“å¯¹è±¡æ¥å£ç§»é™¤æ—¶å‘å‡ºä¿¡å·</p>
</li>
</ul>
<h4 id="dbus-for-bluezæ¥å£"><a href="#dbus-for-bluezæ¥å£" class="headerlink" title="dbus for bluezæ¥å£"></a>dbus for bluezæ¥å£</h4><p>bluez dbus api æ–‡æ¡£æ¶‰åŠåˆ°å„ä¸ªä¸åŒæ¥å£ï¼Œä¸»è¦å…³æ³¨è¿™å‡ ä¸ªæ¥å£ï¼š</p>
<ul>
<li>org.bluez.Adapter1</li>
<li>org.bluez.Device1</li>
<li>org.bluez.Agent1</li>
</ul>
<h5 id="org-bluez-Adapter1"><a href="#org-bluez-Adapter1" class="headerlink" title="org.bluez.Adapter1"></a>org.bluez.Adapter1</h5><p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<p>è¿™ä¸ªæ¥å£ç”¨äºç®¡ç†è“ç‰™é€‚é…å™¨ï¼Œå®ç°äº†è“ç‰™è®¾å¤‡çš„æœç´¢å’Œç®¡ç†åŠŸèƒ½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:Service:	org.bluez</span><br><span class="line">:Interface:	org.bluez.Adapter1</span><br><span class="line">:Object path:	[variable prefix]/&#123;hci0,hci1,...&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><strong>void StartDiscovery()</strong></td>
<td>å¼€å§‹æ‰«æè®¾å¤‡</td>
</tr>
<tr>
<td><strong>void StopDiscovery()</strong></td>
<td>ç»“æŸæ‰«æè®¾å¤‡</td>
</tr>
<tr>
<td><strong>void RemoveDevice(object device)</strong></td>
<td>ç§»é™¤è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td>void SetDiscoveryFilter(dict filter)</td>
<td>è®¾ç½®æ‰«ææ¡ä»¶</td>
</tr>
<tr>
<td>array{string} GetDiscoveryFilters()</td>
<td>è·å–æ‰«ææ¡ä»¶</td>
</tr>
<tr>
<td>object ConnectDevice(dict properties) [experimental]</td>
<td>è¿æ¥è“ç‰™è®¾å¤‡</td>
</tr>
</tbody></table>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>string Address</strong></td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡MACåœ°å€</td>
</tr>
<tr>
<td>string AddressType</td>
<td>[readonly]</td>
<td>å–å€¼èŒƒå›´ï¼špublicå’Œrandom</td>
</tr>
<tr>
<td><strong>string Name</strong></td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡åç§°</td>
</tr>
<tr>
<td>string Alias</td>
<td>[readwrite]</td>
<td>è“ç‰™è®¾å¤‡åˆ«å</td>
</tr>
<tr>
<td>uint32 Class</td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡ç±»å‹</td>
</tr>
<tr>
<td><strong>boolean Powered</strong></td>
<td>[readwrite]</td>
<td>æ‰“å¼€æˆ–å…³é—­é€‚é…å™¨ç”µæº</td>
</tr>
<tr>
<td>string PowerState</td>
<td>[readonly, experimental]</td>
<td>é€‚é…å™¨ç”µæºçŠ¶æ€</td>
</tr>
<tr>
<td>boolean Discoverable</td>
<td>[readwrite] (Default: false)</td>
<td>æ‰“å¼€æˆ–å…³é—­é€‚é…å™¨å¯è¢«å‘ç°çŠ¶æ€</td>
</tr>
<tr>
<td>boolean Pairable</td>
<td>[readwrite] (Default: true)</td>
<td>æ‰“å¼€æˆ–å…³é—­é€‚é…å¯è¢«é…å¯¹çŠ¶æ€</td>
</tr>
<tr>
<td>uint32 PairableTimeout</td>
<td>[readwrite] (Default: 0)</td>
<td>é…å¯¹è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰</td>
</tr>
<tr>
<td>uint32 DiscoverableTimeout</td>
<td>[readwrite] (Default: 180)</td>
<td>å‘ç°è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰</td>
</tr>
<tr>
<td>boolean Discovering</td>
<td>[readonly]</td>
<td>æ‰«ææ‰§è¡ŒçŠ¶æ€</td>
</tr>
<tr>
<td>array{string} UUIDs</td>
<td>[readonly]</td>
<td>128-bit UIIDs</td>
</tr>
<tr>
<td>string Modalias</td>
<td>[readonly, optional]</td>
<td>å†…æ ¸ä½¿ç”¨çš„æœ¬åœ°è®¾å¤‡ID</td>
</tr>
<tr>
<td>array{string} Roles</td>
<td>[readonly]</td>
<td>æ”¯æŒè§’è‰²åˆ—è¡¨</td>
</tr>
<tr>
<td>array{string} ExperimentalFeatures</td>
<td>[readonly, optional]</td>
<td>å®éªŒæ€§è´¨çš„128-bit UIIDs</td>
</tr>
<tr>
<td>uint16 Manufacturer</td>
<td>[readonly]</td>
<td>è®¾å¤‡åˆ¶é€ å•†</td>
</tr>
<tr>
<td>byte Version</td>
<td>[readonly]</td>
<td>è®¾å¤‡æ”¯æŒçš„è“ç‰™ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<h5 id="org-bluez-Device1"><a href="#org-bluez-Device1" class="headerlink" title="org.bluez.Device1"></a>org.bluez.Device1</h5><p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<p>è¿™ä¸ªæ¥å£ç”¨äºç®¡ç†è“ç‰™è®¾å¤‡ï¼Œå®ç°äº†è®¾å¤‡çš„é…å¯¹ã€è¿æ¥å’Œæ–­å¼€è¿æ¥ç­‰åŠŸèƒ½ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">:Service:	org.bluez</span><br><span class="line">:Interface:	org.bluez.Device1</span><br><span class="line">:Object path:	[variable prefix]/&#123;hci0,hci1,...&#125;/dev_XX_XX_XX_XX_XX_XX</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><strong>void Connect()</strong></td>
<td>è¿æ¥è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td><strong>void Disconnect()</strong></td>
<td>æ–­å¼€è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td>void ConnectProfile(string uuid)</td>
<td>è¿æ¥é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td>void DisconnectProfile(string uuid)</td>
<td>æ–­å¼€é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>void Pair()</strong></td>
<td>é…å¯¹è“ç‰™è®¾å¤‡</td>
</tr>
<tr>
<td>void CancelPairing()</td>
<td>å–æ¶ˆé…å¯¹è¯·æ±‚</td>
</tr>
</tbody></table>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>string Address</strong></td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡MACåœ°å€</td>
</tr>
<tr>
<td>string AddressType</td>
<td>[readonly]</td>
<td>å–å€¼èŒƒå›´ï¼špublicå’Œrandom</td>
</tr>
<tr>
<td><strong>string Name</strong></td>
<td>[readonly, optional]</td>
<td>è“ç‰™è®¾å¤‡åç§°</td>
</tr>
<tr>
<td>string Icon</td>
<td>[readonly, optional]</td>
<td>è“ç‰™è®¾å¤‡å›¾æ ‡</td>
</tr>
<tr>
<td>uint32 Class</td>
<td>[readonly, optional]</td>
<td>è“ç‰™è®¾å¤‡ç±»å‹</td>
</tr>
<tr>
<td>uint16 Appearance</td>
<td>[readonly, optional]</td>
<td>è“ç‰™è®¾å¤‡å¤–è§‚</td>
</tr>
<tr>
<td>array{string} UUIDs</td>
<td>[readonly, optional]</td>
<td>128-bit UIIDs</td>
</tr>
<tr>
<td><strong>boolean Paired</strong></td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡é…å¯¹çŠ¶æ€</td>
</tr>
<tr>
<td>boolean Bonded</td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡ç»‘å®šçŠ¶æ€</td>
</tr>
<tr>
<td><strong>boolean Connected</strong></td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡è¿æ¥çŠ¶æ€</td>
</tr>
<tr>
<td>boolean Trusted</td>
<td>[readwrite]</td>
<td>è“ç‰™è®¾å¤‡ä¿¡ä»»çŠ¶æ€</td>
</tr>
<tr>
<td>boolean Blocked</td>
<td>[readwrite]</td>
<td>è“ç‰™è®¾å¤‡é˜»å¡çŠ¶æ€</td>
</tr>
<tr>
<td>boolean WakeAllowed</td>
<td>[readwrite]</td>
<td>è“ç‰™è®¾å¤‡å”¤é†’åŠŸèƒ½</td>
</tr>
<tr>
<td>string Alias</td>
<td>[readwrite]</td>
<td>è“ç‰™è®¾å¤‡åˆ«å</td>
</tr>
<tr>
<td>object Adapter</td>
<td>[readonly]</td>
<td>è“ç‰™è®¾å¤‡æ‰€å±é€‚é…å™¨å¯¹è±¡</td>
</tr>
<tr>
<td>boolean LegacyPairing</td>
<td>[readonly]</td>
<td>ä¼ ç»Ÿé…å¯¹åŠŸèƒ½</td>
</tr>
<tr>
<td>string Modalias</td>
<td>[readonly, optional]</td>
<td>å†…æ ¸ä½¿ç”¨çš„è®¾å¤‡ID</td>
</tr>
<tr>
<td>int16 RSSI</td>
<td>[readonly, optional]</td>
<td>è“ç‰™è®¾å¤‡ä¿¡å·å¼ºåº¦</td>
</tr>
<tr>
<td>int16 TxPower</td>
<td>[readonly, optional]</td>
<td>è“ç‰™å¹¿æ’­å‘å°„åŠŸç‡ç”µå¹³</td>
</tr>
<tr>
<td>dict ManufacturerData</td>
<td>[readonly, optional]</td>
<td>è“ç‰™åˆ¶é€ å•†æ•°æ®</td>
</tr>
<tr>
<td>dict ServiceData</td>
<td>[readonly, optional]</td>
<td>è“ç‰™æœåŠ¡æ•°æ®</td>
</tr>
<tr>
<td>bool ServicesResolved</td>
<td>[readonly]</td>
<td>æœåŠ¡è§£ææ˜¯å¦å®Œæˆ</td>
</tr>
<tr>
<td>array{byte} AdvertisingFlags</td>
<td>[readonly]</td>
<td>è“ç‰™å¹¿æ’­æ•°æ®æ ‡å¿—</td>
</tr>
<tr>
<td>dict AdvertisingData</td>
<td>[readonly]</td>
<td>è“ç‰™å¹¿æ’­æ•°æ®</td>
</tr>
<tr>
<td>array{object, dict} Sets</td>
<td>[readonly, experimental]</td>
<td>è“ç‰™è®¾å¤‡æ‰€å±å¯¹è±¡é›†åˆ</td>
</tr>
</tbody></table>
<h5 id="org-bluez-Agent1"><a href="#org-bluez-Agent1" class="headerlink" title="org.bluez.Agent1"></a>org.bluez.Agent1</h5><p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<p>è¿™ä¸ªç”¨äºç®¡ç†è“ç‰™ä»£ç†ï¼Œå®ç°äº†è“ç‰™è®¤è¯å’ŒæˆæƒåŠŸèƒ½ã€‚åœ¨è¿›è¡Œè“ç‰™é…å¯¹æ—¶ï¼Œä»£ç†ç¨‹åºå°†è¢«è°ƒç”¨æ‰§è¡Œè®¤è¯å’Œæˆæƒæ“ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">:Service:	unique name</span><br><span class="line">:Interface:	org.bluez.Agent1</span><br><span class="line">:Object path:	freely definable</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>void Release()</td>
<td>é‡Šæ”¾ä»»åŠ¡</td>
</tr>
<tr>
<td>string RequestPinCode(object device)</td>
<td>è¯·æ±‚PINç </td>
</tr>
<tr>
<td>void DisplayPinCode(object device, string pincode)</td>
<td>æ˜¾ç¤ºPINç </td>
</tr>
<tr>
<td>uint32 RequestPasskey(object device)</td>
<td>è¯·æ±‚ç§˜é’¥</td>
</tr>
<tr>
<td>void DisplayPasskey(object device, uint32 passkey, uint16 entered)</td>
<td>æ˜¾ç¤ºç§˜é’¥</td>
</tr>
<tr>
<td>void RequestConfirmation(object device, uint32 passkey)</td>
<td>è¯·æ±‚ç¡®è®¤ç§˜é’¥</td>
</tr>
<tr>
<td>void RequestAuthorization(object device)</td>
<td>è¯·æ±‚æˆæƒ</td>
</tr>
<tr>
<td>void AuthorizeService(object device, string uuid)</td>
<td>æˆæƒæœåŠ¡</td>
</tr>
<tr>
<td>void Cancel()</td>
<td>å–æ¶ˆè¯·æ±‚</td>
</tr>
</tbody></table>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<p>æ— å±æ€§</p>
<h4 id="gdbusæ¥å£"><a href="#gdbusæ¥å£" class="headerlink" title="gdbusæ¥å£"></a>gdbusæ¥å£</h4><p>gioåº“æä¾›äº†å¯¹äºdbusæ¥å£çš„é«˜çº§å°è£…ï¼š<a href="https://docs.gtk.org/gio/index.html">gdbus</a>ï¼Œå¸¸ç”¨APIæ€»ç»“ï¼Œæ–¹ä¾¿ç›´æ¥å®šä½æŸ¥å¯»ï¼š</p>
<p><a href="https://docs.gtk.org/gio/func.bus_get_sync.html">g_bus_get_sync()</a></p>
<p>æè¿°ï¼šåŒæ­¥è¿æ¥åˆ°bus_typeæŒ‡å®šçš„æ¶ˆæ¯æ€»çº¿ã€‚è‹¥è¿”å›å€¼ä¸ºNULLï¼Œåˆ™é”™è¯¯å‘ç”Ÿï¼›è‹¥è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨è€…æœ‰è´£ä»»ä½¿ç”¨ <code>g_object_unref()</code> é‡Šæ”¾è¿”å›å€¼ã€‚å½“è°ƒç”¨é”™è¯¯å‘ç”Ÿæ—¶ï¼Œ<code>error != NULL</code>ï¼Œå¯ä»¥é€šè¿‡errorçŸ¥é“é”™è¯¯çš„åŸå› ï¼Œè°ƒç”¨è€…æœ‰è´£ä»»ä½¿ç”¨ <code>g_error_free()</code> é‡Šæ”¾errorã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GDBusConnection*</span><br><span class="line"><span class="title function_">g_bus_get_sync</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GBusType bus_type,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GError** error</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/ctor.MainLoop.new.html">g_main_loop_new()</a></p>
<p>æè¿°ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„GMainLoopç»“æ„ä½“ï¼Œè°ƒç”¨è€…æœ‰è´£ä»»å»é‡Šæ”¾è¿™ä¸ªç»“æ„ä½“ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GMainLoop*</span><br><span class="line"><span class="title function_">g_main_loop_new</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GMainContext* context,</span></span><br><span class="line"><span class="params">  gboolean is_running</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/gobject/method.Object.unref.html">g_object_unref()</a></p>
<p>æè¿°ï¼šå‡å°‘å¯¹è±¡çš„å‚è€ƒè®¡æ•°ã€‚å½“å…¶å‚è€ƒè®¡æ•°é™è‡³0æ—¶ï¼Œå¯¹è±¡å°†æœ€ç»ˆç¡®å®šï¼ˆå³å…¶å†…å­˜å·²é‡Šæ”¾ï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_object_unref</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GObject* object</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://docs.gtk.org/glib/method.MainLoop.run.html">g_main_loop_run()</a></p>
<p>æè¿°ï¼šè¿è¡Œä¸»å¾ªç¯ï¼Œç›´åˆ° g_main_loop_quit() è¢«è°ƒç”¨æ‰ç»“æŸã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_main_loop_run</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GMainLoop* loop</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://docs.gtk.org/gio/type_func.DBusProxy.new.html">g_dbus_proxy_new()</a></p>
<p>æè¿°ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_dbus_proxy_new</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusConnection* connection,</span></span><br><span class="line"><span class="params">  GDBusProxyFlags flags,</span></span><br><span class="line"><span class="params">  GDBusInterfaceInfo* info,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* object_path,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* interface_name,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GAsyncReadyCallback callback,</span></span><br><span class="line"><span class="params">  gpointer user_data</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://docs.gtk.org/gio/method.DBusProxy.call.html">g_dbus_proxy_call()</a></p>
<p>æè¿°ï¼šå¼‚æ­¥è°ƒç”¨ä»£ç†ä¸Šçš„ method_name æ–¹æ³•ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_dbus_proxy_call</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusProxy* proxy,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* method_name,</span></span><br><span class="line"><span class="params">  GVariant* parameters,</span></span><br><span class="line"><span class="params">  GDBusCallFlags flags,</span></span><br><span class="line"><span class="params">  gint timeout_msec,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GAsyncReadyCallback callback,</span></span><br><span class="line"><span class="params">  gpointer user_data</span></span><br><span class="line"><span class="params">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href>g_dbus_proxy_call_sync()</a></p>
<p>æè¿°ï¼šåŒæ­¥è°ƒç”¨<code>method_name</code>ä¸Šçš„æ–¹æ³•<code>proxy</code> ï¼Œè°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°å›å¤ã€‚è‹¥è¿”å›å€¼ä¸ºNULLï¼Œåˆ™é”™è¯¯å‘ç”Ÿï¼›è‹¥è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨è€…æœ‰è´£ä»»ä½¿ç”¨ <code>g_variant_unref()</code> å»é‡Šæ”¾è¿”å›å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line"><span class="title function_">g_dbus_proxy_call_sync</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusProxy* proxy,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* method_name,</span></span><br><span class="line"><span class="params">  GVariant* parameters,</span></span><br><span class="line"><span class="params">  GDBusCallFlags flags,</span></span><br><span class="line"><span class="params">  gint timeout_msec,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GError** error</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://docs.gtk.org/gio/method.DBusConnection.call_sync.html">g_dbus_connection_call_sync()</a></p>
<p>æè¿°ï¼š<strong>åŒæ­¥</strong>è°ƒç”¨bus_name æ‹¥æœ‰çš„object_path è¿œç¨‹å¯¹è±¡ä¸Šinterface_name D-Bus æ¥å£ä¸Šçš„method_name æ–¹æ³•ã€‚å½“è¿”å›å€¼ä¸ºNULLï¼Œåˆ™æœ‰é”™è¯¯å‘ç”Ÿã€‚è‹¥è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨æœ‰è´£ä»»é€šè¿‡ g_variant_unref() å»é‡Šæ”¾å®ƒã€‚è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œçº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°å›å¤ã€‚</p>
<p>è‹¥ <code>error != NULL</code> è¯´æ˜é”™è¯¯å‘ç”Ÿï¼Œè°ƒç”¨è€…æœ‰è´£ä»»å»é‡Šæ”¾errorã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line"><span class="title function_">g_dbus_connection_call_sync</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusConnection* connection,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* bus_name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* object_path,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* interface_name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* method_name,</span></span><br><span class="line"><span class="params">  GVariant* parameters,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> GVariantType* reply_type,</span></span><br><span class="line"><span class="params">  GDBusCallFlags flags,</span></span><br><span class="line"><span class="params">  gint timeout_msec,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GError** error</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/gio/method.DBusConnection.call.html">g_dbus_connection_call()</a></p>
<p>æè¿°ï¼š<strong>å¼‚æ­¥</strong>è°ƒç”¨bus_name æ‹¥æœ‰çš„object_path è¿œç¨‹å¯¹è±¡ä¸Šinterface_name D-Bus æ¥å£ä¸Šçš„method_name æ–¹æ³•ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_dbus_connection_call</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusConnection* connection,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* bus_name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* object_path,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* interface_name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* method_name,</span></span><br><span class="line"><span class="params">  GVariant* parameters,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> GVariantType* reply_type,</span></span><br><span class="line"><span class="params">  GDBusCallFlags flags,</span></span><br><span class="line"><span class="params">  gint timeout_msec,</span></span><br><span class="line"><span class="params">  GCancellable* cancellable,</span></span><br><span class="line"><span class="params">  GAsyncReadyCallback callback,</span></span><br><span class="line"><span class="params">  gpointer user_data</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/gio/method.DBusConnection.call_finish.html">g_dbus_connection_call_finish()</a></p>
<p>æè¿°ï¼šå®Œæˆç”± g_dbus_connection_call() å¯åŠ¨çš„æ“ä½œã€‚è‹¥è¿”å›å€¼ä¸ºNULLï¼Œåˆ™é”™è¯¯å‘ç”Ÿã€‚å½“è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨è€…æœ‰è´£ä»»é€šè¿‡ g_variant_unref() å»é‡Šæ”¾å®ƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line">g_dbus_connection_call_finish (</span><br><span class="line">  GDBusConnection* connection,</span><br><span class="line">  GAsyncResult* res,</span><br><span class="line">  GError** error</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/gio/method.DBusConnection.signal_subscribe.html">g_dbus_connection_signal_subscribe()</a></p>
<p>æè¿°ï¼šåœ¨connectionä¸Šè®¢é˜…ä¿¡å·ï¼Œå½“ä¿¡å·è¢«æ¥æ”¶æ—¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">guint</span><br><span class="line"><span class="title function_">g_dbus_connection_signal_subscribe</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GDBusConnection* connection,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* sender,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* interface_name,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* member,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* object_path,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* arg0,</span></span><br><span class="line"><span class="params">  GDBusSignalFlags flags,</span></span><br><span class="line"><span class="params">  GDBusSignalCallback callback,</span></span><br><span class="line"><span class="params">  gpointer user_data,</span></span><br><span class="line"><span class="params">  GDestroyNotify user_data_free_func</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="https://docs.gtk.org/glib/method.Variant.get.html">g_variant_get()</a></strong></p>
<p>æè¿°ï¼šè§£æ„ä¸€ä¸ª<code>GVariant</code>å®ä¾‹ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼ <code>scanf()</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_variant_get</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* format_string,</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://docs.gtk.org/glib/method.Variant.get_child_value.html">g_variant_get_child_value()</a></p>
<p>æè¿°ï¼šä»å®¹å™¨ GVariant å®ä¾‹ä¸­è¯»å–å­é¡¹ã€‚è¿™åŒ…æ‹¬variantsã€maybesã€arraysã€tupleså’Œdictionary entriesã€‚åœ¨ä»»ä½•å…¶ä»–ç±»å‹çš„ GVariant ä¸Šè°ƒç”¨æ­¤å‡½æ•°éƒ½æ˜¯é”™è¯¯çš„ã€‚è°ƒç”¨è€…æœ‰è´£ä»»ä½¿ç”¨ g_variant_unref() å»é‡Šæ”¾å®ƒï¼ˆè¿”å›å€¼ï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line"><span class="title function_">g_variant_get_child_value</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value,</span></span><br><span class="line"><span class="params">  gsize index_</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="https://docs.gtk.org/glib/method.VariantIter.init.html">g_variant_iter_init()</a></strong></p>
<p>æè¿°ï¼šåˆå§‹åŒ–ï¼ˆä¸ç”³è¯·å†…å­˜ï¼‰ GVariantIter å˜é‡ã€‚è¿”å›å€¼è¡¨ç¤ºé¡¹ç›®æ•°é‡ã€‚</p>
<p> <code>iter</code>åœ¨æ­¤è°ƒç”¨ä¹‹å‰å¯èƒ½å®Œå…¨æœªåˆå§‹åŒ–ï¼›å…¶æ—§å€¼å°†è¢«å¿½ç•¥ã€‚åªè¦è¿­ä»£å™¨<code>value</code>å­˜åœ¨ï¼Œå®ƒå°±ä¼šä¸€ç›´æœ‰æ•ˆï¼Œå¹¶ä¸”ä¸éœ€è¦ä»¥ä»»ä½•æ–¹å¼é‡Šæ”¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gsize</span><br><span class="line"><span class="title function_">g_variant_iter_init</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariantIter* iter,</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><a href="https://docs.gtk.org/glib/method.VariantIter.next.html">g_variant_iter_next()</a></strong></p>
<p>æè¿°ï¼šè·å–å®¹å™¨çš„ä¸‹ä¸€é¡¹ï¼Œå¹¶æ ¹æ®å°†å…¶è§£åŒ…åˆ°å˜é‡å‚æ•°åˆ—è¡¨ä¸­<code>format_string</code>ï¼Œè¿”å›TRUEã€‚è‹¥è¿”å›å€¼ä¸ºFALSEï¼Œåˆ™è¯¥é¡¹æ²¡æœ‰å€¼ã€‚</p>
<p>æ­¤å‡½æ•°çš„å˜é‡å‚æ•°åˆ—è¡¨ä¸­ç»™å‡ºçš„æ‰€æœ‰æŒ‡é’ˆå‡å‡å®šæŒ‡å‘æœªåˆå§‹åŒ–çš„å†…å­˜ã€‚è°ƒç”¨è€…æœ‰è´£ä»»é‡Šæ”¾è§£åŒ…è¿‡ç¨‹è¿”å›çš„æ‰€æœ‰å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gboolean</span><br><span class="line"><span class="title function_">g_variant_iter_next</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariantIter* iter,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* format_string,</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p>å†…å­˜é‡Šæ”¾çš„æ¡ˆä¾‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// Iterates a dictionary of type &#x27;a&#123;sv&#125;&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">iterate_dictionary</span> <span class="params">(GVariant *dictionary)</span></span><br><span class="line">&#123;</span><br><span class="line">	GVariantIter iter;</span><br><span class="line">	GVariant *value;</span><br><span class="line">	gchar *key;</span><br><span class="line"></span><br><span class="line">	g_variant_iter_init (&amp;iter, dictionary);</span><br><span class="line">	<span class="keyword">while</span> (g_variant_iter_next (&amp;iter, <span class="string">&quot;&#123;sv&#125;&quot;</span>, &amp;key, &amp;value))</span><br><span class="line">	&#123;</span><br><span class="line">		g_print (<span class="string">&quot;Item &#x27;%s&#x27; has type &#x27;%s&#x27;\n&quot;</span>, key, </span><br><span class="line">                 g_variant_get_type_string (value));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// must free data for ourselves</span></span><br><span class="line">		g_variant_unref (value);</span><br><span class="line">		g_free (key);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š<code>g_variant_iter_next()</code> å’Œ <code>g_variant_iter_loop()</code> çš„åŒºåˆ«ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯å˜é‡é‡Šæ”¾çš„ä½ç½®ã€‚</p>
<p><strong><a href>g_variant_iter_loop()</a></strong></p>
<p>æè¿°ï¼šè·å–å®¹å™¨ä¸­çš„ä¸‹ä¸€é¡¹ï¼Œå¹¶æ ¹æ®å°†å…¶è§£åŒ…åˆ°å˜é‡å‚æ•°åˆ—è¡¨ä¸­<code>format_string</code>ï¼Œè¿”å› TRUEï¼Œè‹¥å®¹å™¨æ²¡æœ‰ä¸‹ä¸€é¡¹ï¼Œåˆ™è¿”å› FALSEã€‚</p>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå˜é‡å‚æ•°åˆ—è¡¨ä¸­å‡ºç°çš„æŒ‡é’ˆå‡å®šæŒ‡å‘æœªåˆå§‹åŒ–çš„å†…å­˜ã€‚ç¬¬äºŒæ¬¡åŠä»¥åçš„è°ƒç”¨æ—¶ï¼Œå‡å®šå°†ç»™å‡ºç›¸åŒçš„æŒ‡é’ˆï¼Œå¹¶ä¸”å®ƒä»¬å°†æŒ‡å‘ä¸Šæ¬¡è°ƒç”¨æ­¤å‡½æ•°æ—¶è®¾ç½®çš„å†…å­˜ã€‚è¿™æ ·å¯ä»¥é…Œæƒ…é‡Šæ”¾å…ˆå‰çš„å€¼ã€‚</p>
<p>æ­¤å‡½æ•°æ—¨åœ¨ä¸ while å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œæ­¤å‡½æ•°åªèƒ½åœ¨è¿­ä»£æ•°ç»„æ—¶ä½¿ç”¨ã€‚ä»…ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²å¸¸é‡è°ƒç”¨æ­¤å‡½æ•°æ‰æœ‰æ•ˆï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ä¸²å¸¸é‡ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gboolean</span><br><span class="line"><span class="title function_">g_variant_iter_loop</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariantIter* iter,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* format_string,</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p>å†…å­˜é‡Šæ”¾çš„æ¡ˆä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Iterates a dictionary of type &#x27;a&#123;sv&#125;&#x27;</span><br><span class="line">void iterate_dictionary (GVariant *dictionary)</span><br><span class="line">&#123;</span><br><span class="line">	GVariantIter iter;</span><br><span class="line">	GVariant *value;</span><br><span class="line">	gchar *key;</span><br><span class="line"></span><br><span class="line">	g_variant_iter_init (&amp;iter, dictionary);</span><br><span class="line">	while (g_variant_iter_loop (&amp;iter, &quot;&#123;sv&#125;&quot;, &amp;key, &amp;value))</span><br><span class="line">	&#123;</span><br><span class="line">		g_print (&quot;Item &#x27;%s&#x27; has type &#x27;%s&#x27;\n&quot;, key, g_variant_get_type_string (value));</span><br><span class="line"></span><br><span class="line">		// no need to free &#x27;key&#x27; and &#x27;value&#x27; here</span><br><span class="line">		// unless breaking out of this loop</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤§å¤šæ•°æƒ…å†µä¸‹æ‚¨åº”è¯¥ä½¿ç”¨ g_variant_iter_next()ã€‚å¦‚æœæ‚¨åªå¾ªç¯ç®€å•çš„æ•´æ•°å’Œå­—ç¬¦ä¸²ç±»å‹ï¼Œ<code>g_variant_iter_next()</code>åˆ™ç»å¯¹æ˜¯é¦–é€‰ã€‚å¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨â€œ&amp;â€å‰ç¼€å¯ä»¥å®Œå…¨é¿å…åˆ†é…ä»»ä½•å†…å­˜ï¼ˆä»è€Œä¹Ÿé¿å…é‡Šæ”¾ä»»ä½•å†…å®¹ï¼‰ã€‚</p>
<p>æ­¤å‡½æ•°å®é™…ä¸Šä»…åœ¨è§£åŒ…åˆ°<code>GVariant</code>æˆ– æ—¶æœ‰ç”¨ï¼Œ<code>GVariantIter</code>ä»¥ä¾¿å…è®¸æ‚¨è·³è¿‡å¯¹ <code>g_variant_unref()</code>æˆ– <code>g_variant_iter_free()</code> çš„è°ƒç”¨ã€‚</p>
<p><strong><a href="https://docs.gtk.org/glib/ctor.Variant.new.html#:~:text=GVariant%2A%20g_variant_new%20%28const%20gchar%2A%20format_string%2C...%20%5B%20%E2%88%92%5D%20Description,expected%20by%20this%20function%20are%20determined%20by%20format_string.">g_variant_new()</a></strong></p>
<p>æè¿°ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„GVariantå˜é‡å®ä¾‹ï¼Œè‹¥è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨è€…æœ‰è´£ä»»å»é€šè¿‡ <code>g_variant_unref</code> é‡Šæ”¾å®ƒã€‚è¿™ä¸ªå‡½æ•°ä¸€èˆ¬é…åˆwhileå¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œä¸”åªèƒ½åœ¨è¿­ä»£æ•°ç»„æ—¶ä½¿ç”¨ï¼Œä»…ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²å¸¸é‡è°ƒç”¨æ­¤å‡½æ•°æ‰æœ‰æ•ˆï¼Œæ¯æ¬¡éƒ½å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ä¸²å¸¸é‡ã€‚</p>
<p>æ ¼å¼å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯â€œ*â€ã€â€œ?â€ã€â€œ@â€æˆ–â€œrâ€ï¼›æœ¬è´¨ä¸Šï¼Œ<code>GVariant</code>æ­¤å‡½æ•°å¿…é¡»å§‹ç»ˆæ„é€ ä¸€ä¸ªæ–°çš„ï¼ˆè€Œä¸æ˜¯ä¸åŠ ä¿®æ”¹åœ°ä¼ é€’å®ƒï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line"><span class="title function_">g_variant_new</span> <span class="params">(</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* format_string,</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>





<p><a href="https://docs.gtk.org/glib/ctor.Variant.new_object_path.html">g_variant_new_object_path()</a></p>
<p>æè¿°ï¼šåˆ›å»ºä¸€ä¸ªD-Buså¯¹è±¡è·¯å¾„çš„GVariantå˜é‡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GVariant*</span><br><span class="line"><span class="title function_">g_variant_new_object_path</span> <span class="params">(</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* object_path</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>









<p><a href="https://docs.gtk.org/glib/func.strstr_len.html">g_strstr_len()</a></p>
<p>æè¿°ï¼šå…¶ä½œç”¨ç±»ä¼¼ strstr()</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gchar*</span><br><span class="line"><span class="title function_">g_strstr_len</span> <span class="params">(</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* haystack,</span></span><br><span class="line"><span class="params">  gssize haystack_len,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* needle</span></span><br><span class="line"><span class="params">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/func.ascii_strdown.html">g_ascii_strdown()</a></p>
<p>æè¿°ï¼šå…¶ä½œç”¨ç±»ä¼¼ tolower()</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gchar*</span><br><span class="line"><span class="title function_">g_ascii_strdown</span> <span class="params">(</span></span><br><span class="line"><span class="params">  <span class="type">const</span> gchar* str,</span></span><br><span class="line"><span class="params">  gssize len</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.get_string.html">g_variant_get_string()</a></p>
<p>æè¿°ï¼šè¿”å›stringçš„å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> gchar*</span><br><span class="line"><span class="title function_">g_variant_get_string</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value,</span></span><br><span class="line"><span class="params">  gsize* length</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.get_uint32.html">g_variant_get_uint32()</a></p>
<p>æè¿°ï¼šè¿”å›uint32çš„å€¼</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">guint32</span><br><span class="line"><span class="title function_">g_variant_get_uint32</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.get_boolean.html">g_variant_get_boolean()</a></p>
<p>æè¿°ï¼šè¿”å›gbooleançš„å€¼ï¼Œå–å€¼èŒƒå›´ï¼šTRUE or FALSE</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gboolean</span><br><span class="line"><span class="title function_">g_variant_get_boolean</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href>g_variant_get_int16</a></p>
<p>æè¿°ï¼šè¿”å›int16çš„å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gint16</span><br><span class="line"><span class="title function_">g_variant_get_int16</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>





<p><a href="https://docs.gtk.org/glib/method.Variant.get_type_string.html">g_variant_get_type_string()</a></p>
<p>æè¿°ï¼šè·å–valueå€¼çš„ç±»å‹å­—ç¬¦ä¸²</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> gchar*</span><br><span class="line"><span class="title function_">g_variant_get_type_string</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/func.strcmp0.html">g_strcmp0()</a></p>
<p>æè¿°ï¼šå…¶ä½œç”¨ç±»ä¼¼ strcmp()</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int</span><br><span class="line">g_strcmp0 (</span><br><span class="line">  const char* str1,</span><br><span class="line">  const char* str2</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.get_type.html">g_variant_get_type()</a></p>
<p>æè¿°ï¼šç¡®è®¤valueçš„ç±»å‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> GVariantType*</span><br><span class="line"><span class="title function_">g_variant_get_type</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.is_of_type.html">g_variant_is_of_type()</a></p>
<p>æè¿°ï¼šæ£€æŸ¥å€¼çš„ç±»å‹æ˜¯å¦ä¸æä¾›çš„ç±»å‹åŒ¹é…ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gboolean</span><br><span class="line"><span class="title function_">g_variant_is_of_type</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> GVariantType* type</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/func.printf.html">g_printf()</a></p>
<p>æè¿°ï¼šå…¶ä½œç”¨ç±»ä¼¼ printf()ï¼Œglibæä¾›ä¸€å¥—ç±»ä¼¼äº <code>#include &lt;string.h&gt;</code> çš„å‡½æ•°åº“<a href="https://docs.gtk.org/glib/string-utils.html#string-precision-pitfalls">String Utilities</a>ï¼Œä½¿ç”¨è¯¥å‡½æ•°åº“æ˜¯å¿…é¡»æ˜¾ç¤ºçš„å£°æ˜ <code>#include &lt;glib/gprintf.h&gt;</code> ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gint</span><br><span class="line">g_printf (</span><br><span class="line">  const gchar* format,</span><br><span class="line">  ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Variant.print.html">g_variant_print()</a></p>
<p>æè¿°ï¼šå°†GVariantå˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²æ ¼å¼ã€‚è‹¥è¿”å›å€¼ä¸ä¸ºNULLï¼Œè°ƒç”¨è€…æœ‰è´£ä»»é‡Šæ”¾è¿”å›å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gchar*</span><br><span class="line"><span class="title function_">g_variant_print</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GVariant* value,</span></span><br><span class="line"><span class="params">  gboolean type_annotate</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gtk.org/glib/method.Error.free.html">g_error_free()</a></p>
<p>æè¿°ï¼šé‡Šæ”¾GErroræŒ‡å‘çš„å†…å­˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">g_error_free</span> <span class="params">(</span></span><br><span class="line"><span class="params">  GError* error</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>





<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><p>åœ¨Ubuntu 24.04 LTSç³»ç»Ÿä¸Šå¯ä»¥ä¸‹è½½ d-feetå·¥å…·ï¼Œå¯ä»¥UIå½¢å¼æ˜¾ç¤ºåè®®æ–‡æ¡£ä¸­çš„é‚£äº›æ¥å£ï¼Œä»¥ä¾¿å¿«é€Ÿæµ‹è¯•å’Œå®ç°è“ç‰™åŠŸèƒ½ã€‚</p>
<h3 id="bluez"><a href="#bluez" class="headerlink" title="bluez"></a>bluez</h3><p>Linuxç³»ç»Ÿä½¿ç”¨ <a href="https://www.bluez.org/">BlueZ</a> ä½œä¸ºå…¶å®˜æ–¹è“ç‰™å †æ ˆã€‚BlueZæä¾›äº†å¯¹ç»å…¸è“ç‰™å’Œä½åŠŸè€—è“ç‰™çš„æ”¯æŒã€‚ç›®å‰æœ€æ–°çš„bluezç‰ˆæœ¬æ˜¯5.77ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://github.com/bluez/bluez">Github å¼€æºé¡¹ç›® bluez</a>ã€‚</p>
<p>bluezæä¾›ä¸€ä¸ªbluetoothdæœåŠ¡ç¨‹åºå’Œå…¶ä»–çš„å·¥å…·ç¨‹åºã€‚å·¥å…·ç¨‹åºåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>hcitool</strong>ï¼šä¸»è¦æ˜¯æ§åˆ¶è“ç‰™æ¨¡å—çš„åŠ¨ä½œ</li>
<li><strong>hciconfig</strong>ï¼šå¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­çš„è“ç‰™é€‚é…å™¨åŠå…¶çŠ¶æ€</li>
<li>sdptoolï¼šä¸»è¦æ˜¯æŸ¥çœ‹å’Œæ·»åŠ æœåŠ¡</li>
<li>rfcommï¼šä¸»è¦ç”¨äºè¿æ¥å’Œè¯»å†™</li>
<li>agentï¼šä¸»è¦ç”¨äºé…å¯¹</li>
<li>hcidumpï¼šå¯ä»¥æŸ¥çœ‹hostå’Œcontrolerä¹‹é—´hciæ¥å£é€šä¿¡è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨äºè°ƒè¯•</li>
<li>l2pingï¼š</li>
<li>gatttoolï¼šä¸»è¦é’ˆå¯¹BLEè“ç‰™æ¨¡å—çš„å·¥å…·ï¼ˆbulez5åå¼€å§‹ç”¨<strong>bluetoothctl</strong>ä»£æ›¿ï¼‰</li>
</ul>
<h3 id="alsa-utils"><a href="#alsa-utils" class="headerlink" title="alsa-utils"></a>alsa-utils</h3><p><code>alsa-utils</code> æ˜¯ä¸€ç»„ç”¨äºé…ç½®å’Œç®¡ç† Advanced Linux Sound Architecture (ALSA) çš„å®ç”¨ç¨‹åºã€‚ALSA æ˜¯ Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå¤„ç†éŸ³é¢‘è¾“å…¥å’Œè¾“å‡ºã€‚<code>alsa-utils</code> æä¾›äº†ä¸€ç³»åˆ—å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ§åˆ¶å’Œé…ç½® ALSA éŸ³é¢‘è®¾å¤‡ã€‚è¯¥ä½¿ç”¨ç¨‹åºæä¾›å¦‚ä¸‹å·¥å…·é›†ï¼š</p>
<ul>
<li><p>amixerï¼šæ§åˆ¶éŸ³é¢‘æ··åˆå™¨è®¾å¤‡ã€‚å¯ä»¥ç”¨æ¥è°ƒæ•´éŸ³é‡ã€å¼€å…³é™éŸ³ç­‰ã€‚</p>
</li>
<li><p>aplayï¼šç”¨äºæ’­æ”¾ PCM æ•°æ®æˆ– WAV æ–‡ä»¶ã€‚</p>
</li>
<li><p>arecordï¼šç”¨äºå½•åˆ¶ PCM æ•°æ®æˆ– WAV æ–‡ä»¶ã€‚</p>
</li>
<li><p>alsactlï¼šç®¡ç† ALSA æ§åˆ¶å™¨çŠ¶æ€ã€‚å¯ä»¥ç”¨æ¥ä¿å­˜å’Œæ¢å¤æ··éŸ³å™¨è®¾ç½®ã€‚</p>
</li>
<li><p>hdajackretaskï¼šé‡æ–°åˆ†é… HD Audio æ¥å£çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†éº¦å…‹é£æ’å­”é‡æ–°åˆ†é…ä¸ºçº¿è·¯è¾“å…¥ã€‚</p>
</li>
<li><p>alsa-info.shï¼šæ”¶é›†ç³»ç»Ÿä¸Šçš„ ALSA ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡ã€é©±åŠ¨ç¨‹åºç‰ˆæœ¬ç­‰</p>
</li>
<li><p>alsamixerï¼šä¸€ä¸ªåŸºäºæ–‡æœ¬çš„å›¾å½¢ç•Œé¢æ··éŸ³å™¨å·¥å…·ï¼Œæä¾›æ›´ç›´è§‚çš„æ–¹å¼æ¥è°ƒæ•´éŸ³é‡ã€åˆ‡æ¢è¾“å…¥è¾“å‡ºè®¾å¤‡ç­‰ã€‚</p>
</li>
</ul>
<h3 id="bluealsa"><a href="#bluealsa" class="headerlink" title="bluealsa"></a>bluealsa</h3><p><code>bluealsa</code> æ˜¯ä¸€ä¸ªç”¨äºå°† ALSAï¼ˆAdvanced Linux Sound Architectureï¼Œé«˜çº§LinuxéŸ³é¢‘æ¶æ„ï¼‰ä¸ Bluetooth ä½åŠŸè€—ï¼ˆå³ BLEï¼‰éŸ³é¢‘åè®®ç›¸ç»“åˆçš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä½¿å¾— Linux ç³»ç»Ÿèƒ½å¤Ÿé€šè¿‡ BLE è¿æ¥è“ç‰™éŸ³é¢‘è®¾å¤‡ï¼Œå¹¶è®©è“ç‰™éŸ³é¢‘è®¾å¤‡æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚</p>
<h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>æ ¹æ®å‰æ–‡é¢„å®šçš„éœ€æ±‚ï¼Œé€ä¸ªç¼–å†™å¹¶æµ‹è¯•åŠŸèƒ½APIæ¥å£ï¼Œæœ€åå®Œæˆè‡ªå®šä¹‰åº“çš„å°è£…ã€‚</p>
<p>ä½¿ç”¨bluezè¿›è¡Œè“ç‰™è®¾å¤‡è¿æ¥çš„æµç¨‹ï¼š</p>
<p>1ã€è“ç‰™é€‚é…å™¨è®¾ç½®ä¸ºï¼špower on</p>
<p>2ã€è“ç‰™é€‚é…å™¨å¼€å§‹æ‰«æ</p>
<p>â€‹	è®¢é˜… <code>org.freedesktop.DBus.Properties.PropertiesChanged</code> ä¿¡å·ç›‘å¬æ¥å£å±æ€§å˜åŒ–</p>
<p>â€‹	è®¢é˜… <code>org.freedesktop.DBus.ObjectManager.InterfacesAdded</code> ä¿¡å·ç›‘å¬æ¥å£æ–°å¢</p>
<p>â€‹	è®¢é˜… <code>org.freedesktop.DBus.ObjectManager.InterfacesRemoved</code> ä¿¡å·ç›‘å¬æ¥å£ç§»é™¤</p>
<p>â€‹	è°ƒç”¨ <code>org.bluez.Adapter1.StartDiscovery</code> æ–¹æ³•å¼€å§‹æ‰«æé™„è¿‘è“ç‰™è®¾å¤‡</p>
<p>3ã€è“ç‰™é€‚é…å™¨é…å¯¹è“ç‰™è®¾å¤‡</p>
<p>â€‹	åœ¨ <code>InterfacesAdded</code> ä¿¡å·å›è°ƒä¸­ï¼Œæ£€æŸ¥æ˜¯å¦å‡ºç°ç›®æ ‡è“ç‰™è®¾å¤‡</p>
<p>â€‹	å‘ç°ç›®æ ‡è“ç‰™è®¾å¤‡åï¼Œè°ƒç”¨ <code>org.bluez.Adapter1.StopDiscovery</code>ï¼Œè“ç‰™é€‚é…å™¨åœæ­¢æ‰«æ</p>
<p>â€‹	è°ƒç”¨ <code>org.bluez.Device1.Pair</code> æ–¹æ³•è¿›è¡Œé…å¯¹è“ç‰™è®¾å¤‡</p>
<p>â€‹	è°ƒç”¨ <code>org.freedesktop.DBus.ObjectManager.GetManagedObjects</code> æ–¹æ³•è·å–é€‚é…å™¨é…å¯¹çŠ¶æ€ </p>
<p>4ã€è¿æ¥è®¾å¤‡</p>
<p>â€‹	é…å¯¹æˆåŠŸåï¼Œè°ƒç”¨ <code>org.bluez.Device1.Connect</code> æ–¹æ³•è¿æ¥è“ç‰™è®¾å¤‡</p>
<p>â€‹	è°ƒç”¨ <code>org.freedesktop.DBus.ObjectManager.GetManagedObjects</code> æ–¹æ³•è·å–é€‚é…å™¨è¿æ¥çŠ¶æ€ </p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æµ‹è¯•ç›®æ ‡å¹³å°ï¼š</p>
<ul>
<li>x86_64</li>
<li>aarch64</li>
<li>armv7l</li>
</ul>
<p>å¼€å‘å®Œæˆåï¼Œéœ€è¦æµ‹è¯•æ¥å£ç¨³å®šæ€§ï¼ŒåŒ…æ‹¬ï¼šæ‰“å¼€&#x2F;å…³é—­ã€è¿æ¥&#x2F;æ–­å¼€ã€‚</p>
<p><img src="/2024/08/16/2024/bluetoothctl-client-tool/image-20240919110533887.png" alt="image-20240919110533887"></p>
<h3 id="x86-64å¹³å°"><a href="#x86-64å¹³å°" class="headerlink" title="x86_64å¹³å°"></a>x86_64å¹³å°</h3><blockquote>
<p>bluezç‰ˆæœ¬ï¼š5.64</p>
</blockquote>
<p>åœ¨x86_64å¹³å°æµ‹è¯•è¿æ¥è“ç‰™æ¥å£çš„ç¨³å®šæ€§ï¼Œå‘ç°è¿æ¥è“ç‰™è®¾å¤‡åï¼Œä½¿ç”¨ <code>RemoveDevice</code> æ¥å£æ— æ³•ç§»é™¤è“ç‰™è®¾å¤‡ï¼Œä»…ä»…åªæ˜¯æ–­å¼€è“ç‰™è®¾å¤‡è¿æ¥ã€‚</p>
<h3 id="aarch64å¹³å°"><a href="#aarch64å¹³å°" class="headerlink" title="aarch64å¹³å°"></a>aarch64å¹³å°</h3><blockquote>
<p>bluezç‰ˆæœ¬ï¼š5.72</p>
</blockquote>
<p>åœ¨aarch64å¹³å°æµ‹è¯•è¿æ¥è“ç‰™è®¾å¤‡æ¥å£çš„ç¨³å®šæ€§ï¼Œå‡ºç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼š</p>
<p>å½“æ‰«æåˆ°ç›®æ ‡è“ç‰™è®¾å¤‡åï¼Œç«‹å³æ‰§è¡Œè¿æ¥æ“ä½œï¼Œä½†æ˜¯ç›®æ ‡è“ç‰™è®¾å¤‡ç«‹é©¬å°±è¢«åˆ é™¤äº†ï¼Œå¯¼è‡´è¿æ¥æ“ä½œè¶…æ—¶ã€‚</p>
<p><img src="/2024/08/16/2024/bluetoothctl-client-tool/image-20240919111450094.png" alt="image-20240919111450094"></p>
<p><img src="/2024/08/16/2024/bluetoothctl-client-tool/image-20240919111528213.png" alt="image-20240919111528213"></p>
<p>å¾ˆæ˜æ˜¾ï¼Œç›®æ ‡è“ç‰™è®¾å¤‡è¢«bluetoothdè¿‡æ—©ç§»é™¤äº†ã€‚æŸ¥é˜…<a href="https://www.bluez.org/bluez-5-api-introduction-and-porting-guide/">bluezå®˜ç½‘æ–‡æ¡£</a>ï¼Œæœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Once the discovery stops, devices neither connected to or paired will be automatically removed by bluetoothd within three minutes.</p>
<p>ç¿»è¯‘ï¼šä¸€æ—¦æ‰«æåœæ­¢ï¼Œæ²¡æœ‰è¿æ¥æˆ–é…å¯¹çš„è®¾å¤‡å°†åœ¨3åˆ†é’Ÿå†…è¢«bluetoothdè‡ªåŠ¨ç§»é™¤ã€‚</p>
</blockquote>
<h3 id="armv7lå¹³å°"><a href="#armv7lå¹³å°" class="headerlink" title="armv7lå¹³å°"></a>armv7lå¹³å°</h3><blockquote>
<p>bluezç‰ˆæœ¬ï¼š5.77</p>
</blockquote>
<p>åœ¨armv7lå¹³å°æµ‹è¯•è¿æ¥è“ç‰™è®¾å¤‡æ¥å£çš„ç¨³å®šæ€§ï¼š</p>
<ul>
<li><p>ç›®æ ‡è“ç‰™è®¾å¤‡ï¼šJBL ROCKï¼Œæµ‹è¯•æ¬¡æ•°100æ¬¡ï¼ŒæˆåŠŸ99æ¬¡ï¼Œå¤±è´¥1æ¬¡ã€‚å¤±è´¥åŸå› ï¼šè¿æ¥è“ç‰™è®¾å¤‡æ—¶ï¼Œè“ç‰™è®¾å¤‡è¢«è¿‡æ—©ç§»é™¤ã€‚</p>
</li>
<li><p>ç›®æ ‡è“ç‰™è®¾å¤‡ï¼šå°çˆ±è§¦å±éŸ³ç®±ï¼Œæµ‹è¯•æ¬¡æ•°100æ¬¡ï¼ŒæˆåŠŸ93æ¬¡ï¼Œå¤±è´¥7æ¬¡ã€‚å¤±è´¥åŸå› ï¼šè¿æ¥è“ç‰™è®¾å¤‡æ—¶ï¼Œè“ç‰™è®¾å¤‡è¢«è¿‡æ—©ç§»é™¤ï¼Œä¹‹åå°½ç®¡è¢«å‘ç°ï¼Œè¿˜æ˜¯ä¼šå¯¼è‡´è¿æ¥è¶…æ—¶ã€‚</p>
</li>
<li><p>ç›®æ ‡è“ç‰™è®¾å¤‡ï¼šMi Speakerï¼Œæµ‹è¯•å†Œæ•°100æ¬¡ï¼ŒæˆåŠŸ93æ¬¡ï¼Œå¤±è´¥7æ¬¡ã€‚å¤±è´¥åŸå› ï¼šè¿æ¥è“ç‰™è®¾å¤‡æ—¶ï¼Œè“ç‰™è®¾å¤‡è¢«è¿‡æ—©ç§»é™¤ã€‚</p>
</li>
</ul>
<p>å…³äºâ€œæ‰«æåˆ°ç›®æ ‡è“ç‰™è®¾å¤‡åï¼Œæ‰§è¡Œè¿æ¥æ“ä½œï¼Œä½†æ˜¯è“ç‰™è®¾å¤‡ç«‹å³è¢«ç§»é™¤ï¼Œå¯¼è‡´è¿æ¥è¶…æ—¶â€ è¿™ä¸ªé—®é¢˜ï¼Œæˆ–è®¸éœ€è¦æŸ¥çœ‹bluezé¡¹ç›®ä¸­çš„bluetoothdæºç ï¼Œç ”ç©¶æ‰«æåˆ°çš„è“ç‰™è®¾å¤‡è¢«bluetoothdè‡ªåŠ¨ç§»é™¤çš„æ¡ä»¶ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/bluez/bluez">1ã€bluez on github</a></p>
<p><a href="https://www.bluez.org/">2ã€bluez with Official Linux Bluetooth protocol stack</a></p>
<p><a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/org.bluez.Adapter.rst">3ã€org.bluez.Adapter.rst</a></p>
<p><a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/org.bluez.Device.rst">4ã€org.bluez.Device.rst</a></p>
<p><a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/org.bluez.Agent.rst">5ã€org.bluez.Agent.rst</a></p>
<p><a href="https://dbus.freedesktop.org/doc/dbus-specification.html">6ã€D-Bus Specification</a></p>
<p><a href="https://github.com/nkim-bitzap/bluetooth/blob/master/connector/connector.c">7ã€github.com&#x2F;nkim-bitzap&#x2F;bluetooth</a></p>
<p><a href="https://blog.linumiz.com/archives/229">8ã€linumizè“ç‰™ç³»åˆ—åšå®¢</a></p>
<p><a href="https://www.bluetooth.com/specifications/assigned-numbers/">9ã€Bluetooth Office Document: Assigned Numbers Document (PDF)</a></p>
<p><a href="https://www.cnblogs.com/chenbin7/archive/2012/10/16/2726510.html">10ã€Linuxä¸‹Bluezçš„ç¼–ç¨‹å®ç°</a></p>
]]></content>
      <categories>
        <category>bluetooth</category>
      </categories>
      <tags>
        <tag>bluez</tag>
        <tag>bluetooth</tag>
        <tag>raspberry 4b</tag>
        <tag>dbus</tag>
        <tag>gdbus</tag>
      </tags>
  </entry>
  <entry>
    <title>esp-matterï¼šlight project</title>
    <url>/2024/08/15/2024/esp-matter-light-project/</url>
    <content><![CDATA[<h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>æ‹·è´ <code>~/esp/esp-matter/examples</code> åˆ°æŒ‡å®šç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/esp/example-matter</span><br><span class="line"><span class="built_in">cp</span> -r ~/esp/esp-matter/examples/* ~/esp/example-matter</span><br><span class="line"><span class="built_in">cd</span> ~/esp/example-matter/light</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®ç›®æ ‡"><a href="#è®¾ç½®ç›®æ ‡" class="headerlink" title="è®¾ç½®ç›®æ ‡"></a>è®¾ç½®ç›®æ ‡</h3><p>å¼€å‘æ¿Socæ˜¯esp32-c3ï¼Œæ•…è®¾ç½®ç›®æ ‡é€‰æ‹©ï¼šesp32c3</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»esp-idfå’Œesp-matterç¯å¢ƒ</span></span><br><span class="line">get_idf</span><br><span class="line">get_matter</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç›®æ ‡</span></span><br><span class="line">idf.py set-target esp32c3</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘å›ºä»¶"><a href="#ç¼–è¯‘å›ºä»¶" class="headerlink" title="ç¼–è¯‘å›ºä»¶"></a>ç¼–è¯‘å›ºä»¶</h3><p>ç›´æ¥å¼€å§‹ç¼–è¯‘å›ºä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">idf.py build</span><br></pre></td></tr></table></figure>

<h3 id="çƒ§å½•å›ºä»¶"><a href="#çƒ§å½•å›ºä»¶" class="headerlink" title="çƒ§å½•å›ºä»¶"></a>çƒ§å½•å›ºä»¶</h3><p>å°†å¼€å‘æ¿æ’å…¥PCçš„USBæ¥å£ï¼Œä¿®æ”¹ä¸²å£æƒé™ï¼Œå¼€å§‹çƒ§å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾ä¸²å£æƒé™</span></span><br><span class="line"><span class="built_in">ls</span> -l /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸²å£æƒé™</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 664 /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line"><span class="comment"># çƒ§å½•å›ºä»¶</span></span><br><span class="line">idf.py -p /dev/ttyUSB0 flash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥æƒ³å®Œå…¨é‡æ–°ç¼–è¯‘ï¼Œéœ€è¦å…ˆåˆ é™¤buildç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">idf.py fullclean</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šä¸åŒå¼€å‘æ¿çš„æ¥å…¥PCåï¼Œä¸²å£åç§°å¯èƒ½ä¸åŒï¼Œç›®å‰å·²çŸ¥çš„ä¸¤ç§åç§°ï¼š<code>/dev/ttyUSB0</code> å’Œ <code>/dev/ttyACM0</code></em></p>
<p><em>ä¹é‘«esp32c3å¼€å‘æ¿ä¸²å£åç§°ï¼š&#x2F;dev&#x2F;ttyUSB0</em></p>
<p><em>åˆå®™esp32c3å¼€å‘æ¿ä¸²å£åç§°ï¼š&#x2F;dev&#x2F;ttyACM0</em></p>
<h2 id="é…ç½‘"><a href="#é…ç½‘" class="headerlink" title="é…ç½‘"></a>é…ç½‘</h2><p>é€šè¿‡BLEæ–¹å¼ç»™è®¾å¤‡é…ç½‘ï¼šæŒ‡é€šè¿‡ä½åŠŸè€—è“ç‰™ï¼ˆå³BLEï¼‰å°†SSIDå’Œå¯†ç å‘é€ç»™WiFiè®¾å¤‡ï¼Œç„¶åWiFiè¿æ¥åˆ°æŒ‡å®šçš„WiFiç½‘ç»œã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯é…ç½‘ï¼Ÿ</p>
</blockquote>
<p>é…ç½‘æŒ‡çš„æ˜¯å¤–éƒ¨å‘ WiFi è®¾å¤‡æä¾› SSIDå’Œå¯†ç ï¼Œä»¥ä¾¿ WiFi è®¾å¤‡å¯ä»¥è¿æ¥æŒ‡å®šçš„APå¹¶åŠ å…¥APæ‰€å»ºç«‹çš„ WiFi ç½‘ç»œã€‚é…ç½‘çš„æ ¸å¿ƒé—®é¢˜æ˜¯é€šè¿‡å„ç§æ–¹æ³•ï¼ˆSoftAPé…ç½‘ã€ä¸€é”®é…ç½‘ã€è“ç‰™é…ç½‘ã€å…¶ä»–æ–¹å¼é…ç½‘ï¼‰ï¼Œå°†WiFiçš„ SSIDå’Œå¯†ç å‘é€åˆ°éœ€è¦è”ç½‘çš„WiFiè®¾å¤‡ï¼Œç„¶åç”±WiFiè®¾å¤‡å»è¿æ¥æŒ‡å®šçš„WiFiç½‘ç»œï¼Œè¾¾åˆ°æ¥å…¥å±€åŸŸç½‘æˆ–äº’è”ç½‘çš„ç›®çš„ã€‚</p>
<h3 id="chip-toolå‘½ä»¤é…ç½‘"><a href="#chip-toolå‘½ä»¤é…ç½‘" class="headerlink" title="chip-toolå‘½ä»¤é…ç½‘"></a>chip-toolå‘½ä»¤é…ç½‘</h3><p>å¯åŠ¨Terminal Aç”¨äºmonitorä¸²å£æ•°æ®ï¼Œå¯åŠ¨Terminal Bç”¨äºæ‰§è¡Œchip-toolå‘½ä»¤ã€‚å…¶ä¸­chip-toolå·¥å…·æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼šå•æ¬¡æ‰§è¡Œ å’Œ äº¤äº’æ‰§è¡Œã€‚äº¤äº’æ‰§è¡Œæ§åˆ¶è®¾å¤‡æ—¶ï¼Œå“åº”é€Ÿåº¦éå¸¸å¿«ï¼Œå¹¶ä¸”ä¸å®¹æ˜“äº§ç”Ÿè¶…æ—¶æŠ¥é”™ã€‚å•æ¬¡æ‰§è¡ŒæŸæ¡æŒ‡ä»¤éœ€è¦å†ä¸€å®šæ—¶é—´å‘¨æœŸå†…å®Œæˆï¼Œå¦åˆ™chip-toolå°†ä¼šæŠ¥é”™ï¼šTimeoutã€‚</p>
<p><strong>å•æ¬¡æ‰§è¡Œï¼š</strong></p>
<p>å•æ¬¡æ‰§è¡Œé…ç½‘å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡ç‰ˆ</span></span><br><span class="line">chip-tool pairing ble-wifi &lt;node_id&gt; &lt;ssid&gt; &lt;password&gt; &lt;pin_code&gt; &lt;discriminator&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">chip-tool pairing ble-wifi 0x7283 CUBEC_AP_2.4G cubec2015 20202021 3840</span><br></pre></td></tr></table></figure>

<p><em>å‘½ä»¤è§£é‡Šï¼š</em></p>
<ul>
<li><p><code>0x7283</code> æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªéšæœºçš„ <code>node_id</code></p>
</li>
<li><p><code>CUBEC_AP_2.4G</code> ã€<code>cubec2015</code>ï¼šåˆ†åˆ«æ˜¯wifiçš„ <code>ssid</code> å’Œ <code>password</code></p>
</li>
<li><p><code>20202021</code> æ˜¯ <code>pin_code</code></p>
</li>
<li><p><code>3840</code> æ˜¯ <code>discriminator</code></p>
</li>
</ul>
<p><em>å•æ¬¡æ‰§è¡Œå®¹æ˜“å¯¼è‡´è¶…æ—¶ï¼Œå»ºè®®ä½¿ç”¨äº¤äº’æ‰§è¡Œï¼ï¼ï¼</em></p>
<p><strong>äº¤äº’æ‰§è¡Œï¼ˆå»ºè®®ï¼‰ï¼š</strong></p>
<p><strong>Terminal A</strong>å¤„äºç­‰å¾…é…ç½‘çŠ¶æ€ï¼ŒçŠ¶æ€å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">I (1725) esp_matter_core: Dynamic endpoint 1 added</span><br><span class="line">I (1735) chip[DL]: WIFI_EVENT_STA_START</span><br><span class="line">W (1735) wifi:Haven<span class="string">&#x27;t to connect to a suitable AP now!</span></span><br><span class="line"><span class="string">I (1745) chip[DL]: Done driving station state, nothing else to do...</span></span><br><span class="line"><span class="string">I (1745) chip[DL]: Configuring CHIPoBLE advertising (interval 25 ms, connectable)</span></span><br><span class="line"><span class="string">I (1755) NimBLE: GAP procedure initiated: advertise; </span></span><br><span class="line"><span class="string">I (1765) NimBLE: disc_mode=2</span></span><br><span class="line"><span class="string">I (1765) NimBLE:  adv_channel_map=0 own_addr_type=1 adv_filter_policy=0 adv_itvl_min=40 adv_itvl_max=40</span></span><br><span class="line"><span class="string">I (1775) NimBLE: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I (1775) chip[DL]: CHIPoBLE advertising started</span></span><br><span class="line"><span class="string">I (1785) app_main: Commissioning window opened</span></span><br><span class="line"><span class="string">I (1855) main_task: Returned from app_main()</span></span><br><span class="line"><span class="string">&gt; I (4725) esp_matter_core: Store the deferred attribute 0x0 of cluster 0x8 on endpoint 0x1</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šè‹¥æƒ³å°†è®¾å¤‡æ¸…é™¤æ‰€æœ‰çš„é…ç½‘ä¿¡æ¯ï¼Œå¯ä»¥å°†è®¾å¤‡æ¢å¤å‡ºå‚çŠ¶æ€ï¼Œåœ¨ Terminal A æ‰§è¡Œå‘½ä»¤ï¼š<code>matter device factoryreset</code></em></p>
<p><strong>Terminal B</strong>ä¸­æ‰§è¡Œå‘½ä»¤ï¼š<code>chip-tool interactive start</code></p>
<p>æ­¤æ—¶è¿›å…¥äº¤äº’æ¨¡å¼ï¼ŒçŠ¶æ€å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">  +-------------------------------------------------------------------------------------+</span><br><span class="line">  | Command sets:                                                                       |</span><br><span class="line">  +-------------------------------------------------------------------------------------+</span><br><span class="line">  | * any                                                                               |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> sending IM messages based on cluster <span class="built_in">id</span>, not cluster name.         |</span><br><span class="line">  | * delay                                                                             |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> waiting <span class="keyword">for</span> something to happen.                                   |</span><br><span class="line">  | * discover                                                                          |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> device discovery.                                                  |</span><br><span class="line">  | * groupsettings                                                                     |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> manipulating group keys and memberships <span class="keyword">for</span> chip-tool itself.      |</span><br><span class="line">  | * icd                                                                               |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> client-side ICD management.                                        |</span><br><span class="line">  | * pairing                                                                           |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> commissioning devices.                                             |</span><br><span class="line">  | * payload                                                                           |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> parsing and generating setup payloads.                             |</span><br><span class="line">  | * sessionmanagement                                                                 |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> managing CASE and PASE session state.                              |</span><br><span class="line">  | * subscriptions                                                                     |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> shutting down subscriptions.                                       |</span><br><span class="line">  | * interactive                                                                       |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> starting long-lived interactive modes.                             |</span><br><span class="line">  | * storage                                                                           |</span><br><span class="line">  |   - Commands <span class="keyword">for</span> managing persistent data stored by chip-tool.                      |</span><br><span class="line">  +-------------------------------------------------------------------------------------+</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨äº¤äº’æ¨¡å¼å†…æ‰§è¡Œå‘½ä»¤ä¸ºè®¾å¤‡é…ç½‘ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pairing ble-wifi 0x7283 CUBEC_AP_2.4G cubec2015 20202021 3840</span><br></pre></td></tr></table></figure>



<p>è‹¥è®¾å¤‡é…ç½‘æˆåŠŸï¼Œåœ¨Terminal Aä¼šå‡ºç°è®¾å¤‡è®¾å¤‡å·²è·å–IPåœ°å€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">I (323035) wifi:&lt;ba-add&gt;idx:1 (ifx:0, <span class="built_in">fc</span>:83:c6:00:8f:ae), tid:6, ssn:1, winSize:64</span><br><span class="line">I (323075) chip[DL]: Confirm received <span class="keyword">for</span> CHIPoBLE TX characteristic indication (con 1) status= 14 </span><br><span class="line">I (323845) esp_netif_handlers: sta ip: 192.168.5.201, mask: 255.255.255.0, gw: 192.168.5.1</span><br><span class="line">I (323845) chip[DL]: IP_EVENT_STA_GOT_IP</span><br><span class="line">I (323855) chip[DL]: IPv4 address changed on WiFi station interface: 192.168.5.201/255.255.255.0 gateway 192.168.5.1</span><br><span class="line">I (323865) chip[DL]: IPv4 Internet connectivity ESTABLISHED</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="æ‰«ç é…ç½‘"><a href="#æ‰«ç é…ç½‘" class="headerlink" title="æ‰«ç é…ç½‘"></a>æ‰«ç é…ç½‘</h2><h2 id="æ§åˆ¶"><a href="#æ§åˆ¶" class="headerlink" title="æ§åˆ¶"></a>æ§åˆ¶</h2><blockquote>
<p>chip-toolæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>chip-toolæ˜¯ç”¨äºå¼€å‘å’Œè°ƒè¯•Matterè®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<p>è®¾å¤‡é…ç½‘æˆåŠŸåï¼Œæ¥ç€å¯ä»¥åœ¨Terminal Bé€šè¿‡chip-tooläº¤äº’æ¨¡å¼å†…æ§åˆ¶è®¾å¤‡ï¼Œä¾‹å¦‚ï¼šæ‰“å¼€LEDã€å…³é—­LEDã€åè½¬LEDã€è°ƒèŠ‚äº®åº¦ã€è°ƒèŠ‚é¢œè‰²</p>
<p><strong>å•æ¬¡æ‰§è¡Œï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€LED</span></span><br><span class="line">chip-tool onoff on 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­LED</span></span><br><span class="line">chip-tool onoff off 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åè½¬LED</span></span><br><span class="line">chip-tool onoff toggle 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒèŠ‚äº®åº¦</span></span><br><span class="line"><span class="comment">## è®¾ç½®äº®åº¦ä¸º10%ï¼ˆå®é™…ä½äº30%å,LEDå°±ç†„ç­äº†ï¼‰</span></span><br><span class="line">chip-tool levelcontrol move-to-level 10 0 0 0 0x7283 0x1</span><br><span class="line"><span class="comment">## è®¾ç½®äº®åº¦ä¸º100%</span></span><br><span class="line">chip-tool levelcontrol move-to-level 100 0 0 0 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒèŠ‚é¢œè‰²</span></span><br><span class="line"><span class="comment">## è®¾ç½®æš–è‰²è°ƒè‰²æ¸©</span></span><br><span class="line">chip-tool colorcontrol move-to-color-temperature 500 0 0 0 0x7283 0x1</span><br><span class="line"><span class="comment">## è®¾ç½®å†·è‰²è°ƒè‰²æ¸©</span></span><br><span class="line">chip-tool colorcontrol move-to-color-temperature 154 0 0 0 0x7283 0x1</span><br></pre></td></tr></table></figure>

<p><strong>äº¤äº’æ‰§è¡Œï¼ˆå»ºè®®ï¼‰ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€LED</span></span><br><span class="line">onoff on 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­LED</span></span><br><span class="line">onoff off 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åè½¬LED</span></span><br><span class="line">onoff toggle 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒèŠ‚äº®åº¦</span></span><br><span class="line"><span class="comment">## è®¾ç½®äº®åº¦ä¸º10%ï¼ˆå®é™…ä½äº30%å,LEDå°±ç†„ç­äº†ï¼‰</span></span><br><span class="line">levelcontrol move-to-level 10 0 0 0 0x7283 0x1</span><br><span class="line"><span class="comment">## è®¾ç½®äº®åº¦ä¸º100%</span></span><br><span class="line">levelcontrol move-to-level 100 0 0 0 0x7283 0x1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒèŠ‚é¢œè‰²</span></span><br><span class="line"><span class="comment">## è®¾ç½®æš–è‰²è°ƒè‰²æ¸©</span></span><br><span class="line">colorcontrol move-to-color-temperature 500 0 0 0 0x7283 0x1</span><br><span class="line"><span class="comment">## è®¾ç½®å†·è‰²è°ƒè‰²æ¸©</span></span><br><span class="line">colorcontrol move-to-color-temperature 154 0 0 0 0x7283 0x1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>å‘½ä»¤è§£é‡Šï¼š</em></p>
<p><em>1ã€onoffï¼šè¡¨ç¤ºOnOff Cluster</em></p>
<p><em>2ã€onã€offã€toggleï¼šåˆ†åˆ«è¡¨ç¤ºOnã€Offã€Toggleå‘½ä»¤</em></p>
<p><em>3ã€0x7283ï¼šè¡¨ç¤ºNode IDï¼Œè¿™æ˜¯ä¹‹å‰åœ¨é…ç½‘æ—¶å®šä¹‰çš„å€¼</em></p>
<p><em>4ã€0x01ï¼šè¡¨ç¤ºEndpoint 1ï¼Œè¿™æ˜¯Light Projecté¡¹ç›®ä»£ç ä¸­æ–°å»ºçš„ä¸€ä¸ªEndpointã€‚</em></p>
<p><em>5ã€levelcontrolã€colorcontorlï¼šåˆ†åˆ«è¡¨ç¤º LevelControl Cluster å’Œ ColorControl Cluster</em></p>
<p><em>6ã€move-to-level ã€move-to-color-temperatureï¼šåˆ†åˆ«è¡¨ç¤ºå¯¹åº”Clusterä¸‹çš„å‘½ä»¤</em></p>
<p><strong>chip-toolå‘½ä»¤æ‰©å±•ï¼š</strong></p>
<p>ä»Matterè®¾å¤‡è¯»å–ï¼ˆreadï¼‰ä¿¡æ¯ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; onoff <span class="built_in">read</span> on-off 0x7283 0x01</span><br><span class="line">[1726799530.981378][352215:352215] CHIP:TOO: Command: onoff <span class="built_in">read</span> on-off 0x7283 0x01 </span><br><span class="line">[1726799530.981581][352215:352217] CHIP:TOO: Sending <span class="built_in">command</span> to node 0x7283</span><br><span class="line">[1726799530.981826][352215:352217] CHIP:CSM: FindOrEstablishSession: PeerId = [1:0000000000007283]</span><br><span class="line">[1726799530.981836][352215:352217] CHIP:CSM: FindOrEstablishSession: No existing OperationalSessionSetup instance found</span><br><span class="line">[1726799530.981852][352215:352217] CHIP:DIS: Found an existing secure session to [1:0000000000007283]!</span><br><span class="line">[1726799530.981860][352215:352217] CHIP:DIS: OperationalSessionSetup[1:0000000000007283]: State change 1 --&gt; 5</span><br><span class="line">[1726799530.981875][352215:352217] CHIP:TOO: Sending ReadAttribute to:</span><br><span class="line">[1726799530.982385][352215:352217] CHIP:TOO: 	cluster 0x0000_0006, attribute: 0x0000_0000, endpoint 1</span><br><span class="line">[1726799530.982404][352215:352217] CHIP:DMG: SendReadRequest ReadClient[0x72cc4000a6c0]: Sending Read Request</span><br><span class="line">[1726799530.982496][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18684i S:41998 M:177312788] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0001:02 (IM:ReadRequest)</span><br><span class="line">[1726799530.982607][352215:352217] CHIP:DMG: MoveToState ReadClient[0x72cc4000a6c0]: Moving to [AwaitingIn]</span><br><span class="line">[1726799531.173092][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:18684i S:41998 M:189153990 (Ack:177312788)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0001:05 (IM:ReportData)</span><br><span class="line">[1726799531.173129][352215:352217] CHIP:EM: Found matching exchange: 18684i, Delegate: 0x72cc4000a6d0</span><br><span class="line">[1726799531.173146][352215:352217] CHIP:EM: Rxd Ack; Removing MessageCounter:177312788 from Retrans Table on exchange 18684i</span><br><span class="line">[1726799531.173182][352215:352217] CHIP:DMG: ReportDataMessage =</span><br><span class="line">[1726799531.173193][352215:352217] CHIP:DMG: &#123;</span><br><span class="line">[1726799531.173206][352215:352217] CHIP:DMG: 	AttributeReportIBs =</span><br><span class="line">[1726799531.173221][352215:352217] CHIP:DMG: 	[</span><br><span class="line">[1726799531.173232][352215:352217] CHIP:DMG: 		AttributeReportIB =</span><br><span class="line">[1726799531.173250][352215:352217] CHIP:DMG: 		&#123;</span><br><span class="line">[1726799531.173261][352215:352217] CHIP:DMG: 			AttributeDataIB =</span><br><span class="line">[1726799531.173278][352215:352217] CHIP:DMG: 			&#123;</span><br><span class="line">[1726799531.173291][352215:352217] CHIP:DMG: 				DataVersion = 0xe0b02f82,</span><br><span class="line">[1726799531.173307][352215:352217] CHIP:DMG: 				AttributePathIB =</span><br><span class="line">[1726799531.173321][352215:352217] CHIP:DMG: 				&#123;</span><br><span class="line">[1726799531.173334][352215:352217] CHIP:DMG: 					Endpoint = 0x1,</span><br><span class="line">[1726799531.173348][352215:352217] CHIP:DMG: 					Cluster = 0x6,</span><br><span class="line">[1726799531.173363][352215:352217] CHIP:DMG: 					Attribute = 0x0000_0000,</span><br><span class="line">[1726799531.173376][352215:352217] CHIP:DMG: 				&#125;</span><br><span class="line">[1726799531.173395][352215:352217] CHIP:DMG: 					</span><br><span class="line">[1726799531.173409][352215:352217] CHIP:DMG: 				Data = <span class="literal">false</span>, </span><br><span class="line">[1726799531.173422][352215:352217] CHIP:DMG: 			&#125;,</span><br><span class="line">[1726799531.173436][352215:352217] CHIP:DMG: 			</span><br><span class="line">[1726799531.173446][352215:352217] CHIP:DMG: 		&#125;,</span><br><span class="line">[1726799531.173461][352215:352217] CHIP:DMG: 		</span><br><span class="line">[1726799531.173470][352215:352217] CHIP:DMG: 	],</span><br><span class="line">[1726799531.173484][352215:352217] CHIP:DMG: 	</span><br><span class="line">[1726799531.173495][352215:352217] CHIP:DMG: 	SuppressResponse = <span class="literal">true</span>, </span><br><span class="line">[1726799531.173506][352215:352217] CHIP:DMG: 	InteractionModelRevision = 11</span><br><span class="line">[1726799531.173515][352215:352217] CHIP:DMG: &#125;</span><br><span class="line">[1726799531.175422][352215:352217] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_0000 DataVersion: 3769642882</span><br><span class="line">[1726799531.175440][352215:352217] CHIP:TOO:   OnOff: FALSE</span><br><span class="line">[1726799531.175518][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18684i S:41998 M:177312789 (Ack:189153990)] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0000:10 (SecureChannel:StandaloneAck)</span><br><span class="line">[1726799531.175575][352215:352217] CHIP:EM: Flushed pending ack <span class="keyword">for</span> MessageCounter:189153990 on exchange 18684i</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»Matterè®¾å¤‡è®¢é˜…ï¼ˆsubscribeï¼‰ä¿¡æ¯ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; onoff subscribe on-off 5 30  0x7283 0x1</span><br><span class="line">[1726799808.099530][352215:352215] CHIP:TOO: Command: onoff subscribe on-off 5 30 0x7283 0x1 </span><br><span class="line">[1726799808.099753][352215:352217] CHIP:TOO: Sending <span class="built_in">command</span> to node 0x7283</span><br><span class="line">[1726799808.100002][352215:352217] CHIP:CSM: FindOrEstablishSession: PeerId = [1:0000000000007283]</span><br><span class="line">[1726799808.100011][352215:352217] CHIP:CSM: FindOrEstablishSession: No existing OperationalSessionSetup instance found</span><br><span class="line">[1726799808.100026][352215:352217] CHIP:DIS: Found an existing secure session to [1:0000000000007283]!</span><br><span class="line">[1726799808.100035][352215:352217] CHIP:DIS: OperationalSessionSetup[1:0000000000007283]: State change 1 --&gt; 5</span><br><span class="line">[1726799808.100051][352215:352217] CHIP:TOO: Sending SubscribeAttribute to:</span><br><span class="line">[1726799808.100063][352215:352217] CHIP:TOO: 	cluster 0x0000_0006, attribute: 0x0000_0000, endpoint 1</span><br><span class="line">[1726799808.100169][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18685i S:41998 M:177312790] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0001:03 (IM:SubscribeRequest)</span><br><span class="line">[1726799808.100270][352215:352217] CHIP:DMG: MoveToState ReadClient[0x72cc4000a6c0]: Moving to [AwaitingIn]</span><br><span class="line">[1726799808.273067][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:18685i S:41998 M:189153991 (Ack:177312790)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0001:05 (IM:ReportData)</span><br><span class="line">[1726799808.273108][352215:352217] CHIP:EM: Found matching exchange: 18685i, Delegate: 0x72cc4000a6d0</span><br><span class="line">[1726799808.273135][352215:352217] CHIP:EM: Rxd Ack; Removing MessageCounter:177312790 from Retrans Table on exchange 18685i</span><br><span class="line">[1726799808.273179][352215:352217] CHIP:DMG: ReportDataMessage =</span><br><span class="line">[1726799808.273192][352215:352217] CHIP:DMG: &#123;</span><br><span class="line">[1726799808.273204][352215:352217] CHIP:DMG: 	SubscriptionId = 0xef8890e9,</span><br><span class="line">[1726799808.273218][352215:352217] CHIP:DMG: 	AttributeReportIBs =</span><br><span class="line">[1726799808.273237][352215:352217] CHIP:DMG: 	[</span><br><span class="line">[1726799808.273248][352215:352217] CHIP:DMG: 		AttributeReportIB =</span><br><span class="line">[1726799808.273267][352215:352217] CHIP:DMG: 		&#123;</span><br><span class="line">[1726799808.273279][352215:352217] CHIP:DMG: 			AttributeDataIB =</span><br><span class="line">[1726799808.273295][352215:352217] CHIP:DMG: 			&#123;</span><br><span class="line">[1726799808.273313][352215:352217] CHIP:DMG: 				DataVersion = 0xe0b02f82,</span><br><span class="line">[1726799808.273332][352215:352217] CHIP:DMG: 				AttributePathIB =</span><br><span class="line">[1726799808.273351][352215:352217] CHIP:DMG: 				&#123;</span><br><span class="line">[1726799808.273369][352215:352217] CHIP:DMG: 					Endpoint = 0x1,</span><br><span class="line">[1726799808.273389][352215:352217] CHIP:DMG: 					Cluster = 0x6,</span><br><span class="line">[1726799808.273409][352215:352217] CHIP:DMG: 					Attribute = 0x0000_0000,</span><br><span class="line">[1726799808.273424][352215:352217] CHIP:DMG: 				&#125;</span><br><span class="line">[1726799808.273440][352215:352217] CHIP:DMG: 					</span><br><span class="line">[1726799808.273469][352215:352217] CHIP:DMG: 				Data = <span class="literal">false</span>, </span><br><span class="line">[1726799808.273481][352215:352217] CHIP:DMG: 			&#125;,</span><br><span class="line">[1726799808.273497][352215:352217] CHIP:DMG: 			</span><br><span class="line">[1726799808.273508][352215:352217] CHIP:DMG: 		&#125;,</span><br><span class="line">[1726799808.273523][352215:352217] CHIP:DMG: 		</span><br><span class="line">[1726799808.273533][352215:352217] CHIP:DMG: 	],</span><br><span class="line">[1726799808.273549][352215:352217] CHIP:DMG: 	</span><br><span class="line">[1726799808.273559][352215:352217] CHIP:DMG: 	InteractionModelRevision = 11</span><br><span class="line">[1726799808.273569][352215:352217] CHIP:DMG: &#125;</span><br><span class="line">[1726799808.273644][352215:352217] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_0000 DataVersion: 3769642882</span><br><span class="line">[1726799808.273682][352215:352217] CHIP:TOO:   OnOff: FALSE</span><br><span class="line">[1726799808.273711][352215:352217] CHIP:DMG: MoveToState ReadClient[0x72cc4000a6c0]: Moving to [AwaitingSu]</span><br><span class="line">[1726799808.273944][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18685i S:41998 M:177312791 (Ack:189153991)] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0001:01 (IM:StatusResponse)</span><br><span class="line">[1726799808.624854][352215:352217] CHIP:EM: Retransmitting MessageCounter:177312791 on exchange 18685i Send Cnt 1</span><br><span class="line">[1726799808.654348][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:18685i S:41998 M:189153992 (Ack:177312791)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0001:04 (IM:SubscribeResponse)</span><br><span class="line">[1726799808.654383][352215:352217] CHIP:EM: Found matching exchange: 18685i, Delegate: 0x72cc4000a6d0</span><br><span class="line">[1726799808.654408][352215:352217] CHIP:EM: Rxd Ack; Removing MessageCounter:177312791 from Retrans Table on exchange 18685i</span><br><span class="line">[1726799808.654433][352215:352217] CHIP:DMG: SubscribeResponse is received</span><br><span class="line">[1726799808.654462][352215:352217] CHIP:DMG: SubscribeResponseMessage =</span><br><span class="line">[1726799808.654475][352215:352217] CHIP:DMG: &#123;</span><br><span class="line">[1726799808.654487][352215:352217] CHIP:DMG: 	SubscriptionId = 0xef8890e9,</span><br><span class="line">[1726799808.654501][352215:352217] CHIP:DMG: 	MaxInterval = 0x1e,</span><br><span class="line">[1726799808.654514][352215:352217] CHIP:DMG: 	InteractionModelRevision = 11</span><br><span class="line">[1726799808.654526][352215:352217] CHIP:DMG: &#125;</span><br><span class="line">[1726799808.654544][352215:352217] CHIP:DMG: Subscription established with SubscriptionID = 0xef8890e9 MinInterval = 5s MaxInterval = 30s Peer = 01:0000000000007283</span><br><span class="line">[1726799808.654562][352215:352217] CHIP:DMG: MoveToState ReadClient[0x72cc4000a6c0]: Moving to [Subscripti]</span><br><span class="line">[1726799808.654597][352215:352217] CHIP:DMG: Refresh LivenessCheckTime <span class="keyword">for</span> 34224 milliseconds with SubscriptionId = 0xef8890e9 Peer = 01:0000000000007283</span><br><span class="line">[1726799808.654708][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18685i S:41998 M:177312792 (Ack:189153992)] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0000:10 (SecureChannel:StandaloneAck)</span><br><span class="line">[1726799808.654836][352215:352217] CHIP:EM: Flushed pending ack <span class="keyword">for</span> MessageCounter:189153992 on exchange 18685i</span><br><span class="line">[1726799809.093742][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:18685i S:41998 M:189153993 (Ack:177312791)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0000:10 (SecureChannel:StandaloneAck)</span><br><span class="line">[1726799809.093839][352215:352217] CHIP:IN: Received a duplicate message with MessageCounter:189153992 on exchange 18685i</span><br><span class="line">[1726799809.093855][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:18685i S:41998 M:189153992 (Ack:177312791)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0001:04 (IM:SubscribeResponse)</span><br><span class="line">[1726799809.093875][352215:352217] CHIP:EM: Generating StandaloneAck via exchange: 18685i</span><br><span class="line">[1726799809.093885][352215:352217] CHIP:EM: Forcing tx of solitary ack <span class="keyword">for</span> duplicate MessageCounter:189153992 on exchange 18685i</span><br><span class="line">[1726799809.093964][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:18685i S:41998 M:177312793 (Ack:189153992)] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0000:10 (SecureChannel:StandaloneAck)</span><br><span class="line">[1726799814.284411][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:64465r S:41998 M:189153994] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0001:05 (IM:ReportData)</span><br><span class="line">[1726799814.284442][352215:352217] CHIP:EM: Handling via exchange: 64465r, Delegate: 0x59c53aff2ea8</span><br><span class="line">[1726799814.284474][352215:352217] CHIP:DMG: ReportDataMessage =</span><br><span class="line">[1726799814.284491][352215:352217] CHIP:DMG: &#123;</span><br><span class="line">[1726799814.284498][352215:352217] CHIP:DMG: 	SubscriptionId = 0xef8890e9,</span><br><span class="line">[1726799814.284502][352215:352217] CHIP:DMG: 	AttributeReportIBs =</span><br><span class="line">[1726799814.284509][352215:352217] CHIP:DMG: 	[</span><br><span class="line">[1726799814.284513][352215:352217] CHIP:DMG: 		AttributeReportIB =</span><br><span class="line">[1726799814.284519][352215:352217] CHIP:DMG: 		&#123;</span><br><span class="line">[1726799814.284523][352215:352217] CHIP:DMG: 			AttributeDataIB =</span><br><span class="line">[1726799814.284528][352215:352217] CHIP:DMG: 			&#123;</span><br><span class="line">[1726799814.284533][352215:352217] CHIP:DMG: 				DataVersion = 0xe0b02f83,</span><br><span class="line">[1726799814.284538][352215:352217] CHIP:DMG: 				AttributePathIB =</span><br><span class="line">[1726799814.284544][352215:352217] CHIP:DMG: 				&#123;</span><br><span class="line">[1726799814.284549][352215:352217] CHIP:DMG: 					Endpoint = 0x1,</span><br><span class="line">[1726799814.284555][352215:352217] CHIP:DMG: 					Cluster = 0x6,</span><br><span class="line">[1726799814.284561][352215:352217] CHIP:DMG: 					Attribute = 0x0000_0000,</span><br><span class="line">[1726799814.284567][352215:352217] CHIP:DMG: 				&#125;</span><br><span class="line">[1726799814.284573][352215:352217] CHIP:DMG: 					</span><br><span class="line">[1726799814.284583][352215:352217] CHIP:DMG: 				Data = <span class="literal">true</span>, </span><br><span class="line">[1726799814.284589][352215:352217] CHIP:DMG: 			&#125;,</span><br><span class="line">[1726799814.284595][352215:352217] CHIP:DMG: 			</span><br><span class="line">[1726799814.284598][352215:352217] CHIP:DMG: 		&#125;,</span><br><span class="line">[1726799814.284603][352215:352217] CHIP:DMG: 		</span><br><span class="line">[1726799814.284607][352215:352217] CHIP:DMG: 	],</span><br><span class="line">[1726799814.284612][352215:352217] CHIP:DMG: 	</span><br><span class="line">[1726799814.284616][352215:352217] CHIP:DMG: 	InteractionModelRevision = 11</span><br><span class="line">[1726799814.284620][352215:352217] CHIP:DMG: &#125;</span><br><span class="line">[1726799814.284686][352215:352217] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_0000 DataVersion: 3769642883</span><br><span class="line">[1726799814.284712][352215:352217] CHIP:TOO:   OnOff: TRUE</span><br><span class="line">[1726799814.284738][352215:352217] CHIP:DMG: Refresh LivenessCheckTime <span class="keyword">for</span> 34224 milliseconds with SubscriptionId = 0xef8890e9 Peer = 01:0000000000007283</span><br><span class="line">[1726799814.284998][352215:352217] CHIP:EM: &lt;&lt;&lt; [E:64465r S:41998 M:177312794 (Ack:189153994)] (S) Msg TX to 1:0000000000007283 [428F] [UDP:[fe80::f29e:9eff:fe99:1260%wlp1s0]:5540] --- Type 0001:01 (IM:StatusResponse)</span><br><span class="line">[1726799814.371141][352215:352217] CHIP:EM: &gt;&gt;&gt; [E:64465r S:41998 M:189153995 (Ack:177312794)] (S) Msg RX from 1:0000000000007283 [428F] --- Type 0000:10 (SecureChannel:StandaloneAck)</span><br><span class="line">[1726799814.371163][352215:352217] CHIP:EM: Found matching exchange: 64465r, Delegate: (nil)</span><br><span class="line">[1726799814.371177][352215:352217] CHIP:EM: Rxd Ack; Removing MessageCounter:177312794 from Retrans Table on exchange 64465r</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="è§£è¯»"><a href="#è§£è¯»" class="headerlink" title="è§£è¯»"></a>è§£è¯»</h2><p>light projectç¤ºä¾‹æ¼”ç¤ºäº†Extended Color Lightè®¾å¤‡çš„å¼€å‘ã€‚ä»¥ä¸‹å°±æ˜¯å¯¹ä»£ç çš„ç†è§£ï¼š</p>
<ul>
<li><p>åˆ›å»ºä¸€ä¸ªMatterèŠ‚ç‚¹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªMatterèŠ‚ç‚¹å’Œå¢åŠ endpoint 0</span></span><br><span class="line">node::<span class="type">config_t</span> node_config;</span><br><span class="line"></span><br><span class="line"><span class="type">node_t</span> *node = node::<span class="built_in">create</span>(&amp;node_config, app_attribute_update_cb, app_identification_cb);</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºEndpoint</p>
<p>åœ¨æœ¬å®ä¾‹ä¸­åˆ›å»º extended_color_light è®¾å¤‡ç±»å‹çš„Endpointã€‚æ‰€æœ‰çš„Endpointå®šä¹‰éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š<code>esp/esp-matter/components/esp_matter/esp_matter_endpoint.h</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨MatterèŠ‚ç‚¹ä¸‹å¢åŠ Endpointï¼Œé»˜è®¤ä»1å¼€å§‹</span></span><br><span class="line">extended_color_light::<span class="type">config_t</span> light_config;</span><br><span class="line">light_config.on_off.on_off = DEFAULT_POWER;</span><br><span class="line">light_config.on_off.lighting.start_up_on_off = <span class="literal">nullptr</span>;</span><br><span class="line">light_config.level_control.current_level = DEFAULT_BRIGHTNESS;</span><br><span class="line">light_config.level_control.on_level = DEFAULT_BRIGHTNESS;</span><br><span class="line">light_config.level_control.lighting.start_up_current_level = DEFAULT_BRIGHTNESS;</span><br><span class="line">light_config.color_control.color_mode = (<span class="type">uint8_t</span>)ColorControl::ColorMode::kColorTemperature;</span><br><span class="line">light_config.color_control.enhanced_color_mode = (<span class="type">uint8_t</span>)ColorControl::ColorMode::kColorTemperature;</span><br><span class="line">light_config.color_control.color_temperature.startup_color_temperature_mireds = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">endpoint_t</span> *endpoint = extended_color_light::<span class="built_in">create</span>(node, &amp;light_config, ENDPOINT_FLAG_NONE, light_handle);</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¿«é€Ÿå˜åŒ–çš„å±æ€§æ ‡è®°å»¶è¿ŸæŒä¹…æ€§</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡Endpoint 1è·å–å…¶Level Controlé›†ç¾¤ï¼Œç„¶åé€šè¿‡å¯¹åº”çš„é›†ç¾¤è·å–Attributeå€¼ï¼Œæœ€åæ ‡è®°å±æ€§çš„å»¶è¿ŸæŒä¹…æ€§</span></span><br><span class="line"><span class="type">cluster_t</span> *level_control_cluster = cluster::<span class="built_in">get</span>(endpoint, LevelControl::Id);</span><br><span class="line"><span class="type">attribute_t</span> *current_level_attribute = attribute::<span class="built_in">get</span>(level_control_cluster, LevelControl::Attributes::CurrentLevel::Id);</span><br><span class="line">attribute::<span class="built_in">set_deferred_persistence</span>(current_level_attribute);</span><br><span class="line"></span><br><span class="line"><span class="type">cluster_t</span> *color_control_cluster = cluster::<span class="built_in">get</span>(endpoint, ColorControl::Id);</span><br><span class="line"><span class="type">attribute_t</span> *current_x_attribute = attribute::<span class="built_in">get</span>(color_control_cluster, ColorControl::Attributes::CurrentX::Id);</span><br><span class="line">attribute::<span class="built_in">set_deferred_persistence</span>(current_x_attribute);</span><br><span class="line"></span><br><span class="line"><span class="type">attribute_t</span> *current_y_attribute = attribute::<span class="built_in">get</span>(color_control_cluster, ColorControl::Attributes::CurrentY::Id);</span><br><span class="line">attribute::<span class="built_in">set_deferred_persistence</span>(current_y_attribute);</span><br><span class="line"></span><br><span class="line"><span class="type">attribute_t</span> *color_temp_attribute = attribute::<span class="built_in">get</span>(color_control_cluster,ColorControl::Attributes::ColorTemperatureMireds::Id);</span><br><span class="line">attribute::<span class="built_in">set_deferred_persistence</span>(color_temp_attribute);</span><br></pre></td></tr></table></figure>
</li>
<li><p>å±æ€§å›è°ƒ</p>
<p>æ¯å½“ç”¨æˆ·é€šè¿‡Matterå®¢æˆ·ç«¯å¯¹Matterè®¾å¤‡ï¼ˆä½œä¸ºMatter Serverï¼‰è¿›è¡Œæ§åˆ¶æ—¶ï¼Œå…¶æ§åˆ¶å€¼æœ€ç»ˆéƒ½ä¼šæ›´æ–°è®¾å¤‡æ•°æ®æ¨¡å‹ä¸­çš„å±æ€§å€¼ã€‚</p>
<p>å½“å±æ€§æ›´æ–°æ—¶ï¼Œå›è°ƒå‡½æ•° <code>app_attribute_update_cb()</code> ç”¨æˆ·é€šçŸ¥åº”ç”¨ç¨‹åºï¼ˆMatterè®¾å¤‡ï¼‰å±æ€§æœ‰æ›´æ”¹ã€‚è‹¥å›è°ƒå‡½æ•°ç±»å‹ä¸º <code>PRE_UPDATE</code> ï¼Œåˆ™æ›´æ–°Matterè®¾å¤‡é©±åŠ¨ç¨‹åºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title">app_attribute_update_cb</span><span class="params">(attribute::<span class="type">callback_type_t</span> type,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="type">uint16_t</span> endpoint_id, </span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="type">uint32_t</span> cluster_id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="type">uint32_t</span> attribute_id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="type">esp_matter_attr_val_t</span> *val,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="type">void</span> *priv_data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">esp_err_t</span> err = ESP_OK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type == PRE_UPDATE) &#123;</span><br><span class="line">        <span class="comment">/* Driver update */</span></span><br><span class="line">        <span class="type">app_driver_handle_t</span> driver_handle = (<span class="type">app_driver_handle_t</span>)priv_data;</span><br><span class="line">        err = <span class="built_in">app_driver_attribute_update</span>(driver_handle, endpoint_id, cluster_id, attribute_id, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾å¤‡é©±åŠ¨</p>
<p>é¦–å…ˆåˆ¤æ–­æ”¹å˜çš„æ˜¯å¦ä¸ºç›®æ ‡è®¾å¤‡ï¼šlight_endpoint_idï¼Œç„¶åæ ¹æ®é›†ç¾¤ä¸‹çš„å±æ€§æ›´æ–°çŠ¶æ€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Attribute(å±æ€§) Update</span></span><br><span class="line"><span class="function"><span class="type">esp_err_t</span> <span class="title">app_driver_attribute_update</span><span class="params">(<span class="type">app_driver_handle_t</span> driver_handle,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">uint16_t</span> endpoint_id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">uint32_t</span> cluster_id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">uint32_t</span> attribute_id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">esp_matter_attr_val_t</span> *val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">esp_err_t</span> err = ESP_OK;</span><br><span class="line">    <span class="comment">// EndpointåŒ¹é…</span></span><br><span class="line">    <span class="keyword">if</span> (endpoint_id == light_endpoint_id)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">led_indicator_handle_t</span> handle = (<span class="type">led_indicator_handle_t</span>)driver_handle;</span><br><span class="line">        <span class="comment">// ClusteråŒ¹é…</span></span><br><span class="line">        <span class="keyword">if</span> (cluster_id == OnOff::Id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// AttributeåŒ¹é…</span></span><br><span class="line">            <span class="keyword">if</span> (attribute_id == OnOff::Attributes::OnOff::Id)</span><br><span class="line">            &#123;</span><br><span class="line">                err = <span class="built_in">app_driver_light_set_power</span>(handle, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cluster_id == LevelControl::Id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (attribute_id == LevelControl::Attributes::CurrentLevel::Id)</span><br><span class="line">            &#123;</span><br><span class="line">                err = <span class="built_in">app_driver_light_set_brightness</span>(handle, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cluster_id == ColorControl::Id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (attribute_id == ColorControl::Attributes::CurrentHue::Id)</span><br><span class="line">            &#123;</span><br><span class="line">                err = <span class="built_in">app_driver_light_set_hue</span>(handle, val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (attribute_id == ColorControl::Attributes::CurrentSaturation::Id)</span><br><span class="line">            &#123;</span><br><span class="line">                err = <span class="built_in">app_driver_light_set_saturation</span>(handle, val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (attribute_id == ColorControl::Attributes::ColorTemperatureMireds::Id)</span><br><span class="line">            &#123;</span><br><span class="line">                err = <span class="built_in">app_driver_light_set_temperature</span>(handle, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.espressif.com/projects/esp-matter/en/latest/esp32c3/developing.html">1ã€Developing with the SDK of ESP-MATTER</a></p>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>esp-matter</tag>
      </tags>
  </entry>
  <entry>
    <title>Matterï¼šLighting Device Types</title>
    <url>/2024/08/13/2024/Matter-Lighting-Device-Types/</url>
    <content><![CDATA[<h2 id="LightåŸºç¡€"><a href="#LightåŸºç¡€" class="headerlink" title="LightåŸºç¡€"></a>LightåŸºç¡€</h2><p>è‰²è°ƒã€é¥±å’Œåº¦å’Œäº®åº¦ï¼ˆhue, saturation, and brightnessï¼‰ä»¥äººå¯¹çº¢ã€ç»¿ã€è“ï¼ˆRGBï¼‰ä¸‰è‰²ç»„åˆçš„æ„Ÿè§‰ä¸ºåŸºç¡€ã€‚</p>
<ul>
<li>è‰²è°ƒï¼ˆhueï¼‰æ˜¯åœ¨å¯è§å…‰å…‰è°±ä¸­èƒ½é‡æœ€å¼ºæ—¶çš„æ³¢é•¿</li>
<li>é¥±å’Œåº¦ï¼ˆsaturationï¼‰è¡¨ç¤ºå¯è§å…‰çš„ç›¸å¯¹å¸¦å®½</li>
<li>äº®åº¦ï¼ˆbrightnessï¼‰è¡¨ç¤ºå¯è§å…‰çš„èƒ½é‡å¼ºåº¦</li>
</ul>
<p>Lightingæ‰€æœ‰è®¾å¤‡ç±»å‹ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
</tr>
</thead>
<tbody><tr>
<td>0x0100</td>
<td>On&#x2F;Off Light</td>
</tr>
<tr>
<td>0x0101</td>
<td>Dimmable Light</td>
</tr>
<tr>
<td>0x010c</td>
<td>Color Temperature Light</td>
</tr>
<tr>
<td>0x010d</td>
<td>Extended Color Light</td>
</tr>
</tbody></table>
<h2 id="On-Off-Light"><a href="#On-Off-Light" class="headerlink" title="On&#x2F;Off Light"></a>On&#x2F;Off Light</h2><p>On&#x2F;Off Light æ˜¯ä¸€ç§ç…§æ˜è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡ç»‘å®šæ§åˆ¶å™¨è®¾å¤‡ï¼ˆä¾‹å¦‚ï¼šæ™®é€šå¼€å…³æˆ–è€…è°ƒå…‰å¼€å…³ï¼‰å¯¹å…¶è¿›è¡Œæ‰“å¼€å’Œå…³é—­ï¼Œè€Œä¸”ï¼Œä¹Ÿå¯é€šè¿‡ç»‘å®šäººä½“å­˜åœ¨ä¼ æ„Ÿå™¨æ¥åˆ‡æ¢ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0100</td>
<td>On&#x2F;Off Light</td>
<td></td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Group</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p>å¯¹äº On&#x2F;Off Light è®¾å¤‡çš„çŠ¶æ€åªæœ‰ï¼šon å’Œ off ä¸¤ç§çŠ¶æ€ï¼Œä½†æ ‡å‡†è¿˜æ˜¯åŠ ä¸Šäº†Level Control Clusterï¼Œä»…ä»…æ˜¯æ–¹ä¾¿å’Œå…¶ä»– Dimmable Lightå½¢æˆç»„åˆæ—¶ï¼Œèƒ½å¤Ÿæ¥å— On&#x2F;Off å‘½ä»¤ã€‚</p>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLevel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Dimmable-Light"><a href="#Dimmable-Light" class="headerlink" title="Dimmable Light"></a>Dimmable Light</h2><p>å¯è°ƒå…‰ç¯æ˜¯ä¸€ç§èƒ½å¤Ÿæ‰“å¼€æˆ–å…³é—­çš„ç…§æ˜è®¾å¤‡ï¼Œå…¶å…‰çº¿å¼ºåº¦å¯é€šè¿‡ç»‘å®šæ§åˆ¶å™¨è®¾å¤‡ï¼ˆä¾‹å¦‚è°ƒå…‰å¼€å…³æˆ–é¢œè‰²è°ƒå…‰å¼€å…³ï¼‰è¿›è¡Œè°ƒèŠ‚ã€‚æ­¤å¤–ï¼Œå¯è°ƒå…‰ç¯è®¾å¤‡è¿˜èƒ½å¤Ÿé€šè¿‡ç»‘å®šå ç”¨ä¼ æ„Ÿå™¨æˆ–å…¶ä»–è®¾å¤‡è¿›è¡Œåˆ‡æ¢ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x0101</td>
<td>Dimmable Light</td>
<td>On&#x2F;Off Light</td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identity</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLevel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Color-Temperature-Light"><a href="#Color-Temperature-Light" class="headerlink" title="Color Temperature Light"></a>Color Temperature Light</h2><p>è‰²æ¸©ç¯æ˜¯ä¸€ç§ç…§æ˜è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡ç»‘å®šçš„æ§åˆ¶å™¨è®¾å¤‡ï¼ˆä¾‹å¦‚è°ƒå…‰å¼€å…³ï¼‰æ‰“å¼€æˆ–å…³é—­ã€è°ƒèŠ‚å…‰çº¿å¼ºåº¦å’Œè°ƒèŠ‚è‰²æ¸©ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x010c</td>
<td>Color Temperature Light</td>
<td>Dimmable Light</td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identity</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLevel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>ColorTemperature</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Attribute</td>
<td>RemainingTime</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
<h2 id="Extended-Color-Light"><a href="#Extended-Color-Light" class="headerlink" title="Extended Color Light"></a>Extended Color Light</h2><p>æ‰©å±•è‰²å…‰ç¯æ˜¯ä¸€ç§ç…§æ˜è®¾å¤‡ï¼Œå¯é€šè¿‡ç»‘å®šæ§åˆ¶å™¨è®¾å¤‡ï¼ˆå¦‚è°ƒå…‰å¼€å…³æˆ–æ§åˆ¶æ¡¥ï¼‰æ‰“å¼€æˆ–å…³é—­ã€è°ƒæ•´å…‰å¼ºåº¦å’Œè°ƒæ•´é¢œè‰²ã€‚è¯¥è®¾å¤‡æ”¯æŒé€šè¿‡è‰²è°ƒ&#x2F;é¥±å’Œåº¦ã€å¢å¼ºè‰²è°ƒã€é¢œè‰²å¾ªç¯ã€XY åæ ‡å’Œè‰²æ¸©è°ƒæ•´é¢œè‰²ã€‚æ­¤å¤–ï¼Œæ‰©å±•è‰²å…‰ç¯è¿˜å¯é€šè¿‡ç»‘å®šå ç”¨ä¼ æ„Ÿå™¨è¿›è¡Œåˆ‡æ¢ã€‚</p>
<p><strong>åˆ†ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Device Name</th>
<th>Superset</th>
<th>Class</th>
<th>Scope</th>
</tr>
</thead>
<tbody><tr>
<td>0x010d</td>
<td>Extended Color Light</td>
<td>Color Temperature Light</td>
<td>Simple</td>
<td>Endpoint</td>
</tr>
</tbody></table>
<p><strong>é›†ç¾¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Client&#x2F;Server</th>
<th>Quality</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identify</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0004</td>
<td>Groups</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Server</td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Server</td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0406</td>
<td>Occupancy Sensing</td>
<td>Client</td>
<td></td>
<td>O</td>
</tr>
</tbody></table>
<p>æ‰©å±•è‰²å…‰ç­‰é›†ç¾¤æ•°æ®å’Œè‰²æ¸©ç¯çš„é›†ç¾¤å®Œæˆç›¸åŒã€‚</p>
<p><strong>å…ƒç´ ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Cluster</th>
<th>Element</th>
<th>Name</th>
<th>Constraint</th>
<th>Access</th>
<th>Conformance</th>
</tr>
</thead>
<tbody><tr>
<td>0x0003</td>
<td>Identity</td>
<td>Command</td>
<td>TriggerEffect</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0062</td>
<td>Scenes Management</td>
<td>Command</td>
<td>CopyScene</td>
<td></td>
<td></td>
<td>P,M</td>
</tr>
<tr>
<td>0x0006</td>
<td>On&#x2F;Off</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>Lighting</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Feature</td>
<td>OnOff</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>CurrentLevel</td>
<td>1 to 254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MinLevel</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0008</td>
<td>Level Control</td>
<td>Attribute</td>
<td>MaxLevel</td>
<td>254</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>ColorTemperature</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Attribute</td>
<td>RemainingTime</td>
<td></td>
<td></td>
<td>M</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>HueSaturation</td>
<td></td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>EnhancedHue</td>
<td></td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>ColorLoop</td>
<td></td>
<td></td>
<td>O</td>
</tr>
<tr>
<td>0x0300</td>
<td>Color Control</td>
<td>Feature</td>
<td>XY</td>
<td></td>
<td></td>
<td>M</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>Light of Matter Device</tag>
        <tag>matter-1-3-device-library-specification</tag>
      </tags>
  </entry>
  <entry>
    <title>Matter Standard</title>
    <url>/2024/08/13/2024/Matter-Standard/</url>
    <content><![CDATA[<h2 id="Matterä»‹ç»"><a href="#Matterä»‹ç»" class="headerlink" title="Matterä»‹ç»"></a>Matterä»‹ç»</h2><p>å¸‚åœºä¸Šå¯¹äºIoTé¢†åŸŸç”Ÿæ€æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šè‹¹æœç”Ÿæ€ï¼ˆHomekitï¼‰ã€è°·æ­Œç”Ÿæ€ï¼ˆWeaveï¼‰ã€äºšé©¬é€Šç”Ÿæ€ï¼ˆEchoï¼‰ã€ä¸‰æ˜Ÿç”Ÿæ€ã€å°ç±³ç”Ÿæ€ã€‚è®¾å¤‡å‚å•†é’ˆå¯¹æŸä¸€ä¸ªç”Ÿæ€ç”Ÿäº§çš„è®¾å¤‡ä»…æ”¯æŒè¿™ä¸ªç”Ÿæ€ï¼ˆè‹¹æœç”Ÿæ€ï¼‰ï¼Œä¸èƒ½æ”¯æŒå…¶ä»–ç”Ÿæ€ï¼ˆè°·æ­Œç”Ÿæ€ã€ä¸‰æ˜Ÿç”Ÿæ€ï¼‰ï¼Œå½¢æˆäº†ç”Ÿæ€å£å’ã€‚</p>
<p><strong>ç”¨æˆ·ï¼š</strong></p>
<p>å¦‚æœç”¨æˆ·ä½¿ç”¨è‹¹æœæ‰‹æœºï¼Œé‚£ä¹ˆç”¨æˆ·åªèƒ½è´­ä¹°æ”¯æŒè‹¹æœç”Ÿæ€çš„IoTè®¾å¤‡ã€‚ä¸€æ—¦ç”¨æˆ·ä¸åœ¨ä½¿ç”¨è‹¹æœæ‰‹æœºï¼Œè€Œä½¿ç”¨è°·æ­Œæ‰‹æœºï¼Œé‚£ä¹ˆæ”¯æŒè‹¹æœç”Ÿæ€çš„IoTè®¾å¤‡å°±æˆäº†ä¸€å †åºŸå“ã€‚ç°åœ¨ç”¨æˆ·æƒ³ä½¿ç”¨IoTè®¾å¤‡ï¼Œé‚£ä¹ˆå¿…é¡»å†è´­ä¹°æ”¯æŒè°·æ­Œç”Ÿæ€çš„IoTè®¾å¤‡ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¿™åˆæ˜¯ä¸€ç¬”ä¸å°çš„å¼€é”€ã€‚</p>
<p><strong>å‚å•†ï¼š</strong></p>
<p>å¦‚æœå‚å•†ç”Ÿäº§äº†æ”¯æŒè‹¹æœç”Ÿæ€çš„IoTè®¾å¤‡ï¼Œé‚£ä¹ˆå®ƒçš„ç›®æ ‡ç”¨æˆ·æ˜¯æŒæœ‰è‹¹æœæ‰‹æœºçš„ç”¨æˆ·ã€‚å¯¹äºåŒä¸€æ¬¾äº§å“ï¼ˆä¾‹å¦‚ï¼šè‰²æ¸©ç¯ï¼‰ï¼Œå‚å•†ä¸ºäº†è·å–æ›´å¤šçš„ç”¨æˆ·ï¼Œå°±å¿…é¡»å¼€å‘æ”¯æŒå„ç§ç”Ÿæ€çš„äº§å“ï¼ˆä¾‹å¦‚ï¼šè‹¹æœç”Ÿæ€è‰²æ¸©ç¯ã€è°·æ­Œç”Ÿæ€è‰²æ¸©ç¯â€¦ï¼‰ã€‚å¯¹äºå‚å•†æ¥è¯´ï¼Œäº§å“è¿˜æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è½¯ä»¶å±‚é¢çš„ä¸åŒï¼Œä¸å¾—ä¸ç”Ÿäº§æ”¯æŒä¸åŒç”Ÿæ€çš„åŒä¸€æ¬¾äº§å“ï¼Œç”Ÿäº§æˆæœ¬åˆæ˜¯ä¸€ä¸ªçš„é—®é¢˜ã€‚</p>
<p><strong>Matterï¼š</strong></p>
<p>å¦‚æœå‚å•†ç”Ÿäº§çš„IoTäº§å“æ”¯æŒMatteræ ‡å‡†ï¼Œé‚£ä¹ˆå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¸ç®¡ä½ ä½¿ç”¨çš„æ˜¯è‹¹æœæ‰‹æœºï¼Œè¿˜æ˜¯è°·æ­Œæ‰‹æœºï¼Œä½ éƒ½å¯ä»¥å°†IoTäº§å“æ·»åŠ åˆ°ä½ å½“å‰çš„ç”Ÿæ€ä¸­ã€‚å¯¹äºç”¨æˆ·ï¼Œè´­ä¹°çš„IoTäº§å“é€‚é…å„ç§ç”Ÿæ€ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæ¢æ‰‹æœºä¼šå¯¼è‡´IoTäº§å“æ— æ³•ä½¿ç”¨çš„é—®é¢˜ã€‚å¯¹äºå‚å•†ï¼Œä¸ç”¨å†æŠ•å…¥å¾ˆå¤§çš„æˆæœ¬å»ç”Ÿäº§æ”¯æŒå„ç§ç”Ÿæ€çš„IoTè®¾å¤‡ï¼Œä»…éœ€è¦ç”Ÿäº§æ”¯æŒMatteræ ‡å‡†çš„IoTäº§å“ã€‚</p>
<p>ç”šè‡³ï¼ŒIoTäº§å“æ·»åŠ åˆ°è‹¹æœç”Ÿæ€åï¼Œä½ è¿˜å¯ä»¥å°†è¯¥äº§å“åˆ†äº«ç»™å…¶ä»–ç”Ÿæ€ï¼ˆè°·æ­Œç”Ÿæ€ã€äºšé©¬é€Šç”Ÿæ€ã€ä¸‰æ˜Ÿç”Ÿæ€â€¦ï¼‰ä½¿ç”¨ï¼Œå®Œå…¨æ‰“ç ´äº†ç”Ÿæ€å£å’ã€‚</p>
<p>Matteræ˜¯ç”±CSAå‘å¸ƒçš„ä¸€ä¸ªåº”ç”¨å±‚æ ‡å‡†ï¼Œå®ƒçš„ä¼ è¾“æ˜¯å»ºç«‹åœ¨æ”¯æŒIPv6çš„TCPå’ŒUDPåè®®ä¸Šçš„ï¼ŒMatterä¸å¯¹ä¼ è¾“å±‚è¿›è¡Œçº¦å®šï¼ŒMatterä¹Ÿä¸å¯¹ç½‘ç»œè¿›è¡Œçº¦å®šï¼Œä½†æ˜¯Matterçº¦å®šäº†åªèƒ½ä½¿ç”¨ <em>Thread&#x2F;Wi-Fi&#x2F;Ethernet</em> ä¸‰ç§è¿æ¥åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´Matterå¯ä»¥è®©ä¸åŒç½‘ç»œä¸­çš„è®¾å¤‡è¿›è¡Œäº’è”äº’é€šé€šä¿¡ï¼Œè¿™ä¸ªä¸»è¦æ˜¯æŒ‡Thread Board Router å¯ä»¥å®ç° Wi-Fi å’Œ Thread é€šä¿¡äº’è½¬ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒMatterè¿˜å…è®¸æ¥å…¥å…¶ä»–ç½‘ç»œè®¾å¤‡ï¼Œæ¯”å¦‚ZigBeeè®¾å¤‡ï¼Œè¿™ä¸»è¦é€šè¿‡ä¸€ä¸ª <em>Matter bridge</em> è®¾å¤‡æ¥å®ç°ã€‚</p>
<p>åœ¨Matteræ‹“æ‰‘ç»“æ„ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªèŠ‚ç‚¹éå¸¸é‡è¦ï¼š<em>Matter controller</em>ï¼ŒMatter controllerç”¨æ¥å®Œæˆé…ç½‘å’Œè¿œç¨‹æ§åˆ¶è®¾å¤‡ï¼Œæ¯”å¦‚è‹¹æœçš„ HomePod mini &amp; Home app ç»„åˆå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„Matter controllerèŠ‚ç‚¹ã€‚</p>
<p>Threadåè®®ç”±Thread Groupåˆ¶å®šï¼Œæ‰€ä»¥Matter over Threadäº§å“å¿…é¡»é€šè¿‡Thread Groupçš„è®¤è¯ã€‚Wi-Fiåˆ™ç”±Wi-Fiè”ç›Ÿè¿›è¡Œè§„èŒƒï¼Œæ‰€ä»¥Matter over Wi-Fiäº§å“å¿…é¡»é€šè¿‡Wi-Fi Allianceè®¤è¯ã€‚</p>
<ul>
<li><p><strong>Matter over WiFi</strong>ï¼šæŒ‡ä½¿ç”¨WiFiç½‘ç»œæ¥ä¼ è¾“Matteråè®®çš„ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>Matter over Thread</strong>ï¼šæŒ‡ä½¿ç”¨Threadç½‘ç»œæ¥ä¼ è¾“Matteråè®®çš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<p><strong>æ–‡æ¡£ï¼š</strong></p>
<p>Matterå®˜æ–¹æ–‡æ¡£ï¼ˆä¸»è¦æœ‰3ä»½ï¼‰ï¼š</p>
<ul>
<li><strong>Matter 1.3 Device Library Specification</strong>ï¼šå¯¹è®¾å¤‡å±‚é¢çš„ä¸€äº›çº¦æŸå’Œè§„å®š</li>
<li><strong>Matter 1.3 Core Specification</strong>ï¼šæ ¸å¿ƒè§„èŒƒ</li>
<li><strong>Matter 1.3 Application Cluster Specification</strong>ï¼šå¯¹Matterç»„ä»¶Clusterè¿›è¡Œäº†è¯¦ç»†è§„å®š</li>
</ul>
<p>2024å¹´ï¼ŒMatteræœ€æ–°ç‰ˆæœ¬æ˜¯V1.3ï¼Œéšç€Matterçš„ç‰ˆæœ¬æ›´æ–°ï¼Œæ–‡æ¡£ä¹Ÿä¼šéšç€æ›´æ–°ã€‚</p>
<h2 id="Matter-åè®®æ ˆ"><a href="#Matter-åè®®æ ˆ" class="headerlink" title="Matter åè®®æ ˆ"></a>Matter åè®®æ ˆ</h2><p>Matter è§„èŒƒå®šä¹‰äº†åŸºæœ¬è¦æ±‚ï¼Œä»¥ä¾¿é€šè¿‡äº’è”ç½‘åè®®ä¸ºæ™ºèƒ½å®¶å±…è®¾å¤‡æä¾›å¯äº’æ“ä½œçš„åº”ç”¨å±‚è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>Fabricï¼š</strong></p>
<p>ä¸€ä¸ªMatterç½‘ç»œå°±æ˜¯ä¸€ä¸ªFabricï¼Œä¹Ÿå¯ä»¥è¯´ä¸€ä¸ªç”Ÿæ€å°±æ˜¯ä¸€ä¸ªFabricã€‚</p>
<h3 id="Data-Modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰"><a href="#Data-Modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰" class="headerlink" title="Data Modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰"></a>Data Modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰</h3><h4 id="Nodeï¼ˆèŠ‚ç‚¹ï¼‰"><a href="#Nodeï¼ˆèŠ‚ç‚¹ï¼‰" class="headerlink" title="Nodeï¼ˆèŠ‚ç‚¹ï¼‰"></a>Nodeï¼ˆèŠ‚ç‚¹ï¼‰</h4><p>èŠ‚ç‚¹(Node)æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„è®¾å¤‡ï¼Œæœ‰è‡ªå·±å”¯ä¸€çš„ç½‘ç»œåœ°å€ã€‚æ¯ä¸ªMatterè®¾å¤‡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªNodeç»„æˆã€‚é€šå¸¸æ˜¯ç”¨æˆ·å¯ä»¥è¯†åˆ«ä¸ºæ•´ä¸ªè®¾å¤‡çš„ç‰©ç†è®¾å¤‡ï¼Œä¾‹å¦‚ä¸€ä¸ªæœ‰ä¸¤ç›ç¯çš„ç¯å…·ï¼ˆä¸€ç›å¯è°ƒå…‰ç¯å’Œä¸€ç›æ™®é€šç¯ï¼‰ã€‚</p>
<h4 id="Endpointï¼ˆç«¯ç‚¹ï¼‰"><a href="#Endpointï¼ˆç«¯ç‚¹ï¼‰" class="headerlink" title="Endpointï¼ˆç«¯ç‚¹ï¼‰"></a>Endpointï¼ˆç«¯ç‚¹ï¼‰</h4><p>ä¸€ä¸ªNodeåŒ…å«å¤šä¸ªEndpointï¼Œæ¯ä¸ªendpointæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ã€‚ç«¯ç‚¹å¯ä»¥çœ‹ä½œæ˜¯æä¾›é€»è¾‘åˆ†ç»„åœ¨ä¸€èµ·çš„è™šæ‹Ÿè®¾å¤‡ã€‚ä¾‹å¦‚è‰²æ¸©ç¯ï¼Œå…·å¤‡ä¸¤ä¸ªEndpointï¼Œå…¶ä¸­Endpoint 1æ˜¯å¯è°ƒå…‰ç¯ï¼ŒEndPoint 2æ˜¯å¼€&#x2F;å…³ç¯ã€‚</p>
<p><em>æ³¨æ„ï¼šEndpoint 0 é¢„ç•™ç»™ Matter çš„ utility clusterï¼Œè€Œä¸”æ¯ä¸ª Matter è®¾å¤‡éƒ½å¿…é¡»å¼ºåˆ¶åŒ…å« Endpoint 0</em></p>
<h4 id="Clusterï¼ˆé›†ç¾¤ï¼‰"><a href="#Clusterï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="Clusterï¼ˆé›†ç¾¤ï¼‰"></a>Clusterï¼ˆé›†ç¾¤ï¼‰</h4><p>ä¸€ä¸ªEndpointç”±ä¸€ä¸ªæˆ–å¤šä¸ªclusterç»„æˆï¼Œclusterå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½é›†ï¼Œå®ƒåŒ…å« <em>attributess</em>ï¼Œ <em>commands</em>å’Œ <em>events</em>ä¸‰ä¸ªç»„ä»¶ã€‚</p>
<p>å¯¹äºè‰²æ¸©ç¯ï¼Œå…¶ä¸­Endpoint 1æ˜¯å¯è°ƒå…‰ç¯ï¼Œå®ƒæœ‰ä¸¤ä¸ªclusterï¼Œåˆ†åˆ«æ˜¯ï¼šOn&#x2F;Off cluster å’Œ Level Control cluster ã€‚</p>
<p>Matterå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„clusterï¼š</p>
<ul>
<li>serverï¼šæä¾›Attributesã€Commandsã€Eventsï¼Œé€šå¸¸æŒ‡ Matter è®¾å¤‡ã€‚</li>
<li>clientï¼šå¯¹serverå‘èµ·äº¤äº’ï¼ˆinteractionï¼‰æ“ä½œï¼Œé€šå¸¸æŒ‡ Matter Controllerã€‚</li>
</ul>
<h4 id="attributesï¼ˆå±æ€§ï¼‰"><a href="#attributesï¼ˆå±æ€§ï¼‰" class="headerlink" title="attributesï¼ˆå±æ€§ï¼‰"></a>attributesï¼ˆå±æ€§ï¼‰</h4><p>å±æ€§è¡¨ç¤ºå¯ä»¥è¯»å–æˆ–å†™å…¥çš„å†…å®¹ã€‚</p>
<p>å¯¹äºè‰²æ¸©ç¯çš„Endpoint 1ï¼Œå…¶ä¸­On&#x2F;Off cluster çš„ attributess æ˜¯ OnOff ã€‚</p>
<p>å¯¹äºè‰²æ¸©ç¯çš„Endpoint 1ï¼Œå…¶ä¸­Level Control cluster çš„ attributess æ˜¯ CurrentLevel ã€‚</p>
<h4 id="Commandï¼ˆå‘½ä»¤ï¼‰"><a href="#Commandï¼ˆå‘½ä»¤ï¼‰" class="headerlink" title="Commandï¼ˆå‘½ä»¤ï¼‰"></a>Commandï¼ˆå‘½ä»¤ï¼‰</h4><p>å‘½ä»¤æä¾›åœ¨é›†ç¾¤ä¸Šè°ƒç”¨ç‰¹å®šè¡Œä¸ºçš„èƒ½åŠ›ã€‚</p>
<p>å¯¹äºè‰²æ¸©ç¯çš„Endpoint 1ï¼Œå…¶ä¸­On&#x2F;Off cluster çš„ Commands æœ‰ï¼šOnã€Offã€Toggle</p>
<p>å¯¹äºè‰²æ¸©ç¯çš„Endpoint 1ï¼Œå…¶ä¸­Level Control cluster çš„ Commands æœ‰ï¼šMoveToLevel ã€‚</p>
<h4 id="Eventï¼ˆäº‹ä»¶ï¼‰"><a href="#Eventï¼ˆäº‹ä»¶ï¼‰" class="headerlink" title="Eventï¼ˆäº‹ä»¶ï¼‰"></a>Eventï¼ˆäº‹ä»¶ï¼‰</h4><p>Eventå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„attributesï¼Œå®ƒç”¨æ¥æ›´æ–°è®¾å¤‡çš„çŠ¶æ€ã€‚</p>
<h3 id="Interaction-Modelï¼ˆäº¤äº’æ¨¡å‹ï¼‰"><a href="#Interaction-Modelï¼ˆäº¤äº’æ¨¡å‹ï¼‰" class="headerlink" title="Interaction Modelï¼ˆäº¤äº’æ¨¡å‹ï¼‰"></a>Interaction Modelï¼ˆäº¤äº’æ¨¡å‹ï¼‰</h3><p>é€šä¿—åœ°è®²ï¼ŒInteraction modelå°±æ˜¯ç”¨æ¥è§„å®šäº¤äº’å‘½ä»¤é›†çš„ï¼Œæˆ‘ä»¬æŠŠå‘èµ·äº¤äº’çš„èŠ‚ç‚¹å«initiator (ä¸€èˆ¬éƒ½æ˜¯clientè®¾å¤‡)ï¼Œè€Œæ¥æ”¶è€…ç§°ä¸ºtarget (ä¸€èˆ¬ä¸ºserverè®¾å¤‡)ã€‚</p>
<p>Matterå®šä¹‰äº†å¦‚ä¸‹interactionç±»å‹ï¼š</p>
<ul>
<li><strong>Read</strong></li>
</ul>
<p>â€‹	ç”¨æ¥è¯»å–attributesæˆ–eventsçš„å€¼</p>
<ul>
<li><strong>Write</strong></li>
</ul>
<p>â€‹	ç”¨æ¥ä¿®æ”¹attributeçš„å€¼</p>
<ul>
<li><strong>Invoke</strong></li>
</ul>
<p>â€‹	ç”¨æ¥å‘é€commands</p>
<ul>
<li><strong>Subscribe</strong></li>
</ul>
<p>â€‹	ç”¨æ¥è®¢é˜…targetçš„æ•°æ®æŠ¥å‘Šï¼Œä»è€Œä¸ç”¨å®šæ—¶å»æŸ¥è¯¢ç›¸å…³æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…attributeï¼Œä¹Ÿå¯ä»¥è®¢é˜…eventã€‚</p>
<p>Interactionæœ¬èº«ç”±transactionç»„æˆï¼Œè€Œtransactionåˆç”±actionç»„æˆï¼Œæ¯ä¸ªactionåŒ…å«1æ¡æˆ–è€…å¤šæ¡ä¿¡æ¯ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.espressif.com/what-does-matter-mean-to-you-fa3bb53a7793">What does Matter mean to you?</a></p>
<p><a href="https://blog.espressif.com/matter-clusters-attributess-commands-82b8ec1640a0">Matter: Clusters, attributess, Commands</a></p>
<p><a href="https://mp.weixin.qq.com/s/xU82G0LL-92zd86iXChwKQ">Matterå¼€å‘ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p>
]]></content>
      <categories>
        <category>Matter</category>
      </categories>
      <tags>
        <tag>Matter Standard</tag>
        <tag>CSA</tag>
        <tag>IoT</tag>
      </tags>
  </entry>
  <entry>
    <title>wpa-supplicant application</title>
    <url>/2024/08/12/2024/wpa-supplicant-application/</url>
    <content><![CDATA[<h2 id="æ— çº¿çƒ­ç‚¹"><a href="#æ— çº¿çƒ­ç‚¹" class="headerlink" title="æ— çº¿çƒ­ç‚¹"></a>æ— çº¿çƒ­ç‚¹</h2><p>è·¯ç”±å™¨èƒ½å¤Ÿå»ºç«‹æ— çº¿çƒ­ç‚¹ï¼ˆå³APæ¨¡å¼ï¼ŒAccess Point Modeï¼‰ï¼Œä¾›æ‰‹æœºæˆ–PCç­‰æ— çº¿è®¾å¤‡ä¸Šç½‘ã€‚æ— çº¿çƒ­ç‚¹æ”¯æŒIEEE 802.11 b&#x2F;g&#x2F;n æ ‡å‡†å¯ä»¥åŒæ—¶æœ‰ä¸¤ä¸ªé¢‘ç‡é€‰æ‹©ï¼š2.4GHz å’Œ 5GHzã€‚</p>
<p>2.4GHz å·¥ä½œé¢‘æ®µèŒƒå›´ï¼š2.4GHz ~ 2.4835GHzï¼Œå…±åˆ’åˆ†14ä¸ªä¿¡é“ï¼ˆä½†ç¬¬14ä¿¡é“ä¸€èˆ¬ä¸ç”¨ï¼‰ï¼Œæ¯ä¸ªä¿¡é“é¢‘å®½20MHzï¼Œå…¶ç‰¹ç‚¹è¡¨ç°ä¸ºé¢‘ç‡ä½ã€æ³¢é•¿ï¼ˆ0.125mï¼‰é•¿ï¼Œä¼ è¾“è·ç¦»è¿œï¼ˆè¦†ç›–èŒƒå›´å¤§ï¼‰ï¼Œä½†æ˜¯ä¼ è¾“é€Ÿåº¦æ…¢ã€‚</p>
<p>5GHz å·¥ä½œé¢‘æ®µèŒƒå›´ï¼š5.170GHz ~ 5.850GHzï¼Œå¤§çº¦æœ‰ä¸ª45ä¸ªä¿¡é“ï¼Œå…¶ä¸­38ã€46ã€151ã€159ä¿¡é“é¢‘å®½ä¸º40MHzï¼Œå…¶ä½™ä¿¡é“é¢‘å®½å‡ä¸º20MHzï¼Œå…¶ç‰¹ç‚¹è¡¨ç°ä¸ºé¢‘ç‡é«˜ã€æ³¢é•¿ï¼ˆ0.052mï¼‰çŸ­ï¼Œä¼ è¾“è·ç¦»çŸ­ï¼ˆè¦†ç›–èŒƒå›´å°ï¼‰ï¼Œä½†ä¼ è¾“é€Ÿåº¦å¿«ã€‚</p>
<p>æ— çº¿çƒ­ç‚¹çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>
<ul>
<li><p>ç½‘ç»œåç§°ï¼ˆSSIDï¼‰<br>  SSIDä¸èƒ½å”¯ä¸€çš„è¡¨ç¤ºä¸€ä¸ªæ— çº¿çƒ­ç‚¹ï¼Œå³å¤šä¸ªæ— çº¿çƒ­ç‚¹èƒ½è®¾ç½®ç›¸åŒçš„SSIDã€‚<br>  SSIDè®¾ç½®å¹¿æ’­æ¨¡å¼åï¼Œå…¶ä»–è®¾ç½®æ‰èƒ½æœç´¢åˆ°è¯¥SSIDï¼Œå¦åˆ™è¯¥SSIDè¢«éšè—ï¼Œåªèƒ½é€šè¿‡æ‰‹åŠ¨è¾“å…¥SSIDè¿›è¡Œè¿æ¥ã€‚</p>
</li>
<li><p>å®‰å…¨æ¨¡å¼<br>  è·¯ç”±å™¨ä¸­å®‰å…¨æ¨¡å¼èƒ½è®¾ç½®æ— çº¿çƒ­ç‚¹çš„åŠ å¯†ç±»å‹ï¼šOPENã€WPA2(AES)-PSKã€WPA-PSK&#x2F;WPA2-PSK</p>
</li>
<li><p>åŠ å¯†ç±»å‹</p>
<p>  <strong>OPEN</strong>ï¼šå¼€æ”¾å¼è®¤è¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¿æ¥å¹¶ä½¿ç”¨æ— çº¿ç½‘ç»œã€‚</p>
<p>  <strong>WEB</strong>ï¼šå…±äº«ç§˜é’¥è®¤è¯ä¾èµ–äº <strong>WEB</strong> ï¼ˆWired Equivalent Privacyï¼Œæœ‰çº¿ç­‰æ•ˆåŠ å¯†ï¼‰ï¼Œä½¿ç”¨RC4ç®—æ³•ï¼Œç§˜é’¥åˆ†ä¸º64 bit å’Œ 128 bitï¼Œä¸”é€šä¿¡åŒæ–¹ä½¿ç”¨ç›¸åŒçš„ç§˜é’¥ã€‚</p>
<p>  <strong>WPA</strong>ï¼šé‡‡ç”¨TKIPï¼ˆTemporal Key Integrity Protocolï¼Œä¸´æ—¶ç§˜é’¥å®Œæ•´æ€§åè®®ï¼‰æ¥ä¸ºæ¯ä¸€ä¸ªMACå¸§ç”Ÿæˆä¸åŒçš„Keyï¼Œä»¥æ›¿ä»£WEBã€‚WPAæœ‰ä¸¤ç§æ¨¡å¼ï¼šä¼ä¸šæ¨¡å¼ï¼ˆWPA-EAPï¼‰å’Œ ä¸ªäººæ¨¡å¼ï¼ˆWPA-PSKï¼‰ã€‚</p>
<p>  <strong>WPA2</strong>ï¼šRSNè¢«WFAç»„ç»‡æˆä¸ºWPA2ï¼Œé‡‡ç”¨äº†CCMPåŠ å¯†æ–¹å¼ã€‚</p>
<p>  <strong>WPA3</strong>ï¼šæ–°ä¸€ä»£Wi-FiåŠ å¯†åè®®ï¼Œç”¨äºæ›¿ä»£WPA2ã€‚</p>
</li>
<li><p>å¯†ç ï¼ˆPSKï¼‰<br>  å¯†ç çš„æœ‰æ— å–å†³äºå®‰å…¨æ¨¡å¼ã€‚è‹¥å®‰å…¨æ¨¡å¼ä¸º OPENï¼Œåˆ™å¯†ç ä¸ºç©ºï¼›è‹¥å®‰å…¨æ¨¡å¼ä¸ºå…¶ä»–ç±»å‹ï¼Œåˆ™å¯†ç ä¸ä¸ºç©ºã€‚</p>
</li>
</ul>
<h2 id="ä¿¡é“"><a href="#ä¿¡é“" class="headerlink" title="ä¿¡é“"></a>ä¿¡é“</h2><p>ä¿¡é“ä¹Ÿç§°ä½œé€šé“(Channel)ã€é¢‘æ®µï¼Œæ˜¯ä»¥æ— çº¿ä¿¡å·ï¼ˆç”µç£æ³¢ï¼‰ä½œä¸ºä¼ è¾“è½½ä½“çš„æ•°æ®ä¿¡å·ä¼ é€é€šé“ã€‚</p>
<p>IEEE 802.11 ä¸ºISMï¼ˆå…æ‰§ç…§ï¼‰é¢‘æ®µä¸­çš„ä½åŠŸç‡ Wi-Fiå®šä¹‰äº† 14 ä¸ªä¿¡é“ã€‚ä¸ç®¡æ˜¯802.11b&#x2F;gè¿˜æ˜¯802.11a&#x2F;b&#x2F;g&#x2F;n&#x2F;acä¸€èˆ¬éƒ½æ”¯æŒ 13 ä¸ªä¿¡é“ã€‚å®ƒä»¬çš„ä¸­å¿ƒé¢‘ç‡è™½ç„¶ä¸åŒï¼Œä½†æ˜¯å› ä¸ºéƒ½å æ®ä¸€å®šçš„é¢‘ç‡èŒƒå›´ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€äº›ç›¸äº’é‡å çš„æƒ…å†µã€‚</p>
<p>2.4GHzé¢‘å¸¦çš„ä¿¡é“åˆ’åˆ†14ä¸ªä¿¡é“ï¼ˆ2412 MHz ~ 2484 MHzï¼‰ï¼Œä½†ç¬¬14ä¿¡é“ä¸€èˆ¬ä¸ç”¨ï¼Œæ¯ä¸ªä¿¡é“çš„æœ‰æ•ˆå®½åº¦æ˜¯ 20MHzï¼Œå¦å¤–è¿˜æœ‰2MHzçš„å¼ºåˆ¶éš”ç¦»é¢‘å¸¦ã€‚2.4G WiFiä¿¡é“åˆ†å¸ƒå›¾å¯ä»¥çœ‹åˆ°ä¿¡é“ä¹‹é—´ä¼šå½¼æ­¤é‡å ï¼Œä»è€Œå®¹æ˜“é€ æˆWiFiå¹²æ‰°ï¼Œä½†1ã€6ã€11ä¿¡é“é™¤å¤–ï¼Œè¿™ä¸‰ä¸ªä¿¡é“æ²¡æœ‰é‡å éƒ¨åˆ†ï¼Œæ•…è·¯ç”±å™¨ä¸€èˆ¬å°†è¿™ä¸‰ä¸ªä¿¡é“ä½œä¸ºé»˜è®¤çš„ä¿¡é“æ¥ä½¿ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>ä¿¡é“</th>
<th>é¢‘å®½(MHz)</th>
<th>ä¸­å¿ƒé¢‘ç‡(MHz)</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>20</td>
<td>2412</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>2417</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>2422</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>2427</td>
</tr>
<tr>
<td>5</td>
<td>20</td>
<td>2432</td>
</tr>
<tr>
<td>6</td>
<td>20</td>
<td>2437</td>
</tr>
<tr>
<td>7</td>
<td>20</td>
<td>2442</td>
</tr>
<tr>
<td>8</td>
<td>20</td>
<td>2447</td>
</tr>
<tr>
<td>9</td>
<td>20</td>
<td>2452</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>2457</td>
</tr>
<tr>
<td>11</td>
<td>20</td>
<td>2462</td>
</tr>
<tr>
<td>12</td>
<td>20</td>
<td>2467</td>
</tr>
<tr>
<td>13</td>
<td>20</td>
<td>2472</td>
</tr>
<tr>
<td>14</td>
<td>20</td>
<td>2484</td>
</tr>
</tbody></table>
<p><img src="/2024/08/12/2024/wpa-supplicant-application/2.4G.png" alt="2.4G"></p>
<p><em>æ³¨æ„ï¼š</em></p>
<h2 id="WPA-SUPPLICANT"><a href="#WPA-SUPPLICANT" class="headerlink" title="WPA_SUPPLICANT"></a>WPA_SUPPLICANT</h2><blockquote>
<p>wap_supplicantæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>wpa_supplicant æ˜¯é€‚ç”¨äº Linuxã€BSDã€Mac OS X å’Œ Windows çš„ WPA Supplicantï¼Œæ”¯æŒ WPAã€WPA2ï¼ˆIEEE 802.11i &#x2F; RSNï¼‰å’Œ WPA3ã€‚å®ƒé€‚ç”¨äºå°å¼æœº&#x2F;ç¬”è®°æœ¬ç”µè„‘å’ŒåµŒå…¥å¼ç³»ç»Ÿã€‚Supplicant æ˜¯å®¢æˆ·ç«¯ç«™ä¸­ä½¿ç”¨çš„ IEEE 802.1X&#x2F;WPA ç»„ä»¶ã€‚å®ƒä¸ WPA Authenticator å®ç°å¯†é’¥åå•†ï¼Œå¹¶æ§åˆ¶ wlan é©±åŠ¨ç¨‹åºçš„æ¼«æ¸¸å’Œ IEEE 802.11 èº«ä»½éªŒè¯&#x2F;å…³è”ã€‚</p>
<p>è·å–wpa_supplicantä»“åº“ä»£ç ï¼š<code>git clone git://w1.fi/hostap.git</code></p>
<p>wpa_supplicant è¢«è®¾è®¡ä¸ºåœ¨åå°è¿è¡Œçš„â€œå®ˆæŠ¤è¿›ç¨‹â€ç¨‹åºï¼Œå¹¶å……å½“æ§åˆ¶æ— çº¿è¿æ¥çš„åç«¯ç»„ä»¶ã€‚wpa_supplicant æ”¯æŒå•ç‹¬çš„å‰ç«¯ç¨‹åºï¼Œwpa_supplicant åŒ…å«åŸºäºå‘½ä»¤è¡Œçš„å‰ç«¯ (wpa_cli) å’Œ GUI (wpa_gui)ã€‚</p>
<p>wpa_supplicantåº”ç”¨ä¸»è¦åŒ…æ‹¬ç¨‹åºï¼š</p>
<ul>
<li>wpa_supplicantå®ˆæŠ¤ç¨‹åº</li>
<li>wpa_cliå®¢æˆ·ç«¯ç¨‹åº</li>
<li>wpa_passphraseå¯†ç å·¥å…·ç¨‹åº</li>
</ul>
<p>wpa_supplicantçš„è¿è¡Œæ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># -B: åœ¨åå°è¿è¡Œ</span></span><br><span class="line"><span class="comment"># -i: æ¥å£</span></span><br><span class="line"><span class="comment"># -c: é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># -D: é©±åŠ¨(å¯å¤šé€‰)ï¼Œå¯é€‰é¡¹ï¼š</span></span><br><span class="line"><span class="comment">#          nl80211 = Linux nl80211/cfg80211</span></span><br><span class="line"><span class="comment">#          wext = Linux wireless extensions (generic)</span></span><br><span class="line"><span class="comment">#          wired = Wired Ethernet driver</span></span><br><span class="line"><span class="comment">#          macsec_linux = MACsec Ethernet driver for Linux</span></span><br><span class="line"><span class="comment">#          none = no driver (RADIUS server/WPS ER)</span></span><br><span class="line"><span class="comment"># -f: æ—¥å¿—æ–‡ä»¶è¾“å‡ºä½ç½®</span></span><br><span class="line"><span class="comment"># -P: pidæ–‡ä»¶è¾“å‡ºä½ç½®</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„äº‹é¡¹ï¼š</em></p>
<p><em>dbus-daemonéœ€è¦çŸ¥é“å¦‚ä½•è½¬å‘æ¶ˆæ¯ï¼Œ&#x2F;etc&#x2F;dbus-1&#x2F;system.då­˜æ”¾å„ä¸ªappçš„dbusæœåŠ¡æ¥å£é…ç½®ï¼Œdbus-daemonå¯åŠ¨æ—¶ä¼šéå†åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰é…ç½®ï¼ŒåŠ è½½åˆ†å‘æƒ…å†µã€‚è‹¥æ²¡æœ‰é…ç½®æœåŠ¡ï¼ŒæŸä¸ªappæ³¨å†Œè‡ªèº«æœåŠ¡åæ—¶ï¼Œä¼šæŠ¥é”™ï¼šConnection â€œ:1.6â€ is not allowed to own the service â€œorg.bluezâ€ due to security policies in the configuration fileã€‚</em></p>
<p><em>é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/dbus-1/system.d/wpa_supplicant.conf</code>ï¼Œè¯¥æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">busconfig</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">busconfig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">policy</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">allow</span> <span class="attr">own</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">allow</span> <span class="attr">send_destination</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">allow</span> <span class="attr">send_interface</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">allow</span> <span class="attr">receive_sender</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span> <span class="attr">receive_type</span>=<span class="string">&quot;signal&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">policy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">policy</span> <span class="attr">context</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deny</span> <span class="attr">own</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deny</span> <span class="attr">send_destination</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deny</span> <span class="attr">receive_sender</span>=<span class="string">&quot;fi.w1.wpa_supplicant1&quot;</span> <span class="attr">receive_type</span>=<span class="string">&quot;signal&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">policy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">busconfig</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>wpa_supplicantç»“æ„å›¾ï¼š</p>
<p><img src="/2024/08/12/2024/wpa-supplicant-application/image-20241016170128847.png" alt="image-20241016170128847"></p>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>wpa_supplicant.conf ä½œä¸º wpa_supplicant åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŒä¹…åŒ–ä¿å­˜ä¸€äº›ä¿¡æ¯ã€‚è€Œé…ç½®æ–‡ä»¶çš„é»˜è®¤ä¿å­˜è·¯å¾„æ˜¯ï¼š<code>/etc/wpa_supplicant/wpa_supplicant.conf</code></p>
<p>wpa_supplicant.conf å¯ä»¥è®¾ç½®å“ªäº›é…ç½®ï¼Ÿ</p>
<ul>
<li>æŒ‡å®šwpa_supplicantæ§åˆ¶æ¥å£</li>
<li>æ˜¯å¦å…è®¸é…ç½®æ–‡ä»¶æ›´æ–°</li>
<li>é»˜è®¤ç½‘ç»œé…ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¿…é¡»ä¸ºwpa_supplicantæŒ‡å®šä¸€ä¸ªæ§åˆ¶æ¥å£ï¼Œå¹¶ä¸”å¿…é¡»èµ‹äºˆå®ƒæ›´æ–°é…ç½®çš„æƒé™</span><br><span class="line">ctrl_interface=/var/run/wpa_supplicant</span><br><span class="line">update_config=1</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=&quot;ZTE_AP_2.4G&quot;</span><br><span class="line">	scan_ssid=1</span><br><span class="line">	psk=&quot;zte2015&quot;</span><br><span class="line">	priority=1</span><br><span class="line">	disabled=1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=&quot;ZTE_5GCPE_F876&quot;</span><br><span class="line">	scan_ssid=1</span><br><span class="line">	key_mgmt=NONE</span><br><span class="line">	priority=2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><p>ä»é€šä¿¡å±‚æ¬¡ä¸Šåˆ’åˆ†ï¼š</p>
<ul>
<li><p><strong>ä¸Šè¡Œæ¥å£</strong>ï¼šwpa_supplicantæä¾›å‘ä¸Šçš„æ§åˆ¶æ¥å£ control interfaceï¼Œç”¨äºä¸å…¶ä»–æ¨¡å—ï¼ˆå¦‚UIï¼‰è¿›è¡Œé€šä¿¡ï¼Œå…¶ä»–æ¨¡å—å¯ä»¥é€šè¿‡control interface æ¥è·å–ä¿¡æ¯æˆ–ä¸‹å‘å‘½ä»¤ã€‚</p>
</li>
<li><p><strong>ä¸‹è¡Œæ¥å£</strong>ï¼šwpa_supplicanté€šè¿‡socketé€šä¿¡æœºåˆ¶å®ç°ä¸‹è¡Œæ¥å£ï¼Œä¸å†…æ ¸ï¼ˆé©±åŠ¨ç¨‹åºï¼‰è¿›è¡Œé€šä¿¡ï¼Œè·å–ä¿¡æ¯æˆ–ä¸‹å‘å‘½ä»¤ã€‚</p>
</li>
</ul>
<p>å…¶ä¸­wpa_supplicantçš„ä¸Šè¡Œæ¥å£çš„å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>åŸºäºä¼ ç»Ÿdbusæœºåˆ¶å®ç°ä¸å…¶ä»–è¿›ç¨‹é—´çš„IPCé€šä¿¡</li>
<li>é€šè¿‡Unix domain socketæœºåˆ¶å®ç°è¿›ç¨‹é—´çš„IPCé€šä¿¡</li>
</ul>
<p>wpa_supplicantæä¾›çš„<a href="https://w1.fi/wpa_supplicant/devel/dbus.html">D-Bus APIæ¥å£</a>ï¼Œé€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼š<code>wpa_supplicant -h</code>ï¼Œå…¶ç»“æœä¸­æœ‰ <code>-u</code> é€‰é¡¹å°±æ˜¯ä½¿èƒ½D-Busæ§åˆ¶æ¥å£ã€‚</p>
<p>å¦å¤–æˆ‘é€šè¿‡ <code>dbus-send</code> å·¥å…·æ‰§è¡ŒæŸ¥è¯¢dbusæœåŠ¡ï¼ˆå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œå…¶ç»“æœä¸­å‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ªæœåŠ¡ï¼š<code>fi.w1.wpa_supplicant1</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dbus-send --system --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.ListNames</span><br></pre></td></tr></table></figure>

<p>å€ŸåŠ©D-Buså›¾å½¢å·¥å…· <strong>D-Feet</strong> å¯ä»¥æŸ¥çœ‹åˆ°æ›´å…·ä½“çš„ä¿¡æ¯ï¼š</p>
<p><img src="/2024/08/12/2024/wpa-supplicant-application/image-20241016211846477.png" alt="image-20241016211846477"></p>
<h3 id="dbus-for-wpa-supplicantæ¥å£"><a href="#dbus-for-wpa-supplicantæ¥å£" class="headerlink" title="dbus for wpa_supplicantæ¥å£"></a>dbus for wpa_supplicantæ¥å£</h3><p>wpa_supplicant dbus api æ–‡æ¡£æ¶‰åŠåˆ°å„ä¸ªä¸åŒæ¥å£ï¼š</p>
<ul>
<li><strong>fi.w1.wpa_supplicant1</strong></li>
<li><strong>fi.w1.wpa_supplicant1.Interface</strong></li>
<li>fi.w1.wpa_supplicant1.Interface.WPS</li>
<li>fi.w1.wpa_supplicant1.Interface.P2PDevice</li>
<li><strong>fi.w1.wpa_supplicant1.BSS</strong></li>
<li><strong>fi.w1.wpa_supplicant1.Network</strong></li>
<li>fi.w1.wpa_supplicant1.Peer</li>
<li>fi.w1.wpa_supplicant1.Group</li>
<li>fi.w1.wpa_supplicant1.PersistentGroup</li>
</ul>
<h3 id="fi-w1-wpa-supplicant1"><a href="#fi-w1-wpa-supplicant1" class="headerlink" title="fi.w1.wpa_supplicant1"></a>fi.w1.wpa_supplicant1</h3><p>ç”±åœ¨æ€»çº¿ä¸­æ³¨å†Œåä¸º fi.w1.wpa_supplicant1 çš„ä¸» wpa_supplicant D-Bus å¯¹è±¡å®ç°çš„æ¥å£ã€‚</p>
<p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:Service: fi.w1.wpa_supplicant1</span><br><span class="line">:Interface: fi.w1.wpa_supplicant1</span><br><span class="line">:Object path: /fi/w1/wpa_supplicant1</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>CreateInterface ( a{sv} : args ) â€“&gt; o : interface</td>
<td>åœ¨ wpa_supplicant ä¸­æ³¨å†Œä¸€ä¸ªæ— çº¿æ¥å£ã€‚</td>
</tr>
<tr>
<td>RemoveInterface ( o : interface ) â€“&gt; nothing</td>
<td>ä» wpa_supplicant å–æ¶ˆæ³¨å†Œæ— çº¿æ¥å£ã€‚</td>
</tr>
<tr>
<td>GetInterface ( s : ifname ) â€“&gt; o : interface</td>
<td>è¿”å›ä¸ wpa_supplicant å·²æ§åˆ¶çš„æ¥å£ç›¸å…³çš„å¯¹è±¡çš„ D-Bus è·¯å¾„ã€‚</td>
</tr>
</tbody></table>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>string DebugLevel</td>
<td>[readwrite]</td>
<td>å…¨å±€ wpa_supplicant è°ƒè¯•çº§åˆ«ã€‚</td>
</tr>
<tr>
<td>bool DebugTimestamp</td>
<td>[readwrite]</td>
<td>ç¡®å®šæ—¶é—´æˆ³æ˜¯å¦æ˜¾ç¤ºåœ¨è°ƒè¯•æ—¥å¿—ä¸­ï¼ˆå…¨å±€å‚æ•°ï¼‰ã€‚</td>
</tr>
<tr>
<td>bool DebugShowKeys</td>
<td>[readwrite]</td>
<td>ç¡®å®šé”®åæ˜¯å¦æ˜¾ç¤ºåœ¨è°ƒè¯•æ—¥å¿—ä¸­ã€‚</td>
</tr>
<tr>
<td>array{object} Interfaces</td>
<td>[read]</td>
<td>ä¸€ä¸ªåŒ…å«æŒ‡å‘ D-Bus å¯¹è±¡è·¯å¾„çš„æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡ä»£è¡¨å—æ§çš„æ¥å£ã€‚</td>
</tr>
<tr>
<td>array{string} EapMethods</td>
<td>[read]</td>
<td>åŒ…å«å—æ”¯æŒçš„ EAP æ–¹æ³•åç§°çš„æ•°ç»„ã€‚</td>
</tr>
<tr>
<td>array{string} Capabilities</td>
<td>[read]</td>
<td>å…·æœ‰æ”¯æŒåŠŸèƒ½çš„é˜µåˆ—</td>
</tr>
<tr>
<td>array{byte} WFDIEs</td>
<td>[readwrite]</td>
<td>Wi-Fi æ˜¾ç¤ºå­å…ƒç´ ã€‚</td>
</tr>
</tbody></table>
<p><strong>ä¿¡å·ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ä¿¡å·åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>InterfaceAdded ( o : interface, a{sv} : properties )</td>
<td>æ–°å¢æ¥å£</td>
</tr>
<tr>
<td>InterfaceRemoved ( o : interface )</td>
<td>ç§»é™¤æ¥å£</td>
</tr>
<tr>
<td>PropertiesChanged ( a{sv} : properties )</td>
<td>å±æ€§å˜åŒ–</td>
</tr>
</tbody></table>
<h3 id="fi-w1-wpa-supplicant1-Interface"><a href="#fi-w1-wpa-supplicant1-Interface" class="headerlink" title="fi.w1.wpa_supplicant1.Interface"></a>fi.w1.wpa_supplicant1.Interface</h3><p>ç”±æ·»åŠ åˆ° wpa_supplicant çš„ç½‘ç»œæ¥å£ç›¸å…³å¯¹è±¡å®ç°çš„æ¥å£ï¼Œå³ç”± fi.w1.wpa_supplicant1.CreateInterface è¿”å›çš„æ¥å£ã€‚</p>
<p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:Service: fi.w1.wpa_supplicant1</span><br><span class="line">:Interface: fi.w1.wpa_supplicant1.Interface</span><br><span class="line">:Object path: /fi/w1/wpa_supplicant1/Interfaces/index  (index is 0ã€1ã€2 ...)</span><br></pre></td></tr></table></figure>



<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>Scan ( a{sv} : args ) â€“&gt; nothing</td>
<td>è§¦å‘æ‰«æ</td>
</tr>
<tr>
<td>Disconnect ( ) â€“&gt; nothing</td>
<td>æ–­å¼€ç½‘ç»œ</td>
</tr>
<tr>
<td>AddNetwork ( a{sv} : args ) â€“&gt; o : network</td>
<td>æ–°å¢ç½‘ç»œåˆ°æ¥å£</td>
</tr>
<tr>
<td>RemoveNetwork ( o : network ) â€“&gt; nothing</td>
<td>ç§»é™¤ç½‘ç»œæ¥å£</td>
</tr>
<tr>
<td>RemoveAllNetworks ( ) â€“&gt; nothing</td>
<td>ç§»é™¤æ‰€æœ‰ç½‘ç»œæ¥å£</td>
</tr>
<tr>
<td>SelectNetwork ( o : network ) â€“&gt; nothing</td>
<td>å°è¯•ä¸å·²é…ç½®çš„ç½‘ç»œå…³è”</td>
</tr>
<tr>
<td>Reassociate ( ) â€“&gt; nothing</td>
<td>å°è¯•é‡æ–°å…³è”</td>
</tr>
<tr>
<td>Reattach ( ) â€“&gt; nothing</td>
<td>å°è¯•é‡æ–°å…³è”è‡³å½“å‰ BSS</td>
</tr>
<tr>
<td>Reconnect ( ) â€“&gt; nothing</td>
<td>å¦‚æœå¤„äºæ–­å¼€è¿æ¥çŠ¶æ€ï¼Œåˆ™å°è¯•é‡æ–°è¿æ¥å¹¶è¿æ¥ã€‚</td>
</tr>
<tr>
<td>AddBlob ( s : name, ay : data ) â€“&gt; nothing</td>
<td>å‘æ¥å£æ·»åŠ ä¸€ä¸ª blob</td>
</tr>
<tr>
<td>RemoveBlob ( s : name ) â€“&gt; nothing</td>
<td>ä»æ¥å£ç§»é™¤ä¸€ä¸ª blob</td>
</tr>
<tr>
<td>GetBlob ( s : name ) â€“&gt; ay : data</td>
<td>è¿”å›å…ˆå‰æ·»åŠ çš„ Blob çš„ Blob æ•°æ®</td>
</tr>
<tr>
<td>AutoScan ( s : arg ) â€“&gt; nothing</td>
<td>è®¾ç½®æ¥å£çš„è‡ªåŠ¨æ‰«æå‚æ•°</td>
</tr>
<tr>
<td>TDLSDiscover ( s : peer_address ) â€“&gt; nothing</td>
<td>å¯åŠ¨å¯¹ç­‰æ–¹çš„ TDLS å‘ç°</td>
</tr>
<tr>
<td>TDLSSetup ( s : peer_address ) â€“&gt; nothing</td>
<td>ä¸ºå¯¹ç­‰æ–¹è®¾ç½® TDLS ä¼šè¯</td>
</tr>
<tr>
<td>TDLSStatus ( s : peer_address ) â€“&gt; s</td>
<td>è¿”å›ç›¸å¯¹äºå¯¹ç­‰æ–¹çš„ TDLS çŠ¶æ€</td>
</tr>
<tr>
<td>TDLSTeardown ( s : peer_address ) â€“&gt; nothing</td>
<td>æ‹†é™¤ä¸å¯¹ç­‰æ–¹çš„ TDLS ä¼šè¯</td>
</tr>
<tr>
<td>EAPLogoff ( ) â€“&gt; nothing</td>
<td>IEEE 802.1X EAPOL çŠ¶æ€æœºæ³¨é”€</td>
</tr>
<tr>
<td>EAPLogon ( ) â€“&gt; nothing</td>
<td>IEEE 802.1X EAPOL çŠ¶æ€æœºç™»å½•</td>
</tr>
<tr>
<td>NetworkReply ( o : network, s : field, s : value ) â€“&gt; nothing</td>
<td>æä¾›NetworkRequest()è¯·æ±‚çš„å‚æ•°</td>
</tr>
<tr>
<td>SetPKCS11EngineAndModulePath ( s : pkcs11_engine_path, s : pkcs11_module_path ) â€“&gt; nothing</td>
<td>è®¾ç½® PKCS #11 å¼•æ“å’Œæ¨¡å—è·¯å¾„</td>
</tr>
<tr>
<td>SignalPoll ( ) â€“&gt; a{sv} : properties</td>
<td>è·å–å½“å‰è¿æ¥çš„ä¿¡å·å±æ€§</td>
</tr>
<tr>
<td>FlushBSS ( u : age ) â€“&gt; nothing</td>
<td>ä»ç¼“å­˜ä¸­åˆ·æ–° BSS æ¡ç›®</td>
</tr>
<tr>
<td>SubscribeProbeReq ( ) â€“&gt; nothing</td>
<td>è®¢é˜…ä»¥æ¥æ”¶æ¢æµ‹è¯·æ±‚äº‹ä»¶</td>
</tr>
<tr>
<td>UnsubscribeProbeReq ( ) â€“&gt; nothing</td>
<td>å–æ¶ˆæ¥æ”¶æ¢æµ‹è¯·æ±‚äº‹ä»¶</td>
</tr>
</tbody></table>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>array{string, variant} Capabilities</td>
<td>read</td>
<td>æ¥å£åŠŸèƒ½</td>
</tr>
<tr>
<td>string State</td>
<td>read</td>
<td>æ¥å£çŠ¶æ€</td>
</tr>
<tr>
<td>bool Scanning</td>
<td>read</td>
<td>ç¡®å®šæ¥å£æ˜¯å¦å·²åœ¨æ‰«æ</td>
</tr>
<tr>
<td>uint32 ApScan</td>
<td>readwrite</td>
<td>ä¸ wpa_supplicant é…ç½®æ–‡ä»¶ä¸­çš„ ap_scan æ¡ç›®ç›¸åŒã€‚å¯èƒ½çš„å€¼ä¸º 0ã€1 æˆ– 2</td>
</tr>
<tr>
<td>uint32 BSSExpireAge</td>
<td>readwrite</td>
<td>ä¸ wpa_supplicant é…ç½®æ–‡ä»¶ä¸­çš„ bss_expiration_age æ¡ç›®ç›¸åŒ</td>
</tr>
<tr>
<td>uint32 BSSExpireCount</td>
<td>readwrite</td>
<td>ä¸ wpa_supplicant é…ç½®æ–‡ä»¶ä¸­çš„ bss_expiration_scan_count æ¡ç›®ç›¸åŒ</td>
</tr>
<tr>
<td>string Country</td>
<td>readwrite</td>
<td>ä¸ wpa_supplicant é…ç½®æ–‡ä»¶ä¸­çš„å›½å®¶&#x2F;åœ°åŒºæ¡ç›®ç›¸åŒ</td>
</tr>
<tr>
<td>string Ifname</td>
<td>read</td>
<td>æ¥å£æ§åˆ¶çš„ç½‘ç»œæ¥å£åç§°ï¼Œä¾‹å¦‚ wlan0</td>
</tr>
<tr>
<td>string BridgeIfname</td>
<td>read</td>
<td>è¯¥æ¥å£æ§åˆ¶çš„æ¡¥æ¥ç½‘ç»œæ¥å£åç§°ï¼Œä¾‹å¦‚ br0</td>
</tr>
<tr>
<td>string Driver</td>
<td>read</td>
<td>æ¥å£ä½¿ç”¨çš„é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œä¾‹å¦‚ nl80211</td>
</tr>
<tr>
<td>object CurrentBSS</td>
<td>read</td>
<td>è¡¨ç¤ºä¸ wpa_supplicant å…³è”çš„ BSS çš„ D-Bus å¯¹è±¡çš„è·¯å¾„ï¼Œå¦‚æœæ ¹æœ¬æ²¡æœ‰å…³è”ï¼Œåˆ™ä¸ºâ€œ&#x2F;â€</td>
</tr>
<tr>
<td>object CurrentNetwork</td>
<td>read</td>
<td>è¡¨ç¤º wpa_supplicant å½“å‰ä½¿ç”¨çš„é…ç½®ç½‘ç»œçš„ D-Bus å¯¹è±¡çš„è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ™ä¸ºâ€œ&#x2F;â€</td>
</tr>
<tr>
<td>string CurrentAuthMode</td>
<td>read</td>
<td>å½“å‰èº«ä»½éªŒè¯ç±»å‹</td>
</tr>
<tr>
<td>array{string} Blobs</td>
<td>read</td>
<td>æ·»åŠ åˆ°ç•Œé¢çš„ blob åç§°åˆ—è¡¨</td>
</tr>
<tr>
<td>array{object} BSSs</td>
<td>read</td>
<td>ä»£è¡¨æ¥å£å·²çŸ¥çš„ BSS çš„ D-Bus å¯¹è±¡è·¯å¾„åˆ—è¡¨ï¼Œä¾‹å¦‚æ‰«æç»“æœ</td>
</tr>
<tr>
<td>array{object} Networks</td>
<td>read</td>
<td>ä»£è¡¨å·²é…ç½®ç½‘ç»œçš„ D-Bus å¯¹è±¡è·¯å¾„åˆ—è¡¨</td>
</tr>
<tr>
<td>bool FastReauth</td>
<td>readwrite</td>
<td>ä¸ wpa_supplicant é…ç½®æ–‡ä»¶ä¸­çš„ fast_reauth æ¡ç›®ç›¸åŒ</td>
</tr>
<tr>
<td>int32 ScanInterval</td>
<td>readwrite</td>
<td>æ‰«æåˆé€‚ AP çš„é—´éš”æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚å¿…é¡» &gt;&#x3D; 0</td>
</tr>
<tr>
<td>string PKCS11EnginePath</td>
<td>read</td>
<td>PKCS #11 å¼•æ“è·¯å¾„</td>
</tr>
<tr>
<td>string PKCS11ModulePath</td>
<td>read</td>
<td>PKCS #11 æ¨¡å—è·¯å¾„</td>
</tr>
<tr>
<td>int32 DisconnectReason</td>
<td>read</td>
<td>æœ€è¿‘çš„ IEEE 802.11 æ–­å¼€è¿æ¥åŸå› ä»£ç ã€‚è´Ÿå€¼è¡¨ç¤ºæœ¬åœ°ç”Ÿæˆçš„æ–­å¼€è¿æ¥</td>
</tr>
</tbody></table>
<p><strong>ä¿¡å·ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ä¿¡å·åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>ScanDone ( b : success )</td>
<td>æ‰«æå®Œæˆ</td>
</tr>
<tr>
<td>BSSAdded ( o : BSS, a{sv} : properties )</td>
<td>BSSæ–°å¢</td>
</tr>
<tr>
<td>BSSRemoved ( o : BSS )</td>
<td>BSSç§»é™¤</td>
</tr>
<tr>
<td>BlobAdded ( s : blobName )</td>
<td>blobæ–°å¢</td>
</tr>
<tr>
<td>BlobRemoved ( s : blobName )</td>
<td>blobç§»é™¤</td>
</tr>
<tr>
<td>NetworkAdded ( o : network, a{sv} : properties )</td>
<td>networkæ–°å¢</td>
</tr>
<tr>
<td>NetworkRemoved ( o : network )</td>
<td>networkç§»é™¤</td>
</tr>
<tr>
<td>NetworkSelected ( o : network )</td>
<td>networké€‰æ‹©</td>
</tr>
<tr>
<td>StaAuthorized ( s : mac )</td>
<td>å·²æˆæƒæ–°ç«™ä½¿ç”¨æ¥å£</td>
</tr>
<tr>
<td>StaDeauthorized ( s : mac )</td>
<td>å·²å–æ¶ˆå¯¹æŸä¸ªç«™çš„æ¥å£æˆæƒ</td>
</tr>
<tr>
<td>PropertiesChanged ( a{sv} : properties )</td>
<td>ä¸€äº›å±æ€§æœ‰æ”¹å˜</td>
</tr>
<tr>
<td>Certification ( a{sv} : parameters )</td>
<td>æœ‰å…³æœåŠ¡å™¨ TLS è¯ä¹¦çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>EAP ( s : status, s : parameter )</td>
<td>æœ‰å…³ EAP å¯¹ç­‰çŠ¶æ€çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>NetworkRequest ( o : network, s : field, s : txt )</td>
<td>è¯·æ±‚ç½‘ç»œå‚æ•°ã€‚NetworkResponse() ç”¨äºæä¾›æ‰€è¯·æ±‚çš„å‚æ•°</td>
</tr>
<tr>
<td>ProbeRequest ( a{sv} : args )</td>
<td>æœ‰å…³å·²æ¥æ”¶æ¢æµ‹è¯·æ±‚å¸§çš„ä¿¡æ¯ã€‚æ­¤ä¿¡å·ä»…å‘é€ç»™å·²ä½¿ç”¨ SubscribeProbeReq() è®¢é˜…æ¥æ”¶äº‹ä»¶çš„å•ä¸ªåº”ç”¨ç¨‹åº</td>
</tr>
</tbody></table>
<h3 id="fi-w1-wpa-supplicant1-BSS"><a href="#fi-w1-wpa-supplicant1-BSS" class="headerlink" title="fi.w1.wpa_supplicant1.BSS"></a>fi.w1.wpa_supplicant1.BSS</h3><p>è¡¨ç¤ºå·²æ‰«æ BSSï¼ˆå³æ‰«æç»“æœï¼‰çš„å¯¹è±¡å®ç°çš„æ¥å£</p>
<p><strong>æ¥å£ä»‹ç»ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:Service: fi.w1.wpa_supplicant1</span><br><span class="line">:Interface: fi.w1.wpa_supplicant1.BSS</span><br><span class="line">:Object path: /fi/w1/wpa_supplicant1/Interfaces/index/BSSs/serial  (serial is 0ã€1ã€2 ...)</span><br></pre></td></tr></table></figure>



<p><strong>æ–¹æ³•ä»‹ç»:</strong></p>
<p>æ— </p>
<p><strong>å±æ€§ä»‹ç»:</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>array{byte} BSSID</td>
<td>read</td>
<td>BSSçš„BSSID</td>
</tr>
<tr>
<td>array{byte} SSID</td>
<td>read</td>
<td>BSSçš„SSID</td>
</tr>
<tr>
<td>array{string, variant} WPA</td>
<td>read</td>
<td>BSSçš„WPAä¿¡æ¯</td>
</tr>
<tr>
<td>array{string, variant} RSN</td>
<td>read</td>
<td>BSSçš„RSNä¿¡æ¯</td>
</tr>
<tr>
<td>array{string, variant} WPS</td>
<td>read</td>
<td>BSSçš„WPSä¿¡æ¯</td>
</tr>
<tr>
<td>array{byte} IEs</td>
<td>read</td>
<td>BSS çš„æ‰€æœ‰ IE ä½œä¸º TLV é“¾</td>
</tr>
<tr>
<td>bool Privacy</td>
<td>read</td>
<td>æŒ‡ç¤º BSS æ˜¯å¦æ”¯æŒéšç§</td>
</tr>
<tr>
<td>string Mode</td>
<td>read</td>
<td>æè¿° BSS çš„æ¨¡å¼</td>
</tr>
<tr>
<td>uint16 Frequency</td>
<td>read</td>
<td>BSS çš„é¢‘ç‡ï¼ˆMHzï¼‰</td>
</tr>
<tr>
<td>array{uint32} Rates</td>
<td>read</td>
<td>æŒ‰é™åºæ’åˆ—çš„ BSS æ”¯æŒçš„é€Ÿç‡ï¼ˆå•ä½ä¸ºæ¯”ç‰¹&#x2F;ç§’ï¼‰</td>
</tr>
<tr>
<td>int16 Signal</td>
<td>read</td>
<td>BSS ä¿¡å·å¼ºåº¦</td>
</tr>
<tr>
<td>uint32 Age</td>
<td>read</td>
<td>è‡ªä¸Šæ¬¡çœ‹åˆ° BSS ä»¥æ¥çš„ç§’æ•°</td>
</tr>
</tbody></table>
<p><strong>ä¿¡å·ä»‹ç»</strong></p>
<table>
<thead>
<tr>
<th>ä¿¡å·åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>PropertiesChanged ( a{sv} : properties )</td>
<td>ä¸€äº›å±æ€§å‘ç”Ÿäº†æ”¹å˜</td>
</tr>
</tbody></table>
<h3 id="fi-w1-wpa-supplicant1-Network"><a href="#fi-w1-wpa-supplicant1-Network" class="headerlink" title="fi.w1.wpa_supplicant1.Network"></a>fi.w1.wpa_supplicant1.Network</h3><p>ç”±ä»£è¡¨é…ç½®ç½‘ç»œçš„å¯¹è±¡å®ç°çš„æ¥å£ï¼Œå³ç”± fi.w1.wpa_supplicant1.Interface.AddNetwork è¿”å›ã€‚</p>
<p><strong>æ–¹æ³•ä»‹ç»ï¼š</strong></p>
<p>æ— </p>
<p><strong>å±æ€§ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>bool Enabled</td>
<td>readwrite</td>
<td>ç¡®å®šé…ç½®çš„ç½‘ç»œæ˜¯å¦å¯ç”¨</td>
</tr>
<tr>
<td>array{string,variant}</td>
<td>readwrite</td>
<td>wpa_supplicant é…ç½®æ–‡ä»¶çš„â€œç½‘ç»œâ€å—çš„æ¡ç›®</td>
</tr>
</tbody></table>
<p><strong>ä¿¡å·ä»‹ç»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ä¿¡å·åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>PropertiesChanged ( a{sv} : properties )</td>
<td>ä¸€äº›å±æ€§å‘ç”Ÿäº†æ”¹å˜</td>
</tr>
</tbody></table>
<h2 id="wpa-cli"><a href="#wpa-cli" class="headerlink" title="wpa_cli"></a>wpa_cli</h2><p>wpa_cliæ˜¯wpa_supplicantçš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥å®ç°WiFiçš„æ‰«æã€è¿æ¥ã€æ–­å¼€ã€ç§»é™¤ç­‰åŠŸèƒ½ã€‚</p>
<h2 id="å‚è€ƒä¿¡æ¯"><a href="#å‚è€ƒä¿¡æ¯" class="headerlink" title="å‚è€ƒä¿¡æ¯"></a>å‚è€ƒä¿¡æ¯</h2><p><a href="https://wiki.archlinux.org/title/Wpa_supplicant">1ã€wpa_supplicant</a></p>
<p><a href="https://w1.fi/wpa_supplicant/devel/">2ã€wpa_supplicant &#x2F; hostapd</a></p>
<p><a href="https://w1.fi/wpa_supplicant/devel/dbus.html">3ã€wpa_supplicant å®˜æ–¹dbusæ¥å£æ–‡æ¡£</a></p>
<p><a href="https://www.cnblogs.com/chenbin7/p/3266164.html">4ã€wpa_supplicantæä¾›çš„æ¥å£</a></p>
<p><a href="https://android.googlesource.com/platform/external/wpa_supplicant_8/+/master/wpa_supplicant/examples/wpas-dbus-new.py">5ã€wpa_supplicant dbus api example using python</a></p>
<p><a href="https://kingtuo123.com/posts/wpa_supplicant/">6ã€ä½¿ç”¨ wpa_supplicant è¿æ¥æ— çº¿ç½‘ç»œ</a></p>
]]></content>
      <categories>
        <category>Wi-Fi</category>
      </categories>
      <tags>
        <tag>Wi-Fi</tag>
        <tag>wpa_supplicant</tag>
      </tags>
  </entry>
  <entry>
    <title>Blog deploy to Github Page.md</title>
    <url>/2024/08/11/2024/Blog-deploy-to-Github-Page/</url>
    <content><![CDATA[<blockquote>
<p>2024-08-11 æ˜ŸæœŸæ—¥ æ™´</p>
</blockquote>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><blockquote>
<p>å‰ç½®æ¡ä»¶ï¼š<br>1ã€æœ¬åœ°å¯ä»¥æ­£å¸¸è¿è¡Œhexo<br>2ã€å·²ç»å®‰è£…git<br>3ã€å·²ç»æ³¨å†Œäº†Githubè´¦å·</p>
</blockquote>
<p>é¦–å…ˆéœ€è¦æ‹¿åˆ°Githubçš„ä»“åº“åŸŸåï¼Œæ¥ç€ä¸Šä¼ æœ¬åœ°çš„å…¬é’¥åˆ°Github</p>
<h3 id="è·å–åŸŸå"><a href="#è·å–åŸŸå" class="headerlink" title="è·å–åŸŸå"></a>è·å–åŸŸå</h3><p>åœ¨Githubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“å‘½åï¼š<code>eiSouthBoy.github.io</code>ï¼ŒeiSouthBoy æ˜¯ç”¨æˆ·åï¼Œæ ¹æ®è‡ªå·±å®é™…ç”¨æˆ·åä¿®æ”¹ï¼Œä»“åº“çš„å±æ€§é€‰æ‹©ï¼š<code>Public</code>ï¼Œæœ€åç‚¹å‡»åˆ›å»ºã€‚</p>
<p>æ­¤æ—¶ï¼Œåœ¨ eiSouthBoy.github.io ä»“åº“é¡µé¢ï¼Œè¿›å…¥åˆ°ä»“åº“çš„Settingsâ€“&gt;Pagesï¼Œå¯ä»¥çœ‹åˆ°Githubæä¾›çš„Github Pagesï¼Œç»™å‡ºäº†ç½‘å€ï¼š<code>Your site is live at https://eisouthboy.github.io/</code>ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€ç›´æ¥è®¿é—®çš„ã€‚</p>
<h3 id="ä¸Šä¼ å…¬é’¥"><a href="#ä¸Šä¼ å…¬é’¥" class="headerlink" title="ä¸Šä¼ å…¬é’¥"></a>ä¸Šä¼ å…¬é’¥</h3><p>å°†æœ¬åœ°çš„åšå®¢ä¸Šä¼ åˆ°Githubä¸Šï¼Œéœ€è¦ä½¿ç”¨Githubçš„å†™å…¥æƒé™ï¼Œæ‰€ä»¥éœ€è¦å°†æœ¬åœ°ç”¨æˆ·çš„å…¬é’¥ä¸Šä¼ åˆ°Githubã€‚</p>
<p>åˆ›å»ºå…¬é’¥å‰ï¼Œéœ€è¦é…ç½®gitçš„ç”¨æˆ·åå’Œé‚®ç®±</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ubuntu22.04å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it -u cj 52e0bd6293ac /usr/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /workspace/blog</span><br><span class="line">git config --global user.name=eiSouthBoy</span><br><span class="line">git config --global user.email=caoj97141@gmail.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>gitç”¨æˆ·åå’Œé‚®ç®±æ·»åŠ åï¼Œæ­¤æ—¶å¯ä»¥ç”Ÿæˆå…¬é’¥äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯¥å‘½ä»¤æœ‰äº¤äº’ï¼Œé»˜è®¤å…¨éƒ¨å›è½¦å³å¯</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œæç¤ºå…¬é’¥æ–‡ä»¶ä¿å­˜çš„è·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ ll ~/.ssh/</span><br><span class="line">total 28</span><br><span class="line">drwx------ 2 cj cj 4096 Aug 11 03:53 ./</span><br><span class="line">drwxr-x--- 1 cj cj 4096 Aug 11 07:57 ../</span><br><span class="line">-rw------- 1 cj cj 2602 Aug 11 03:48 id_rsa</span><br><span class="line">-rw-r--r-- 1 cj cj  569 Aug 11 03:48 id_rsa.pub</span><br></pre></td></tr></table></figure>

<p>å°†å…¬é’¥ä¿¡æ¯ä¸Šä¼ åˆ°Githubï¼Œå³å°†id_rsa.pubæ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°Githubçš„<strong>githubä¸ªäººå›¾åƒ â€“&gt; Settings â€“&gt; SSH and GPG Keys â€“&gt; New SSH Key</strong>ï¼Œç‚¹å‡»åˆ›å»ºï¼Œå°±ä¼šåˆ›å»ºSSH Keyä¿¡æ¯ã€‚è¯¥ä¿¡æ¯å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºäº†ä¸ä¿ç•™ä¸ªäººä¿¡æ¯ï¼ŒSHA256éšè—äº†å…³é”®ä¿¡æ¯ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac</span><br><span class="line">SHA256:*******************************************</span><br><span class="line">Added on Aug 11, 2024</span><br><span class="line">Last used within the last week â€” Read/write</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯• SSH æ˜¯å¦èƒ½è¿æ¥åˆ° GitHub çš„ SSH æœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<p>å‡ºç°å¦‚ä¸‹æç¤ºï¼Œå³è¯´æ˜æœ¬åœ°èƒ½å¤Ÿé€šè¿‡SSHè¿æ¥åˆ°Githubçš„SSHæœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Hi eiSouthBoy! You<span class="string">&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>é€šè¿‡gitæ–¹å¼ä¸Šä¼ åšå®¢åˆ°Githubï¼Œè¿˜éœ€è¦ä¸‹è½½ä¸€ä¸ªæ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>åœ¨éƒ¨ç½²å‰ï¼Œå¿…é¡»è¦ä¿®æ”¹ <code>/workspace/blog/_config.yml</code> æ–‡ä»¶ï¼Œä¿®æ”¹çš„éƒ¨åˆ†å†…å®¹æœ‰ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç¬¬ä¸€å¤„</span></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://eisouthboy.github.io</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ç¬¬äºŒå¤„</span></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:eiSouthBoy/eiSouthBoy.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥éƒ¨ç½²åˆ°Githubä¸Šäº†ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /workspace/blog</span><br><span class="line">hexo clean &amp;&amp; hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>è®°å½• <code>hexo d</code> å‘½ä»¤çš„è¿”å›ç»“æœä¿¡æ¯ (éé¦–æ¬¡æäº¤)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo d</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend <span class="built_in">dirs</span>...</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">Enumerating objects: 74, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (74/74), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (29/29), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (43/43), 21.26 KiB | 3.54 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 43 (delta 19), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (19/19), completed with 14 <span class="built_in">local</span> objects.</span><br><span class="line">To github.com:eiSouthBoy/eiSouthBoy.github.io.git</span><br><span class="line">   bbb8d53..60a542a  HEAD -&gt; main</span><br><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;main&#x27;</span> from <span class="string">&#x27;git@github.com:eiSouthBoy/eiSouthBoy.github.io.git&#x27;</span>.</span><br><span class="line">INFO  Deploy <span class="keyword">done</span>: git</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥åœ¨å®¿ä¸»æœºçš„æµè§ˆå™¨è¾“å…¥ï¼š<code>https://eisouthboy.github.io</code> è®¿é—®åšå®¢ã€‚</p>
<h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½é‡åˆ°ä¸€äº›æŠ¥é”™æˆ–è€…ç–‘ç‚¹ï¼Œå¸Œæœ›è®°å½•ä¸‹æ¥ã€‚ç”¨äºæé†’è‡ªå·±ï¼Œè¿˜å¯ä»¥æé†’åæ¥äººã€‚</p>
<h3 id="ç–‘ç‚¹1"><a href="#ç–‘ç‚¹1" class="headerlink" title="ç–‘ç‚¹1"></a>ç–‘ç‚¹1</h3><p>åœ¨æ‰§è¡Œ <code>hexo d</code> å‘½ä»¤æ—¶ï¼Œæœ‰ä¸€å¥æé†’ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;main&#x27;</span> from <span class="string">&#x27;git@github.com:eiSouthBoy/eiSouthBoy.github.io.git&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°åˆ†æ”¯ master å»ºç«‹è·Ÿè¸ªåœ¨è¿œç¨‹åˆ†æ”¯mainä¸Šã€‚Githubä»2020å¹´10æœˆå¼€å§‹ï¼Œåˆ›å»ºä»“åº“çš„é»˜è®¤åˆ†æ”¯åï¼šmainï¼Œè‡³äºåŸå› å¯å‚è€ƒï¼š<a href="https://pages.carm.cc/doc/branch-main.html">ä¸ºä»€ä¹ˆGitåˆ†æ”¯å¼€å§‹ä»â€œmasterâ€å˜ä¸ºâ€œmainâ€äº†ï¼Ÿ</a></p>
<p>ä½†æ˜¯ <code>git init</code> åˆå§‹åŒ–ä¸€ä¸ªæœ¬åœ°ä»“åº“æ—¶ï¼Œé»˜è®¤çš„åˆ†æ”¯æ˜¯ï¼š<code>master</code>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ¬åœ°masteråˆ†æ”¯å’Œè¿œç¨‹mainåˆ†æ”¯åç§°ä¸ä¸€è‡´çš„åŸå› äº†ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æœ¬åœ°çš„masteråç§°ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /workspace/blog/.deploy_git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åˆ†æ”¯å</span></span><br><span class="line">git branch -m master main</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ†æ”¯ä¿¡æ¯</span></span><br><span class="line">git branch</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æœ¬åœ°åˆ†æ”¯åå·²ç»ä¿®æ”¹å®Œæˆäº†ï¼Œå†æ¬¡æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ ï¼ŒéªŒè¯ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo d</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend <span class="built_in">dirs</span>...</span><br><span class="line">[main 6aa2596] Site updated: 2024-08-11 10:04:48</span><br><span class="line"> 4 files changed, 28 insertions(+), 10 deletions(-)</span><br><span class="line">Enumerating objects: 21, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (21/21), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (7/7), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (11/11), 3.32 KiB | 1.66 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 11 (delta 5), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (5/5), completed with 5 <span class="built_in">local</span> objects.</span><br><span class="line">To github.com:eiSouthBoy/eiSouthBoy.github.io.git</span><br><span class="line">   60a542a..6aa2596  HEAD -&gt; main</span><br><span class="line">Branch <span class="string">&#x27;main&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;main&#x27;</span> from <span class="string">&#x27;git@github.com:eiSouthBoy/eiSouthBoy.github.io.git&#x27;</span>.</span><br><span class="line">INFO  Deploy <span class="keyword">done</span>: git</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°åˆ†æ”¯åå’Œè¿œç¨‹åˆ†æ”¯åä¸€è‡´äº†ã€‚</p>
]]></content>
      <tags>
        <tag>Github</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Create Blog with hexo</title>
    <url>/2024/08/10/2024/Create-Blog-with-hexo/</url>
    <content><![CDATA[<blockquote>
<p>2024-08-10 æ˜ŸæœŸå…­ æ™´</p>
</blockquote>
<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p>åœ¨å¤§å­¦æ—¶ï¼ˆ2015å¹´~2019å¹´ï¼‰ï¼Œæˆ‘è§‰å¾—æ­å»ºä¸€ä¸ªåšå®¢å¾ˆé…·çš„äº‹ã€‚è™½ç„¶è§‰å¾—å¾ˆé…·ï¼Œä½†æˆ‘ä»ç„¶æ²¡æœ‰å»å®ç°è¿™ä¸ªå¾ˆé…·çš„äº‹ã€‚ç›´åˆ°ä¸‰å¹´åï¼Œæˆ‘å°è¯•äº†å»æ­å»ºä¸ªäººåšå®¢ç«™ç‚¹ï¼Œä½†æ˜¯å¯¹äºæˆ‘éš¾åº¦ç¡®å®ä¸å°ï¼ˆçŸ¥è¯†å‚¨å¤‡ä¸è¶³ï¼‰ï¼Œå¤±è´¥å¹¶ææµ…äº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆå‡ å¹´åçš„ä»Šå¤©ï¼Œæˆ‘åˆå°è¯•å»æ­å»ºä¸ªäººåšå®¢å‘¢ï¼Ÿ ä¸€æ–¹é¢ï¼Œæˆ‘çœ‹åˆ°åšå®¢å›­è¿‘ä¸¤å¹´æ¥å±æœºä¸æ–­ï¼Œè€Œæˆ‘å½“åˆä¸ºäº†å¯»æ±‚æ–¹ä¾¿ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨åšå®¢å›­è®°å½•è‡ªå·±çš„ä¸œè¥¿ã€‚å½“ç„¶ï¼Œæˆ‘ä¹Ÿå¸Œæœ›åšå®¢å›­èƒ½å°½å¿«èµ°å‡ºå±æœºï¼Œå‡†å¤‡å»ä¹°ä¸€ä»¶åšå®¢å›­çš„å‘¨è¾¹Tæ¤ï¼Œæƒå½“èµåŠ©åšå®¢å›­ã€‚ä½†ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œåªèƒ½åšåˆ°è¿™ç‚¹å¸®åŠ©ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦åšå®¢å›­æ‰¾åˆ°è‡ªå·±çš„è¿è¥æ¨¡å¼ï¼Œæ¯•ç«Ÿå•çº¯ä¾é ç²‰ä¸æ”¯æ´å’ŒèµåŠ©åªèƒ½è§£å†³ä¸€æ—¶å›°å¢ƒã€‚å¦ä¸€æ–¹é¢ï¼Œéšç€è¿™å‡ å¹´çš„æŠ€æœ¯ç»éªŒçš„ç§¯ç´¯ï¼Œå®Œå…¨æœ‰ä¿¡å¿ƒæŠŠåšå®¢æ­å»ºèµ·æ¥ã€‚<br>é¸¡è›‹ä¸èƒ½æ”¾åœ¨åŒä¸€ä¸ªç¯®å­é‡Œï¼Œåœ¨åšå®¢å›­å­˜æ”¾ä¸€ä»½ï¼ŒGithubä¹Ÿè¦å­˜æ”¾ä¸€ä»½ï¼Œå½“ç„¶åœ¨æœ¬åœ°ä¸»æœºä¸Šè¿˜æ˜¯è¦å­˜æ”¾ä¸€ä»½ã€‚è¿™æ ·å­å°±æ¯”è¾ƒä¿é™©äº†ï¼Œæ¯•ç«Ÿæ•°æ®æ˜¯æ— ä»·çš„ã€‚</p>
<h2 id="é€‰å‹"><a href="#é€‰å‹" class="headerlink" title="é€‰å‹"></a>é€‰å‹</h2><p>æ­å»ºåšå®¢çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼šWordPressã€huogoã€hexoç­‰ç­‰ã€‚ä½†æ˜¯æˆ‘å¿…é¡»å¯»æ±‚ä¸€ç§é€‚åˆæˆ‘çš„æ­å»ºæ–¹å¼ï¼Œæˆ‘çš„è¦æ±‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ”¯æŒmarkdown<br>  æˆ‘ä¹ æƒ¯äºäº†ä½¿ç”¨markdownå†™ä¸œè¥¿ï¼Œç”¨èµ·æ¥æ–¹ä¾¿ã€å¿«æ·ã€‚</li>
<li>ç®€å•ä¸”æ˜“ç”¨<br>  æˆ‘å¸Œæœ›èƒ½å¤Ÿé€šè¿‡ç®€å•çš„å‘½ä»¤è¡Œå°±èƒ½å¤Ÿéƒ¨ç½²èµ·æ¥</li>
<li>æ”¯æŒGithub<br>  æˆ‘æœ‰ä½¿ç”¨Githubçš„ä¹ æƒ¯ï¼Œä¸€äº›å­¦ä¹ çš„é¡¹ç›®ä¼šä¸Šä¼ åˆ°Github</li>
<li>å¼€æº<br>  æˆ‘ä¹ æƒ¯ä½¿ç”¨å¼€æºçš„ä¸œè¥¿ï¼Œæ”¯æŒè‡ªå®šä¹‰å¾ˆå¤šä¸œè¥¿</li>
</ul>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„æŒ‘é€‰ï¼ŒhexoåŸºæœ¬ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œè€Œä¸”ç”Ÿæ€ä¹Ÿæ¯”è¾ƒå¥½ï¼Œå‡ºç°é—®é¢˜ä¹Ÿå®¹æ˜“è§£å†³ï¼Œæˆ‘å†³å®šä½¿ç”¨hexoæ­å»ºä¸ªäººåšå®¢ç«™ç‚¹ã€‚	</p>
<h2 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h2><blockquote>
<p>æ­å»ºç¯å¢ƒï¼š<br>1ã€ubuntu22.04å®¹å™¨<br>2ã€npm (v8.5.1)<br>3ã€node (v12.22.9)<br>4ã€git (v2.34.1)</p>
</blockquote>
<p>æˆ‘çš„ç”µè„‘ç³»ç»Ÿæ˜¯Ubuntu22.04ï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº†Dockerã€‚æˆ‘ä¸å¸Œæœ›hexoçš„ç¯å¢ƒå½±å“åˆ°æˆ‘çš„Ubuntu22.04ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘å†³å®šé€šè¿‡Dockeråˆ›å»ºUbuntu22.04å®¹å™¨æ¥ä½œä¸ºæ­å»ºåšå®¢çš„ç¯å¢ƒã€‚åŒæ—¶ï¼Œæˆ‘å­¦ä¹ DockeræŠ€æœ¯çš„æ—¶é—´ä¹Ÿå°±ä¸€å‘¨å·¦å³ï¼Œä¹Ÿèƒ½é€šè¿‡æ­å»ºåšå®¢çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ å¼ºå¯¹Dockerçš„ä½¿ç”¨å’Œç†è§£ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p>
<h3 id="æ‹‰å–ubuntu22-04é•œåƒ"><a href="#æ‹‰å–ubuntu22-04é•œåƒ" class="headerlink" title="æ‹‰å–ubuntu22.04é•œåƒ"></a>æ‹‰å–ubuntu22.04é•œåƒ</h3><p>é¦–å…ˆï¼Œæœç´¢ä¸€ä¸‹é•œåƒæºæ˜¯å¦å­˜åœ¨ubuntu22.04é•œåƒï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š <code>docker search ubuntu:22.04</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">caojun@caojun-NMH-WCX9:~/07-docker$ docker search ubuntu:22.04</span><br><span class="line">NAME                                              DESCRIPTION                                     STARS     OFFICIAL</span><br><span class="line">ubuntu                                            Ubuntu is a Debian-based Linux operating sysâ€¦   17202     [OK]</span><br><span class="line">ubuntu-debootstrap                                DEPRECATED; use <span class="string">&quot;ubuntu&quot;</span> instead                52        [OK]</span><br><span class="line">ubuntu-upstart                                    DEPRECATED, as is Upstart (find other procesâ€¦   115       [OK]</span><br><span class="line">apache/cassandra-testing-ubuntu2004-java11        https://github.com/apache/cassandra-builds/tâ€¦   2         </span><br><span class="line">antrea/antrea-ubuntu-arm64                                                                        2         </span><br><span class="line">osrf/ubuntu_i386                                  Ubuntu i386 Docker Base Images                  2         </span><br><span class="line">istio/app_sidecar_base_ubuntu_xenial              Image <span class="keyword">for</span> testing                               0         </span><br><span class="line">istio/app_sidecar_ubuntu_jammy                    Image <span class="keyword">for</span> testing                               0         </span><br><span class="line">envoyproxy/envoy-build-ubuntu                                                                     7         </span><br><span class="line">eclipse/ubuntu_jdk8                               Ubuntu, JDK8, Maven 3, git, curl, nmap, mc, â€¦   17        </span><br><span class="line">osrf/ubuntu_arm64                                 Ubuntu Arm64 Base Images                        1         </span><br><span class="line">dokken/ubuntu-20.04                               Ubuntu 20.04 image <span class="keyword">for</span> use with Test Kitchenâ€¦   3         </span><br><span class="line">opensciencegrid/osgvo-ubuntu-18.04                OSG VO<span class="string">&#x27;s base Ubuntu 18.04 image                0         </span></span><br><span class="line"><span class="string">dokken/ubuntu-18.04                               Ubuntu 18.04 image for use with Test Kitchenâ€¦   5         </span></span><br><span class="line"><span class="string">fnndsc/ubuntu-python3                             A slim Ubuntu-based Python3 image               33        </span></span><br><span class="line"><span class="string">apache/cassandra-ubuntu2004_test                  Apache Cassandra                                0         </span></span><br><span class="line"><span class="string">jenkinsciinfra/jenkins-agent-ubuntu-20.04         &quot;All-in-one&quot; agent image for the Jenkins Infâ€¦   1         </span></span><br><span class="line"><span class="string">antrea/ubuntu                                                                                     1         </span></span><br><span class="line"><span class="string">dokken/ubuntu-22.04                               Ubuntu 22.04 image for use with Test Kitchenâ€¦   3         </span></span><br><span class="line"><span class="string">antrea/base-ubuntu                                                                                1         </span></span><br><span class="line"><span class="string">ubuntu/cortex                                     Cortex provides storage for Prometheus. Longâ€¦   4         </span></span><br><span class="line"><span class="string">jenkinsciinfra/jenkins-agent-ubuntu-22.04         &quot;All-in-one&quot; agent image for the Jenkins Infâ€¦   0         </span></span><br><span class="line"><span class="string">gmao/ubuntu20-geos-env                                                                            0         </span></span><br><span class="line"><span class="string">dokken/ubuntu-16.04                               Ubuntu 16.04 image for use with Test Kitchenâ€¦   2         </span></span><br><span class="line"><span class="string">pytorch/pytorch-binary-docker-image-ubuntu16.04                                                   6    </span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°é•œåƒæºåŒ…æ‹¬äº†ï¼šubuntu:18.04 ã€ubuntu:20.04 ã€ubuntu:22.04ã€‚ç›´æ¥æ‹‰å–é•œåƒåˆ°æœ¬åœ°ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š <code>docker pull ubuntu22.04</code><br>æ‹‰å–æˆåŠŸåï¼Œå¯ä»¥åœ¨æœ¬åœ°æŸ¥çœ‹æ‰€æœ‰é•œåƒï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>docker images</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">caojun@caojun-NMH-WCX9:~/07-docker$ docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">ubuntu        22.04     8a3cdc4d1ad3   6 weeks ago     77.9MB</span><br><span class="line">ubuntu        20.04     5f5250218d28   2 months ago    72.8MB</span><br><span class="line">hello-world   latest    d2c94e258dcb   15 months ago   13.3kB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šè¿°çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ‹‰å–çš„ubuntu22.04é•œåƒåªæœ‰77.9MBã€‚å¾ˆå¤šåŸºç¡€å·¥å…·è½¯ä»¶éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æœ‰å¿…è¦å®‰è£…å¹¶é…ç½®ä¸€ä¸‹åŸºç¡€ç¯å¢ƒï¼Œä½†æ˜¯å…ˆè¦å®¿ä¸»æœºä¸Šé…ç½®ä¸€äº›ä¸œè¥¿ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºäº†å®¹å™¨æ˜ å°„å·ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/07-docker/blog-ubuntu22_04</span><br><span class="line"><span class="built_in">cd</span> ~/07-docker/blog-ubuntu22_04</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¿ä¸»æœºé˜²ç«å¢™å¼€æ”¾8110ç«¯å£ï¼Œå…ˆæŸ¥ä¸€ä¸‹8110ç«¯å£æ˜¯å¦è¢«å ç”¨</span></span><br><span class="line"><span class="comment"># è‹¥æ²¡æœ‰è¢«å ç”¨ï¼Œå°±ç”¨8110æ¥åšæ˜ å°„</span></span><br><span class="line">netstat -ap | grep 8110</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²ç«å¢™å¼€æ”¾8110</span></span><br><span class="line">ufw <span class="built_in">enable</span></span><br><span class="line">ufw allow 8110</span><br><span class="line">ufw status</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼Œimage_id=8a3cdc4d1ad3</span></span><br><span class="line">docker run -itd -p 127.0.0.1:8110:4000 -e LANG=C.utf8 -e LC_ALL=C.utf8 --restart=always -v <span class="variable">$PWD</span>:/workspace -u 1000 --security-opt seccomp=unconfined 8a3cdc4d1ad3</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>å®Œæˆå®¿ä¸»æœºä¸Šçš„ä¸€äº›åŸºæœ¬é…ç½®åï¼Œå¯ä»¥è¿›å…¥ubuntu22.04å®¹å™¨é…ç½®ç¯å¢ƒäº†ã€‚é¦–æ¬¡è¿›å…¥ubuntu22.04å®¹å™¨è¿˜æ˜¯è¦æŠŠåŸºç¡€ç¯å¢ƒæ­èµ·æ¥ï¼Œä¸ç„¶ä½¿ç”¨èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ubuntu22.04å®¹å™¨ï¼Œcontainer_id=52e0bd6293ac</span></span><br><span class="line">docker <span class="built_in">exec</span> -it -u root 52e0bd6293ac /usr/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºrootç”¨æˆ·åˆ›å»ºå¯†ç </span></span><br><span class="line">passwd root</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ™®é€šç”¨æˆ·cj</span></span><br><span class="line">useradd -u 1000 -m -s /usr/bin/bash cj</span><br><span class="line">passwd cj</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·cj</span></span><br><span class="line">su cj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°aptæºå’Œå‡çº§æœ¬åœ°è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…åŸºç¡€å·¥å…·è½¯ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y git net-tools iputils-ping build-essential vim <span class="built_in">sudo</span> curl</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢åŸºæœ¬ç¯å¢ƒæ­å»ºèµ·æ¥åï¼Œå‘ç°æœ‰ä¸¤ä¸ªå°é—®é¢˜ï¼š</p>
<ul>
<li>cjç”¨æˆ·æ— æ³•ä½¿ç”¨sudo</li>
<li>gitå‘½ä»¤æ— æ³•è‡ªåŠ¨è¡¥å…¨</li>
</ul>
<p><strong>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</strong></p>
<p>åœ¨ <code>/etc/sudoers</code> æ–‡ä»¶ä¸­ï¼ŒæŠŠcjçš„æƒé™æ·»åŠ è¿›å»ï¼Œå¯¹äºæ•´ä¸ªæ–‡ä»¶ä»…æ–°å¢ä¸€è¡Œå³å¯ã€‚<br>ç”±äº <code>/etc/sudoers</code> æ–‡ä»¶çš„æƒé™æ˜¯ï¼š440ï¼Œæ‰€ä»¥å…ˆä¿®æ”¹æ–‡ä»¶æƒé™æ‰èƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>sudo chmod 640 /etc/sudoers</code></p>
<p>æ‰“å¼€æ–‡ä»¶ï¼Œæ‰§è¡Œï¼š<code>vim /etc/sudoers</code>ï¼Œæ–°å¢ä¸€è¡Œï¼š<code>cj	ALL=(ALL:ALL) ALL</code>ï¼Œç»™å‡ºä¿®æ”¹åçš„éƒ¨åˆ†å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çœç•¥...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User privilege specification</span></span><br><span class="line">root	ALL=(ALL:ALL) ALL</span><br><span class="line">cj	ALL=(ALL:ALL) ALL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çœç•¥...</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å¹¶ä¿å­˜æ–‡ä»¶ï¼Œéœ€è¦å°†è¯¥æ–‡ä»¶çš„æƒé™ä¿®æ”¹å›æ¥ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>sudo chmod 440 /etc/sudoers</code></p>
<p><strong>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼š</strong></p>
<p>ubuntu22.04å®¹å™¨æ²¡æœ‰æ¿€æ´»gitçš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬ï¼Œæ‰€ä»¥gitç›¸å…³çš„å‘½ä»¤éƒ½æ— æ³•è‡ªåŠ¨è¡¥å…¨ã€‚<br>æ¿€æ´»gitè‡ªåŠ¨è¡¥å…¨è„šæœ¬ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>source /usr/share/bash-completion/completions/git</code></p>
<p>è‡³æ­¤ï¼Œubuntu22.04å®¹å™¨çš„åŸºæœ¬ç¯å¢ƒå‡†å¤‡å®Œæˆäº†ï¼Œå¯ä»¥è¿›å…¥åˆ°ä¸‹ä¸€æ­¥ã€‚</p>
<h3 id="å®‰è£…hexo"><a href="#å®‰è£…hexo" class="headerlink" title="å®‰è£…hexo"></a>å®‰è£…hexo</h3><p>å®‰è£…hexo</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°aptæº</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½hexoçš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt intall node npm</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½hexo</span></span><br><span class="line"><span class="built_in">sudo</span> npm install -g hexo-cli</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>hexoå®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>hexo -v</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo -v</span><br><span class="line">INFO  Validating config</span><br><span class="line">hexo: 7.3.0</span><br><span class="line">hexo-cli: 4.3.2</span><br><span class="line">os: linux 6.5.0-45-generic Ubuntu 22.04.4 LTS 22.04.4 LTS (Jammy Jellyfish)</span><br><span class="line">node: 12.22.9</span><br><span class="line">v8: 7.8.279.23-node.56</span><br><span class="line">uv: 1.43.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.9</span><br><span class="line">ares: 1.18.1</span><br><span class="line">modules: 72</span><br><span class="line">nghttp2: 1.43.0</span><br><span class="line">napi: 8</span><br><span class="line">llhttp: 2.1.6</span><br><span class="line">http_parser: 2.9.4</span><br><span class="line">openssl: 1.1.1m</span><br><span class="line">cldr: 40.0</span><br><span class="line">icu: 70.1</span><br><span class="line">tz: 2021a3</span><br><span class="line">unicode: 14.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>é€šè¿‡hexoåˆå§‹åŒ–ä¸€ä¸ªåšå®¢ç«™ç‚¹ï¼Œåœ¨æœ¬åœ°è¿è¡Œåšå®¢ç«™ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºåšå®¢åˆ›å»ºæ ¹ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /workspace/blog</span><br><span class="line"><span class="built_in">cd</span> /workspace/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–åšå®¢</span></span><br><span class="line">hexo init</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œåšå®¢ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-pæŒ‡å®šç«¯å£ï¼Œé»˜è®¤ç«¯å£æ˜¯4000</span></span><br><span class="line">hexo s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œï¼š<code>hexo s</code> æ—¶ä¼šå¤±è´¥ï¼Œæç¤ºå¦‚ä¸‹æŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;% extends â€˜_layout.swigâ€˜ %&#125; &#123;% import â€˜_macro/post.swigâ€˜ as post_template %&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡åœ¨ç½‘ä¸ŠæŸ¥æ‰¾ï¼Œå‘ç°hexoç¼ºå°‘äº†swigæ¨¡å—ï¼Œç°åœ¨å°†è¯¥æ¨¡å—ä¸‹è½½åˆ°æœ¬åœ°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /workspace/blog</span><br><span class="line">npm i hexo-renderer-swig</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è¿è¡Œåšå®¢ï¼Œå¯ä»¥çœ‹ä¸‹å¦‚ä¸‹æç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cj@52e0bd6293ac:/workspace/blog$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">WARN  ===============================================================</span><br><span class="line">WARN  ========================= ATTENTION! ==========================</span><br><span class="line">WARN  ===============================================================</span><br><span class="line">WARN   NexT repository is moving here: https://github.com/theme-next </span><br><span class="line">WARN  ===============================================================</span><br><span class="line">WARN   It<span class="string">&#x27;s rebase to v6.0.0 and future maintenance will resume there</span></span><br><span class="line"><span class="string">WARN  ===============================================================</span></span><br><span class="line"><span class="string">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å·²ç»æˆåŠŸäº†ï¼Œå¯ä»¥åœ¨ubuntu22.04å®¹å™¨å†…è®¿é—®ï¼š<code>http://localhost:4000/</code>ï¼Œå¯ä»¥é€šè¿‡curlå»è®¿é—®åšå®¢ï¼Œä½†æ˜¯è¿™æ²¡æ³•æ¸²æŸ“ã€‚ubuntu22.04å®¹å™¨åˆæ²¡æœ‰æµè§ˆå™¨ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡å®¿ä¸»æœºçš„æµè§ˆå™¨å»è®¿é—®åšå®¢ï¼Œåœ¨åˆ›å»ºubuntu22.04å®¹å™¨æ—¶ï¼Œå°±å·²ç»åšäº†ç«¯å£æ˜ å°„ï¼š<code>-p 127.0.0.1:8110:4000</code>ï¼Œæ‰€ä»¥å®¿ä¸»æœºè®¿é—® <code>http://localhost:8110</code> å°±æ˜¯è®¿é—®ubuntu22.04å®¹å™¨ <code>http://localhost:4000</code>ã€‚æ‰€ä»¥ï¼Œç›´æ¥åœ¨å®¿ä¸»æœºçš„æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š<code>http://localhost:8110</code> å³å¯çœ‹åˆ°åšå®¢å†…å®¹ã€‚</p>
<p>è‡³æ­¤ï¼Œåœ¨ubuntu22.04å®¹å™¨ä¸ŠåŸºäºhexoæ­å»ºä¸ªäººåšå®¢å°±å®Œæˆäº†ã€‚åç»­è¿˜ä¼šä¿®æ”¹åšå®¢çš„ä¸»é¢˜ï¼ˆé€‰æ‹©ï¼šnextä¸»é¢˜ï¼‰ï¼Œå¹¶å¯¹nextä¸»é¢˜è‡ªå®šä¹‰ä¿®æ”¹ï¼Œä»¥åŠéƒ¨ç½²åˆ°Githubã€‚</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>Blog</tag>
        <tag>hexo-theme-next</tag>
      </tags>
  </entry>
</search>
